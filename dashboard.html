<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CipherHall | Personalized Cybersecurity Dashboard</title>
    <meta
      name="description"
      content="Access your CipherHall dashboard, track courses, achievements, and professional certificates in cybersecurity."
    />
    <meta
      name="keywords"
      content="cybersecurity, online courses, ethical hacking, penetration testing, malware analysis, digital forensics, SOC, security certifications"
    />
    <meta name="author" content="CipherHall" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />

    <link rel="canonical" href="https://www.cipherhall.com/dashboard.html" />
    <meta name="robots" content="noindex, nofollow">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Exo+2:wght@700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "ProfilePage",
        "name": "Personalized Cybersecurity Dashboard | CipherHall",
        "description": "Access your personalized CipherHall dashboard to track your cybersecurity course progress, view unlocked achievements, and manage professional certificates.",
        "url": "https://www.cipherhall.com/dashboard.html",
        "isPartOf": {
          "@type": "EducationalOrganization",
          "name": "CipherHall",
          "url": "https://www.cipherhall.com/"
        },
        "mainEntity": {
          "@type": "Person",
          "name": "CipherHall User",
          "description": "A registered student of CipherHall, tracking their learning journey in cybersecurity.",
          "alumniOf": {
            "@type": "EducationalOrganization",
            "name": "CipherHall"
          },
          "hasCredential": [
            {
              "@type": "EducationalOccupationalCredential",
              "name": "Penetration Testing Expert"
            },
            {
              "@type": "EducationalOccupationalCredential",
              "name": "Cloud Security Professional"
            },
            {
              "@type": "EducationalOccupationalCredential",
              "name": "Malware Analysis Expert"
            },
            {
              "@type": "EducationalOccupationalCredential",
              "name": "Digital Forensics Master"
            }
          ]
        },
        "keywords": "cybersecurity dashboard, course progress, ethical hacking training, user profile, security achievements, professional certificates"
      }
    </script>
<link rel="stylesheet" href="assets/css/dashboard.css">
  </head>
  <body>
    <!-- Login Message -->
    <div id="loginMessage" class="login-message">
      <h2>Welcome to CipherHall</h2>
      <p>
        Please sign in to access your personalized dashboard and continue your
        cybersecurity journey.
      </p>
      <a href="/" class="login-btn">
        <i class="fas fa-sign-in-alt"></i>
        Sign In to Continue
      </a>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="/" class="logo">
          <i class="fas fa-shield-virus"></i>
          CipherHall
        </a>
      </div>

      <nav class="sidebar-nav">
        <a href="index.html" class="navlink">
          <i class="fas fa-home"></i>
          Home
        </a>
        <a href="AllCourses.html" class="navlink">
          <i class="fas fa-graduation-cap"></i>
          My Courses
        </a>
        <a
          href="#achievementsSection"
          class=" navlink"
          data-section="achievements"
        >
          <i class="fas fa-trophy"></i>
          Achievements
          <span class="achievement-count" id="unlockedCount">0</span>
        </a>
        <a href="Labs.html" class="navlink">
          <i class="fas fa-flask"></i>
          Lab Sessions
        </a>
        <a href="news.html" class="navlink">
          <i class="fas fa-chart-line"></i>
          News
        </a>
      </nav>

      <div class="sidebar-footer">
        <div class="user-profile">
          <div class="user-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div>
            <div id="userName">Loading...</div>
            <small id="userLevel">Beginner</small>
          </div>
        </div>
      </div>
    </aside>
    <div id="sidebarOverlay" class="sidebar-overlay"></div>
    <button class="menu-toggle" id="mobileMenuToggle">
      <i class="fas fa-bars"></i>
    </button>
    <!-- Main Content -->
    <main class="main-content">
      <header class="dashboard-header">
       <div class="welcome-section">
    <h1>Welcome back, <span id="welcomeName">Hacker</span>!</h1>
    <div class="user-rank-progress">
        <div class="rank-info">
            <span id="userRank">Script Kiddie</span>
            <span id="rankProgressText">0/1000 XP</span>
        </div>
        <div class="rank-progress-bar">
            <div id="rankProgressBarFill" class="rank-progress-bar-fill" style="width: 0%;"></div>
        </div>
    </div>
</div>
        <div class="header-actions">
          <button class="btn btn-secondary" id="settingsBtn">
            <i class="fas fa-cog"></i>
            Settings
          </button>
          <a href="/" class="btn btn-primary">
            <i class="fas fa-home"></i>
            Home
          </a>
        </div>
      </header>
<!-- ========== Start: New Resume Journey Section ========== -->
<section class="resume-journey-section" id="resumeJourneySection" style="display: none;">
    <!-- This section will be populated by JavaScript -->
</section>
<!-- ========== End: New Resume Journey Section ========== -->
      <!-- Stats Overview -->
      <section class="stats-overview">
        <div class="stat-card">
          <h3><i class="fas fa-star"></i>Total Points</h3>
          <div class="stat-value" id="totalPoints">0</div>
          <div class="stat-change">+50 this week</div>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-graduation-cap"></i>Courses Completed</h3>
          <div class="stat-value" id="completedCourses">0</div>
          <div class="stat-change">2 in progress</div>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-certificate"></i>Certificates Earned</h3>
          <div class="stat-value" id="totalCertificates">0</div>
          <div class="stat-change">Professional level</div>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-trophy"></i>Achievements Unlocked</h3>
          <div class="stat-value" id="totalAchievements">0</div>
          <div class="stat-change" id="achievementProgress">0/55 total</div>
        </div>
        <div class="stat-card">
          <h3><i class="fas fa-fire"></i>Current Streak</h3>
          <div class="stat-value" id="userStreak">0</div>
          <div class="stat-change">
            <span id="lastActivity">Last active: Today</span>
          </div>
        </div>
      </section>

      <!-- Certificate Packs -->
      <section class="certificate-packs">
        <h2>
          <i class="fas fa-certificate"></i>
          Professional Certificate Programs
        </h2>
        <div id="packGrid" class="pack-grid">
          <!-- Certificate packs will be loaded dynamically -->
        </div>
      </section>

      <!-- Achievements Section -->
      <section class="achievements-section" id="achievementsSection">
        <div class="achievements-header">
          <h2>
            <i class="fas fa-trophy"></i>
            Achievements System
          </h2>
          <div class="achievement-stats">
            <div class="achievement-stat">
              <span class="achievement-stat-value" id="unlockedAchievements"
                >0</span
              >
              <span class="achievement-stat-label">Unlocked</span>
            </div>
            <div class="achievement-stat">
              <span class="achievement-stat-value" id="totalAchievementCount"
                >55</span
              >
              <span class="achievement-stat-label">Total</span>
            </div>
            <div class="achievement-stat">
              <span class="achievement-stat-value" id="achievementPoints"
                >0</span
              >
              <span class="achievement-stat-label">Points</span>
            </div>
          </div>
        </div>

        <div class="achievement-filters">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="unlocked">Unlocked</button>
          <button class="filter-btn" data-filter="locked">Locked</button>
          <button class="filter-btn" data-filter="common">Common</button>
          <button class="filter-btn" data-filter="rare">Rare</button>
          <button class="filter-btn" data-filter="epic">Epic</button>
          <button class="filter-btn" data-filter="legendary">Legendary</button>
          <button class="filter-btn" data-filter="mythic">Mythic</button>
        </div>

        <div id="achievementsGrid" class="achievements-grid">
          <!-- Achievements will be loaded dynamically -->
        </div>
      </section>
    </main>

    <!-- Achievement Notification -->
    <div id="achievementNotification" class="achievement-notification">
      <div class="notification-header">
        <div class="notification-icon" id="notificationIcon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="notification-content">
          <h3 id="notificationTitle">Achievement Unlocked!</h3>
          <p id="notificationDescription">Description here...</p>
        </div>
      </div>
      <div class="notification-reward" id="notificationReward">
        <i class="fas fa-coins"></i>
        <span id="notificationPoints">+100 Points</span>
      </div>
    </div>

    <!-- Certificate Name Modal -->
    <div id="certificateModal" class="certificate-modal">
      <div class="certificate-form">
        <button class="close-modal" onclick="closeCertificateModal()">
          <i class="fas fa-times"></i>
        </button>
        <h3>Generate Your Certificate</h3>
        <p>
          Congratulations! You've completed all courses in this program. Enter
          your full legal name as you'd like it to appear on your professional
          certificate.
        </p>

        <div class="form-group">
          <label for="certificateName">Full Legal Name</label>
          <input
            type="text"
            id="certificateName"
            placeholder="Enter your full legal name"
            maxlength="50"
          />
        </div>

        <div class="certificate-actions">
          <button class="btn-generate" onclick="generateCertificate()">
            <i class="fas fa-certificate"></i>
            Generate Certificate
          </button>
          <button class="btn-cancel" onclick="closeCertificateModal()">
            Cancel
          </button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeSettings()">
          <i class="fas fa-times"></i>
        </button>
        <h2>Account Settings</h2>

        <div class="settings-section">
          <h3>Profile Information</h3>
          <div class="form-group">
            <label for="settingsName">Full Name</label>
            <input
              type="text"
              id="settingsName"
              placeholder="Enter your full name"
            />
          </div>
          <div class="form-group">
            <label for="settingsEmail">Email</label>
            <input
              type="email"
              id="settingsEmail"
              placeholder="Enter your email"
              disabled
            />
          </div>
        </div>

        <div class="form-group">
          <button class="btn btn-primary" onclick="saveSettings()">
            <i class="fas fa-save"></i>
            Save Changes
          </button>
          <button class="btn btn-secondary" onclick="signOut()">
            <i class="fas fa-sign-out-alt"></i>
            Sign Out
          </button>
        </div>
      </div>
    </div>
    <!-- Hacking Loader -->
    <div class="loader-overlay" id="loaderOverlay">
      <div class="hacker-loader">
        <div class="terminal-window">
          <div class="terminal-header">
            <div class="terminal-buttons">
              <div class="terminal-button"></div>
              <div class="terminal-button"></div>
              <div class="terminal-button"></div>
            </div>
            <span>CipherHall Terminal</span>
          </div>
          <div class="terminal-content">
            <div class="matrix-bg" id="matrixBg"></div>
            <div class="loading-text" id="loadingText">
              > Initializing CipherHall..<br />
              > Loading course database...<br />
              > Establishing secure connection...<br />
              > Fetching user credentials...<br />
              > <span class="cursor"></span>
            </div>
          </div>
        </div>
        <div class="loading-spinner"></div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage"></span>
    </div>

    <script>
      // Supabase Configuration
      const supabaseUrl = "https://lzcmzulemfubjaksoqor.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6Y216dWxlbWZ1Ympha3NvcW9yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzM5MDgsImV4cCI6MjA3MDkwOTkwOH0.crhPH4YWtRsr1BJTpAQcmPbWSpwIWRbzoI4sRb2_fPI";
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      // Global State
      let currentUser = null;
      let userStats = {};
      let currentPackForCertificate = null;
      let userAchievements = [];
      let allAchievements = [];
      let currentSection = "dashboard";
      let streakTimer = null;
      let loadingMessages = [
        "> Initializing CipherHall...",
        "> Loading course database...",
        "> Establishing secure connection...",
        "> Fetching user credentials...",
        "> Decrypting course data...",
        "> Validating security protocols...",
        "> Loading user interface...",
        "> System ready!",
      ];

      const achievements = [
        // Getting Started (Common)
        {
          id: "first_login",
          name: "Welcome Aboard",
          description: "Log into CipherHall for the first time",
          icon: "fas fa-sign-in-alt",
          rarity: "common",
          category: "getting_started",
          points: 50,
          requirement: { type: "login_count", value: 1 },
        },
        {
          id: "profile_complete",
          name: "Identity Verified",
          description: "Complete your profile with full name and information",
          icon: "fas fa-user-check",
          rarity: "common",
          category: "getting_started",
          points: 100,
          requirement: { type: "profile_complete", value: 1 },
        },
        {
          id: "first_course_start",
          name: "Learning Initiated",
          description: "Start your first cybersecurity course",
          icon: "fas fa-play",
          rarity: "common",
          category: "getting_started",
          points: 75,
          requirement: { type: "course_started", value: 1 },
        },

        // Course Progress (Bronze to Gold)
        {
          id: "first_lesson",
          name: "First Steps",
          description: "Complete your first lesson",
          icon: "fas fa-baby",
          rarity: "bronze",
          category: "course_progress",
          points: 100,
          requirement: { type: "lessons_completed", value: 1 },
        },
        {
          id: "course_completion_1",
          name: "Course Crusher",
          description: "Complete your first course",
          icon: "fas fa-graduation-cap",
          rarity: "bronze",
          category: "course_progress",
          points: 200,
          requirement: { type: "courses_completed", value: 1 },
        },
        {
          id: "course_completion_5",
          name: "Knowledge Seeker",
          description: "Complete 5 courses",
          icon: "fas fa-book-reader",
          rarity: "silver",
          category: "course_progress",
          points: 500,
          requirement: { type: "courses_completed", value: 5 },
        },
        {
          id: "course_completion_10",
          name: "Learning Machine",
          description: "Complete 10 courses",
          icon: "fas fa-brain",
          rarity: "gold",
          category: "course_progress",
          points: 1000,
          requirement: { type: "courses_completed", value: 10 },
        },
        {
          id: "course_completion_25",
          name: "Master Student",
          description: "Complete 25 courses",
          icon: "fas fa-user-graduate",
          rarity: "epic",
          category: "course_progress",
          points: 2500,
          requirement: { type: "courses_completed", value: 25 },
        },

        // Streaks (Bronze to Legendary)
        {
          id: "streak_3",
          name: "Getting Consistent",
          description: "Maintain a 3-day learning streak",
          icon: "fas fa-fire",
          rarity: "bronze",
          category: "streaks",
          points: 150,
          requirement: { type: "streak_days", value: 3 },
        },
        {
          id: "streak_7",
          name: "Week Warrior",
          description: "Maintain a 7-day learning streak",
          icon: "fas fa-calendar-week",
          rarity: "silver",
          category: "streaks",
          points: 300,
          requirement: { type: "streak_days", value: 7 },
        },
        {
          id: "streak_14",
          name: "Fortnight Fighter",
          description: "Maintain a 14-day learning streak",
          icon: "fas fa-medal",
          rarity: "gold",
          category: "streaks",
          points: 700,
          requirement: { type: "streak_days", value: 14 },
        },
        {
          id: "streak_30",
          name: "Monthly Master",
          description: "Maintain a 30-day learning streak",
          icon: "fas fa-crown",
          rarity: "rare",
          category: "streaks",
          points: 1500,
          requirement: { type: "streak_days", value: 30 },
        },
        {
          id: "streak_100",
          name: "Centurion",
          description: "Maintain a 100-day learning streak",
          icon: "fas fa-crown",
          rarity: "epic",
          category: "streaks",
          points: 5000,
          requirement: { type: "streak_days", value: 100 },
        },
        {
          id: "streak_365",
          name: "Year Long Dedication",
          description: "Maintain a 365-day learning streak",
          icon: "fas fa-trophy",
          rarity: "legendary",
          category: "streaks",
          points: 10000,
          requirement: { type: "streak_days", value: 365 },
        },

        // Points (Silver to Mythic)
        {
          id: "points_1000",
          name: "First Thousand",
          description: "Earn 1,000 total points",
          icon: "fas fa-coins",
          rarity: "silver",
          category: "points",
          points: 200,
          requirement: { type: "total_points", value: 1000 },
        },
        {
          id: "points_5000",
          name: "Five Grand",
          description: "Earn 5,000 total points",
          icon: "fas fa-hand-holding-usd",
          rarity: "gold",
          category: "points",
          points: 500,
          requirement: { type: "total_points", value: 5000 },
        },
        {
          id: "points_10000",
          name: "Ten Thousand Club",
          description: "Earn 10,000 total points",
          icon: "fas fa-gem",
          rarity: "rare",
          category: "points",
          points: 1000,
          requirement: { type: "total_points", value: 10000 },
        },
        {
          id: "points_25000",
          name: "Point Collector",
          description: "Earn 25,000 total points",
          icon: "fas fa-treasure-chest",
          rarity: "epic",
          category: "points",
          points: 2500,
          requirement: { type: "total_points", value: 25000 },
        },
        {
          id: "points_50000",
          name: "Point Master",
          description: "Earn 50,000 total points",
          icon: "fas fa-crown",
          rarity: "legendary",
          category: "points",
          points: 5000,
          requirement: { type: "total_points", value: 50000 },
        },
        {
          id: "points_100000",
          name: "Point Overlord",
          description: "Earn 100,000 total points - Ultimate achievement",
          icon: "fas fa-infinity",
          rarity: "mythic",
          category: "points",
          points: 10000,
          requirement: { type: "total_points", value: 100000 },
        },

        // Certificates (Bronze to Legendary)
        {
          id: "first_certificate",
          name: "Certified Professional",
          description: "Earn your first professional certificate",
          icon: "fas fa-certificate",
          rarity: "bronze",
          category: "certificates",
          points: 300,
          requirement: { type: "certificates_earned", value: 1 },
        },
        {
          id: "certificate_collector",
          name: "Certificate Collector",
          description: "Earn 3 professional certificates",
          icon: "fas fa-scroll",
          rarity: "silver",
          category: "certificates",
          points: 750,
          requirement: { type: "certificates_earned", value: 3 },
        },
        {
          id: "all_certificates",
          name: "Master Certified",
          description: "Earn all 5 professional certificates",
          icon: "fas fa-award",
          rarity: "legendary",
          category: "certificates",
          points: 5000,
          requirement: { type: "certificates_earned", value: 5 },
        },

        // Speed Achievements (Rare to Epic)
        {
          id: "speed_demon_course",
          name: "Speed Demon",
          description: "Complete a course in under 2 hours",
          icon: "fas fa-rocket",
          rarity: "rare",
          category: "speed",
          points: 800,
          requirement: { type: "course_completion_time", value: 120 },
        },
        {
          id: "marathon_learner",
          name: "Marathon Learner",
          description: "Study for 8 hours in a single day",
          icon: "fas fa-running",
          rarity: "epic",
          category: "speed",
          points: 1200,
          requirement: { type: "daily_study_time", value: 480 },
        },

        // Skill-Specific Achievements (Silver to Legendary)
        {
          id: "ethical_hacker",
          name: "Ethical Hacker",
          description: "Complete all ethical hacking courses",
          icon: "fas fa-user-secret",
          rarity: "gold",
          category: "skills",
          points: 1500,
          requirement: {
            type: "category_completion",
            value: "ethical-hacking",
          },
        },
        {
          id: "network_guardian",
          name: "Network Guardian",
          description: "Complete all network security courses",
          icon: "fas fa-shield-alt",
          rarity: "gold",
          category: "skills",
          points: 1500,
          requirement: {
            type: "category_completion",
            value: "network-security",
          },
        },
        {
          id: "malware_hunter",
          name: "Malware Hunter",
          description: "Complete all malware analysis courses",
          icon: "fas fa-virus",
          rarity: "rare",
          category: "skills",
          points: 2000,
          requirement: { type: "category_completion", value: "malware" },
        },
        {
          id: "crypto_master",
          name: "Cryptography Master",
          description: "Complete all cryptography courses",
          icon: "fas fa-key",
          rarity: "rare",
          category: "skills",
          points: 2000,
          requirement: { type: "category_completion", value: "cryptography" },
        },

        // Social Achievements (Silver to Epic)
        {
          id: "first_forum_post",
          name: "Community Member",
          description: "Make your first forum post",
          icon: "fas fa-comments",
          rarity: "silver",
          category: "social",
          points: 200,
          requirement: { type: "forum_posts", value: 1 },
        },
        {
          id: "helpful_member",
          name: "Helpful Member",
          description: "Help 10 students in the forum",
          icon: "fas fa-hands-helping",
          rarity: "gold",
          category: "social",
          points: 1000,
          requirement: { type: "forum_helps", value: 10 },
        },
        {
          id: "mentor_status",
          name: "Mentor",
          description: "Achieve mentor status by helping 50+ students",
          icon: "fas fa-chalkboard-teacher",
          rarity: "epic",
          category: "social",
          points: 3000,
          requirement: { type: "forum_helps", value: 50 },
        },

        // Challenge Achievements (Gold to Mythic)
        {
          id: "first_lab_complete",
          name: "Lab Rat",
          description: "Complete your first hands-on lab",
          icon: "fas fa-flask",
          rarity: "gold",
          category: "challenges",
          points: 400,
          requirement: { type: "labs_completed", value: 1 },
        },
        {
          id: "ctf_champion",
          name: "CTF Champion",
          description: "Win a Capture The Flag competition",
          icon: "fas fa-flag",
          rarity: "epic",
          category: "challenges",
          points: 2500,
          requirement: { type: "ctf_wins", value: 1 },
        },
        {
          id: "hackathon_winner",
          name: "Hackathon Hero",
          description: "Win a cybersecurity hackathon",
          icon: "fas fa-trophy",
          rarity: "legendary",
          category: "challenges",
          points: 5000,
          requirement: { type: "hackathon_wins", value: 1 },
        },

        // Time-Based Achievements (Bronze to Legendary)
        {
          id: "night_owl",
          name: "Night Owl",
          description: "Study after midnight for 7 days",
          icon: "fas fa-moon",
          rarity: "bronze",
          category: "time_based",
          points: 300,
          requirement: { type: "midnight_sessions", value: 7 },
        },
        {
          id: "early_bird",
          name: "Early Bird",
          description: "Study before 6 AM for 7 days",
          icon: "fas fa-sun",
          rarity: "bronze",
          category: "time_based",
          points: 300,
          requirement: { type: "early_sessions", value: 7 },
        },
        {
          id: "weekend_warrior",
          name: "Weekend Warrior",
          description: "Study on 20 weekends",
          icon: "fas fa-calendar-plus",
          rarity: "silver",
          category: "time_based",
          points: 500,
          requirement: { type: "weekend_sessions", value: 20 },
        },

        // Special Achievements (Epic to Mythic)
        {
          id: "perfectionist",
          name: "Perfectionist",
          description: "Score 100% on 10 different assessments",
          icon: "fas fa-star",
          rarity: "epic",
          category: "special",
          points: 2000,
          requirement: { type: "perfect_scores", value: 10 },
        },
        {
          id: "comeback_kid",
          name: "Comeback Kid",
          description: "Return to learning after 30+ day break",
          icon: "fas fa-redo",
          rarity: "rare",
          category: "special",
          points: 1000,
          requirement: { type: "comeback_days", value: 30 },
        },
        {
          id: "beta_tester",
          name: "Beta Tester",
          description: "Test new features before public release",
          icon: "fas fa-vial",
          rarity: "legendary",
          category: "special",
          points: 3000,
          requirement: { type: "beta_tests", value: 1 },
        },
        {
          id: "founding_member",
          name: "Founding Member",
          description: "One of the first 100 academy members",
          icon: "fas fa-seedling",
          rarity: "mythic",
          category: "special",
          points: 10000,
          requirement: { type: "member_number", value: 100 },
        },

        // Exploration Achievements (Common to Rare)
        {
          id: "explorer",
          name: "Explorer",
          description: "Visit all sections of the academy",
          icon: "fas fa-compass",
          rarity: "common",
          category: "exploration",
          points: 150,
          requirement: { type: "sections_visited", value: 7 },
        },
        {
          id: "settings_customizer",
          name: "Settings Customizer",
          description: "Customize your profile settings",
          icon: "fas fa-cog",
          rarity: "common",
          category: "exploration",
          points: 100,
          requirement: { type: "settings_changed", value: 1 },
        },

        // Achievement Hunter Meta Achievements (Legendary to Mythic)
        {
          id: "achievement_hunter",
          name: "Achievement Hunter",
          description: "Unlock 25 achievements",
          icon: "fas fa-crosshairs",
          rarity: "legendary",
          category: "meta",
          points: 2500,
          requirement: { type: "achievements_unlocked", value: 25 },
        },
        {
          id: "completionist",
          name: "Completionist",
          description: "Unlock 40 achievements",
          icon: "fas fa-check-double",
          rarity: "mythic",
          category: "meta",
          points: 7500,
          requirement: { type: "achievements_unlocked", value: 40 },
        },
        {
          id: "ultimate_achiever",
          name: "Ultimate Achiever",
          description: "Unlock ALL achievements - The ultimate goal",
          icon: "fas fa-infinity",
          rarity: "mythic",
          category: "meta",
          points: 15000,
          requirement: { type: "achievements_unlocked", value: 55 },
        },

        // Seasonal/Holiday Achievements (Rare to Epic)
        {
          id: "new_year_learner",
          name: "New Year, New Skills",
          description: "Complete a course on New Year's Day",
          icon: "fas fa-calendar-star",
          rarity: "rare",
          category: "seasonal",
          points: 1000,
          requirement: { type: "holiday_learning", value: "new_year" },
        },
        {
          id: "halloween_hacker",
          name: "Halloween Hacker",
          description: "Complete a malware course on Halloween",
          icon: "fas fa-ghost",
          rarity: "epic",
          category: "seasonal",
          points: 1500,
          requirement: { type: "holiday_learning", value: "halloween" },
        },

        // Loyalty Achievements (Silver to Legendary)
        {
          id: "one_month_member",
          name: "One Month Strong",
          description: "Be an active member for 30 days",
          icon: "fas fa-calendar-check",
          rarity: "silver",
          category: "loyalty",
          points: 500,
          requirement: { type: "membership_days", value: 30 },
        },
        {
          id: "six_month_member",
          name: "Half Year Hero",
          description: "Be an active member for 180 days",
          icon: "fas fa-medal",
          rarity: "gold",
          category: "loyalty",
          points: 1500,
          requirement: { type: "membership_days", value: 180 },
        },
        {
          id: "one_year_member",
          name: "Annual Achiever",
          description: "Be an active member for 365 days",
          icon: "fas fa-crown",
          rarity: "legendary",
          category: "loyalty",
          points: 5000,
          requirement: { type: "membership_days", value: 365 },
        },
      ];

      // Certificate Pack Definitions
      const certificatePacks = {
        // Level 1 – Fundamentals (Specialist)
        cybersecurity_fundamentals: {
          id: "cybersecurity_fundamentals",
          name: "Cybersecurity Fundamentals Specialist",
          description:
            "Master the core principles of cybersecurity, networking, and ethical hacking basics.",
          badge_type: "Specialist",
          courses: [
            "computer-networking-basics",
            "linux-command-line-basics",
            "ethical-hacking-fundamentals",
          ],
          certificate_template: "specialist",
          points_reward: 1000,
        },

        // Level 2 – Networking & Systems (Specialist)
        networking_systems_specialist: {
          id: "networking_systems_specialist",
          name: "Networking & Systems Specialist",
          description:
            "Learn system administration, TCP/IP, and basic defensive security.",
          badge_type: "Specialist",
          courses: [
            "tcp-ip-protocols-deep-dive",
            "windows-linux-administration",
            "system-hardening-basics",
          ],
          certificate_template: "specialist",
          points_reward: 1200,
        },

        // Level 3 – Cryptography Basics (Specialist)
        cryptography_specialist: {
          id: "cryptography_specialist",
          name: "Applied Cryptography Specialist",
          description:
            "Understand the fundamentals of encryption, hashing, and secure communications.",
          badge_type: "Specialist",
          courses: [
            "cryptography-essentials",
            "ssl-tls-basics",
            "public-key-infrastructure-pki",
          ],
          certificate_template: "specialist",
          points_reward: 1300,
        },

        // Level 4 – Penetration Testing Expert
        penetration_testing_expert: {
          id: "penetration_testing_expert",
          name: "Penetration Testing Expert",
          description:
            "Perform penetration testing on systems, networks, and applications.",
          badge_type: "Expert",
          courses: [
            "network-penetration-testing",
            "web-application-security-full-course",
            "wireless-pen-testing-defense-first",
          ],
          certificate_template: "expert",
          points_reward: 2000,
        },

        // Level 5 – Malware Analysis Expert
        malware_analysis_expert: {
          id: "malware_analysis_expert",
          name: "Malware Analysis Expert",
          description: "Analyze and reverse engineer malicious code.",
          badge_type: "Expert",
          courses: [
            "malware-analysis-introduction-safe-expanded",
            "reverse-engineering-basics",
            "sandboxing-and-detection",
          ],
          certificate_template: "expert",
          points_reward: 2000,
        },

        // Level 6 – Threat Intelligence Expert
        threat_intelligence_expert: {
          id: "threat_intelligence_expert",
          name: "Threat Intelligence Expert",
          description:
            "Learn adversary tactics, threat hunting, and intelligence gathering.",
          badge_type: "Expert",
          courses: [
            "threat-hunting-professional-detailed-expanded",
            "open-source-intelligence",
            "attack-simulation",
          ],
          certificate_template: "expert",
          points_reward: 2000,
        },

        // Level 7 – SOC Analyst Professional
        soc_analyst_professional: {
          id: "soc_analyst_professional",
          name: "SOC Analyst Professional",
          description: "Training for Security Operations Center roles.",
          badge_type: "Professional",
          courses: [
            "siem-operations",
            "incident-response-planning",
            "digital-forensics-introduction",
          ],
          certificate_template: "professional",
          points_reward: 2500,
        },

        // Level 8 – Cloud Security Professional
        cloud_security_professional: {
          id: "cloud_security_professional",
          name: "Cloud Security Professional",
          description: "Secure AWS, Azure, and Google Cloud environments.",
          badge_type: "Professional",
          courses: [
            "aws-security-fundamentals",
            "azure-security-basics",
            "gcp-security-essentials",
          ],
          certificate_template: "professional",
          points_reward: 2500,
        },

        // Level 9 – Web Security Professional
        web_security_professional: {
          id: "web_security_professional",
          name: "Web Security Professional",
          description:
            "Protect and test modern web applications against OWASP Top 10 threats.",
          badge_type: "Professional",
          courses: [
            "owasp-top-10",
            "sql-injection-attacks",
            "cross-site-scripting",
          ],
          certificate_template: "professional",
          points_reward: 2500,
        },

        // Level 10 – Mobile Security Professional
        mobile_security_professional: {
          id: "mobile_security_professional",
          name: "Mobile Security Professional",
          description:
            "Learn Android and iOS security testing and app protection.",
          badge_type: "Professional",
          courses: [
            "android-application-security",
            "ios-security-testing",
            "mobile-malware-analysis",
          ],
          certificate_template: "professional",
          points_reward: 2500,
        },

        // Level 11 – Security Architect
        security_architect: {
          id: "security_architect",
          name: "Enterprise Security Architect",
          description: "Design secure enterprise systems and frameworks.",
          badge_type: "Architect",
          courses: [
            "nist-framework-basics",
            "zero-trust-architecture",
            "security-architecture-design",
          ],
          certificate_template: "architect",
          points_reward: 3000,
        },

        // Level 12 – Cloud Security Architect
        cloud_security_architect: {
          id: "cloud_security_architect",
          name: "Cloud Security Architect",
          description: "Specialize in DevSecOps and secure cloud environments.",
          badge_type: "Architect",
          courses: [
            "cloud-compliance-frameworks",
            "devsecops-principles",
            "multi-cloud-security",
          ],
          certificate_template: "architect",
          points_reward: 3000,
        },

        // Level 13 – Application Security Architect
        appsec_architect: {
          id: "appsec_architect",
          name: "Application Security Architect",
          description: "Secure software development lifecycle with DevSecOps.",
          badge_type: "Architect",
          courses: [
            "secure-software-development",
            "code-review-security",
            "application-hardening",
          ],
          certificate_template: "architect",
          points_reward: 3000,
        },

        // Level 14 – Incident Response Architect
        incident_response_architect: {
          id: "incident_response_architect",
          name: "Incident Response Architect",
          description: "Advanced planning and handling of cyber incidents.",
          badge_type: "Architect",
          courses: [
            "incident-response-planning",
            "cyber-kill-chain",
            "crisis-management",
          ],
          certificate_template: "architect",
          points_reward: 3000,
        },

        // Level 15 – Digital Forensics Master
        digital_forensics_master: {
          id: "digital_forensics_master",
          name: "Digital Forensics Master",
          description: "Master digital forensics and evidence collection.",
          badge_type: "Master",
          courses: [
            "digital-forensics-introduction",
            "memory-forensics",
            "network-forensics",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 16 – Malware Research Master
        malware_research_master: {
          id: "malware_research_master",
          name: "Malware Research Master",
          description: "Deep reverse engineering and exploit development.",
          badge_type: "Master",
          courses: [
            "advanced-malware-research",
            "exploit-development-basics",
            "rootkits-and-bootkits",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 17 – Cryptography Master
        cryptography_master: {
          id: "cryptography_master",
          name: "Cryptography & Secure Systems Master",
          description: "Advanced cryptography and blockchain security.",
          badge_type: "Master",
          courses: [
            "elliptic-curve-cryptography",
            "blockchain-security",
            "post-quantum-cryptography",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 18 – AI Cybersecurity Master
        ai_cybersecurity_master: {
          id: "ai_cybersecurity_master",
          name: "AI & Next-Gen Cybersecurity Master",
          description: "AI, ML, and next-gen security in ethical hacking.",
          badge_type: "Master",
          courses: [
            "ai-for-cybersecurity",
            "machine-learning-attacks",
            "deepfake-detection",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 19 – Advanced Red Team Master
        red_team_master: {
          id: "red_team_master",
          name: "Advanced Red Team Master",
          description:
            "Simulate nation-state adversaries with advanced red teaming.",
          badge_type: "Master",
          courses: [
            "adversary-simulation-course",
            "bypass-security-controls",
            "living-off-the-land-course",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 20 – Advanced Blue Team Master
        blue_team_master: {
          id: "blue_team_master",
          name: "Advanced Blue Team Master",
          description:
            "Master SOC operations, detection engineering, and defense.",
          badge_type: "Master",
          courses: [
            "detection-engineering",
            "advanced-threat-hunting",
            "automated-defense-systems",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 21 – Governance Risk & Compliance Master
        grc_master: {
          id: "grc_master",
          name: "GRC & Compliance Master",
          description: "Governance, risk, and compliance mastery.",
          badge_type: "Master",
          courses: [
            "iso-27001-compliance",
            "gdpr-hipaa-security",
            "risk-management-advanced",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 22 – IoT & OT Security Master
        iot_ot_security_master: {
          id: "iot_ot_security_master",
          name: "IoT & OT Security Master",
          description:
            "Specialized hacking and defense of IoT and ICS/SCADA systems.",
          badge_type: "Master",
          courses: [
            "iot-hacking-basics",
            "scada-security",
            "smart-device-penetration",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 23 – Hardware Hacking Master
        hardware_hacking_master: {
          id: "hardware_hacking_master",
          name: "Hardware Hacking Master",
          description:
            "Learn advanced hardware exploitation and firmware analysis.",
          badge_type: "Master",
          courses: [
            "firmware-analysis",
            "side-channel-attacks",
            "chip-off-forensics",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 24 – Blockchain & Web3 Security Master
        blockchain_master: {
          id: "blockchain_master",
          name: "Blockchain & Web3 Security Master",
          description:
            "Advanced blockchain penetration testing and DeFi security.",
          badge_type: "Master",
          courses: [
            "smart-contract-security",
            "defi-hacking-techniques",
            "web3-vulnerabilities",
          ],
          certificate_template: "master",
          points_reward: 4000,
        },

        // Level 25 – Cyber Warfare & APT Master
        cyberwarfare_master: {
          id: "cyberwarfare_master",
          name: "Cyber Warfare & APT Master",
          description:
            "Understand cyber warfare, APTs, and nation-state attacks.",
          badge_type: "Master",
          courses: [
            "apt-attack-analysis",
            "nation-state-threats",
            "cyber-warfare-strategy",
          ],
          certificate_template: "master",
          points_reward: 4500,
        },

        // Level 26 – Offensive Security Architect
        offensive_security_architect: {
          id: "offensive_security_architect",
          name: "Offensive Security Architect",
          description:
            "Design and execute advanced offensive security operations.",
          badge_type: "Architect",
          courses: [
            "red-team-infrastructure",
            "attack-chain-design",
            "evading-detection",
          ],
          certificate_template: "architect",
          points_reward: 3500,
        },

        // Level 27 – Defensive Security Architect
        defensive_security_architect: {
          id: "defensive_security_architect",
          name: "Defensive Security Architect",
          description: "Build and maintain resilient defense systems.",
          badge_type: "Architect",
          courses: [
            "advanced-firewalling",
            "zero-trust-implementation",
            "intrusion-prevention-systems",
          ],
          certificate_template: "architect",
          points_reward: 3500,
        },

        // Level 28 – Grandmaster Ethical Hacker
        grandmaster_hacker: {
          id: "grandmaster_hacker",
          name: "Grandmaster Ethical Hacker",
          description:
            "The ultimate certification covering all domains of ethical hacking.",
          badge_type: "Master",
          courses: [
            "full-spectrum-penetration-testing",
            "advanced-exploit-development",
            "cybersecurity-leadership",
          ],
          certificate_template: "master",
          points_reward: 6000,
        },
        // NEW CERTIFICATE PACKS FOR ADDITIONAL COURSES

        // Security Fundamentals Path
        security_fundamentals_complete: {
          id: "security_fundamentals_complete",
          name: "Security Fundamentals Complete",
          description:
            "Complete foundation in cybersecurity principles, risk management, and security awareness.",
          badge_type: "Specialist",
          courses: [
            "cybersecurity-principles",
            "risk-assessment-basics",
            "security-awareness-training",
          ],
          certificate_template: "specialist",
          points_reward: 1000,
        },

        // Network Defense Mastery
        network_defense_mastery: {
          id: "network_defense_mastery",
          name: "Network Defense Mastery",
          description:
            "Advanced network security with firewalls, monitoring, and intrusion prevention systems.",
          badge_type: "Professional",
          courses: [
            "network-security-basics",
            "advanced-firewalling",
            "intrusion-prevention-systems",
          ],
          certificate_template: "professional",
          points_reward: 2500,
        },

        // Penetration Testing Mastery
        penetration_testing_mastery: {
          id: "penetration_testing_mastery",
          name: "Penetration Testing Mastery",
          description:
            "Complete penetration testing expertise with methodology and vulnerability management.",
          badge_type: "Professional",
          courses: [
            "penetration-testing-methodology",
            "vulnerability-management",
            "network-penetration-testing",
          ],
          certificate_template: "professional",
          points_reward: 2500,
        },

        // Business Security Leadership
        business_security_leadership: {
          id: "business_security_leadership",
          name: "Business Security Leadership",
          description:
            "Business-focused security management with continuity planning and risk management.",
          badge_type: "Architect",
          courses: [
            "business-continuity-planning",
            "risk-management-advanced",
            "cybersecurity-leadership",
          ],
          certificate_template: "architect",
          points_reward: 3500,
        },
      };

      // Sample course data
      const courseData = [
        // Existing courses (updated)
        {
          id: "ethical-hacking-fundamentals",
          title: "Ethical Hacking Fundamentals",
          description:
            "Learn the basics of ethical hacking, including reconnaissance, scanning, enumeration, and vulnerability assessment techniques used by security professionals.",
          icon: "fas fa-user-secret",
          difficulty: "Beginner",
          duration: "8 hours",
          lessons: 24,
          category: "ethical-hacking",
          instructor: "Dr. Sarah Chen",
          skills: [
            "Network Scanning",
            "Vulnerability Assessment",
            "Penetration Testing",
            "Reconnaissance",
          ],
          courseUrl: "courses/ethical-hacking-fundamentals.html", // Add actual course page URL
          previewUrl: "courses/preview/ethical-hacking-fundamentals.html",
        },
        {
          id: "network-security-monitoring",
          title: "Network Security Monitoring",
          description:
            "Master network security monitoring techniques, intrusion detection systems, and incident response procedures to protect organizational networks.",
          icon: "fas fa-network-wired",
          difficulty: "Intermediate",
          duration: "12 hours",
          lessons: 32,
          category: "network-security",
          instructor: "Marcus Johnson",
          skills: [
            "IDS/IPS",
            "Network Monitoring",
            "Incident Response",
            "SIEM",
          ],
          courseUrl: "courses/comingsoon.html", // Add actual course page URL
          previewUrl: "courses/preview/network-security-monitoring.html",
        },
        {
          id: "web-application-security-full-course",
          title: "Web Application Security",
          description:
            "Comprehensive guide to web application security, covering OWASP Top 10, secure coding practices, and vulnerability testing methodologies.",
          icon: "fas fa-globe",
          difficulty: "Intermediate",
          duration: "10 hours",
          lessons: 28,
          category: "web-security",
          instructor: "Lisa Rodriguez",
          skills: [
            "OWASP Top 10",
            "SQL Injection",
            "XSS Prevention",
            "Secure Coding",
          ],
          courseUrl: "courses/web-application-security.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "malware-analysis-introduction-safe-expanded",
          title: "Malware Analysis Fundamentals",
          description:
            "Learn static and dynamic malware analysis techniques, reverse engineering basics, and threat intelligence gathering methods.",
          icon: "fas fa-bug",
          difficulty: "Advanced",
          duration: "15 hours",
          lessons: 40,
          category: "malware-analysis",
          instructor: "Dr. Kevin Park",
          skills: [
            "Reverse Engineering",
            "Static Analysis",
            "Dynamic Analysis",
            "Threat Intel",
          ],
          courseUrl: "courses/malware-analysis-introduction-safe-expanded.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "digital-forensics-introduction",
          title: "Digital Forensics Investigation",
          description:
            "Master digital forensics techniques, evidence collection, and analysis procedures for cybersecurity incident investigations.",
          icon: "fas fa-search",
          difficulty: "Intermediate",
          duration: "14 hours",
          lessons: 35,
          category: "digital-forensics",
          instructor: "Detective Amy Wilson",
          skills: [
            "Evidence Collection",
            "File System Analysis",
            "Network Forensics",
            "Timeline Analysis",
          ],
          courseUrl: "courses/digital-forensics-introduction.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "cryptography-essentials",
          title: "Cryptography Essentials",
          description:
            "Understanding modern cryptography, encryption algorithms, digital signatures, and cryptographic protocols in cybersecurity.",
          icon: "fas fa-key",
          difficulty: "Advanced",
          duration: "16 hours",
          lessons: 42,
          category: "cryptography",
          instructor: "Prof. Michael Zhang",
          skills: ["Encryption", "Digital Signatures", "PKI", "Hash Functions"],
          courseUrl: "courses/cryptography-essentials.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "social-engineering-defense",
          title: "Social Engineering & Defense",
          description:
            "Learn about social engineering attacks, psychological manipulation tactics, and how to build effective defenses against human-based attacks.",
          icon: "fas fa-users",
          difficulty: "Beginner",
          duration: "6 hours",
          lessons: 18,
          category: "ethical-hacking",
          instructor: "Rachel Green",
          skills: [
            "Social Engineering",
            "Human Psychology",
            "Security Awareness",
            "Phishing Defense",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "cloud-security-fundamentals",
          title: "Cloud Security Fundamentals",
          description:
            "Comprehensive coverage of cloud security principles, AWS/Azure/GCP security, and cloud compliance frameworks.",
          icon: "fas fa-cloud",
          difficulty: "Intermediate",
          duration: "11 hours",
          lessons: 30,
          category: "cloud-security",
          instructor: "David Kumar",
          skills: [
            "AWS Security",
            "Azure Security",
            "Cloud Compliance",
            "Container Security",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "incident-response-fundamentals",
          title: "Incident Response & Planning",
          description:
            "Develop comprehensive incident response plans, threat hunting techniques, and crisis management skills for cybersecurity teams.",
          icon: "fas fa-fire-extinguisher",
          difficulty: "Advanced",
          duration: "13 hours",
          lessons: 36,
          category: "incident-response",
          instructor: "Captain Jennifer Smith",
          skills: [
            "Incident Response",
            "Threat Hunting",
            "Crisis Management",
            "Forensic Analysis",
          ],
          courseUrl: "courses/incident-response-fundamentals.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "mobile-security-testing",
          title: "Mobile Security Testing",
          description:
            "Learn mobile application security testing for Android and iOS platforms, including static and dynamic analysis techniques.",
          icon: "fas fa-mobile-alt",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 33,
          category: "mobile-security",
          instructor: "Alex Thompson",
          skills: [
            "Mobile Testing",
            "Android Security",
            "iOS Security",
            "App Penetration Testing",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },

        // Additional courses from certificate packs
        {
          id: "computer-networking-basics",
          title: "Computer Networking Basics",
          description:
            "Foundation course covering networking fundamentals, protocols, and infrastructure essentials for cybersecurity professionals.",
          icon: "fas fa-network-wired",
          difficulty: "Beginner",
          duration: "7 hours",
          lessons: 20,
          category: "fundamentals",
          instructor: "Prof. Robert Lee",
          skills: ["OSI Model", "TCP/IP", "Network Topology", "Routing Basics"],
          courseUrl: "courses/computer-networking-basics.html",
          previewUrl: "courses/preview/computer-networking-basics.html",
        },
        {
          id: "linux-command-line-basics",
          title: "Linux Command Line Basics",
          description:
            "Master essential Linux commands, file system navigation, and command-line tools critical for cybersecurity operations.",
          icon: "fab fa-linux",
          difficulty: "Beginner",
          duration: "6 hours",
          lessons: 18,
          category: "fundamentals",
          instructor: "James Wilson",
          skills: [
            "Bash Commands",
            "File Operations",
            "System Navigation",
            "Shell Scripting",
          ],
          courseUrl: "courses/linux-command-line-basics.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "tcp-ip-protocols-deep-dive",
          title: "TCP/IP Protocol Suite",
          description:
            "Deep dive into TCP/IP protocols, packet analysis, and network communication fundamentals for security professionals.",
          icon: "fas fa-exchange-alt",
          difficulty: "Intermediate",
          duration: "9 hours",
          lessons: 26,
          category: "network-security",
          instructor: "Dr. Maria Gonzalez",
          skills: [
            "Protocol Analysis",
            "Packet Capture",
            "Network Troubleshooting",
            "Wireshark",
          ],
          courseUrl: "courses/tcp-ip-protocols-deep-dive.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "windows-linux-administration",
          title: "Windows & Linux Administration",
          description:
            "System administration fundamentals for both Windows and Linux environments with security best practices.",
          icon: "fas fa-server",
          difficulty: "Intermediate",
          duration: "14 hours",
          lessons: 38,
          category: "system-administration",
          instructor: "Mike Davis",
          skills: [
            "Active Directory",
            "Group Policy",
            "System Hardening",
            "User Management",
          ],
          courseUrl: "courses/windows-linux-administration.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "system-hardening-basics",
          title: "System Hardening Basics",
          description:
            "Learn essential system hardening techniques for Windows and Linux to reduce attack surface and improve security posture.",
          icon: "fas fa-shield-alt",
          difficulty: "Intermediate",
          duration: "8 hours",
          lessons: 22,
          category: "system-administration",
          instructor: "Sarah Mitchell",
          skills: [
            "OS Hardening",
            "Security Configuration",
            "Access Control",
            "Baseline Security",
          ],
          courseUrl: "courses/system-hardening-basics.html",
          previewUrl: "courses/preview/system-hardening-basics.html",
        },
        {
          id: "ssl-tls-basics",
          title: "SSL/TLS Security Basics",
          description:
            "Understanding SSL/TLS protocols, certificate management, and secure communication implementation.",
          icon: "fas fa-certificate",
          difficulty: "Intermediate",
          duration: "7 hours",
          lessons: 20,
          category: "cryptography",
          instructor: "Dr. Alan Kumar",
          skills: [
            "SSL/TLS",
            "Certificate Management",
            "Secure Communications",
            "Protocol Security",
          ],
          courseUrl: "courses/ssl-tls-basics.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "public-key-infrastructure-pki",
          title: "Public Key Infrastructure (PKI)",
          description:
            "Comprehensive guide to PKI systems, certificate authorities, and digital certificate lifecycle management.",
          icon: "fas fa-key",
          difficulty: "Advanced",
          duration: "10 hours",
          lessons: 28,
          category: "cryptography",
          instructor: "Dr. Elena Petrov",
          skills: [
            "PKI Management",
            "Certificate Authorities",
            "Digital Certificates",
            "Key Management",
          ],
          courseUrl: "courses/public-key-infrastructure-pki.html",
          previewUrl: "courses/preview/public-key-infrastructure-pki.html",
        },
        {
          id: "network-penetration-testing",
          title: "Network Penetration Testing",
          description:
            "Advanced network penetration testing methodologies, exploitation techniques, and post-exploitation procedures.",
          icon: "fas fa-crosshairs",
          difficulty: "Advanced",
          duration: "16 hours",
          lessons: 45,
          category: "penetration-testing",
          instructor: "John Martinez",
          skills: [
            "Network Exploitation",
            "Post-Exploitation",
            "Privilege Escalation",
            "Lateral Movement",
          ],
          courseUrl: "courses/network-penetration-testing.html",
          previewUrl: "courses/preview/network-penetration-testing.html",
        },
        {
          id: "wireless-pen-testing-defense-first",
          title: "Wireless Penetration Testing",
          description:
            "Specialized course on wireless network security testing, WiFi hacking, and wireless protocol vulnerabilities.",
          icon: "fas fa-wifi",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 30,
          category: "penetration-testing",
          instructor: "Dr. Chris Taylor",
          skills: [
            "WiFi Security",
            "Wireless Protocols",
            "Aircrack-ng",
            "WPA/WPA2 Testing",
          ],
          courseUrl: "courses/wireless-pen-testing-defense-first.html",
          previewUrl: "courses/preview/wireless-pen-testing-defense-first.html",
        },
        {
          id: "reverse-engineering-basics",
          title: "Reverse Engineering Basics",
          description:
            "Introduction to reverse engineering techniques, disassemblers, debuggers, and binary analysis fundamentals.",
          icon: "fas fa-cogs",
          difficulty: "Advanced",
          duration: "18 hours",
          lessons: 48,
          category: "malware-analysis",
          instructor: "Dr. Anna Volkov",
          skills: ["IDA Pro", "Ghidra", "Assembly Language", "Binary Analysis"],
          courseUrl: "courses/reverse-engineering-professional-expanded.html",
          previewUrl:
            "courses/preview/reverse-engineering-professional-expanded.html",
        },
        {
          id: "sandboxing-and-detection",
          title: "Sandboxing & Malware Detection",
          description:
            "Learn malware sandboxing techniques, automated analysis, and detection evasion methods used by modern threats.",
          icon: "fas fa-box",
          difficulty: "Advanced",
          duration: "10 hours",
          lessons: 25,
          category: "malware-analysis",
          instructor: "Dr. Tom Anderson",
          skills: [
            "Sandbox Analysis",
            "Automated Detection",
            "Evasion Techniques",
            "Behavioral Analysis",
          ],
          courseUrl: "courses/sandboxing-detection-engineering-expanded.html",
          previewUrl:
            "courses/preview/sandboxing-detection-engineering-expanded.html",
        },
        {
          id: "threat-hunting-basics",
          title: "Threat Hunting Fundamentals",
          description:
            "Proactive threat hunting methodologies, hypothesis-driven investigations, and advanced persistent threat detection.",
          icon: "fas fa-binoculars",
          difficulty: "Advanced",
          duration: "15 hours",
          lessons: 38,
          category: "threat-intelligence",
          instructor: "Lt. Col. Patricia Brown",
          skills: [
            "Threat Hunting",
            "IOC Analysis",
            "Hypothesis Testing",
            "Advanced Persistence",
          ],
          courseUrl:
            "courses/threat-hunting-professional-detailed-expanded.html",
          previewUrl:
            "courses/preview/threat-hunting-professional-detailed-expanded.html",
        },
        {
          id: "open-source-intelligence",
          title: "Open Source Intelligence (OSINT)",
          description:
            "Master OSINT techniques for cybersecurity, including social media investigation, domain analysis, and threat actor profiling.",
          icon: "fas fa-search-plus",
          difficulty: "Intermediate",
          duration: "9 hours",
          lessons: 24,
          category: "threat-intelligence",
          instructor: "Agent Maria Santos",
          skills: [
            "OSINT Tools",
            "Social Media Intel",
            "Domain Investigation",
            "Threat Actor Profiling",
          ],
          courseUrl: "courses/osint-professional.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "attack-simulation",
          title: "Attack Simulation & Red Teaming",
          description:
            "Advanced attack simulation techniques, red team operations, and adversary emulation methodologies.",
          icon: "fas fa-sword",
          difficulty: "Expert",
          duration: "20 hours",
          lessons: 52,
          category: "red-team",
          instructor: "Colonel Jack Harrison",
          skills: [
            "Red Team Operations",
            "Attack Simulation",
            "Adversary Emulation",
            "Advanced TTPs",
          ],
          courseUrl: "courses/attack-simulation.html",
          previewUrl: "courses/preview/attack-simulation.html",
        },
        {
          id: "siem-operations",
          title: "SIEM Operations & Management",
          description:
            "Security Information and Event Management (SIEM) operations, log analysis, and security monitoring best practices.",
          icon: "fas fa-chart-line",
          difficulty: "Intermediate",
          duration: "11 hours",
          lessons: 29,
          category: "soc-operations",
          instructor: "Sandra Kim",
          skills: [
            "SIEM Management",
            "Log Analysis",
            "Alert Correlation",
            "Security Monitoring",
          ],
          courseUrl: "courses/siem-operations-foundations.html",
          previewUrl: "courses/preview/siem-operations-foundations.html",
        },
        {
          id: "aws-security-fundamentals",
          title: "AWS Security Fundamentals",
          description:
            "Comprehensive AWS security training covering IAM, VPC security, encryption, and compliance in Amazon Web Services.",
          icon: "fab fa-aws",
          difficulty: "Intermediate",
          duration: "12 hours",
          lessons: 34,
          category: "cloud-security",
          instructor: "David Kumar",
          skills: ["AWS IAM", "VPC Security", "S3 Security", "CloudTrail"],
          courseUrl: "courses/aws-security-fundamentals.html",
          previewUrl: "courses/preview/aws-security-fundamentals.html",
        },
        {
          id: "azure-security-basics",
          title: "Azure Security Basics",
          description:
            "Microsoft Azure security fundamentals including Azure AD, security center, and cloud security best practices.",
          icon: "fab fa-microsoft",
          difficulty: "Intermediate",
          duration: "11 hours",
          lessons: 31,
          category: "cloud-security",
          instructor: "Dr. Rachel Blue",
          skills: [
            "Azure AD",
            "Security Center",
            "Key Vault",
            "Azure Security",
          ],
          courseUrl: "courses/azure-security-basics.html",
          previewUrl: "courses/preview/azure-security-basics.html",
        },
        {
          id: "gcp-security-essentials",
          title: "Google Cloud Platform Security Essentials",
          description:
            "Google Cloud security fundamentals covering IAM, VPC security, and GCP security services.",
          icon: "fab fa-google",
          difficulty: "Intermediate",
          duration: "10 hours",
          lessons: 28,
          category: "cloud-security",
          instructor: "Jennifer Chang",
          skills: ["GCP IAM", "Cloud Security", "VPC Security", "Cloud KMS"],
          courseUrl: "courses/gcp-security-essentials.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "owasp-top-10",
          title: "OWASP Top 10 Security Risks",
          description:
            "In-depth analysis of OWASP Top 10 web application security risks with practical testing and mitigation strategies.",
          icon: "fas fa-list-ol",
          difficulty: "Intermediate",
          duration: "8 hours",
          lessons: 25,
          category: "web-security",
          instructor: "Lisa Rodriguez",
          skills: [
            "OWASP Top 10",
            "Web Vulnerabilities",
            "Security Testing",
            "Risk Assessment",
          ],
          courseUrl: "courses/owasp-top-10-web-app-security.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "sql-injection-attacks",
          title: "SQL Injection Attacks & Prevention",
          description:
            "Master SQL injection techniques, detection methods, and prevention strategies for web application security.",
          icon: "fas fa-database",
          difficulty: "Advanced",
          duration: "9 hours",
          lessons: 26,
          category: "web-security",
          instructor: "Dr. Carlos Mendez",
          skills: [
            "SQL Injection",
            "Database Security",
            "Input Validation",
            "Parameterized Queries",
          ],
          courseUrl: "courses/sql-injection-attacks.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "cross-site-scripting",
          title: "Cross-Site Scripting (XSS) Security",
          description:
            "Comprehensive guide to XSS vulnerabilities, exploitation techniques, and prevention methodologies.",
          icon: "fas fa-code",
          difficulty: "Intermediate",
          duration: "7 hours",
          lessons: 21,
          category: "web-security",
          instructor: "Emma Thompson",
          skills: [
            "XSS Testing",
            "Client-Side Security",
            "Input Sanitization",
            "Content Security Policy",
          ],
          courseUrl: "courses/xss-attacks-roadmap.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "android-application-security",
          title: "Android Application Security",
          description:
            "Android security testing, APK analysis, and mobile application penetration testing techniques.",
          icon: "fab fa-android",
          difficulty: "Advanced",
          duration: "13 hours",
          lessons: 35,
          category: "mobile-security",
          instructor: "Alex Thompson",
          skills: [
            "APK Analysis",
            "Android Security",
            "Mobile Penetration Testing",
            "Static Analysis",
          ],
          courseUrl: "courses/android-app-security.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "ios-security-testing",
          title: "iOS Security Testing",
          description:
            "iOS application security testing, jailbreak techniques, and iPhone/iPad security assessment methods.",
          icon: "fab fa-apple",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 32,
          category: "mobile-security",
          instructor: "Dr. Jennifer Nakamura",
          skills: [
            "iOS Security",
            "Jailbreak Testing",
            "App Store Security",
            "iOS Forensics",
          ],
          courseUrl: "courses/ios-security-testing.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "mobile-malware-analysis",
          title: "Mobile Malware Analysis",
          description:
            "Specialized course on mobile malware analysis, Android and iOS threats, and mobile forensics techniques.",
          icon: "fas fa-virus",
          difficulty: "Expert",
          duration: "14 hours",
          lessons: 37,
          category: "malware-analysis",
          instructor: "Dr. Kevin Park",
          skills: [
            "Mobile Malware",
            "APK Reverse Engineering",
            "iOS Analysis",
            "Mobile Forensics",
          ],
          courseUrl: "courses/mobile-malware-analysis.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "nist-framework-basics",
          title: "NIST Cybersecurity Framework",
          description:
            "Understanding and implementing the NIST Cybersecurity Framework for organizational security management.",
          icon: "fas fa-clipboard-check",
          difficulty: "Intermediate",
          duration: "8 hours",
          lessons: 24,
          category: "compliance",
          instructor: "Dr. Patricia Williams",
          skills: [
            "NIST Framework",
            "Risk Management",
            "Security Controls",
            "Compliance",
          ],
          courseUrl: "courses/nist-framework-basics.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "zero-trust-architecture",
          title: "Zero Trust Architecture",
          description:
            "Design and implement zero trust security models and architectures for modern enterprise environments.",
          icon: "fas fa-lock",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 30,
          category: "architecture",
          instructor: "Dr. Michael Chen",
          skills: [
            "Zero Trust",
            "Security Architecture",
            "Identity Verification",
            "Micro-segmentation",
          ],
          courseUrl: "courses/zero-trust-architecture.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "security-architecture-design",
          title: "Security Architecture Design",
          description:
            "Enterprise security architecture principles, threat modeling, and secure system design methodologies.",
          icon: "fas fa-drafting-compass",
          difficulty: "Advanced",
          duration: "15 hours",
          lessons: 40,
          category: "architecture",
          instructor: "Dr. Lisa Chang",
          skills: [
            "Security Architecture",
            "Threat Modeling",
            "System Design",
            "Enterprise Security",
          ],
          courseUrl: "courses/security-architecture-design.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "cloud-compliance-frameworks",
          title: "Cloud Compliance Frameworks",
          description:
            "Navigate cloud compliance requirements including SOC 2, ISO 27001, and industry-specific regulations.",
          icon: "fas fa-balance-scale",
          difficulty: "Advanced",
          duration: "10 hours",
          lessons: 27,
          category: "compliance",
          instructor: "Jennifer Roberts",
          skills: [
            "SOC 2",
            "ISO 27001",
            "Cloud Compliance",
            "Regulatory Frameworks",
          ],
          courseUrl: "courses/cloud-compliance-frameworks-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "devsecops-principles",
          title: "DevSecOps Principles",
          description:
            "Integrate security into DevOps pipelines with automated security testing and secure development practices.",
          icon: "fas fa-code-branch",
          difficulty: "Advanced",
          duration: "13 hours",
          lessons: 35,
          category: "devsecops",
          instructor: "Dr. Ryan Powell",
          skills: [
            "CI/CD Security",
            "Automated Testing",
            "Container Security",
            "Security Automation",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "multi-cloud-security",
          title: "Multi-Cloud Security",
          description:
            "Secure multi-cloud environments and hybrid cloud architectures with centralized security management.",
          icon: "fas fa-clouds",
          difficulty: "Expert",
          duration: "16 hours",
          lessons: 42,
          category: "cloud-security",
          instructor: "Dr. Amanda Foster",
          skills: [
            "Multi-Cloud",
            "Hybrid Security",
            "Cloud Integration",
            "Centralized Management",
          ],
          courseUrl: "courses/complete-multi-cloud-security-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "secure-software-development",
          title: "Secure Software Development",
          description:
            "Secure coding practices, SDLC security integration, and application security throughout the development lifecycle.",
          icon: "fas fa-code",
          difficulty: "Advanced",
          duration: "14 hours",
          lessons: 38,
          category: "application-security",
          instructor: "Dr. Robert Kim",
          skills: [
            "Secure Coding",
            "SDLC Security",
            "Code Review",
            "Application Hardening",
          ],
          courseUrl: "courses/complete-secure-software-development-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "code-review-security",
          title: "Security Code Review",
          description:
            "Master security code review techniques, static analysis tools, and vulnerability identification in source code.",
          icon: "fas fa-search-plus",
          difficulty: "Advanced",
          duration: "11 hours",
          lessons: 29,
          category: "application-security",
          instructor: "Maria Lopez",
          skills: [
            "Static Analysis",
            "Code Review",
            "Vulnerability Scanning",
            "Secure Development",
          ],
          courseUrl: "courses/complete-code-review-security-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "application-hardening",
          title: "Application Hardening",
          description:
            "Comprehensive application security hardening techniques and runtime application self-protection methods.",
          icon: "fas fa-shield",
          difficulty: "Advanced",
          duration: "9 hours",
          lessons: 24,
          category: "application-security",
          instructor: "Dr. James Liu",
          skills: [
            "App Hardening",
            "Runtime Protection",
            "Security Controls",
            "Application Defense",
          ],
          courseUrl: "courses/complete-application-hardening-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "incident-response-planning",
          title: "Incident Response Planning",
          description:
            "Develop comprehensive incident response plans, playbooks, and coordinate effective cybersecurity incident management.",
          icon: "fas fa-clipboard-list",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 32,
          category: "incident-response",
          instructor: "Captain Jennifer Smith",
          skills: [
            "IR Planning",
            "Playbook Development",
            "Crisis Communication",
            "Business Continuity",
          ],
          courseUrl: "courses/complete-incident-response-planning.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "cyber-kill-chain",
          title: "Cyber Kill Chain Analysis",
          description:
            "Understanding the cyber kill chain, attack lifecycle analysis, and defensive strategies at each stage.",
          icon: "fas fa-chain",
          difficulty: "Intermediate",
          duration: "8 hours",
          lessons: 22,
          category: "threat-intelligence",
          instructor: "Dr. Mark Stevens",
          skills: [
            "Kill Chain",
            "Attack Analysis",
            "Defensive Strategies",
            "TTPs",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "crisis-management",
          title: "Cybersecurity Crisis Management",
          description:
            "Crisis management procedures, communication strategies, and business continuity during cybersecurity incidents.",
          icon: "fas fa-exclamation-triangle",
          difficulty: "Advanced",
          duration: "9 hours",
          lessons: 25,
          category: "incident-response",
          instructor: "Dr. Susan White",
          skills: [
            "Crisis Management",
            "Business Continuity",
            "Stakeholder Communication",
            "Recovery Planning",
          ],
          courseUrl: "courses/crisis-management-in-cybersecurity.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "disk-forensics",
          title: "Disk Forensics & Analysis",
          description:
            "Advanced disk forensics techniques, file system analysis, and data recovery methods for cybersecurity investigations.",
          icon: "fas fa-hdd",
          difficulty: "Expert",
          duration: "16 hours",
          lessons: 43,
          category: "digital-forensics",
          instructor: "Detective Amy Wilson",
          skills: [
            "Disk Analysis",
            "File Recovery",
            "Forensic Imaging",
            "Evidence Preservation",
          ],
          courseUrl: "courses/disk-forensics-complete-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "memory-forensics",
          title: "Memory Forensics",
          description:
            "RAM analysis, memory dump investigation, and volatile data forensics for incident response and investigations.",
          icon: "fas fa-memory",
          difficulty: "Expert",
          duration: "14 hours",
          lessons: 36,
          category: "digital-forensics",
          instructor: "Dr. Brian Clark",
          skills: [
            "Memory Analysis",
            "Volatility",
            "RAM Forensics",
            "Process Analysis",
          ],
          courseUrl: "courses/memory-forensics-complete-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "network-forensics",
          title: "Network Forensics",
          description:
            "Network traffic analysis, packet forensics, and network-based evidence collection techniques.",
          icon: "fas fa-network-wired",
          difficulty: "Advanced",
          duration: "13 hours",
          lessons: 34,
          category: "digital-forensics",
          instructor: "Dr. Linda Garcia",
          skills: [
            "Packet Analysis",
            "Network Investigation",
            "Traffic Forensics",
            "Evidence Collection",
          ],
          courseUrl: "courses/network-forensics-complete-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "advanced-malware-research",
          title: "Advanced Malware Research",
          description:
            "Cutting-edge malware research techniques, zero-day analysis, and advanced persistent threat investigation.",
          icon: "fas fa-microscope",
          difficulty: "Expert",
          duration: "20 hours",
          lessons: 55,
          category: "malware-analysis",
          instructor: "Dr. Victor Kozlov",
          skills: [
            "Advanced Analysis",
            "Zero-day Research",
            "APT Investigation",
            "Malware Research",
          ],
          courseUrl: "courses/advanced-malware-research-complete-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "exploit-development-basics",
          title: "Exploit Development Basics",
          description:
            "Introduction to exploit development, buffer overflows, and vulnerability research methodologies.",
          icon: "fas fa-bomb",
          difficulty: "Expert",
          duration: "18 hours",
          lessons: 48,
          category: "exploit-development",
          instructor: "Dr. Marcus Weber",
          skills: [
            "Buffer Overflows",
            "Exploit Writing",
            "Vulnerability Research",
            "Shellcode Development",
          ],
          courseUrl: "courses/exploit-development-basics.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "rootkits-and-bootkits",
          title: "Rootkits & Bootkits Analysis",
          description:
            "Advanced analysis of rootkits, bootkits, and kernel-level malware with detection and removal techniques.",
          icon: "fas fa-eye-slash",
          difficulty: "Expert",
          duration: "16 hours",
          lessons: 42,
          category: "malware-analysis",
          instructor: "Dr. Anna Volkov",
          skills: [
            "Rootkit Analysis",
            "Kernel Security",
            "Bootkit Detection",
            "Low-level Analysis",
          ],
          courseUrl: "courses/rootkits-and-bootkits-complete-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "elliptic-curve-cryptography",
          title: "Elliptic Curve Cryptography",
          description:
            "Advanced cryptography focusing on elliptic curve algorithms, mathematical foundations, and implementation security.",
          icon: "fas fa-calculator",
          difficulty: "Expert",
          duration: "15 hours",
          lessons: 38,
          category: "cryptography",
          instructor: "Prof. Michael Zhang",
          skills: [
            "ECC",
            "Mathematical Cryptography",
            "Curve Security",
            "Advanced Encryption",
          ],
          courseUrl: "courses/elliptic-curve-cryptography-complete-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "blockchain-security",
          title: "Blockchain Security",
          description:
            "Blockchain technology security, smart contract vulnerabilities, and cryptocurrency security analysis.",
          icon: "fas fa-link",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 30,
          category: "blockchain",
          instructor: "Dr. Satoshi Nakamoto Jr.",
          skills: [
            "Blockchain Security",
            "Smart Contracts",
            "Cryptocurrency",
            "DeFi Security",
          ],
          courseUrl: "courses/blockchain-security.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "post-quantum-cryptography",
          title: "Post-Quantum Cryptography",
          description:
            "Future-proof cryptography resistant to quantum computing attacks and next-generation encryption standards.",
          icon: "fas fa-atom",
          difficulty: "Expert",
          duration: "14 hours",
          lessons: 35,
          category: "cryptography",
          instructor: "Dr. Alice Quantum",
          skills: [
            "Quantum Resistance",
            "Next-Gen Crypto",
            "Lattice Cryptography",
            "Future Security",
          ],
          courseUrl: "courses/post-quantum-cryptography.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "ai-for-cybersecurity",
          title: "AI for Cybersecurity",
          description:
            "Artificial intelligence and machine learning applications in cybersecurity, automated threat detection, and AI-powered defense.",
          icon: "fas fa-robot",
          difficulty: "Advanced",
          duration: "13 hours",
          lessons: 33,
          category: "ai-security",
          instructor: "Dr. Alan Turing III",
          skills: [
            "AI Security",
            "Machine Learning",
            "Automated Detection",
            "AI Defense",
          ],
          courseUrl: "courses/ai-for-cybersecurity.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "machine-learning-attacks",
          title: "Machine Learning Attacks",
          description:
            "Understanding adversarial attacks on ML systems, model poisoning, and AI security vulnerabilities.",
          icon: "fas fa-brain",
          difficulty: "Expert",
          duration: "15 hours",
          lessons: 39,
          category: "ai-security",
          instructor: "Dr. Sarah AI",
          skills: [
            "Adversarial ML",
            "Model Security",
            "AI Attacks",
            "ML Vulnerabilities",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "deepfake-detection",
          title: "Deepfake Detection & Prevention",
          description:
            "Detect and prevent deepfake attacks, synthetic media analysis, and digital authenticity verification.",
          icon: "fas fa-mask",
          difficulty: "Advanced",
          duration: "10 hours",
          lessons: 26,
          category: "ai-security",
          instructor: "Dr. Emma Authentic",
          skills: [
            "Deepfake Detection",
            "Media Forensics",
            "Synthetic Media",
            "Digital Authenticity",
          ],
          courseUrl: "courses/deepfake-detection-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "adversary-simulation-course",
          title: "Adversary Simulation",
          description:
            "Advanced adversary simulation techniques emulating real-world threat actors and attack patterns.",
          icon: "fas fa-theater-masks",
          difficulty: "Expert",
          duration: "18 hours",
          lessons: 47,
          category: "red-team",
          instructor: "Colonel Jack Harrison",
          skills: [
            "Adversary Emulation",
            "TTPs",
            "Attack Simulation",
            "Threat Actor Modeling",
          ],
          courseUrl: "courses/adversary-simulation-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "bypass-security-controls",
          title: "Bypassing Security Controls",
          description:
            "Advanced techniques for bypassing modern security controls, EDR evasion, and defensive countermeasures.",
          icon: "fas fa-unlock",
          difficulty: "Expert",
          duration: "16 hours",
          lessons: 41,
          category: "red-team",
          instructor: "Dr. Ghost Walker",
          skills: [
            "EDR Evasion",
            "Control Bypass",
            "Defensive Evasion",
            "Advanced Persistence",
          ],
          courseUrl: "courses/bypass-security-controls.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "living-off-the-land-course",
          title: "Living Off The Land Techniques",
          description:
            "Master LOLBAS techniques, fileless attacks, and using legitimate tools for malicious purposes.",
          icon: "fas fa-hammer",
          difficulty: "Expert",
          duration: "14 hours",
          lessons: 36,
          category: "red-team",
          instructor: "Agent Shadow",
          skills: [
            "LOLBAS",
            "Fileless Attacks",
            "Tool Abuse",
            "Stealth Techniques",
          ],
          courseUrl: "courses/living-off-the-land-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "detection-engineering",
          title: "Detection Engineering",
          description:
            "Build custom detection rules, behavioral analytics, and automated threat detection systems for blue team operations.",
          icon: "fas fa-radar",
          difficulty: "Expert",
          duration: "17 hours",
          lessons: 44,
          category: "blue-team",
          instructor: "Dr. Sentinel Blue",
          skills: [
            "Detection Rules",
            "Behavioral Analytics",
            "SIEM Engineering",
            "Threat Detection",
          ],
          courseUrl: "courses/detection-engineering.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "advanced-threat-hunting",
          title: "Advanced Threat Hunting",
          description:
            "Expert-level threat hunting techniques, hypothesis development, and proactive threat discovery methodologies.",
          icon: "fas fa-crosshairs",
          difficulty: "Expert",
          duration: "19 hours",
          lessons: 50,
          category: "blue-team",
          instructor: "Lt. Col. Patricia Brown",
          skills: [
            "Advanced Hunting",
            "Hypothesis Testing",
            "Threat Discovery",
            "Hunt Operations",
          ],
          courseUrl: "courses/advanced-threat-hunting-course.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "automated-defense-systems",
          title: "Automated Defense Systems",
          description:
            "Design and implement automated cybersecurity defense systems, SOAR platforms, and orchestrated incident response.",
          icon: "fas fa-cog",
          difficulty: "Expert",
          duration: "15 hours",
          lessons: 39,
          category: "blue-team",
          instructor: "Dr. Auto Defender",
          skills: [
            "SOAR",
            "Security Automation",
            "Orchestration",
            "Automated Response",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "iso-27001-compliance",
          title: "ISO 27001 Compliance",
          description:
            "Comprehensive ISO 27001 information security management system implementation and audit preparation.",
          icon: "fas fa-certificate",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 31,
          category: "compliance",
          instructor: "Dr. Standard Bearer",
          skills: ["ISO 27001", "ISMS", "Compliance Audit", "Risk Management"],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "gdpr-hipaa-security",
          title: "GDPR & HIPAA Security",
          description:
            "Navigate GDPR and HIPAA compliance requirements with practical implementation strategies for data protection.",
          icon: "fas fa-user-shield",
          difficulty: "Intermediate",
          duration: "9 hours",
          lessons: 25,
          category: "compliance",
          instructor: "Legal Expert Jane Doe",
          skills: [
            "GDPR Compliance",
            "HIPAA Security",
            "Data Protection",
            "Privacy Laws",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "risk-management-advanced",
          title: "Advanced Risk Management",
          description:
            "Enterprise risk management frameworks, quantitative risk analysis, and strategic security decision making.",
          icon: "fas fa-chart-pie",
          difficulty: "Advanced",
          duration: "11 hours",
          lessons: 28,
          category: "risk-management",
          instructor: "Dr. Risk Calculator",
          skills: [
            "Risk Analysis",
            "Quantitative Risk",
            "Risk Frameworks",
            "Strategic Planning",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "iot-hacking-basics",
          title: "IoT Hacking Basics",
          description:
            "Internet of Things security testing, IoT device penetration testing, and smart device vulnerability assessment.",
          icon: "fas fa-microchip",
          difficulty: "Advanced",
          duration: "10 hours",
          lessons: 27,
          category: "iot-security",
          instructor: "Dr. Smart Device",
          skills: [
            "IoT Security",
            "Device Testing",
            "Firmware Analysis",
            "Protocol Security",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "scada-security",
          title: "SCADA & Industrial Control Systems Security",
          description:
            "Industrial control systems security, SCADA penetration testing, and critical infrastructure protection.",
          icon: "fas fa-industry",
          difficulty: "Expert",
          duration: "14 hours",
          lessons: 37,
          category: "iot-security",
          instructor: "Engineer Bob Factory",
          skills: [
            "SCADA Security",
            "ICS Protection",
            "Industrial Networks",
            "Critical Infrastructure",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "smart-device-penetration",
          title: "Smart Device Penetration Testing",
          description:
            "Penetration testing of smart home devices, wearables, and connected IoT ecosystems.",
          icon: "fas fa-home",
          difficulty: "Advanced",
          duration: "11 hours",
          lessons: 29,
          category: "iot-security",
          instructor: "Dr. Connected World",
          skills: [
            "Smart Home Security",
            "Wearable Testing",
            "IoT Penetration",
            "Device Security",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "firmware-analysis",
          title: "Firmware Analysis & Security",
          description:
            "Firmware reverse engineering, embedded system security, and hardware-level vulnerability assessment.",
          icon: "fas fa-microchip",
          difficulty: "Expert",
          duration: "17 hours",
          lessons: 45,
          category: "hardware-security",
          instructor: "Dr. Circuit Board",
          skills: [
            "Firmware Analysis",
            "Embedded Security",
            "Hardware Reverse Engineering",
            "JTAG Analysis",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "side-channel-attacks",
          title: "Side-Channel Attacks",
          description:
            "Advanced side-channel attack techniques, power analysis, electromagnetic analysis, and hardware security testing.",
          icon: "fas fa-bolt",
          difficulty: "Expert",
          duration: "15 hours",
          lessons: 38,
          category: "hardware-security",
          instructor: "Prof. Side Channel",
          skills: [
            "Power Analysis",
            "EM Analysis",
            "Timing Attacks",
            "Hardware Security",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "chip-off-forensics",
          title: "Chip-Off Forensics",
          description:
            "Physical chip-off forensics techniques, NAND flash analysis, and hardware-level data recovery methods.",
          icon: "fas fa-puzzle-piece",
          difficulty: "Expert",
          duration: "13 hours",
          lessons: 32,
          category: "hardware-security",
          instructor: "Dr. Hardware Hacker",
          skills: [
            "Chip-Off",
            "NAND Analysis",
            "Hardware Forensics",
            "Physical Recovery",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "smart-contract-security",
          title: "Smart Contract Security",
          description:
            "Ethereum smart contract security, Solidity vulnerabilities, and DeFi protocol security assessment.",
          icon: "fas fa-file-contract",
          difficulty: "Advanced",
          duration: "13 hours",
          lessons: 34,
          category: "blockchain",
          instructor: "Dr. Vitalik Security",
          skills: [
            "Smart Contract Audit",
            "Solidity Security",
            "DeFi Security",
            "Blockchain Analysis",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "defi-hacking-techniques",
          title: "DeFi Hacking Techniques",
          description:
            "Decentralized Finance security testing, flash loan attacks, and DeFi protocol vulnerability assessment.",
          icon: "fas fa-coins",
          difficulty: "Expert",
          duration: "14 hours",
          lessons: 36,
          category: "blockchain",
          instructor: "Dr. Flash Loan",
          skills: [
            "DeFi Hacking",
            "Flash Loans",
            "Protocol Security",
            "Yield Farming Security",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "web3-vulnerabilities",
          title: "Web3 Vulnerabilities",
          description:
            "Web3 security assessment, dApp penetration testing, and decentralized application security analysis.",
          icon: "fas fa-cube",
          difficulty: "Advanced",
          duration: "12 hours",
          lessons: 31,
          category: "blockchain",
          instructor: "Dr. Decentralized",
          skills: [
            "Web3 Security",
            "dApp Testing",
            "Wallet Security",
            "NFT Security",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "apt-attack-analysis",
          title: "APT Attack Analysis",
          description:
            "Advanced Persistent Threat analysis, nation-state attack patterns, and sophisticated threat actor techniques.",
          icon: "fas fa-satellite",
          difficulty: "Expert",
          duration: "16 hours",
          lessons: 43,
          category: "threat-intelligence",
          instructor: "Agent Classified",
          skills: [
            "APT Analysis",
            "Nation-State TTPs",
            "Attribution",
            "Advanced Threats",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "nation-state-threats",
          title: "Nation-State Threats",
          description:
            "Understanding nation-state cyber operations, geopolitical cyber threats, and state-sponsored attack methodologies.",
          icon: "fas fa-flag",
          difficulty: "Expert",
          duration: "14 hours",
          lessons: 37,
          category: "threat-intelligence",
          instructor: "Dr. Geopolitics",
          skills: [
            "Nation-State Analysis",
            "Geopolitical Threats",
            "State Actors",
            "Cyber Warfare",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "cyber-warfare-strategy",
          title: "Cyber Warfare Strategy",
          description:
            "Strategic aspects of cyber warfare, national cyber security, and cyber conflict analysis.",
          icon: "fas fa-chess",
          difficulty: "Expert",
          duration: "15 hours",
          lessons: 40,
          category: "cyber-warfare",
          instructor: "General Cyber War",
          skills: [
            "Cyber Strategy",
            "National Security",
            "Cyber Conflict",
            "Strategic Planning",
          ],
        },
        {
          id: "red-team-infrastructure",
          title: "Red Team Infrastructure",
          description:
            "Building and managing red team infrastructure, command and control systems, and operational security.",
          icon: "fas fa-server",
          difficulty: "Expert",
          duration: "17 hours",
          lessons: 44,
          category: "red-team",
          instructor: "Red Team Leader",
          skills: [
            "C2 Infrastructure",
            "OpSec",
            "Red Team Operations",
            "Infrastructure Security",
          ],
        },
        {
          id: "attack-chain-design",
          title: "Attack Chain Design",
          description:
            "Design complex attack chains, multi-stage operations, and sophisticated offensive security campaigns.",
          icon: "fas fa-sitemap",
          difficulty: "Expert",
          duration: "16 hours",
          lessons: 42,
          category: "red-team",
          instructor: "Dr. Attack Vector",
          skills: [
            "Attack Chains",
            "Multi-stage Attacks",
            "Campaign Design",
            "Offensive Strategy",
          ],
        },
        {
          id: "evading-detection",
          title: "Evading Detection",
          description:
            "Advanced evasion techniques, anti-forensics, and stealth operations for red team engagements.",
          icon: "fas fa-eye-slash",
          difficulty: "Expert",
          duration: "15 hours",
          lessons: 38,
          category: "red-team",
          instructor: "Ghost Operator",
          skills: [
            "Evasion Techniques",
            "Anti-Forensics",
            "Stealth Operations",
            "Detection Bypass",
          ],
        },
        {
          id: "advanced-firewalling",
          title: "Advanced Firewalling",
          description:
            "Next-generation firewall management, advanced filtering techniques, and network security architecture.",
          icon: "fas fa-fire",
          difficulty: "Advanced",
          duration: "10 hours",
          lessons: 27,
          category: "network-security",
          instructor: "Dr. Firewall Master",
          skills: [
            "NGFW",
            "Advanced Filtering",
            "Network Segmentation",
            "Firewall Architecture",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "zero-trust-implementation",
          title: "Zero Trust Implementation",
          description:
            "Practical zero trust network architecture implementation, identity verification, and micro-segmentation strategies.",
          icon: "fas fa-user-check",
          difficulty: "Advanced",
          duration: "13 hours",
          lessons: 33,
          category: "architecture",
          instructor: "Dr. Never Trust",
          skills: [
            "Zero Trust Implementation",
            "Identity Verification",
            "Micro-segmentation",
            "Access Control",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "intrusion-prevention-systems",
          title: "Intrusion Prevention Systems",
          description:
            "Deploy and manage intrusion prevention systems, signature development, and automated threat blocking.",
          icon: "fas fa-shield-alt",
          difficulty: "Advanced",
          duration: "11 hours",
          lessons: 29,
          category: "network-security",
          instructor: "Dr. Prevention",
          skills: [
            "IPS Management",
            "Signature Development",
            "Threat Blocking",
            "Network Defense",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "full-spectrum-penetration-testing",
          title: "Full-Spectrum Penetration Testing",
          description:
            "Comprehensive penetration testing across all domains including network, web, mobile, and infrastructure testing.",
          icon: "fas fa-globe-americas",
          difficulty: "Expert",
          duration: "25 hours",
          lessons: 65,
          category: "penetration-testing",
          instructor: "Grandmaster Penetrator",
          skills: [
            "Full-Spectrum Testing",
            "Advanced Exploitation",
            "Multi-Domain Testing",
            "Enterprise Penetration",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "advanced-exploit-development",
          title: "Advanced Exploit Development",
          description:
            "Master-level exploit development, zero-day research, and advanced vulnerability exploitation techniques.",
          icon: "fas fa-bomb",
          difficulty: "Expert",
          duration: "22 hours",
          lessons: 58,
          category: "exploit-development",
          instructor: "Dr. Zero Day",
          skills: [
            "Advanced Exploits",
            "Zero-day Research",
            "Exploit Chaining",
            "Advanced Shellcode",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "cybersecurity-leadership",
          title: "Cybersecurity Leadership",
          description:
            "Strategic cybersecurity leadership, team management, and executive-level security decision making.",
          icon: "fas fa-crown",
          difficulty: "Expert",
          duration: "12 hours",
          lessons: 30,
          category: "leadership",
          instructor: "CISO Excellence",
          skills: [
            "Security Leadership",
            "Strategic Planning",
            "Team Management",
            "Executive Communication",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },

        // Additional foundational courses to complete the ecosystem
        {
          id: "cybersecurity-principles",
          title: "Cybersecurity Principles",
          description:
            "Core principles and frameworks in cybersecurity including CIA triad, defense in depth, and security fundamentals.",
          icon: "fas fa-shield-alt",
          difficulty: "Beginner",
          duration: "6 hours",
          lessons: 15,
          category: "fundamentals",
          instructor: "Dr. Foundation",
          skills: [
            "CIA Triad",
            "Defense in Depth",
            "Security Principles",
            "Risk Basics",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "network-security-basics",
          title: "Network Security Basics",
          description:
            "Introduction to network security concepts, firewalls, VPNs, and basic network protection mechanisms.",
          icon: "fas fa-wifi",
          difficulty: "Beginner",
          duration: "8 hours",
          lessons: 18,
          category: "network-security",
          instructor: "Network Guru",
          skills: [
            "Firewall Basics",
            "VPN Technology",
            "Network Protection",
            "Security Devices",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "risk-assessment-basics",
          title: "Risk Assessment Basics",
          description:
            "Learn to identify and assess cybersecurity risks, threat modeling, and risk mitigation strategies.",
          icon: "fas fa-exclamation-triangle",
          difficulty: "Beginner",
          duration: "5 hours",
          lessons: 12,
          category: "risk-management",
          instructor: "Risk Analyst Pro",
          skills: [
            "Risk Assessment",
            "Threat Modeling",
            "Risk Mitigation",
            "Security Metrics",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "penetration-testing-methodology",
          title: "Penetration Testing Methodology",
          description:
            "Systematic penetration testing methodologies, testing frameworks, and professional penetration testing standards.",
          icon: "fas fa-list-check",
          difficulty: "Intermediate",
          duration: "9 hours",
          lessons: 24,
          category: "penetration-testing",
          instructor: "Method Master",
          skills: [
            "Testing Methodology",
            "PTES",
            "OWASP Testing",
            "Professional Standards",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "vulnerability-management",
          title: "Vulnerability Management",
          description:
            "Comprehensive vulnerability management program development, scanning, assessment, and remediation processes.",
          icon: "fas fa-bug",
          difficulty: "Intermediate",
          duration: "8 hours",
          lessons: "21",
          category: "vulnerability-management",
          instructor: "Vuln Manager",
          skills: [
            "Vulnerability Scanning",
            "Risk Prioritization",
            "Patch Management",
            "Remediation Planning",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "security-awareness-training",
          title: "Security Awareness Training",
          description:
            "Design and deliver effective security awareness programs, user education, and human factor security training.",
          icon: "fas fa-graduation-cap",
          difficulty: "Beginner",
          duration: "6 hours",
          lessons: 16,
          category: "awareness",
          instructor: "Awareness Expert",
          skills: [
            "User Education",
            "Phishing Simulation",
            "Security Culture",
            "Awareness Programs",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
        {
          id: "business-continuity-planning",
          title: "Business Continuity Planning",
          description:
            "Develop business continuity and disaster recovery plans with cybersecurity incident considerations.",
          icon: "fas fa-business-time",
          difficulty: "Advanced",
          duration: "10 hours",
          lessons: 26,
          category: "business-continuity",
          instructor: "Continuity Planner",
          skills: [
            "BCP Development",
            "Disaster Recovery",
            "Business Impact Analysis",
            "Recovery Planning",
          ],
          courseUrl: "courses/comingsoon.html",
          previewUrl: "courses/preview/web-application-security.html",
        },
      ];
      // CORRECTED MOBILE SIDEBAR SCRIPT
      document.addEventListener("DOMContentLoaded", function () {
        const sidebar = document.getElementById("sidebar");
        const menuToggle = document.getElementById("mobileMenuToggle");
        const sidebarOverlay = document.getElementById("sidebarOverlay");
        const navItems = document.querySelectorAll(
          ".sidebar-nav .navlink, .sidebar-nav .navlink"
        );

        if (menuToggle) {
          menuToggle.addEventListener("click", function () {
            sidebar.classList.toggle("open");
            sidebarOverlay.style.display = sidebar.classList.contains("open")
              ? "block"
              : "none";
          });
        }

        if (sidebarOverlay) {
          sidebarOverlay.addEventListener("click", function () {
            sidebar.classList.remove("open");
            sidebarOverlay.style.display = "none";
          });
        }

        navItems.forEach((item) => {
          item.addEventListener("click", function () {
            if (
              window.innerWidth <= 768 &&
              sidebar.classList.contains("open")
            ) {
              sidebar.classList.remove("open");
              sidebarOverlay.style.display = "none";
            }
          });
        });
      });

      // Close sidebar when a nav item is clicked (on mobile

      // Close sidebar when clicking outside (for desktop if needed)

      // Load User Achievements
      async function loadUserAchievements() {
        try {
          if (!allAchievements || allAchievements.length === 0) {
            allAchievements = achievements;
          }

          const { data: userAch, error } = await supabase
            .from("user_achievements")
            .select("*")
            .eq("user_id", currentUser.id);

          if (error) throw error;

          // Cache user achievements locally
          userAchievements = userAch || [];
          sessionStorage.setItem(
            "userAchievements",
            JSON.stringify(userAchievements)
          );

          // Update achievement stats
          const unlockedCount = userAchievements.length;
          const totalCount = allAchievements.length;
          const achievementPoints = userAchievements.reduce((sum, ach) => {
            const achievement = allAchievements.find(
              (a) => a.id === ach.achievement_id
            );
            return sum + (achievement ? achievement.points : 0);
          }, 0);

          // Update UI elements
          const elements = {
            unlockedCount: unlockedCount,
            unlockedAchievements: unlockedCount,
            totalAchievementCount: totalCount,
            achievementPoints: achievementPoints,
          };

          Object.entries(elements).forEach(([id, value]) => {
            const element = document.getElementById(id);
            if (element) element.textContent = value;
          });

          // Display achievements after loading them
          await displayAchievements("all");
          return true;
        } catch (error) {
          console.error("Error loading achievements:", error);
          showToast("Failed to load achievements", "error");
          return false;
        }
      }

      // Initialize Dashboard
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          showHackerLoader();

          // Initialize achievements first
          allAchievements = achievements;

          // Try to load cached achievements
          const cached = sessionStorage.getItem("userAchievements");
          if (cached) {
            userAchievements = JSON.parse(cached);
          }

          await checkAuth();

          if (currentUser) {
            await loadUserData();
            await checkStreakOnLogin();
            initializeEventListeners();
            initializeStreakSystem();
            updateNavigationSection();
            trackUserActivity(); // Add this call
            showHackerLoader(false);
          } else {
            showHackerLoader(false);
            showLoginMessage();
          }
        } catch (error) {
          console.error("Error initializing dashboard:", error);
          showHackerLoader(false);
          showToast("Error loading dashboard", "error");
        }
      });
      // Add this immediately after DOMContentLoaded

      // Show/Hide Loaders
      function showHackerLoader(show) {
        const loaderOverlay = document.getElementById("loaderOverlay");
        const loadingText = document.getElementById("loadingText");
        const matrixBg = document.getElementById("matrixBg");

        if (!loaderOverlay) return;

        if (show) {
          loaderOverlay.style.display = "flex";
        } else {
          setTimeout(() => {
            loaderOverlay.style.display = "none";
          }, 4000);
        }
      }

      function startTypingLoader() {
        const loadingTextEl = document.getElementById("loadingText");
        loadingTextEl.innerHTML = ""; // clear placeholder text
        let msgIndex = 0;
        let charIndex = 0;

        function typeChar() {
          if (msgIndex < loadingMessages.length) {
            const currentMsg = loadingMessages[msgIndex];

            if (charIndex < currentMsg.length) {
              loadingTextEl.innerHTML += currentMsg.charAt(charIndex);
              charIndex++;
              setTimeout(typeChar, 40); // typing speed per char
            } else {
              loadingTextEl.innerHTML += "<br>";
              msgIndex++;
              charIndex = 0;
              setTimeout(typeChar, 500); // delay before next line
            }
          } else {
            // All messages done -> hide loader
            setTimeout(() => {
              document.getElementById("loaderOverlay").style.display = "none";
            }, 4000);
          }
        }

        typeChar();
      }

      window.addEventListener("load", startTypingLoader);

      // Call when page loads
      window.addEventListener("load", showHackerLoader);

      function showLoginMessage() {
        const loginMessage = document.getElementById("loginMessage");
        if (loginMessage) loginMessage.classList.add("show");
      }

      // Authentication Check
      async function checkAuth() {
        try {
          const {
            data: { session },
            error,
          } = await supabase.auth.getSession();

          if (error || !session) {
            currentUser = null;
            return;
          }

          currentUser = session.user;
          updateUIWithUser();
        } catch (error) {
          console.error("Error checking auth:", error);
          currentUser = null;
        }
      }

      // Update UI with user info
      function updateUIWithUser() {
        if (!currentUser) return;

        const name =
          currentUser.user_metadata?.full_name ||
          currentUser.email.split("@")[0];
        const userNameEl = document.getElementById("userName");
        const welcomeNameEl = document.getElementById("welcomeName");

        if (userNameEl) userNameEl.textContent = name;
        if (welcomeNameEl) welcomeNameEl.textContent = name;
      }

      // Load User Data with error handling
           // CORRECTED: loadUserData function
      async function loadUserData() {
        try {
          // --- SEQUENTIAL LOADING OF CRITICAL DATA ---
          // 1. Load the user's profile first.
          await loadUserProfile();

          // 2. Load and calculate all user stats. This populates the userStats object.
          await loadUserStats();
          
          // 3. Display the "Resume Journey" card now that stats are loaded.
          await displayResumeJourney();

          // --- LOAD NON-CRITICAL DATA IN PARALLEL ---
          // Now that userStats is ready, we can load other parts of the dashboard.
          await Promise.allSettled([
            loadUserAchievements(), // This now runs AFTER userStats is populated.
            loadCourseProgress(),
            loadCertificatePacks(),
            loadUserCertificates(),
          ]);

          // Check for achievements after a brief delay to ensure UI is stable.
          setTimeout(() => {
            checkInitialAchievements();
            checkPointsAchievements();
            checkCourseAchievements();
          }, 2000);

        } catch (error) {
          console.error("Error loading user data:", error);
          showToast("Failed to load user data", "error");
        }
      }

      // Refresh Stats
      async function refreshStats() {
        try {
          await loadUserStats();
          await loadUserAchievements();
        } catch (error) {
          console.error("Error refreshing stats:", error);
        }
      }

      // Load User Profile
           // Load User Profile - CORRECTED
           // CORRECTED: loadUserProfile
      async function loadUserProfile() {
        try {
          const { data, error } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", currentUser.id)
            .single();

          if (error && error.code !== "PGRST116") {
            console.error("Error loading profile:", error);
            return;
          }

          if (!data) {
            // Create a new profile with ALL necessary fields initialized to 0.
            const newProfile = {
              id: currentUser.id,
              full_name: currentUser.user_metadata?.full_name || "",
              email: currentUser.email,
              level: "Script Kiddie",
              total_points: 0,
              completed_courses: 0,
              current_streak: 0,
              total_certificates: 0,
              total_achievements: 0,
              last_activity: new Date().toISOString(),
              created_at: new Date().toISOString(),
              in_progress_courses: 0,
              settings_changed: 0,
              sections_visited: 0,
              // --- ADDED MISSING COUNTERS FOR ACHIEVEMENT TRACKING ---
              midnight_sessions: 0,
              early_sessions: 0,
              weekend_sessions: 0,
            };

            const { error: insertError } = await supabase
              .from("profiles")
              .insert([newProfile]);

            if (!insertError) {
              setTimeout(() => checkAndUnlockAchievement("first_login"), 1000);
            }
          } else {
            // Update last activity on login
            const { error: updateError } = await supabase
              .from("profiles")
              .update({
                last_activity: new Date().toISOString(),
              })
              .eq("id", currentUser.id);

            if (updateError)
              console.error("Error updating last activity:", updateError);
          }
        } catch (error) {
          console.error("Error in loadUserProfile:", error);
        }
      }
      // Enhanced Load User Stats
           // Enhanced Load User Stats - REVISED
      async function loadUserStats() {
        try {
          // Get the base profile data
          const { data: profile, error: profileError } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", currentUser.id)
            .single();

          if (profileError) {
            console.error("Error loading profile for stats:", profileError);
            return;
          }
          userStats = profile || {};

          // Fetch all sources of points and stats in parallel
          const [
            courseProgressData,
            certificatesData,
            achievementsData,
            pointsHistoryData, // Fetch miscellaneous points
          ] = await Promise.all([
            supabase
              .from("course_progress")
              .select("progress")
              .eq("user_id", currentUser.id),
            supabase
              .from("certificates")
              .select("pack_id")
              .eq("user_id", currentUser.id),
            supabase
              .from("user_achievements")
              .select("points_awarded")
              .eq("user_id", currentUser.id),
            supabase
              .from("points_history")
              .select("points_gained")
              .eq("user_id", currentUser.id),
          ]);

          // --- Start Recalculation from Zero ---
          const completedCourses = courseProgressData.data?.filter(cp => cp.progress >= 100).length || 0;
          const inProgressCourses = courseProgressData.data?.filter(cp => cp.progress > 0 && cp.progress < 100).length || 0;
          const totalCertificates = certificatesData.data?.length || 0;
          const totalAchievements = achievementsData.data?.length || 0;

          // 1. Points from Achievements
          const achievementPoints = achievementsData.data?.reduce((sum, ach) => sum + (ach.points_awarded || 0), 0) || 0;

          // 2. Points from Completed Courses (500 each)
          const coursePoints = completedCourses * 500;
          
          // 3. Points from Certificates
          const certificatePoints = certificatesData.data?.reduce((sum, cert) => {
              const pack = certificatePacks[cert.pack_id];
              return sum + (pack ? pack.points_reward : 0);
          }, 0) || 0;
          
          // 4. (Optional) Points from history for miscellaneous rewards
          const historicPoints = pointsHistoryData.data?.reduce((sum, entry) => sum + (entry.points_gained || 0), 0) || 0;

          // The final, accurate total
          const calculatedTotalPoints = achievementPoints + coursePoints + certificatePoints + historicPoints;

          const updatedStats = {
            completed_courses: completedCourses,
            total_certificates: totalCertificates,
            total_achievements: totalAchievements,
            total_points: calculatedTotalPoints,
            in_progress_courses: inProgressCourses,
          };

          // Update the database with the single source of truth
          await supabase
            .from("profiles")
            .update(updatedStats)
            .eq("id", currentUser.id);

          // Update local state and UI
          Object.assign(userStats, updatedStats);
          updateStatsUI();
          updateDashboardStats();
          updateUserRank();

        } catch (error) {
          console.error("Error loading user stats:", error);
          showToast("Failed to load statistics", "error");
        }
      }
      // Update Stats UI
      function updateStatsUI() {
        const elements = {
          totalPoints: userStats.total_points || 0,
          completedCourses: userStats.completed_courses || 0,
          totalCertificates: userStats.total_certificates || 0,
          totalAchievements: userStats.total_achievements || 0,
          userLevel: userStats.level || "Script Kiddie",
          currentStreak: userStats.current_streak || 0,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });
      }

      // Update Dashboard Stats
      function updateDashboardStats() {
        // This Week Points - Mock calculation for demonstration
        // In a real app, you would fetch point changes from the last 7 days.
        const thisWeekPoints = userStats.bonus_points || 50; // We'll use bonus_points as a proxy for recent gains
        const statChangeEl = document.querySelector(
          "#totalPoints + .stat-change"
        );
        if (statChangeEl) {
          statChangeEl.textContent = `+${thisWeekPoints} this week`;
        }

        // Courses in Progress
        const inProgressEl = document.querySelector(
          "#completedCourses + .stat-change"
        );
        if (inProgressEl) {
          const count = userStats.in_progress_courses || 0;
          inProgressEl.textContent = `${count} in progress`;
        }

        // Achievement Progress
        const achievementProgressEl = document.getElementById(
          "achievementProgress"
        );
        if (achievementProgressEl) {
          const totalAchievementsCount = allAchievements.length || 55;
          achievementProgressEl.textContent = `${
            userStats.total_achievements || 0
          }/${totalAchievementsCount} total`;
        }
      }

      // Streak System
      function initializeStreakSystem() {
        updateStreakDisplay();
        checkDailyStreak();
        startStreakTimer();
        trackSessionStart();
        setInterval(updateStreakDisplay, 60000); // 60,000 ms = 1 minute
      }
      function trackUserActivity() {
        // Update last_activity every 3 minutes to keep the session fresh
        setInterval(async () => {
          if (currentUser) {
            await supabase
              .from("profiles")
              .update({ last_activity: new Date().toISOString() })
              .eq("id", currentUser.id);
          }
        }, 180000); // 180,000 milliseconds = 3 minutes
      }
      function startStreakTimer() {
        if (streakTimer) clearInterval(streakTimer);

        streakTimer = setInterval(async () => {
          await checkStreakStatus();
        }, 60000); // Check every minute
      }
      function closeSettings() {
        const modal = document.getElementById("settingsModal");
        modal.classList.remove("show");
      }
      document.getElementById("settingsBtn").addEventListener("click", () => {
        document.getElementById("settingsModal").classList.add("show");
      });

      async function checkStreakStatus() {
        try {
          const { data, error } = await supabase
            .from("profiles")
            .select("last_activity, current_streak, last_streak_date")
            .eq("id", currentUser.id)
            .single();

          if (error || !data) return;

          const lastActivity = new Date(data.last_activity);
          const now = new Date();
          const hoursSinceActivity = (now - lastActivity) / (1000 * 60 * 60);

          // Set streak reset threshold - reset if inactive for more than 48 hours
          const STREAK_RESET_THRESHOLD_HOURS = 48;

          // Check if streak should be broken
          if (hoursSinceActivity > STREAK_RESET_THRESHOLD_HOURS) {
            // Only reset if streak is not already 0
            if (data.current_streak > 0) {
              await supabase
                .from("profiles")
                .update({
                  current_streak: 0,
                  last_activity: now.toISOString(),
                })
                .eq("id", currentUser.id);

              userStats.current_streak = 0;
              updateStreakDisplay();
              showToast("Streak reset due to inactivity", "error");

              console.log(
                `Streak reset: ${hoursSinceActivity.toFixed(
                  1
                )} hours since last activity`
              );
            }
            return;
          }

          // Check if it's a new day and user is active (within last 24 hours)
          const lastStreakDate = data.last_streak_date
            ? new Date(data.last_streak_date).toDateString()
            : null;
          const today = now.toDateString();

          // Only increment streak if it's a new day and user was active recently
          if (lastStreakDate !== today && hoursSinceActivity < 24) {
            await checkDailyStreak();
          }
        } catch (error) {
          console.error("Error checking streak status:", error);
        }
      }

      function updateStreakDisplay() {
        const streakEl = document.getElementById("userStreak");
        const currentStreakEl = document.getElementById("currentStreak");
        const lastActivityEl = document.getElementById("lastActivity");

        const streakValue = userStats?.current_streak || 0;

        if (streakEl) streakEl.textContent = streakValue;
        if (currentStreakEl) currentStreakEl.textContent = streakValue;

        if (lastActivityEl && userStats?.last_activity) {
          const lastActive = new Date(userStats.last_activity);
          const now = new Date();
          const diffMinutes = Math.floor((now - lastActive) / (1000 * 60));

          if (diffMinutes < 60) {
            if (diffMinutes < 1) {
              lastActivityEl.textContent = "Last active: Just now";
            } else {
              lastActivityEl.textContent = `Last active: ${diffMinutes}m ago`;
            }
          } else {
            const diffHours = Math.floor(diffMinutes / 60);
            if (diffHours < 24) {
              lastActivityEl.textContent = `Last active: ${diffHours}h ago`;
            } else {
              const diffDays = Math.floor(diffHours / 24);
              lastActivityEl.textContent = `Last active: ${diffDays}d ago`;
            }
          }
        }
      }
      async function checkDailyStreak() {
        try {
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("last_activity, current_streak, last_streak_date")
            .eq("id", currentUser.id)
            .single();

          if (error) throw error;

          const now = new Date();
          const today = now.toDateString();
          const lastActivity = profile.last_activity
            ? new Date(profile.last_activity)
            : null;
          const lastStreakDate = profile.last_streak_date
            ? new Date(profile.last_streak_date).toDateString()
            : null;

          let newStreak = profile.current_streak || 0;
          let shouldUpdateStreak = false;

          if (!lastActivity) {
            // First time user
            newStreak = 1;
            shouldUpdateStreak = true;
          } else {
            const hoursSinceLastActivity =
              (now - lastActivity) / (1000 * 60 * 60);
            const daysSinceLastActivity = Math.floor(
              hoursSinceLastActivity / 24
            );

            // If already counted today's streak, don't count again
            if (lastStreakDate === today) {
              return newStreak;
            }

            // Reset streak if more than 48 hours of inactivity
            if (hoursSinceLastActivity > 48) {
              newStreak = 1; // Start fresh streak
              shouldUpdateStreak = true;
              showToast(
                "Previous streak lost due to inactivity, starting fresh!",
                "warning"
              );
            }
            // Continue streak if active within reasonable time (24-48 hours)
            else if (
              daysSinceLastActivity === 1 ||
              (daysSinceLastActivity === 0 && lastStreakDate !== today)
            ) {
              newStreak += 1;
              shouldUpdateStreak = true;
            }
            // Same day activity but haven't counted streak yet
            else if (daysSinceLastActivity === 0 && lastStreakDate !== today) {
              newStreak += 1;
              shouldUpdateStreak = true;
            }
          }

          if (shouldUpdateStreak) {
            await supabase
              .from("profiles")
              .update({
                current_streak: newStreak,
                last_activity: now.toISOString(),
                last_streak_date: now.toISOString(),
              })
              .eq("id", currentUser.id);

            userStats.current_streak = newStreak;
            updateStreakDisplay();

            if (newStreak === 1) {
              showToast("Daily streak started: 1 day!", "success");
            } else {
              showToast(`Daily streak updated: ${newStreak} days!`, "success");
            }

            await checkStreakAchievements(newStreak);
            return newStreak;
          }

          return newStreak;
        } catch (error) {
          console.error("Error checking daily streak:", error);
          return 0;
        }
      }
      async function checkStreakOnLogin() {
        try {
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("last_activity, current_streak, last_streak_date")
            .eq("id", currentUser.id)
            .single();

          if (error) throw error;

          const now = new Date();
          const lastActivity = profile.last_activity
            ? new Date(profile.last_activity)
            : null;

          if (lastActivity) {
            const hoursSinceLastActivity =
              (now - lastActivity) / (1000 * 60 * 60);

            // If more than 48 hours since last activity, reset streak
            if (hoursSinceLastActivity > 48 && profile.current_streak > 0) {
              await supabase
                .from("profiles")
                .update({
                  current_streak: 0,
                  last_activity: now.toISOString(),
                })
                .eq("id", currentUser.id);

              userStats.current_streak = 0;
              updateStreakDisplay();

              showToast(
                "Welcome back! Your streak was reset due to inactivity.",
                "warning"
              );
              console.log(
                `Streak reset on login: ${hoursSinceLastActivity.toFixed(
                  1
                )} hours since last activity`
              );
            }
          }
        } catch (error) {
          console.error("Error checking streak on login:", error);
        }
      }

      // Check streak achievements
      async function checkStreakAchievements(currentStreak) {
        const streakAchievements = [
          { id: "streak_3", requirement: 3 },
          { id: "streak_7", requirement: 7 },
          { id: "streak_14", requirement: 14 },
          { id: "streak_30", requirement: 30 },
          { id: "streak_100", requirement: 100 },
          { id: "streak_365", requirement: 365 },
        ];

        for (const achievement of streakAchievements) {
          if (currentStreak >= achievement.requirement) {
            await checkAndUnlockAchievement(achievement.id, true);
          }
        }
      }

      // Track session start for activity logging
      function trackSessionStart() {
        const sessionStart = new Date();
        sessionStorage.setItem("sessionStart", sessionStart.toISOString());
        logUserActivity("session_start");
      }

      // Log user activity for time-based achievements
      async function logUserActivity(activityType, metadata = {}) {
        try {
          const now = new Date();
          const hour = now.getHours();
          const dayOfWeek = now.getDay();

          // Check time-based achievements immediately
          await checkTimeBasedAchievements(now);

          // Try to log to database if tables exist
          try {
            const activityData = {
              user_id: currentUser.id,
              activity_type: activityType,
              timestamp: now.toISOString(),
              hour: hour,
              day_of_week: dayOfWeek,
              metadata: metadata,
              created_at: now.toISOString(),
            };

            const { error } = await supabase
              .from("user_activities")
              .insert([activityData]);

            if (error && error.code !== "42P01") {
              // Ignore if table doesn't exist
              console.warn(
                "Activity logging table not found, skipping database log"
              );
            }
          } catch (dbError) {
            // Silently handle database errors for optional features
            console.warn(
              "Could not log activity to database:",
              dbError.message
            );
          }
        } catch (error) {
          console.error("Error logging user activity:", error);
        }
      }

      // Check time-based achievements
      async function checkTimeBasedAchievements(timestamp) {
        const hour = timestamp.getHours();
        const dayOfWeek = timestamp.getDay();

        // Night owl (after midnight, before 6 AM)
        if (hour >= 0 && hour < 6) {
          await incrementTimeBasedCounter("midnight_sessions", "night_owl");
        }

        // Early bird (4 AM to 6 AM)
        if (hour >= 4 && hour < 6) {
          await incrementTimeBasedCounter("early_sessions", "early_bird");
        }

        // Weekend warrior (Saturday = 6, Sunday = 0)
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          await incrementTimeBasedCounter(
            "weekend_sessions",
            "weekend_warrior"
          );
        }
      }

      // Increment time-based counters with achievement checking
      async function incrementTimeBasedCounter(counterType, achievementId) {
        try {
          const dateStr = new Date().toISOString().split("T")[0];
          const cacheKey = `${counterType}_${currentUser.id}_${dateStr}`;

          // Prevent multiple increments per day
          if (sessionStorage.getItem(cacheKey)) {
            return;
          }

          // Get current count from profile
          const { data: profile, error } = await supabase
            .from("profiles")
            .select(counterType)
            .eq("id", currentUser.id)
            .single();

          if (error) {
            console.warn(`Could not fetch ${counterType} from profile`);
            return;
          }

          const currentCount = profile[counterType] || 0;
          const newCount = currentCount + 1;

          // Update counter in database
          const { error: updateError } = await supabase
            .from("profiles")
            .update({ [counterType]: newCount })
            .eq("id", currentUser.id);

          if (updateError) throw updateError;

          // Update local stats
          userStats[counterType] = newCount;

          // Cache to prevent double counting today
          sessionStorage.setItem(cacheKey, "true");

          // Check related achievement
          if (achievementId) {
            await checkAndUnlockAchievement(achievementId, true);
          }
        } catch (error) {
          console.error(`Error incrementing ${counterType}:`, error);
        }
      }

      // Enhanced achievement progress calculation for time-based achievements
      async function calculateTimeBasedProgress(achievement) {
        const progress = {
          current: 0,
          required: achievement.requirement.value,
        };

        try {
          switch (achievement.requirement.type) {
            case "streak_days":
              progress.current = userStats?.current_streak || 0;
              break;

            case "midnight_sessions":
              progress.current = userStats?.midnight_sessions || 0;
              break;

            case "early_sessions":
              progress.current = userStats?.early_sessions || 0;
              break;

            case "weekend_sessions":
              progress.current = userStats?.weekend_sessions || 0;
              break;

            case "membership_days":
              if (userStats?.created_at) {
                const created = new Date(userStats.created_at);
                const now = new Date();
                const membershipDays = Math.floor(
                  (now - created) / (1000 * 60 * 60 * 24)
                );
                progress.current = membershipDays;
              }
              break;

            case "daily_study_time":
              // For marathon learner - check if user has studied 8 hours (480 minutes) in any day
              // This is a simplified check - you might want to implement proper daily tracking
              progress.current = 0; // Default to 0 until proper daily tracking is implemented
              break;

            case "course_completion_time":
              // For speed demon - check if any course was completed under 2 hours
              // This requires course timing data to be properly tracked
              progress.current = 0; // Default to 0 until proper timing is implemented
              break;
          }

          return progress;
        } catch (error) {
          console.error(
            `Error calculating time-based progress for ${achievement.id}:`,
            error
          );
          return progress;
        }
      }

      // Enhanced Achievement System
      async function checkInitialAchievements() {
        const basicAchievements = [
          "first_login",
          "profile_complete",
          "explorer",
        ];

        for (const achievementId of basicAchievements) {
          await checkAndUnlockAchievement(achievementId, true);
        }
      }

           // CORRECTED & FINAL: checkAndUnlockAchievement function
      async function checkAndUnlockAchievement(
        achievementId,
        skipNotification = false
      ) {
        try {
          const cacheKey = `achievement_${achievementId}_${currentUser.id}`;
          if (sessionStorage.getItem(cacheKey)) return false;

          const isUnlocked = userAchievements.some(
            (ua) => ua.achievement_id === achievementId
          );
          if (isUnlocked) {
            sessionStorage.setItem(cacheKey, "true");
            return false;
          }

          const achievement = allAchievements.find((a) => a.id === achievementId);
          if (!achievement) return false;

          const progress = await calculateAchievementProgress(achievement);
          
          // Use >= to handle cases where progress might exceed the requirement (e.g., completing 6 courses for a 5-course achievement)
          if (progress.current < progress.required) {
            return false;
          }

          // Atomically insert the new achievement
          const { data, error } = await supabase
            .from("user_achievements")
            .insert([
              {
                user_id: currentUser.id,
                achievement_id: achievementId,
                unlocked_at: new Date().toISOString(),
                points_awarded: achievement.points,
              },
            ])
            .select()
            .single();

          if (error) {
            if (error.code === "23505") return false; // Already exists
            throw error;
          }

          // --- THIS IS THE KEY FIX ---
          // 1. Manually add the new achievement to our local array.
          userAchievements.push(data);
          sessionStorage.setItem(cacheKey, "true");

          // 2. Recalculate numerical stats (like total points and achievement count).
          await loadUserStats();

          // 3. Redraw the achievement grid immediately using the updated local array.
          // This avoids the race condition by not re-fetching from the database.
          await displayAchievements(localStorage.getItem("achievementFilter") || "all");
          
          // 4. Show the notification.
          if (!skipNotification) {
            queueAchievementNotification(achievement);
          }

          return true;
        } catch (error) {
          console.error("Error unlocking achievement:", error);
          return false;
        }
      }
                  // CORRECTED: updateUserStatsAfterAchievement
      async function updateUserStatsAfterAchievement(pointsAwarded) {
        try {
          // REMOVED: The flawed RPC call 'increment_user_stats' is gone.
          // This was the primary source of the inflated achievement and point counts.
          
          // The recalculation done by refreshStats() is now the single, reliable source of truth.
          await refreshStats();
        } catch (error) {
          console.error("Error updating stats after achievement:", error);
          showToast("Failed to update points", "error");
        }
      }

      // Add efficient progress calculation:
           async function calculateAchievementProgress(achievement) {
        // REMOVED: The faulty caching that was storing stale "0" values has been removed.
        const cacheKey = `ach_progress_${achievement.id}_${currentUser.id}`;
        const progress = {
          current: 0,
          required: achievement.requirement.value,
        };

        try {
          // This switch statement will now correctly use the up-to-date userStats object.
          switch (achievement.requirement.type) {
            case "login_count":
              progress.current = 1; 
              break;
            case "profile_complete":
              progress.current = userStats.settings_changed > 0 ? 1 : 0;
              break;
            case "course_started":
              const { data: startedCourses } = await supabase
                .from("course_progress")
                .select("course_id", { count: 'exact', head: true })
                .eq("user_id", currentUser.id)
                .gt("progress", 0);
              progress.current = startedCourses?.count || 0;
              break;
            case "lessons_completed":
              const { data: lessonsData } = await supabase
                .from("course_progress")
                .select("lessons_completed")
                .eq("user_id", currentUser.id);
              progress.current =
                lessonsData?.reduce(
                  (sum, course) => sum + (course.lessons_completed || 0),
                  0
                ) || 0;
              break;
            case "courses_completed":
              progress.current = userStats.completed_courses || 0;
              break;
            case "streak_days":
              progress.current = userStats.current_streak || 0;
              break;
            case "total_points":
              progress.current = userStats.total_points || 0;
              break;
            case "certificates_earned":
              progress.current = userStats.total_certificates || 0;
              break;

            // Time-based achievements
            case "course_completion_time":
              // Check if any course was completed in under the required minutes
              const { data: courseTimesData } = await supabase
                .from("course_progress")
                .select("completion_time_minutes")
                .eq("user_id", currentUser.id)
                .eq("progress", 100);

              const fastestTime = courseTimesData?.reduce((min, course) => {
                const time = course.completion_time_minutes || Infinity;
                return time < min ? time : min;
              }, Infinity);

              progress.current =
                fastestTime !== Infinity &&
                fastestTime <= achievement.requirement.value
                  ? 1
                  : 0;
              break;

            case "daily_study_time":
              // Check if user has studied for required minutes in a single day
              const { data: dailyTimeData } = await supabase
                .from("daily_study_sessions")
                .select("total_minutes")
                .eq("user_id", currentUser.id)
                .order("total_minutes", { ascending: false })
                .limit(1);

              const maxDailyTime = dailyTimeData?.[0]?.total_minutes || 0;
              progress.current =
                maxDailyTime >= achievement.requirement.value ? 1 : 0;
              break;

            // Category-specific completions
            case "category_completion":
              const categoryId = achievement.requirement.value;
              const categoryCourses = courseData.filter(
                (course) => course.category === categoryId
              );

              const { data: categoryProgress } = await supabase
                .from("course_progress")
                .select("course_id, progress")
                .eq("user_id", currentUser.id)
                .in(
                  "course_id",
                  categoryCourses.map((c) => c.id)
                );

              const completedInCategory =
                categoryProgress?.filter((cp) => cp.progress >= 100).length ||
                0;
              progress.current =
                completedInCategory >= categoryCourses.length ? 1 : 0;
              break;

            // Social achievements
            case "forum_posts":
              const { data: forumPostsData } = await supabase
                .from("forum_posts")
                .select("id")
                .eq("user_id", currentUser.id);
              progress.current = forumPostsData?.length || 0;
              break;

            case "forum_helps":
              const { data: forumHelpsData } = await supabase
                .from("forum_posts")
                .select("id")
                .eq("user_id", currentUser.id)
                .eq("is_helpful", true);
              progress.current = forumHelpsData?.length || 0;
              break;

            // Lab and challenge achievements
            case "labs_completed":
              const { data: labsData } = await supabase
                .from("lab_completions")
                .select("lab_id")
                .eq("user_id", currentUser.id);
              progress.current = labsData?.length || 0;
              break;

            case "ctf_wins":
              const { data: ctfData } = await supabase
                .from("ctf_participations")
                .select("id")
                .eq("user_id", currentUser.id)
                .eq("position", 1);
              progress.current = ctfData?.length || 0;
              break;

            case "hackathon_wins":
              const { data: hackathonData } = await supabase
                .from("hackathon_participations")
                .select("id")
                .eq("user_id", currentUser.id)
                .eq("won", true);
              progress.current = hackathonData?.length || 0;
              break;

            // Time-based patterns
            case "midnight_sessions":
              const { data: midnightData } = await supabase
                .from("study_sessions")
                .select("id")
                .eq("user_id", currentUser.id)
                .gte("start_time", "00:00:00")
                .lt("start_time", "06:00:00");
              progress.current = midnightData?.length || 0;
              break;

            case "early_sessions":
              const { data: earlyData } = await supabase
                .from("study_sessions")
                .select("id")
                .eq("user_id", currentUser.id)
                .gte("start_time", "04:00:00")
                .lt("start_time", "06:00:00");
              progress.current = earlyData?.length || 0;
              break;

            case "weekend_sessions":
              const { data: weekendData } = await supabase
                .from("study_sessions")
                .select("created_at")
                .eq("user_id", currentUser.id);

              const weekendCount =
                weekendData?.filter((session) => {
                  const day = new Date(session.created_at).getDay();
                  return day === 0 || day === 6; // Sunday or Saturday
                }).length || 0;
              progress.current = weekendCount;
              break;

            // Special achievements
            case "perfect_scores":
              const { data: scoresData } = await supabase
                .from("assessment_results")
                .select("id")
                .eq("user_id", currentUser.id)
                .eq("score", 100);
              progress.current = scoresData?.length || 0;
              break;

            case "comeback_days":
              // Check if user returned after X days of inactivity
              const { data: activitiesData } = await supabase
                .from("user_activities")
                .select("created_at")
                .eq("user_id", currentUser.id)
                .order("created_at", { ascending: true });

              if (activitiesData && activitiesData.length >= 2) {
                let maxGap = 0;
                for (let i = 1; i < activitiesData.length; i++) {
                  const prev = new Date(activitiesData[i - 1].created_at);
                  const curr = new Date(activitiesData[i].created_at);
                  const gapDays = Math.floor(
                    (curr - prev) / (1000 * 60 * 60 * 24)
                  );
                  maxGap = Math.max(maxGap, gapDays);
                }
                progress.current =
                  maxGap >= achievement.requirement.value ? maxGap : 0;
              }
              break;

            case "beta_tests":
              const { data: betaData } = await supabase
                .from("beta_participations")
                .select("id")
                .eq("user_id", currentUser.id);
              progress.current = betaData?.length || 0;
              break;

            case "member_number":
              // Check if user is among first X members
              const { data: memberData, error: memberError } = await supabase
                .from("profiles")
                // CORRECTED QUERY: Select both id and created_at
                .select("id, created_at")
                .order("created_at", { ascending: true })
                .limit(achievement.requirement.value);

              if (memberError) throw memberError;

              // The rest of the logic can stay the same
              const isEarlyMember = memberData?.some(
                (member) => member.id === currentUser.id
              );
              progress.current = isEarlyMember
                ? achievement.requirement.value
                : 0;
              break;

            // Exploration
            case "sections_visited":
              progress.current = userStats.sections_visited || 0;
              break;

            case "settings_changed":
              progress.current = userStats.settings_changed || 0;
              break;

            // Meta achievements
            case "achievements_unlocked":
              progress.current = userStats.total_achievements || 0;
              break;
            case "midnight_sessions":
              progress.current = userStats?.midnight_sessions || 0;
              break;

            case "early_sessions":
              progress.current = userStats?.early_sessions || 0;
              break;

            case "weekend_sessions":
              progress.current = userStats?.weekend_sessions || 0;
              break;

            case "membership_days":
              if (userStats?.created_at) {
                const created = new Date(userStats.created_at);
                const now = new Date();
                const membershipDays = Math.floor(
                  (now - created) / (1000 * 60 * 60 * 24)
                );
                progress.current = membershipDays;
              }
              break;

            case "daily_study_time":
              // Simplified check - you can enhance this with proper daily tracking
              progress.current = 0;
              break;

            case "course_completion_time":
              // Simplified check - you can enhance this with proper timing data
              progress.current = 0;
              break;
            // Holiday achievements
            case "holiday_learning":
              const holiday = achievement.requirement.value;
              const { data: holidayData } = await supabase
                .from("course_progress")
                .select("updated_at")
                .eq("user_id", currentUser.id)
                .eq("progress", 100);

              const holidayCompletions =
                holidayData?.filter((course) => {
                  const completionDate = new Date(course.updated_at);
                  const month = completionDate.getMonth() + 1;
                  const day = completionDate.getDate();

                  switch (holiday) {
                    case "new_year":
                      return month === 1 && day === 1;
                    case "halloween":
                      return month === 10 && day === 31;
                    default:
                      return false;
                  }
                }).length || 0;

              progress.current = holidayCompletions > 0 ? 1 : 0;
              break;

            // Loyalty/membership
            case "membership_days":
              if (userStats.created_at) {
                const created = new Date(userStats.created_at);
                const now = new Date();
                const membershipDays = Math.floor(
                  (now - created) / (1000 * 60 * 60 * 24)
                );
                progress.current = membershipDays;
              }
              break;

            default:
              console.warn(
                `Unknown achievement requirement type: ${achievement.requirement.type}`
              );
              progress.current = 0;
              break;
          }

          // Ensure progress doesn't exceed requirements for binary achievements
          if (
            [
              "profile_complete",
              "course_completion_time",
              "daily_study_time",
              "category_completion",
              "comeback_days",
              "beta_tests",
              "member_number",
              "holiday_learning",
            ].includes(achievement.requirement.type)
          ) {
            progress.current = Math.min(progress.current, progress.required);
          }

          // Cache the result for 5 minutes
          sessionStorage.setItem(cacheKey, JSON.stringify(progress));
          setTimeout(() => sessionStorage.removeItem(cacheKey), 5 * 60 * 1000);

          return progress;
        } catch (error) {
          console.error(
            `Error calculating progress for achievement ${achievement.id}:`,
            error
          );
          return progress;
        }
      }

      // Add performance optimization for achievements display:
      async function displayAchievements(filter = "all") {
        const grid = document.getElementById("achievementsGrid");
        if (!grid) return;

        // Show loading state
        grid.innerHTML = '<div class="loading">Loading achievements...</div>';

        // Use requestAnimationFrame for smooth rendering
        requestAnimationFrame(async () => {
          try {
            let filteredAchievements = allAchievements;

            if (filter !== "all") {
              filteredAchievements = allAchievements.filter((ach) => {
                if (filter === "unlocked") {
                  return userAchievements.some(
                    (ua) => ua.achievement_id === ach.id
                  );
                } else if (filter === "locked") {
                  return !userAchievements.some(
                    (ua) => ua.achievement_id === ach.id
                  );
                }
                return ach.rarity === filter;
              });
            }

            // Clear grid
            grid.innerHTML = "";

            // Create achievement cards in chunks to prevent UI blocking
            const CHUNK_SIZE = 10;
            for (let i = 0; i < filteredAchievements.length; i += CHUNK_SIZE) {
              const chunk = filteredAchievements.slice(i, i + CHUNK_SIZE);
              await new Promise((resolve) => {
                requestAnimationFrame(async () => {
                  for (const achievement of chunk) {
                    const card = await createAchievementCard(achievement);
                    grid.appendChild(card);
                  }
                  resolve();
                });
              });
            }
          } catch (error) {
            console.error("Error displaying achievements:", error);
            grid.innerHTML =
              '<div class="error">Error loading achievements</div>';
          }
        });
      }
function updateUserRank() {
    const ranks = [
        { name: 'Script Kiddie', minPoints: 0 },
        { name: 'Novice Hacker', minPoints: 1000 },
        { name: 'Adept Coder', minPoints: 2500 },
        { name: 'Cyber Operator', minPoints: 5000 },
        { name: 'Security Specialist', minPoints: 10000 },
        { name: 'Elite Hacker', minPoints: 20000 },
        { name: 'Cyber Master', minPoints: 50000 },
    ];

    const currentPoints = userStats.total_points || 0;
    let currentRank = ranks[0];
    let nextRank = ranks[1];

    for (let i = 0; i < ranks.length; i++) {
        if (currentPoints >= ranks[i].minPoints) {
            currentRank = ranks[i];
            if (i < ranks.length - 1) {
                nextRank = ranks[i + 1];
            } else {
                nextRank = null; // Max rank
            }
        }
    }

    let progressPercent = 0;
    let progressText = `${currentPoints} XP`;

    if (nextRank) {
        const pointsInLevel = currentPoints - currentRank.minPoints;
        const pointsForNextLevel = nextRank.minPoints - currentRank.minPoints;
        progressPercent = (pointsInLevel / pointsForNextLevel) * 100;
        progressText = `${pointsInLevel} / ${pointsForNextLevel} XP`;
    } else {
        progressPercent = 100; // Max rank reached
    }

    document.getElementById('userRank').textContent = currentRank.name;
    document.getElementById('rankProgressText').textContent = progressText;
    document.getElementById('rankProgressBarFill').style.width = `${progressPercent}%`;
    document.getElementById('userLevel').textContent = currentRank.name; // Update sidebar level too
}

// Call this function at the end of loadUserStats()
// Example:
// async function loadUserStats() {
//     // ... your existing code ...
//     updateStatsUI();
//     updateDashboardStats();
//     updateUserRank(); // Add this line
// }
      // Create Achievement Card
      async function createAchievementCard(achievement) {
        const card = document.createElement("div");
        const userAchievement = userAchievements.find(
          (uAch) => uAch.achievement_id === achievement.id
        );
        const isUnlocked = !!userAchievement;

        const progress = await calculateAchievementProgress(achievement);
        const progressPercent = Math.min(
          100,
          (progress.current / progress.required) * 100
        );

        card.className = `achievement-card ${
          isUnlocked ? "unlocked" : "locked"
        }`;

        card.innerHTML = `
    <div class="achievement-header">
      <div class="achievement-icon ${achievement.rarity}">
        <i class="${achievement.icon}"></i>
      </div>
      <div class="achievement-info">
        <div class="achievement-name">${achievement.name}</div>
        <div class="achievement-rarity ${achievement.rarity}">${
          achievement.rarity
        }</div>
      </div>
    </div>
    
    <div class="achievement-description">${achievement.description}</div>
    
    ${
      !isUnlocked
        ? `
      <div class="achievement-progress">
        <div class="achievement-progress-bar">
          <div class="achievement-progress-fill" style="width: ${progressPercent}%"></div>
        </div>
        <div class="achievement-progress-text">
          <span>${progress.current}/${progress.required}</span>
          <span>${Math.round(progressPercent)}%</span>
        </div>
      </div>
    `
        : `
      <div class="achievement-unlock-date">
        Unlocked: ${new Date(userAchievement.unlocked_at).toLocaleDateString()}
      </div>
    `
    }
    
    <div class="achievement-reward">
      <i class="fas fa-coins"></i>
      <span>+${achievement.points} Points</span>
    </div>
  `;

        return card;
        try {
          const progress = await calculateAchievementProgress(achievement);
          const progressPercent = Math.min(
            100,
            (progress.current / progress.required) * 100
          );
          // Update progress bar with real data
        } catch (error) {
          console.error(
            `Error calculating progress for ${achievement.id}:`,
            error
          );
          // Show 0% progress as fallback
        }
      }

      // Show Achievement Notification
      function showAchievementNotification(achievement) {
        const notification = document.getElementById("achievementNotification");
        if (!notification) return;

        const icon = document.getElementById("notificationIcon");
        const title = document.getElementById("notificationTitle");
        const description = document.getElementById("notificationDescription");
        const points = document.getElementById("notificationPoints");

        if (icon) {
          icon.innerHTML = `<i class="${achievement.icon}"></i>`;
          icon.className = `notification-icon ${achievement.rarity}`;
        }
        if (title) title.textContent = achievement.name;
        if (description) description.textContent = achievement.description;
        if (points) points.textContent = `+${achievement.points} Points`;

        notification.className = `achievement-notification ${achievement.rarity}`;
        notification.classList.add("show");

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          notification.classList.remove("show");
        }, duration);
      }

      // Load Course Progress
      async function loadCourseProgress() {
        try {
          const { data: progress, error } = await supabase
            .from("course_progress")
            .select("*")
            .eq("user_id", currentUser.id);

          if (error) throw error;

          const completedCourses =
            progress?.filter((p) => p.progress >= 100).length || 0;
          const inProgressCourses =
            progress?.filter((p) => p.progress > 0 && p.progress < 100)
              .length || 0;

          // Update in database
          await supabase
            .from("profiles")
            .update({
              completed_courses: completedCourses,
              in_progress_courses: inProgressCourses,
            })
            .eq("id", currentUser.id);

          userStats.completed_courses = completedCourses;
          userStats.in_progress_courses = inProgressCourses;
        } catch (error) {
          console.error("Error loading course progress:", error);
        }
      }

      // Load Certificate Packs
      async function loadCertificatePacks() {
        const packGrid = document.getElementById("packGrid");
        if (!packGrid) return;

        packGrid.innerHTML = "";

        try {
          // First get course progress
          const { data: progress, error: progressError } = await supabase
            .from("course_progress")
            .select("course_id, progress")
            .eq("user_id", currentUser.id);

          if (progressError) throw progressError;

          const userProgress = progress || [];

          // Get all certificates in one query
          const { data: certificates, error: certError } = await supabase
            .from("certificates")
            .select("pack_id, certificate_id, recipient_name")
            .eq("user_id", currentUser.id);

          if (certError) throw certError;

          // Create certificate lookup map
          const certMap = new Map(
            certificates?.map((cert) => [cert.pack_id, cert]) || []
          );

          // Create pack cards
          for (const [packId, pack] of Object.entries(certificatePacks)) {
            const existingCert = certMap.get(packId);
            const card = await createPackCard(pack, userProgress, existingCert);
            packGrid.appendChild(card);
          }
        } catch (error) {
          console.error("Error loading certificate packs:", error);
          showToast("Failed to load certificate packs", "error");
        }
      }

      // Create Pack Card
      async function createPackCard(pack, userProgress, existingCert) {
        const card = document.createElement("div");

        const completedCourses = pack.courses.filter((courseId) => {
          const progress = userProgress.find((p) => p.course_id === courseId);
          return progress && progress.progress >= 100;
        });

        const packProgress = Math.round(
          (completedCourses.length / pack.courses.length) * 100
        );
        const isPackCompleted = packProgress >= 100;

        card.className = `pack-card ${isPackCompleted ? "completed" : ""}`;

        card.innerHTML = `
    <div class="pack-header">
      <h3 class="pack-title">${pack.name}</h3>
      <span class="pack-badge">${pack.badge_type}</span>
    </div>
    <p class="pack-description">${pack.description}</p>
    
    <div class="pack-progress">
      <div class="pack-progress-header">
        <span class="pack-progress-label">${completedCourses.length}/${
          pack.courses.length
        } Courses</span>
        <span class="pack-progress-percentage">${packProgress}%</span>
      </div>
      <div class="pack-progress-bar">
        <div class="pack-progress-fill" style="width: ${packProgress}%"></div>
      </div>
    </div>
    
    <div class="pack-courses">
      <h4>Required Courses:</h4>
      <div class="course-list">
        ${pack.courses
          .map((courseId) => {
            const course = courseData.find((c) => c.id === courseId);
            const progress = userProgress.find((p) => p.course_id === courseId);
            const isCompleted = progress && progress.progress >= 100;
            const isInProgress =
              progress && progress.progress > 0 && progress.progress < 100;

            let statusClass = "not-started";
            let statusIcon = "○";

            if (isCompleted) {
              statusClass = "completed";
              statusIcon = "✓";
            } else if (isInProgress) {
              statusClass = "in-progress";
              statusIcon = "◐";
            }

            return `
            <div class="course-item">
              <span class="course-status ${statusClass}">${statusIcon}</span>
              <span class="course-name ${isCompleted ? "completed" : ""}">${
              course ? course.title : courseId
            }</span>
            </div>
          `;
          })
          .join("")}
      </div>
    </div>
    
    <div class="pack-actions">
      ${
        existingCert
          ? `<button class="btn-certificate" onclick="viewCertificate('${pack.id}')">
            <i class="fas fa-eye"></i> View Certificate
          </button>`
          : `<button class="btn-certificate ${
              !isPackCompleted ? "disabled" : ""
            }" 
            ${
              isPackCompleted
                ? `onclick="requestCertificate('${pack.id}')"`
                : "disabled"
            }>
            <i class="fas fa-certificate"></i> 
            ${
              isPackCompleted
                ? "Get Certificate"
                : `${completedCourses.length}/${pack.courses.length} Completed`
            }
          </button>`
      }
    </div>
  `;

        return card;
      }

      // Certificate Functions
      function requestCertificate(packId) {
        currentPackForCertificate = packId;
        const modal = document.getElementById("certificateModal");
        if (modal) {
          modal.classList.add("show");
          const nameInput = document.getElementById("certificateName");
          if (nameInput) {
            nameInput.value = userStats.full_name || "";
            nameInput.focus();
          }
        }
      }

      function closeCertificateModal() {
        const modal = document.getElementById("certificateModal");
        if (modal) modal.classList.remove("show");
        currentPackForCertificate = null;
      }

                 async function generateCertificate() {
        const recipientName = document
          .getElementById("certificateName")
          ?.value.trim();

        if (!recipientName) {
          showToast("Please enter your full name", "error");
          return;
        }

        if (recipientName.length < 2) {
          showToast("Please enter a valid full name", "error");
          return;
        }

        if (!currentPackForCertificate) {
          showToast("No certificate pack selected", "error");
          return;
        }

        try {
          const pack = certificatePacks[currentPackForCertificate];

          const { data: existingCert, error: checkError } = await supabase
            .from("certificates")
            .select("certificate_id, recipient_name, issued_date")
            .eq("user_id", currentUser.id)
            .eq("pack_id", pack.id)
            .single();

          if (checkError && checkError.code !== "PGRST116") {
            throw checkError;
          }

          let certificateId;
          let issuedDate;

          if (existingCert) {
            certificateId = existingCert.certificate_id;
            issuedDate = existingCert.issued_date;
          } else {
            certificateId = generateCertificateId();
            issuedDate = new Date().toISOString();

            await supabase
              .from("certificates")
              .insert([
                {
                  certificate_id: certificateId,
                  user_id: currentUser.id,
                  pack_id: pack.id,
                  pack_name: pack.name,
                  recipient_name: recipientName,
                  issued_date: issuedDate,
                  certificate_type: pack.certificate_template,
                },
              ]);
            
            // Log the points earned to the history table for accurate recalculation.
            await supabase.from("points_history").insert({
              user_id: currentUser.id,
              points_gained: pack.points_reward,
              reason: `Certificate: ${pack.name}`,
            });

            // REMOVED: The direct update to bonus_points is gone.

            await checkAndUnlockAchievement("first_certificate");
            await checkAndUnlockAchievement("certificate_collector");
            await checkAndUnlockAchievement("all_certificates");
            await checkPointsAchievements();
          }

          displayCertificate(pack, recipientName, certificateId, issuedDate);
          closeCertificateModal();
          await loadCertificatePacks();
          showToast("Certificate generated successfully!", "certificate");
          await refreshStats(); // Trigger the accurate recalculation
        } catch (error) {
          console.error("Error generating certificate:", error);
          showToast("Failed to generate certificate", "error");
        }
      }
      // Check Points Achievements
      async function checkPointsAchievements() {
        const pointAchievements = [
          "points_1000",
          "points_5000",
          "points_10000",
          "points_25000",
          "points_50000",
          "points_100000",
        ];

        for (const achievementId of pointAchievements) {
          await checkAndUnlockAchievement(achievementId, true);
        }
      }

      // Generate unique certificate ID
      function generateCertificateId() {
        const timestamp = Date.now().toString(36);
        const randomStr = Math.random().toString(36).substring(2, 8);
        return `CERT-${timestamp}-${randomStr}`.toUpperCase();
      }

      // Display Certificate
      function displayCertificate(
        pack,
        recipientName,
        certificateId,
        issuedDate
      ) {
        const certificateHtml = `
    <div class="certificate-display" style="background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460); border: 3px solid #ffd700; border-radius: 20px; padding: 3rem; text-align: center; position: relative; overflow: hidden; max-width: 800px; margin: 0 auto;">
      <div style="position: absolute; top: 20px; left: 20px; right: 20px; bottom: 20px; border: 2px solid rgba(255, 215, 0, 0.3); border-radius: 15px;"></div>
      
      <div style="position: relative; z-index: 2;">
        <div style="display: flex; justify-content: center; margin-bottom: 2rem;">
          <div style="background: radial-gradient(circle, #ffd700, #ffed4e); width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);">
            <i class="fas fa-award" style="font-size: 2rem; color: #1a1a2e;"></i>
          </div>
        </div>
        
        <h1 style="font-family: var(--font-primary); font-size: 2.5rem; color: #ffd700; margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);">CERTIFICATE</h1>
        <p style="font-size: 1.2rem; color: #ccc; margin-bottom: 2rem; font-style: italic;">OF PROFESSIONAL COMPLETION</p>
        
        <p style="font-size: 1.1rem; color: white; margin-bottom: 1rem;">This is to certify that</p>
        <h2 style="font-family: var(--font-primary); font-size: 2.5rem; color: #ffd700; margin: 1rem 0; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);">${recipientName}</h2>
        
        <p style="color: white; margin-bottom: 1rem;">has successfully completed the professional training program</p>
        <h3 style="font-size: 1.5rem; color: #00ff41; font-weight: 700; margin: 1rem 0;">${
          pack.name
        }</h3>
        
        <p style="color: #ccc; line-height: 1.6; margin-bottom: 2rem;">demonstrating proficiency in cybersecurity skills and knowledge as outlined by CipherHall's comprehensive curriculum.</p>
        
        <div style="border-top: 2px solid #ffd700; padding-top: 2rem; margin-top: 3rem; display: flex; justify-content: space-between; align-items: end;">
          <div style="text-align: left;">
            <strong style="color: #ffd700;">Issued:</strong><br>
            <span style="color: #ccc;">${new Date(
              issuedDate
            ).toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })}</span>
          </div>
          <div style="text-align: center;">
            <div style="border-top: 1px solid #ffd700; width: 200px; margin-bottom: 0.5rem;"></div>
            <div style="color: #ffd700; font-weight: 600;">CipherHall</div>
          </div>
          <div style="text-align: right;">
            <strong style="color: #ffd700;">Certificate ID:</strong><br>
            <span style="color: #ccc; font-family: var(--font-secondary); font-size: 0.9rem;">${certificateId}</span>
          </div>
        </div>
      </div>
    </div>
  `;

        const modal = document.createElement("div");
        modal.className = "certificate-modal show";
        modal.style.background = "rgba(0, 0, 0, 0.95)";
        modal.innerHTML = `
    <div style="max-width: 700px; width: 95%; position: relative; max-height: 90vh; overflow-y: auto;">
      <button onclick="this.parentElement.parentElement.remove()" 
              style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: white; font-size: 2rem; cursor: pointer; z-index: 10;">
        ×
      </button>
      ${certificateHtml}
      <div style="text-align: center; margin: 1.5rem 0; padding: 1rem;">
        <button onclick="downloadCertificate('${certificateId}')" class="btn-primary" style="margin-right: 1rem; padding: 12px 20px;">
          <i class="fas fa-download"></i> Download PNG
        </button>
        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="btn-secondary" style="padding: 12px 20px;">
          Close
        </button>
      </div>
    </div>
  `;

        document.body.appendChild(modal);
      }

      // View existing certificate
      async function viewCertificate(packId) {
        try {
          const { data: cert, error } = await supabase
            .from("certificates")
            .select("*")
            .eq("user_id", currentUser.id)
            .eq("pack_id", packId)
            .single();

          if (error) throw error;

          const pack = certificatePacks[packId];
          displayCertificate(
            pack,
            cert.recipient_name,
            cert.certificate_id,
            cert.issued_date
          );
        } catch (error) {
          console.error("Error viewing certificate:", error);
          showToast("Failed to load certificate", "error");
        }
      }

      // Download certificate
      async function downloadCertificate(certificateId) {
        try {
          const certElement = document.querySelector(".certificate-display");
          if (!certElement) {
            showToast("Certificate not found for download", "error");
            return;
          }

          const canvas = await html2canvas(certElement, {
            scale: 2,
            useCORS: true,
            scrollY: -window.scrollY,
          });

          const link = document.createElement("a");
          link.download = `CyberSec_Certificate_${certificateId}.png`;
          link.href = canvas.toDataURL("image/png");
          link.click();

          showToast("Certificate downloaded successfully!", "certificate");
        } catch (error) {
          console.error("Error downloading certificate:", error);
          showToast("Download failed. Please try again.", "error");
        }
      }

      // Load User Certificates
      async function loadUserCertificates() {
        try {
          const { data: certificates, error } = await supabase
            .from("certificates")
            .select("*")
            .eq("user_id", currentUser.id)
            .order("issued_date", { ascending: false });

          if (error) throw error;

          if (certificates) {
            userStats.total_certificates = certificates.length;
            const element = document.getElementById("totalCertificates");
            if (element) element.textContent = certificates.length;
          }
        } catch (error) {
          console.error("Error loading certificates:", error);
          showToast("Failed to load certificates", "error");
        }
      }

      // Initialize Event Listeners
      function initializeEventListeners() {
        // Settings modal
        const settingsBtn = document.getElementById("settingsBtn");
        if (settingsBtn) settingsBtn.addEventListener("click", openSettings);

        // Navigation
        document.querySelectorAll(".nav-item").forEach((item) => {
          item.addEventListener("click", (e) => {
            e.preventDefault();
            const section = e.target.closest(".nav-item").dataset.section;
            if (section) switchSection(section);
          });
        });

        // Certificate modal enter key
        const certNameInput = document.getElementById("certificateName");
        if (certNameInput) {
          certNameInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") generateCertificate();
          });
        }

        // Close modals on backdrop click
        const certModal = document.getElementById("certificateModal");
        if (certModal) {
          certModal.addEventListener("click", (e) => {
            if (e.target.id === "certificateModal") closeCertificateModal();
          });
        }

        const settingsModal = document.getElementById("settingsModal");
        if (settingsModal) {
          settingsModal.addEventListener("click", (e) => {
            if (e.target.id === "settingsModal") closeSettings();
          });
        }

        // Initialize achievement filters
        initializeAchievementFilters();
      }

      // Achievement Filter Functions
      function initializeAchievementFilters() {
        const filterButtons = document.querySelectorAll(".filter-btn");

        // Get saved filter from localStorage or default to "all"
        const savedFilter = localStorage.getItem("achievementFilter") || "all";

        // Set active class on the correct filter button
        filterButtons.forEach((btn) => {
          if (btn.dataset.filter === savedFilter) {
            btn.classList.add("active");
          } else {
            btn.classList.remove("active");
          }
        });

        // Display achievements with saved filter immediately
        displayAchievements(savedFilter);

        // Add click handlers for filter buttons
        filterButtons.forEach((button) => {
          button.addEventListener("click", async (e) => {
            e.preventDefault();
            filterButtons.forEach((btn) => btn.classList.remove("active"));
            button.classList.add("active");

            const filter = button.dataset.filter;
            localStorage.setItem("achievementFilter", filter);
            await displayAchievements(filter);
          });
        });
      }

      // Settings Functions
      async function openSettings() {
        const modal = document.getElementById("settingsModal");
        if (modal) modal.classList.add("show");

        const nameInput = document.getElementById("settingsName");
        const emailDisplay = document.getElementById("settingsEmail");

        if (nameInput) nameInput.value = userStats.full_name || "";
        if (emailDisplay) {
          emailDisplay.value = currentUser.email || "";
          emailDisplay.disabled = true; // Email cannot be changed
        }

        await trackSectionVisit("settings");
      }

      function closeSettings() {
        const modal = document.getElementById("settingsModal");
        if (modal) modal.classList.remove("show");
      }

      async function saveSettings() {
        try {
          const nameInput = document.getElementById("settingsName");
          if (!nameInput) return;

          const fullName = nameInput.value.trim();
          if (!fullName || fullName.length < 2) {
            showToast("Please enter a valid full name", "error");
            return;
          }

          const settings = {
            full_name: fullName,
            updated_at: new Date().toISOString(),
            settings_changed: 1,
          };

          const { error } = await supabase
            .from("profiles")
            .update(settings)
            .eq("id", currentUser.id);

          if (error) throw error;

          // Update local state
          userStats.full_name = fullName;

          // Update UI
          const userNameEl = document.getElementById("userName");
          const welcomeNameEl = document.getElementById("welcomeName");
          if (userNameEl) userNameEl.textContent = fullName;
          if (welcomeNameEl) welcomeNameEl.textContent = fullName;

          showToast("Settings saved successfully!", "success");
          closeSettings();

          // Check achievements
          await checkAndUnlockAchievement("settings_customizer");
          await checkAndUnlockAchievement("profile_complete");
        } catch (error) {
          console.error("Error saving settings:", error);
          showToast("Error saving settings", "error");
        }
      }

      async function signOut() {
        try {
          showHackingLoader();
          const { error } = await supabase.auth.signOut();
          if (error) throw error;

          setTimeout(() => {
            window.location.href = "/";
          }, 1000);
        } catch (error) {
          console.error("Error signing out:", error);
          showToast("Error signing out", "error");
          hideHackingLoader();
        }
      }

      // Track Section Visit
      async function trackSectionVisit(section) {
        try {
          const { data, error } = await supabase
            .from("profiles")
            .select("sections_visited")
            .eq("id", currentUser.id)
            .single();

          if (error) throw error;

          const visitedSections = data.sections_visited || 0;
          if (visitedSections < 7) {
            await supabase
              .from("profiles")
              .update({ sections_visited: visitedSections + 1 })
              .eq("id", currentUser.id);

            userStats.sections_visited = visitedSections + 1;
            await checkAndUnlockAchievement("explorer");
          }
        } catch (error) {
          console.error("Error tracking section visit:", error);
        }
      }

      // Enhanced Navigation Functions
      function updateNavigationSection() {
        const navItems = document.querySelectorAll(".nav-item");
        navItems.forEach((item) => {
          item.classList.toggle(
            "active",
            item.dataset.section === currentSection
          );
        });
      }

      async function switchSection(section) {
        currentSection = section;
        updateNavigationSection();

        // Track section visit
        await trackSectionVisit(section);

        // Load section-specific content
        switch (section) {
          case "achievements":
            if (allAchievements.length > 0) {
              await displayAchievements();
              showToast("Achievement system loaded!", "certificate");
            }
            break;
          case "courses":
            await loadCourseProgress();
            showToast("Loading courses...", "success");
            break;
          case "certificates":
            await loadCertificatePacks();
            showToast("Loading your certificates...", "certificate");
            break;
          case "labs":
            showToast("Lab environment initializing...", "success");
            break;
          case "leaderboard":
            showToast("Loading global leaderboard...", "success");
            break;
          case "dashboard":
            await refreshStats();
            showToast("Dashboard refreshed!", "success");
            break;
          default:
            showToast(`Navigating to ${section}...`, "success");
        }
      }

      // Enhanced Toast Notification
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const messageEl = document.getElementById("toastMessage");

        if (!toast || !messageEl) return;

        messageEl.textContent = message;
        toast.className = `toast ${type}`;
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
        }, 4000);
      }

      // Simulate course completion for testing
      async function simulateCourseCompletion(courseId) {
        try {
          await supabase.from("course_progress").upsert([
            {
              user_id: currentUser.id,
              course_id: courseId,
              progress: 100,
              lessons_completed: 20, // Assuming a sample number of lessons
              updated_at: new Date().toISOString(),
            },
          ]);

          showToast(`Course ${courseId} completed!`, "success");

          // REMOVED: The manual update to total_points is gone.
          // refreshStats() will now correctly account for the 500 points
          // for a completed course during its recalculation.

          await checkCourseAchievements();
          await checkPointsAchievements();
          await refreshStats();
          await loadCertificatePacks();
        } catch (error) {
          console.error("Error simulating course completion:", error);
          showToast("Error completing course", "error");
        }
      }
      async function checkCourseAchievements() {
        const courseAchievements = [
          "first_course_start",
          "first_lesson",
          "course_completion_1",
          "course_completion_5",
          "course_completion_10",
          "course_completion_25",
        ];

        for (const achievementId of courseAchievements) {
          await checkAndUnlockAchievement(achievementId, true);
        }
      }

      // Simulate streak increase for testing
      async function simulateStreakIncrease() {
        try {
          const currentStreak = userStats?.current_streak || 0;
          const newStreak = currentStreak + 1;
          const now = new Date();

          const { error } = await supabase
            .from("profiles")
            .update({
              current_streak: newStreak,
              last_activity: now.toISOString(),
              last_streak_date: now.toISOString(),
            })
            .eq("id", currentUser.id);

          if (error) throw error;

          userStats.current_streak = newStreak;
          updateStreakDisplay();

          showToast(`Streak increased to ${newStreak} days!`, "success");

          // Check streak achievements
          await checkStreakAchievements(newStreak);
        } catch (error) {
          console.error("Error simulating streak increase:", error);
          showToast("Error increasing streak", "error");
        }
      }

      // Mobile Sidebar Toggle
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        if (sidebar) sidebar.classList.toggle("open");
      }

      // Handle window resize
      window.addEventListener("resize", () => {
        if (window.innerWidth > 768) {
          const sidebar = document.getElementById("sidebar");
          if (sidebar) sidebar.classList.remove("open");
        }
      });

      // Add mobile menu toggle for smaller screens
      if (window.innerWidth <= 768) {
        const menuToggle = document.createElement("button");
        menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
        menuToggle.className = "menu-toggle";
        menuToggle.style.cssText = `
    position: fixed; 
    top: 1rem; 
    left: 1rem; 
    z-index: 1001; 
    background: var(--color-green); 
    color: var(--color-black); 
    border: none; 
    padding: 10px; 
    border-radius: 5px; 
    cursor: pointer;
    font-size: 1.2rem;
  `;
        menuToggle.addEventListener("click", toggleSidebar);
        document.body.appendChild(menuToggle);
      }

      // Developer testing shortcuts
           document.addEventListener("keydown", async (e) => { // Make async
        // Ctrl+Shift+C: Complete courses
        if (e.ctrlKey && e.shiftKey && e.key === "C") {
          const courseIds = [
            "ethical-hacking-fundamentals",
            "computer-networking-basics",
            "linux-command-line-basics",
          ];
          for (const courseId of courseIds) {
            await simulateCourseCompletion(courseId);
          }
          showToast("Developer mode: Sample courses completed!", "success");
        }

        // Ctrl+Shift+S: Increase streak
        if (e.ctrlKey && e.shiftKey && e.key === "S") {
          await simulateStreakIncrease();
          showToast("Developer mode: Increasing streak...", "success");
        }

        // Ctrl+Shift+P: Add points
        if (e.ctrlKey && e.shiftKey && e.key === "P") {
          const pointsToAdd = 1000;
          // CORRECTED: Log points to history instead of forcing the total
          await supabase.from("points_history").insert({
              user_id: currentUser.id,
              points_gained: pointsToAdd,
              reason: 'Developer adjustment'
          });
          showToast(`Added ${pointsToAdd} points! Refreshing...`, "success");
          await refreshStats(); // Trigger the accurate recalculation
        }

        // Ctrl+Shift+R: Refresh all data
        if (e.ctrlKey && e.shiftKey && e.key === "R") {
          await refreshStats();
          showToast("Developer mode: Refreshing all data...", "success");
        }
      });

      // Achievement notification queue for multiple unlocks
      let notificationQueue = [];
      let isShowingNotification = false;

      function queueAchievementNotification(achievement) {
        notificationQueue.push(achievement);
        processNotificationQueue();
      }

      function processNotificationQueue() {
        if (isShowingNotification || notificationQueue.length === 0) return;

        isShowingNotification = true;
        const achievement = notificationQueue.shift();
        showAchievementNotification(achievement);

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          isShowingNotification = false;
          processNotificationQueue();
        }, duration + 500);
      }

      // Export user achievements
      async function exportUserAchievements() {
        try {
          const achievementData = userAchievements.map((uAch) => {
            const achievement = allAchievements.find(
              (a) => a.id === uAch.achievement_id
            );
            return {
              name: achievement?.name || "Unknown",
              description: achievement?.description || "",
              rarity: achievement?.rarity || "common",
              points: achievement?.points || 0,
              unlocked_date: uAch.unlocked_at,
              category: achievement?.category || "general",
            };
          });

          const exportData = {
            user_email: currentUser.email,
            total_achievements: userAchievements.length,
            total_points_from_achievements: achievementData.reduce(
              (sum, ach) => sum + ach.points,
              0
            ),
            achievements: achievementData,
            export_date: new Date().toISOString(),
          };

          const blob = new Blob([JSON.stringify(exportData, null, 2)], {
            type: "application/json",
          });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `cipehrhall_achievements_${
            currentUser.email
          }_${Date.now()}.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          showToast("Achievements exported successfully!", "certificate");
        } catch (error) {
          console.error("Error exporting achievements:", error);
          showToast("Error exporting achievements", "error");
        }
      }
async function displayResumeJourney() {
    const resumeSection = document.getElementById('resumeJourneySection');
    if (!currentUser || !resumeSection) return;

    // Get the most recently updated in-progress course
    const { data: recentCourses, error } = await supabase
        .from('course_progress')
        .select('course_id, progress, lessons_completed, updated_at')
        .eq('user_id', currentUser.id)
        .gt('progress', 0)
        .lt('progress', 100)
        .order('updated_at', { ascending: false })
        .limit(1);

    if (error || !recentCourses || recentCourses.length === 0) {
        resumeSection.style.display = 'none'; // Hide if no in-progress courses
        return;
    }

    const recentCourseProgress = recentCourses[0];
    const courseInfo = courseData.find(c => c.id === recentCourseProgress.course_id);

    if (!courseInfo) return;

    resumeSection.innerHTML = `
        <h2 class="section-title">Resume Your Journey</h2>
        <div class="resume-card">
            <div class="resume-icon">
                <i class="${courseInfo.icon}"></i>
            </div>
            <div class="resume-details">
                <span class="course-category">${courseInfo.category.replace('-', ' ').toUpperCase()}</span>
                <h3>${courseInfo.title}</h3>
                <p>${courseInfo.description}</p>
            </div>
            <div class="resume-progress">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" style="width: ${recentCourseProgress.progress}%;"></div>
                </div>
                <span class="progress-percentage">${recentCourseProgress.progress}% Complete</span>
            </div>
            <div class="resume-action">
                <a href="${courseInfo.courseUrl}" class="btn btn-primary">
                    Continue Course <i class="fas fa-arrow-right"></i>
                </a>
            </div>
        </div>
    `;
    resumeSection.style.display = 'block';
}

// Call this function within your loadUserData() function
// Example:
// async function loadUserData() {
//     // ... your existing code ...
//     await displayResumeJourney(); // Add this line
//     // ... rest of your code ...
// }
      // Periodic data refresh
      setInterval(async () => {
        if (
          currentUser &&
          !document
            .getElementById("certificateModal")
            ?.classList.contains("show")
        ) {
          await checkInitialAchievements();
        }
      }, 60000); // Check every minute

      console.log("CipherHall Enhanced Dashboard Loaded Successfully!");
    </script>
  </body>
</html>

