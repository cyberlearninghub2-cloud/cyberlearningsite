


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- ========== Start: SEO & Schema Enhancement ========== -->
    <title>Crisis Management in Cybersecurity Course | CipherHall</title>
    <meta name="description" content="Enroll in our expert-led Crisis Management in Cybersecurity course. Master incident response, strategic communication, and executive leadership for major cyber threats." />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />
    <link rel="canonical" href="https://www.cipherhall.com/courses/crisis-management-in-cybersecurity-detail.html" />
    <meta name="robots" content="noindex, nofollow" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Course",
      "name": "Crisis Management in Cybersecurity - Complete Course",
      "description": "Master the art and science of managing cybersecurity crises, from initial incident response and technical remediation to strategic communication, legal considerations, and executive leadership.",
      "provider": {
        "@type": "Organization",
        "name": "CipherHall",
        "sameAs": "https://www.cipherhall.com"
      },
      "hasCourseInstance": {
        "@type": "CourseInstance",
        "courseMode": "Online",
        "instructor": {
          "@type": "Person",
          "name": "Dr. Anya Sharma"
        }
      }
    }
    </script>
    <!-- ========== End: SEO & Schema Enhancement ========== -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Exo+2:wght@700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css"
    />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />

    <link rel="stylesheet" href="assets/css/coursepages.css" />
</head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loader-icon">
        <i class="fas fa-graduation-cap"></i>
      </div>
      <div class="loader-text">Loading Course Content...</div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Music Player (fixed at top right) -->
    <div class="header-controls">
      <div class="music-dropdown" id="music-dropdown">
        <button class="btn btn-secondary">
          <span id="music-button-text">STUDY MUSIC</span>
          <i id="music-icon" class="fa-solid fa-music"></i>
        </button>
        <div class="music-dropdown-content" id="music-dropdown-content">
          <a
            href="#"
            data-src="https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3"
            >1. Coffee Shop Vibes</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-16.mp3"
            >2. City Lights Lofi</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3"
            >3. Mellow Thoughts</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-13.mp3"
            >4. Rainy Mood</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3"
            >5. Time Alone</a
          >
          <a href="#" id="stop-music-link"
            ><i class="fa-solid fa-stop-circle"></i> Stop Music</a
          >
        </div>
      </div>

      <button class="btn btn-secondary" id="resetProgressBtn">
        <i class="fas fa-redo"></i>
        Reset Progress
      </button>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal" style="display: none">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <span class="close" id="closeAuthModal">&times;</span>
        <div class="auth-tabs">
          <button id="tabSignIn" class="auth-tab active">Sign In</button>
          <button id="tabSignUp" class="auth-tab">Sign Up</button>
        </div>
        <div
          id="authLoader"
          style="display: none; text-align: center; padding: 2rem"
        >
          <i
            class="fas fa-spinner fa-spin fa-2x"
            style="color: var(--color-green)"
          ></i>
          <p style="margin-top: 0.5rem">Authenticating...</p>
        </div>
        <div id="signInForm" class="auth-form">
          <h2>Sign In to CipherHall</h2>
          <button id="googleSignIn" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignInForm">
            <input
              type="email"
              id="signInEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signInPassword"
              placeholder="Password"
              required
            />
            <button type="submit" class="btn btn-primary">Sign In</button>
          </form>
        </div>
        <div id="signUpForm" class="auth-form" style="display: none">
          <h2>Join CipherHall</h2>
          <button id="googleSignUp" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignUpForm">
            <input
              type="text"
              id="signUpName"
              placeholder="Full Name"
              required
            />
            <input
              type="email"
              id="signUpEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signUpPassword"
              placeholder="Password (min. 8 characters)"
              required
            />
            <button type="submit" class="btn btn-secondary">
              Create Account
            </button>
          </form>
        </div>
        <div id="authMessage"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="course-info">
          <h1 class="course-title" id="courseTitle">Loading...</h1>
          <div class="course-progress">
            <div class="progress-header">
              <span class="progress-label">Course Progress</span>
              <span class="progress-percentage" id="courseProgressPercent"
                >0%</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="courseProgressFill"
                style="width: 0%"
              ></div>
            </div>
            <div class="progress-stats">
              <span id="completedLessons">0</span>
              <span id="totalLessons">0</span>
            </div>
          </div>
          <a href="/dashboard.html" class="back-to-dashboard">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
          </a>
        </div>
      </div>

      <nav class="lesson-nav" id="lessonNav">
        <!-- Lessons will be loaded dynamically -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="content-header">
        <div class="lesson-header">
          <div class="lesson-header-left">
            <span class="lesson-number" id="currentLessonNumber">1</span>
            <h1 class="lesson-header-title" id="currentLessonTitle">
              Loading...
            </h1>
          </div>
          <div class="lesson-actions">
            <button class="mbtn btn-primary" id="menuToggle">
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </header>

      <div class="content-body" id="contentBody">
        <div class="lesson-content" id="lessonContent">
          <!-- Lesson content will be loaded dynamically -->
        </div>
      </div>

      <footer class="lesson-navigation">
        <div class="nav-info" id="navInfo">Lesson 1 of 10</div>
        <div class="nav-controls">
          <button class="btn btn-secondary" id="prevLessonBtn" disabled>
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button class="btn btn-primary" id="nextLessonBtn" disabled>
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </footer>
    </main>

    <!-- Achievement Notification -->
    <div id="achievementNotification" class="achievement-notification">
      <div class="notification-header">
        <div class="notification-icon" id="notificationIcon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="notification-content">
          <h3 id="notificationTitle">Achievement Unlocked!</h3>
          <p id="notificationDescription">Description here...</p>
        </div>
      </div>
      <div class="notification-reward" id="notificationReward">
        <i class="fas fa-coins"></i>
        <span id="notificationPoints">+100 Points</span>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage"></span>
    </div>

    <script>
      // =====================================================
      // SYNCHRONIZED COURSE SYSTEM WITH DASHBOARD INTEGRATION
      // =====================================================

      // Supabase Configuration - Replace with your config
      const supabaseUrl = "https://lzcmzulemfubjaksoqor.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6Y216dWxlbWZ1Ympha3NvcW9yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzM5MDgsImV4cCI6MjA3MDkwOTkwOH0.crhPH4YWtRsr1BJTpAQcmPbWSpwIWRbzoI4sRb2_fPI";
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      // =====================================================
      // COURSE DATA STRUCTURE - REPLACE WITH YOUR COURSE JSON
      // =====================================================

      const COURSE_DATA =  {
        "id": "crisis-management",
        "title": "Crisis Management in Cybersecurity - Complete Course",
        "description": "Master the art and science of managing cybersecurity crises, from initial incident response and technical remediation to strategic communication, legal considerations, and executive leadership.",
        "category": "cybersecurity-strategy",
        "difficulty": "Advanced",
        "duration": "60 hours",
        "instructor": "Dr. Anya Sharma",
        "lessons": [
            {
                "id": "lesson-1",
                "title": "Fundamentals of Cybersecurity Crisis Management",
                "duration": "90 min",
                "objectives": [
                    "Differentiate between a cybersecurity 'incident' and a 'crisis'.",
                    "Classify crises based on a defined taxonomy and severity.",
                    "Understand the fundamentals of risk assessment and business impact analysis.",
                    "Map key stakeholders and analyze their influence and communication needs.",
                    "Outline the phases of the crisis lifecycle.",
                    "Evaluate organizational readiness using a crisis management maturity model."
                ],
                "content": {
                    "overview": "This foundational lesson establishes the core principles of cybersecurity crisis management. We will define the critical threshold that elevates a routine incident into a full-blown crisis, explore how to classify and assess the potential impact of these events, and understand the lifecycle that governs every crisis from beginning to end.",
                    "sections": [
                        {
                            "title": "Incident vs. Crisis: Understanding the Threshold",
                            "content": "<p>Not all security events are crises. Understanding the difference is the first step in a proportional response.</p><ul><li><strong>Incident:</strong> An adverse event in a system or network. It is typically a tactical, technical issue that can be handled by the Incident Response (IR) team through established procedures. <em>Example: A single workstation is infected with commodity malware.</em></li><li><strong>Crisis:</strong> An incident that escalates to have a strategic impact on the entire organization. It threatens the company's reputation, finances, or ability to operate. A crisis requires executive leadership and a multi-disciplinary response beyond just IT. <em>Example: A ransomware attack encrypts all core servers, halting business operations worldwide.</em></li></ul><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>The Tipping Point</strong></div><p>The tipping point from incident to crisis is when the event's impact overwhelms the standard IR process and requires strategic decision-making from executive leadership to protect the viability of the business.</p></div>",
                            "image": "https://images.unsplash.com/photo-1556761175-b413da4b248a?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "The Crisis Lifecycle: A Predictable Path",
                            "content": "<p>While every crisis is unique, they generally follow a predictable lifecycle. Understanding these phases helps in planning and resource allocation.</p><ol><li><strong>Pre-Crisis (Readiness):</strong> The proactive phase. This is where planning, training, risk assessment, and building relationships with stakeholders (Legal, PR) occurs.</li><li><strong>Crisis (Response):</strong> The event has been triggered. The focus is on executing the plan, containing the issue, and managing communications. This is a high-stress, reactive phase.</li><li><strong>Post-Crisis (Recovery & Learning):</strong> The immediate threat is over. The focus shifts to restoring operations, investigating the root cause, and, most importantly, conducting a 'lessons learned' review to improve the readiness phase for the future.</li></ol>",
                            "image": "https://images.unsplash.com/photo-1542744173-05336fcc7ad4?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Business Impact Analysis (BIA)",
                            "content": "<p>A BIA is a foundational document that informs crisis management planning. It identifies the organization's most critical business processes and quantifies the potential impact of their disruption.</p><h3>Key BIA Outputs:</h3><ul><li><strong>Financial Impact:</strong> Lost revenue, regulatory fines, legal penalties.</li><li><strong>Operational Impact:</strong> Inability to produce goods, deliver services, or support customers.</li><li><strong>Reputational Impact:</strong> Loss of customer trust, negative media coverage, stock price decline.</li></ul><p>The BIA provides the data needed to prioritize recovery efforts and justify investments in security and resilience.</p>",
                            "image": "https://images.unsplash.com/photo-1554224155-1696413565d3?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Risk Assessment Calculation",
                            "language": "python",
                            "code": "# A simple function to calculate a risk score.\n# In a real assessment, these values would be derived from detailed analysis.\n\ndef calculate_risk_score(likelihood, impact):\n    \"\"\"Calculates a risk score based on likelihood and impact (1-5 scale).\"\"\"\n    # Likelihood: 1=Rare, 5=Very Likely\n    # Impact: 1=Insignificant, 5=Catastrophic\n    risk_score = likelihood * impact\n    \n    if risk_score >= 15:\n        risk_level = \"Critical\"\n    elif risk_score >= 10:\n        risk_level = \"High\"\n    elif risk_score >= 5:\n        risk_level = \"Medium\"\n    else:\n        risk_level = \"Low\"\n        \n    print(f\"Risk Score: {risk_score} -> Risk Level: {risk_level}\")\n    return risk_level\n\n# Example: A ransomware attack is assessed as 'Likely' (4) and 'Catastrophic' (5).\ncalculate_risk_score(likelihood=4, impact=5)"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the key factor that elevates a security 'incident' into a 'crisis'?",
                            "options": [
                                "The time of day it occurs.",
                                "The involvement of a specific type of malware.",
                                "The event has a strategic impact that threatens the organization's reputation, finances, or operations.",
                                "The number of security analysts on duty."
                            ],
                            "correct": 2,
                            "explanation": "A crisis is defined by its strategic impact on the business, requiring executive-level management, whereas an incident is a tactical issue handled by the IR team."
                        },
                        {
                            "id": 2,
                            "question": "In which phase of the crisis lifecycle would you conduct a tabletop exercise?",
                            "options": [
                                "Pre-Crisis (Readiness)",
                                "Crisis (Response)",
                                "Post-Crisis (Recovery & Learning)",
                                "During the financial audit"
                            ],
                            "correct": 0,
                            "explanation": "Tabletop exercises are a proactive activity. They are part of the Pre-Crisis or Readiness phase, designed to test plans and train the team before a real crisis occurs."
                        },
                        {
                            "id": 3,
                            "question": "What is the primary goal of a Business Impact Analysis (BIA)?",
                            "options": [
                                "To attribute an attack to a threat actor.",
                                "To identify critical business processes and quantify the potential impact of their disruption.",
                                "To select a new firewall vendor.",
                                "To write a press release."
                            ],
                            "correct": 1,
                            "explanation": "The BIA provides the foundational data for all continuity and crisis planning by answering the question: 'What is most important to our business and how bad would it be if it broke?'"
                        }
                    ]
                }
            },
            {
                "id": "lesson-2",
                "title": "Incident Response Framework and Methodologies",
                "duration": "100 min",
                "objectives": [
                    "Understand the key phases of the NIST SP 800-61 Incident Handling Guide.",
                    "Compare and contrast the NIST, SANS, and ISO/IEC 27035 methodologies.",
                    "Detail the critical activities within the Preparation phase.",
                    "Analyze the loop of Detection, Analysis, Containment, Eradication, and Recovery.",
                    "Recognize the importance of Post-Incident Activities for continuous improvement.",
                    "Develop incident classification and escalation procedures."
                ],
                "content": {
                    "overview": "A structured and repeatable process is the foundation of an effective crisis response. This lesson provides a deep dive into industry-standard Incident Response (IR) frameworks, focusing on the NIST methodology. We will walk through each phase, from preparing for an incident to learning from it afterwards.",
                    "sections": [
                        {
                            "title": "The NIST Incident Response Lifecycle",
                            "content": "<p>The National Institute of Standards and Technology (NIST) Special Publication 800-61 provides a widely adopted lifecycle for incident handling. It is a cyclical process that emphasizes learning and improvement.</p><h3>The Four Phases:</h3><ul><li><strong>1. Preparation:</strong> Proactively establishing the tools, processes, and people needed to respond effectively before an incident occurs.</li><li><strong>2. Detection & Analysis:</strong> Identifying an incident, analyzing all available data to confirm its scope and impact, and prioritizing the response.</li><li><strong>3. Containment, Eradication & Recovery:</strong> Taking action to stop the incident's spread, remove the root cause, and restore systems to a secure, operational state.</li><li><strong>4. Post-Incident Activity:</strong> The 'lessons learned' phase, where the incident and the response are analyzed to identify and implement improvements.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1542626991-a2f575a45b67?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Preparation: The Foundation for Success",
                            "content": "<p>The quality of your response is directly determined by the quality of your preparation. A lack of preparation leads to a chaotic and ineffective response during a crisis.</p><h3>Key Preparation Activities:</h3><ul><li><strong>Create the Plan:</strong> Develop and document a formal Incident Response Plan.</li><li><strong>Form the Team:</strong> Designate an IR team with clearly defined roles and responsibilities.</li><li><strong>Deploy the Tools:</strong> Implement and configure security tools like SIEM, EDR, and firewalls.</li><li><strong>Conduct Training:</strong> Regularly run tabletop exercises and technical simulations.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Containment, Eradication, and Recovery In Action",
                            "content": "<p>This is the core, hands-on phase of the response.</p><ul><li><strong>Containment:</strong> 'Stop the bleeding.' Isolate the affected systems to prevent the incident from spreading. This is a short-term, immediate action.</li><li><strong>Eradication:</strong> 'Remove the disease.' Identify and eliminate the root cause of the incident (e.g., patch the vulnerability, remove the malware).</li><li><strong>Recovery:</strong> 'Return to health.' Carefully restore the affected systems to normal operation from clean backups and validate that they are secure.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Don't Rush Recovery</strong></div><p>A common mistake is to rush the recovery phase. If you restore a system without first eradicating the root cause (e.g., the unpatched vulnerability), the attacker will get right back in, and the incident will repeat.</p></div>",
                            "image": "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Incident Escalation Matrix (YAML)",
                            "language": "yaml",
                            "code": "# This defines the procedure for escalating an incident based on its severity.\n\nseverity_levels:\n  - level: 1 (Critical)\n    description: \"Widespread business impact, critical data breach, imminent threat to life or safety.\"\n    escalation_procedure:\n      - action: \"Immediately activate the Crisis Management Team (CMT).\"\n        timeline: \"T+0\"\n      - action: \"Brief the CEO and General Counsel.\"\n        timeline: \"T+30min\"\n\n  - level: 2 (High)\n    description: \"Significant business impact, potential data loss, disruption of a critical service.\"\n    escalation_procedure:\n      - action: \"Notify the CISO and Head of the affected business unit.\"\n        timeline: \"T+15min\"\n      - action: \"Provide hourly written updates to leadership.\"\n        timeline: \"Ongoing\"\n\n  - level: 3 (Medium)\n    description: \"Moderate impact, single system or small group affected.\"\n    escalation_procedure:\n      - action: \"Managed by the IR team lead.\"\n        timeline: \"Ongoing\"\n      - action: \"Report in daily security briefing.\"\n        timeline: \"T+24h\""
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "Which NIST IR phase involves proactive activities like creating a plan and training the team?",
                            "options": [
                                "Detection & Analysis",
                                "Containment, Eradication & Recovery",
                                "Preparation",
                                "Post-Incident Activity"
                            ],
                            "correct": 2,
                            "explanation": "The Preparation phase includes all the proactive work done before an incident occurs to ensure the organization is ready to respond effectively."
                        },
                        {
                            "id": 2,
                            "question": "What is the primary goal of the 'Containment' step?",
                            "options": [
                                "To learn from the incident to prevent future occurrences.",
                                "To restore all systems to normal operation.",
                                "To limit the damage and prevent the incident from spreading further.",
                                "To remove the root cause of the incident."
                            ],
                            "correct": 2,
                            "explanation": "Containment is the immediate, emergency action taken to isolate affected systems and stop the incident from getting worse, giving the IR team time to analyze and plan eradication."
                        },
                        {
                            "id": 3,
                            "question": "The 'Lessons Learned' review is the key component of which NIST phase?",
                            "options": [
                                "Preparation",
                                "Post-Incident Activity",
                                "Detection & Analysis",
                                "Recovery"
                            ],
                            "correct": 1,
                            "explanation": "Post-Incident Activity is the formal phase dedicated to reviewing the incident and the response to identify and implement improvements, which then feeds back into the Preparation phase."
                        }
                    ]
                }
            },
            {
                "id": "lesson-3",
                "title": "Crisis Communication and Public Relations",
                "duration": "120 min",
                "objectives": [
                    "Develop a strategic crisis communication plan with clear objectives.",
                    "Establish protocols for timely and accurate internal communication.",
                    "Create effective briefing procedures for executive leadership.",
                    "Draft communication templates for customers, partners, and regulators.",
                    "Manage media relations and social media during a crisis.",
                    "Understand the legal and regulatory aspects of public statements."
                ],
                "content": {
                    "overview": "During a cybersecurity crisis, communication is a response function just as critical as technical remediation. A failure to communicate effectively can destroy customer trust and inflict more lasting damage than the breach itself. This lesson covers the strategy and tactics of communicating with all stakeholders during a high-stakes event.",
                    "sections": [
                        {
                            "title": "The Principles of Crisis Communication",
                            "content": "<p>Effective communication during a crisis is guided by a set of core principles designed to build and maintain trust.</p><h3>The 3 C's of Crisis Communication:</h3><ul><li><strong>Clarity:</strong> Use simple, direct language. Avoid technical jargon, speculation, and overly optimistic timelines.</li><li><strong>Consistency:</strong> Ensure all stakeholders (internal and external) receive the same core message. All communications should be coordinated and approved.</li><li><strong>Credibility:</strong> Be as transparent as possible. Take responsibility, show empathy for those affected, and explain what you are doing to address the situation.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Never Lie or Speculate</strong></div><p>The fastest way to lose credibility is to provide false information or speculate about facts you don't have. It is always better to say 'We don't know yet, but we are actively investigating and will provide an update by [Time]' than to guess and be wrong.</p></div>",
                            "image": "https://images.unsplash.com/photo-1486312338219-ce68d2c6f44d?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Internal vs. External Audiences",
                            "content": "<p>Communication must be tailored to the specific audience.</p><h3>Internal Communication:</h3><ul><li><strong>Employees:</strong> Need to know how the crisis affects them and their work. They are your brand ambassadors; keeping them informed prevents rumors and leaks.</li><li><strong>Help Desk:</strong> Needs pre-approved scripts to handle customer and employee inquiries consistently.</li><li><strong>Executive Leadership:</strong> Needs high-level, business-impact-focused briefings, not deep technical details. Use the BLUF (Bottom Line Up Front) principle.</li></ul><h3>External Communication:</h3><ul><li><strong>Customers:</strong> Need to know how they are affected and what you are doing to protect them.</li><li><strong>Regulators:</strong> Require formal notification according to specific legal timelines and formats.</li><li><strong>Media:</strong> All media inquiries should be routed through a single, trained spokesperson to ensure a consistent message.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "The 'Holding Statement'",
                            "content": "<p>In the first hours of a crisis, you may not have all the facts, but you cannot remain silent. A 'holding statement' is a pre-approved initial statement that acknowledges the issue and buys you time.</p><h3>Key Elements of a Holding Statement:</h3><ul><li><strong>Acknowledge the event:</strong> 'We are aware of a cybersecurity incident...'</li><li><strong>State that you are investigating:</strong> '...and have launched an immediate investigation.'</li><li><strong>Show commitment:</strong> 'Protecting our customers' data is our top priority.'</li><li><strong>Engage experts:</strong> 'We have engaged leading cybersecurity experts to assist us.'</li><li><strong>Set expectations:</strong> 'We will provide more information as it becomes available.'</li></ul><p>This statement confirms you are aware and in control of the situation without revealing unconfirmed details.</p>",
                            "image": "https://images.unsplash.com/photo-1507679799987-c73779587ccf?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Executive Briefing Template (BLUF)",
                            "language": "markdown",
                            "code": "## Cybersecurity Crisis Briefing - 2025-09-05 14:00 UTC\n\n**SUBJECT:** Ransomware Attack Impacting Manufacturing Operations\n\n### 1. Bottom Line Up Front (BLUF)\n\nWe are responding to a ransomware attack that has encrypted servers supporting our primary manufacturing plant. **As a result, all production is currently halted.** Our technical team is actively working to contain the threat and restore systems. There is currently no evidence of data theft.\n\n### 2. Business Impact\n\n*   **Operations:** Production line is down. Estimated financial impact is $2M per day.\n*   **Data:** Core production data is encrypted. Backups are being validated.\n*   **Reputation:** No public awareness at this time.\n\n### 3. Response Actions Taken\n\n*   The affected plant has been isolated from the corporate network.\n*   Our incident response retainer has been activated.\n*   We are currently validating the integrity of our backups for restoration.\n\n### 4. Decisions Needed\n\n*   Approval to engage external legal counsel specialized in ransomware.\n*   Guidance on communications with key supply chain partners."
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What are the '3 C's' of effective crisis communication?",
                            "options": [
                                "Command, Control, and Containment",
                                "Cost, Complexity, and Compliance",
                                "Clarity, Consistency, and Credibility",
                                "Cloud, Containers, and Code"
                            ],
                            "correct": 2,
                            "explanation": "These three principles guide the development of all crisis communications, focusing on being clear, ensuring the message is consistent across all channels, and being credible through transparency and honesty."
                        },
                        {
                            "id": 2,
                            "question": "What is the primary purpose of a 'holding statement' at the beginning of a crisis?",
                            "options": [
                                "To provide a detailed technical timeline of the attack.",
                                "To blame a third-party vendor for the incident.",
                                "To acknowledge the issue and show you are in control, buying time to gather more facts before releasing details.",
                                "To announce the names of the employees responsible."
                            ],
                            "correct": 2,
                            "explanation": "A holding statement is a critical tool to fill the initial information vacuum. It allows the organization to control the narrative early without speculating or releasing unverified information."
                        },
                        {
                            "id": 3,
                            "question": "The BLUF (Bottom Line Up Front) principle is most important when communicating with which audience?",
                            "options": [
                                "The technical incident response team.",
                                "The help desk.",
                                "Executive leadership.",
                                "The media."
                            ],
                            "correct": 2,
                            "explanation": "Executives are time-constrained and need the most critical business-impact information immediately. BLUF ensures they get the 'so what' first, before the details."
                        }
                    ]
                }
            },
            {
                "id": "lesson-4",
                "title": "Malware Crisis Response and Management",
                "duration": "100 min",
                "objectives": [
                    "Differentiate between various types of malware (viruses, worms, trojans, spyware, ransomware).",
                    "Apply static and dynamic analysis techniques to understand malware behavior.",
                    "Use behavioral analysis and network traffic to identify indicators of compromise.",
                    "Develop containment strategies appropriate for different malware types.",
                    "Follow forensic procedures for evidence collection during a malware outbreak.",
                    "Execute recovery and rebuilding processes to ensure complete eradication."
                ],
                "content": {
                    "overview": "A malware outbreak can spread rapidly, crippling systems and disrupting operations. This lesson provides a technical deep dive into managing a malware crisis, from initial analysis and containment to the critical process of ensuring the threat is completely eradicated from the environment before recovery.",
                    "sections": [
                        {
                            "title": "Malware Analysis for Responders",
                            "content": "<p>During a crisis, the goal of analysis is not to fully reverse-engineer the malware, but to quickly extract actionable intelligence to aid the response.</p><h3>Analysis Techniques:</h3><ul><li><strong>Static Analysis:</strong> Examining the malware file without running it. This is a safe first step. Techniques include checking file hashes against VirusTotal, running the `strings` command to find readable text like IPs or domains, and examining the file's metadata.</li><li><strong>Dynamic Analysis (Sandboxing):</strong> Executing the malware in a safe, isolated environment (a sandbox) to observe its behavior. The sandbox monitors what files it creates, what registry keys it modifies, and what network connections it attempts to make.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Containment: Stopping the Spread",
                            "content": "<p>The containment strategy depends on the type of malware. A self-propagating worm requires a much more aggressive response than a simple trojan.</p><h3>Containment Strategies:</h3><ul><li><strong>Network Segmentation/Isolation:</strong> The most common and effective technique. Disconnect affected hosts from the network to prevent them from infecting other systems. This can be done by disabling switch ports or using an EDR agent to quarantine the host.</li><li><strong>Blocking C2 Traffic:</strong> Identify the command-and-control (C2) domains or IP addresses from your analysis and block them at the firewall or web proxy. This can sever the attacker's control over the malware.</li><li><strong>User Account Disablement:</strong> If the malware is spreading using a compromised user account, disable that account immediately.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Eradication and Recovery: The 'Nuke and Pave' Approach",
                            "content": "<p>Once a system has been compromised by advanced malware like a rootkit or a persistent backdoor, it can be extremely difficult to be 100% certain it is clean.</p><h3>Rebuild, Don't Clean:</h3><p>For critical systems, the industry best practice is not to *attempt* to clean the malware off the existing system. The safest and most effective eradication strategy is to wipe the system and rebuild it from a known-good, trusted source.</p><ol><li>Preserve the original system offline for forensic analysis.</li><li>Completely wipe the hard drive.</li><li>Reinstall the operating system from trusted media.</li><li>Apply all security patches.</li><li>Reinstall applications from trusted sources.</li><li>Restore data from a known-clean backup.</li></ol><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Backup Integrity is Key</strong></div><p>During a malware crisis, it is critical to verify that your backups were not also compromised and do not contain the malware. Restoring an infected backup will just restart the incident.</p></div>",
                            "image": "https://images.unsplash.com/photo-1544197150-b99a580bb7a8?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Automated Malware Detection System (YARA)",
                            "language": "c",
                            "code": "/* This YARA rule is a simple example for detecting a common type of malware behavior:\n   a packed executable that tries to connect to a dynamic DNS domain, a common\n   technique for C2 communication.\n*/\n\nimport \"pe\"\n\nrule Suspicious_Packed_C2_Behavior {\n\n   meta:\n      description = \"Detects a potentially malicious packed file with a suspicious C2 domain.\"\n      author = \"Crisis Management Course\"\n\n   strings:\n      // Common dynamic DNS providers used for C2\n      $dns1 = \".duckdns.org\"\n      $dns2 = \".no-ip.com\"\n      $dns3 = \".dynu.com\"\n\n   condition:\n      // File is a Windows PE executable\n      uint16(0) == 0x5a4d and\n      // PE file has a high entropy, suggesting it is packed or encrypted\n      pe.entropy > 7.5 and\n      // It contains one of the suspicious DNS strings\n      (1 of ($dns*))\n}"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "Executing a malware sample in an isolated virtual machine to observe its network and file system activity is known as:",
                            "options": [
                                "Static Analysis",
                                "Dynamic Analysis",
                                "Vulnerability Scanning",
                                "Penetration Testing"
                            ],
                            "correct": 1,
                            "explanation": "Dynamic analysis involves running the malware in a controlled 'sandbox' environment to safely observe its live behavior and extract indicators of compromise."
                        },
                        {
                            "id": 2,
                            "question": "What is the most recommended eradication strategy for a server that has been compromised by a sophisticated backdoor?",
                            "options": [
                                "Run a full antivirus scan and hope it finds everything.",
                                "Delete the suspicious files you can find.",
                                "Unplug the server and leave it in storage.",
                                "Wipe the server and rebuild it from a known-good operating system image and clean backups."
                            ],
                            "correct": 3,
                            "explanation": "The 'nuke and pave' approach is the industry best practice. It is the only way to be confident that all persistence mechanisms and hidden components of the malware have been completely removed."
                        },
                        {
                            "id": 3,
                            "question": "Blocking an attacker's C2 domain at your firewall is an example of what kind of response action?",
                            "options": [
                                "Recovery",
                                "Preparation",
                                "Containment",
                                "Lessons Learned"
                            ],
                            "correct": 2,
                            "explanation": "This is a containment action. By severing the malware's ability to communicate with its controller, you are limiting the attacker's ability to cause further damage and stopping the spread of the incident."
                        }
                    ]
                }
            },
            {
                "id": "lesson-5",
                "title": "Data Breach Crisis Management",
                "duration": "120 min",
                "objectives": [
                    "Classify data based on its sensitivity and regulatory requirements.",
                    "Apply different methodologies for detecting a data breach.",
                    "Follow a framework for assessing the impact of a breach.",
                    "Navigate complex legal notification requirements like GDPR and CCPA.",
                    "Develop and execute a customer notification strategy.",
                    "Understand the role of credit monitoring and identity theft protection services.",
                    "Follow forensic protocols to determine the scope of a breach."
                ],
                "content": {
                    "overview": "A data breach is one of the most damaging crises a company can face, leading to regulatory fines, lawsuits, and a profound loss of customer trust. This lesson covers the specific, high-stakes process of managing a data breach crisis, with a strong focus on the legal and communication requirements.",
                    "sections": [
                        {
                            "title": "The Breach Investigation: Scope and Impact",
                            "content": "<p>Once a potential breach is detected, the immediate focus of the investigation is to answer a few key questions as quickly as possible.</p><h3>The Critical Questions:</h3><ul><li><strong>What data was involved?</strong> Was it sensitive personal information (PII), health information (PHI), financial data, or intellectual property?</li><li><strong>Who was affected?</strong> How many individuals had their data exposed? Were they customers, employees, or both?</li><li><strong>What was the jurisdiction?</strong> Where do the affected individuals reside? This is critical for determining which laws apply (e.g., a breach affecting German citizens triggers GDPR).</li><li><strong>What was the root cause?</strong> How did the attacker get in, and have we closed the vulnerability?</li></ul><p>The answers to these questions, determined through digital forensics, will dictate the entire legal and communication response.</p>",
                            "image": "https://images.unsplash.com/photo-1526628953301-3e589a6a8b74?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Navigating Breach Notification Laws",
                            "content": "<p>Most jurisdictions now have laws that require organizations to notify affected individuals and regulatory authorities in the event of a data breach. These laws are complex and have strict deadlines.</p><h3>Major Regulations:</h3><ul><li><strong>GDPR (General Data Protection Regulation):</strong> Applies to the personal data of EU residents. Requires notification to the supervisory authority within <strong>72 hours</strong> of becoming aware of the breach.</li><li><strong>CCPA/CPRA (California Consumer Privacy Act/Privacy Rights Act):</strong> Applies to California residents.</li><li><strong>HIPAA (Health Insurance Portability and Accountability Act):</strong> Requires notification to affected individuals within 60 days for a breach of protected health information (PHI).</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>The Clock is Ticking</strong></div><p>The notification clock often starts from the moment of 'discovery', not when the investigation is complete. This creates immense pressure to quickly assess the situation and engage legal counsel to manage the notification process.</p></div>",
                            "image": "https://images.unsplash.com/photo-1505664194779-8beace7a2044?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Customer Notification and Support",
                            "content": "<p>Communicating with affected customers must be handled with care and empathy. The goal is to provide them with the information they need to protect themselves.</p><h3>Key Components of a Customer Notification:</h3><ul><li>A clear description of the incident.</li><li>The types of personal information that were involved.</li><li>The steps you are taking to address the situation.</li><li>The steps they can take to protect themselves (e.g., changing passwords, being wary of phishing).</li><li>An offer of free credit monitoring or identity theft protection services.</li><li>A dedicated hotline or website for them to get more information.</li></ul><p>A poorly handled notification can cause more reputational damage than the breach itself.</p>",
                            "image": "https://images.unsplash.com/photo-1556740714-a8395b3bf30f?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Breach Detection and Alerting System (Pseudocode)",
                            "language": "python",
                            "code": "# This is pseudocode for a simple rule in a SIEM to detect potential data exfiltration.\n\ndef check_database_logs(logs):\n    \"\"\"Analyzes database audit logs for suspicious activity.\"\"\"\n    \n    for user_session in logs.group_by('user'):\n        # Rule 1: Look for unusually large query result sets\n        if user_session.query('rows_returned').sum() > 100000: # Threshold\n            alert(f\"High Volume Query by {user_session['user']}\", severity=\"Medium\")\n            \n        # Rule 2: Look for an abnormal number of failed queries (SQL injection attempt)\n        if user_session.query('status == FAILED').count() > 100:\n            alert(f\"Massive SQL Errors from {user_session['user']}\", severity=\"High\")\n\ndef alert(message, severity):\n    \"\"\"Sends an alert to the security team.\"\"\"\n    print(f\"[!] ALERT [{severity}]: {message}\")\n    # In a real system, this would page an on-call analyst or create a ticket."
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "Under GDPR, what is the general timeframe for notifying the supervisory authority of a data breach?",
                            "options": [
                                "Within 30 days.",
                                "Within 1 year.",
                                "Within 72 hours of becoming aware of it.",
                                "There is no specific timeframe."
                            ],
                            "correct": 2,
                            "explanation": "GDPR is known for its strict 72-hour notification deadline for informing the relevant data protection authority, which puts immense pressure on the initial investigation."
                        },
                        {
                            "id": 2,
                            "question": "What is the primary reason to offer free credit monitoring services to customers after a breach of their personal information?",
                            "options": [
                                "It is a legal requirement in every country.",
                                "It is a tangible gesture of goodwill and helps the affected individuals protect themselves from identity theft, which can reduce legal liability and reputational damage.",
                                "It helps the company's marketing efforts.",
                                "It allows the company to track their customers' finances."
                            ],
                            "correct": 1,
                            "explanation": "Offering credit monitoring is a standard part of modern data breach response. It shows the company is taking responsibility and providing practical help to those affected."
                        },
                        {
                            "id": 3,
                            "question": "Why is determining the physical residency of affected individuals a critical first step in a data breach investigation?",
                            "options": [
                                "To send them a gift card as an apology.",
                                "Because the applicable breach notification laws are determined by the location of the victim, not the location of the company.",
                                "To understand cultural differences.",
                                "It is not a critical step."
                            ],
                            "correct": 1,
                            "explanation": "Data privacy is a legal construct based on the location of the data subject. A breach of data belonging to California residents triggers California law, while a breach of French citizens' data triggers French/EU law (GDPR)."
                        }
                    ]
                }
            },
            {
                "id": "lesson-6",
                "title": "DDoS Attack Crisis Response",
                "duration": "90 min",
                "objectives": [
                    "Differentiate between various types of DDoS attacks (volumetric, protocol, application layer).",
                    "Analyze traffic patterns to distinguish a DDoS attack from legitimate traffic spikes.",
                    "Establish a baseline of normal network traffic.",
                    "Implement real-time monitoring and alerting for DDoS indicators.",
                    "Apply mitigation techniques like rate limiting, filtering, and blackholing.",
                    "Coordinate with ISPs and cloud-based protection services (scrubbing centers).",
                    "Follow protocols for service restoration after an attack."
                ],
                "content": {
                    "overview": "A Distributed Denial of Service (DDoS) attack can bring an organization's online presence to a complete standstill, crippling services and denying access to legitimate users. This lesson covers the technical and coordination challenges of managing a DDoS crisis, focusing on rapid detection and effective mitigation.",
                    "sections": [
                        {
                            "title": "Types of DDoS Attacks",
                            "content": "<p>DDoS attacks are not all the same. They target different layers of the network stack.</p><h3>The Three Main Categories:</h3><ul><li><strong>Volumetric Attacks:</strong> The most common type. The goal is to consume all available bandwidth by sending a massive flood of traffic (e.g., UDP floods, ICMP floods). Measured in Gigabits per second (Gbps).</li><li><strong>Protocol Attacks:</strong> Consume server resources by sending malformed protocol requests (e.g., SYN floods, Ping of Death). Measured in Packets per second (Pps).</li><li><strong>Application Layer Attacks:</strong> Target a specific application or service with seemingly legitimate requests that are designed to exhaust its resources (e.g., HTTP floods, Slowloris). These are the hardest to detect because the traffic can look legitimate. Measured in Requests per second (Rps).</li></ul>",
                            "image": "https://images.unsplash.com/photo-1510511459019-5dda7724fd87?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Detection: Attack or Flash Crowd?",
                            "content": "<p>One of the first challenges in a DDoS event is distinguishing a malicious attack from a sudden, legitimate surge in traffic (a 'flash crowd').</p><h3>Key Detection Techniques:</h3><ul><li><strong>Baselines:</strong> You must first have a clear understanding of what 'normal' traffic looks like for your services. Without a baseline, you cannot spot an anomaly.</li><li><strong>Traffic Analysis:</strong> Analyze traffic patterns. Is the traffic coming from a small number of sources or a huge, distributed set of IPs? Is it targeting a single page or resource? Does it lack the normal variation of human behavior?</li><li><strong>Real-time Monitoring:</strong> Use tools like NetFlow and network performance monitoring to alert on sudden, massive spikes in bandwidth or packet rates.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Mitigation: Weathering the Storm",
                            "content": "<p>Mitigating a large-scale DDoS attack is often beyond the capability of an organization's own infrastructure. It typically requires coordination with upstream providers.</p><h3>Mitigation Strategies:</h3><ul><li><strong>On-Premise Appliances:</strong> DDoS mitigation appliances can handle smaller attacks, but can be overwhelmed by large volumetric floods.</li><li><strong>ISP Coordination:</strong> Contacting your Internet Service Provider (ISP) to request they block the attack traffic upstream before it ever reaches your network. This is often called 'blackholing'.</li><li><strong>Cloud-Based Scrubbing Services:</strong> This is the most effective modern defense. You redirect all of your traffic through a specialized DDoS mitigation provider (like Cloudflare, Akamai, or AWS Shield). They 'scrub' the traffic, filtering out the malicious requests and forwarding only the clean, legitimate traffic to your servers.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Be Prepared</strong></div><p>The worst time to shop for a DDoS mitigation service is during a DDoS attack. The best practice is to have a contract and integration in place with a scrubbing provider *before* you need it, allowing you to 'swing' your traffic to them with a simple DNS change during a crisis.</p></div>",
                            "image": "https://images.unsplash.com/photo-1544197150-b99a580bb7a8?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "DDoS Detection and Mitigation Script (Firewall)",
                            "language": "shell",
                            "code": "# This is a simple bash script demonstrating a basic DDoS mitigation technique.\n# It identifies IPs making too many connections and blocks them using iptables.\n# WARNING: This is for educational purposes. Real DDoS requires more sophisticated tools.\n\n# The number of connections to allow from a single IP in a given time.\nCONNECTION_LIMIT=100\n\n# Find IPs exceeding the limit on port 80 (HTTP)\nATTACKING_IPS=$(netstat -tn 2>/dev/null | grep :80 | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr | awk -v limit=\"$CONNECTION_LIMIT\" '$1 > limit {print $2}')\n\nif [ -n \"$ATTACKING_IPS\" ]; then\n    echo \"[!] DDoS activity detected. Blocking offending IPs...\"\n    for ip in $ATTACKING_IPS; do\n        echo \"Blocking $ip...\"\n        # Add a rule to the firewall to drop packets from this IP\n        iptables -I INPUT -s $ip -j DROP\n    done\nelse\n    echo \"[+] Network traffic appears normal.\"\nfi"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "An attack that attempts to exhaust a web server's resources by sending a flood of seemingly legitimate HTTP requests is what type of DDoS attack?",
                            "options": [
                                "Volumetric Attack",
                                "Protocol Attack",
                                "Application Layer Attack",
                                "DNS Amplification Attack"
                            ],
                            "correct": 2,
                            "explanation": "This is an application layer (Layer 7) attack. It's stealthy because the individual requests look legitimate, but the sheer volume is designed to overwhelm the application itself (e.g., the web server or database)."
                        },
                        {
                            "id": 2,
                            "question": "What is the most effective and common strategy for defending against large-scale volumetric DDoS attacks?",
                            "options": [
                                "Buying a bigger firewall for your data center.",
                                "Unplugging your internet connection.",
                                "Using a cloud-based scrubbing service to filter traffic before it reaches your network.",
                                "Calling the attackers and asking them to stop."
                            ],
                            "correct": 2,
                            "explanation": "Large volumetric attacks can easily exceed the total bandwidth capacity of an organization's internet connection. The only effective defense is to use a specialized upstream service that has massive bandwidth and filtering capabilities to absorb the attack."
                        },
                        {
                            "id": 3,
                            "question": "What is the first and most critical prerequisite for being able to detect a DDoS attack?",
                            "options": [
                                "Hiring more security analysts.",
                                "Having a clear baseline of what your 'normal' network traffic looks like.",
                                "Buying the most expensive security tool.",
                                "Having a good relationship with the FBI."
                            ],
                            "correct": 1,
                            "explanation": "You cannot spot an anomaly if you don't know what is normal. Establishing a clear, historical baseline of your traffic patterns (e.g., bits per second, packets per second) is the essential first step for any DDoS detection system."
                        }
                    ]
                }
            },
            {
                "id": "lesson-7",
                "title": "Ransomware Crisis Management",
                "duration": "120 min",
                "objectives": [
                    "Identify different ransomware families and their characteristics.",
                    "Analyze the encryption process and identify potential weaknesses.",
                    "Follow a decision-making framework for the 'to pay or not to pay' question.",
                    "Understand the risks and procedures of engaging with threat actors for negotiation.",
                    "Execute a robust recovery strategy focused on verified backups.",
                    "Develop protocols for coordinating with law enforcement and cyber insurance.",
                    "Manage the complexities of a double extortion scenario (encryption + data theft)."
                ],
                "content": {
                    "overview": "Ransomware is one of the most destructive and high-pressure crises an organization can face. It combines technical disruption, data loss, and often public extortion. This lesson covers the end-to-end management of a ransomware crisis, from the initial containment to the difficult decisions around payment and recovery.",
                    "sections": [
                        {
                            "title": "The Modern Ransomware Attack: Double Extortion",
                            "content": "<p>Modern ransomware attacks are no longer just about encryption. The 'double extortion' technique has become standard practice for major ransomware groups.</p><h3>The Two-Stage Attack:</h3><ol><li><strong>Data Exfiltration:</strong> Before encrypting any files, the attackers move laterally through the network, identify the most sensitive data, and steal a copy of it.</li><li><strong>Encryption:</strong> Only after they have exfiltrated the data do they deploy the ransomware to encrypt the organization's systems.</li></ol><p>This creates two points of leverage for the attacker. They demand a ransom to provide the decryption key, AND they demand a second ransom to prevent them from leaking the stolen data publicly.</p>",
                            "image": "https://images.unsplash.com/photo-1614064548237-096537d54645?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "To Pay or Not to Pay? A Difficult Decision",
                            "content": "<p>The decision of whether to pay the ransom is a complex business decision, not a technical one, and it should be made by the Crisis Management Team, not the IR team.</p><h3>Key Factors in the Decision:</h3><ul><li><strong>Do you have viable backups?</strong> If you have clean, tested, and available backups, recovery is the far better option.</li><li><strong>What is the scope of the impact?</strong> Is the outage life-threatening (e.g., in a hospital) or merely a financial issue?</li><li><strong>Do you have cyber insurance?</strong> The insurance carrier will have a major say in the decision and will often bring in their own negotiators.</li><li><strong>Is data exfiltration confirmed?</strong> If data was stolen, paying to get a decryption key doesn't solve the data leak problem.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Payment is Not a Guarantee</strong></div><p>There is no guarantee that the attackers will provide a working decryption key after payment. Furthermore, paying the ransom funds criminal activity and marks your organization as a willing target for future attacks.</p></div>",
                            "image": "https://images.unsplash.com/photo-1544327415-77222e20790b?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "The Recovery Process: A Methodical Rebuild",
                            "content": "<p>Recovery from ransomware is a long and painstaking process. The primary goal is to rebuild a clean, secure environment and ensure the attacker has no lingering access.</p><h3>Recovery Best Practices:</h3><ol><li><strong>Do Not Trust the Infected Environment:</strong> Assume every system in the affected network segment is compromised.</li><li><strong>Identify the Initial Access Vector:</strong> You must determine how the attacker got in and patch that vulnerability before bringing systems back online.</li><li><strong>Rebuild from Gold Images:</strong> Restore systems by wiping them and reinstalling from known-good OS and application images.</li><li><strong>Restore Data from Clean Backups:</strong> Restore data from backups that have been verified as clean and unencrypted.</li><li><strong>Force a Global Password Reset:</strong> Reset the passwords for ALL user and service accounts before reconnecting systems to the network.</li></ol>",
                            "image": "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Ransomware Detection and Response Automation (Pseudocode)",
                            "language": "python",
                            "code": "# This is pseudocode for a SOAR playbook to respond to ransomware indicators.\n\ndef ransomware_response_playbook(alert):\n    \"\"\"Automated response to a high-fidelity ransomware alert from EDR.\"\"\"\n    \n    # 1. Immediately contain the host to stop the spread\n    host_ip = alert.get('source_ip')\n    edr.isolate_host(host_ip)\n    print(f\"Contained host: {host_ip}\")\n\n    # 2. Disable the user account associated with the activity\n    username = alert.get('username')\n    active_directory.disable_user(username)\n    print(f\"Disabled user: {username}\")\n\n    # 3. Block the hash of the ransomware executable across all endpoints\n    file_hash = alert.get('file_hash')\n    edr.block_hash_globally(file_hash)\n    print(f\"Blocked hash: {file_hash}\")\n\n    # 4. Create a critical priority ticket for the IR team\n    ticketing_system.create_ticket(\n        title=f\"Ransomware Detected on {host_ip}\",\n        priority=\"Critical\",\n        assignee=\"IR Team\"\n    )\n    print(\"Crisis ticket created and assigned.\")"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is 'double extortion' in the context of a ransomware attack?",
                            "options": [
                                "The attackers demand two separate bitcoin payments.",
                                "The attackers encrypt the data and also steal a copy to threaten to leak it publicly.",
                                "The attackers encrypt both the primary systems and the backups.",
                                "The attackers send two different ransom notes."
                            ],
                            "correct": 1,
                            "explanation": "Double extortion combines data encryption with data theft, giving the attackers two forms of leverage. This means that even if the victim has good backups, they still face the threat of a public data leak."
                        },
                        {
                            "id": 2,
                            "question": "The decision to pay a ransom should primarily be made by whom?",
                            "options": [
                                "The lead technical incident responder.",
                                "The help desk manager.",
                                "The Crisis Management Team, including executive leadership and legal counsel.",
                                "The FBI."
                            ],
                            "correct": 2,
                            "explanation": "The payment decision is a strategic business decision with legal, financial, and ethical implications. It is not a technical decision and must be made at the highest levels of the organization."
                        },
                        {
                            "id": 3,
                            "question": "What is the most critical prerequisite for being able to recover from a ransomware attack without paying?",
                            "options": [
                                "Having a good relationship with the attackers.",
                                "Having clean, tested, and offline/isolated backups.",
                                "Having a large cybersecurity budget.",
                                "Having a fast internet connection."
                            ],
                            "correct": 1,
                            "explanation": "Viable backups are the single most important defense against ransomware. If an organization can restore its data and systems from a clean source, the attacker's primary leverage (encryption) is neutralized."
                        }
                    ]
                }
            },
            {
                "id": "lesson-8",
                "title": "Advanced Persistent Threat (APT) Crisis Response",
                "duration": "120 min",
                "objectives": [
                    "Define the characteristics that differentiate an APT from a typical cybercriminal.",
                    "Develop long-term monitoring strategies for a confirmed APT compromise.",
                    "Apply threat hunting methodologies to uncover the full scope of an APT campaign.",
                    "Understand the challenges and techniques of attribution for nation-state actors.",
                    "Utilize defensive deception strategies like honeypots to gather intelligence.",
                    "Plan and execute a coordinated, enterprise-wide eradication event."
                ],
                "content": {
                    "overview": "Responding to an Advanced Persistent Threat (APT) is a strategic, long-term campaign, not a short-term incident. These nation-state actors are highly sophisticated, well-funded, and patient. This lesson covers the advanced mindset and techniques required to manage a crisis involving a deep-rooted APT intrusion.",
                    "sections": [
                        {
                            "title": "What Defines an APT?",
                            "content": "<p>An APT is not just any sophisticated attacker. The term refers to a specific class of adversary, typically a nation-state intelligence service or military unit.</p><h3>Key Characteristics:</h3><ul><li><strong>Advanced:</strong> They use custom tools, zero-day exploits, and sophisticated TTPs to evade detection.</li><li><strong>Persistent:</strong> Their goal is not a quick score. They establish a long-term presence in a network, often for months or years, to achieve their strategic objectives.</li><li><strong>Threat:</strong> They have a specific mission (e.g., espionage, intellectual property theft) and the resources of a government behind them.</li></ul><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>The Goal is Stealth, Not Noise</strong></div><p>Unlike ransomware groups, APTs want to remain undetected for as long as possible. Their primary objective is intelligence gathering. This means the response must be equally patient and stealthy.</p></div>",
                            "image": "https://images.unsplash.com/photo-1573495782740-62c135d54483?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "The 'Long Game' Response: Watch and Learn",
                            "content": "<p>When an APT is discovered, the immediate goal is *not* to block their IP address or delete their malware. This is a critical mistake. An APT will have multiple backdoors; blocking one will only tip them off, causing them to hide better or use a different channel.</p><h3>The Strategic Response Cycle:</h3><ol><li><strong>Detection:</strong> An initial indicator of the APT is found.</li><li><strong>Surveillance (The 'Long Game'):</strong> Instead of blocking, the response team shifts to a covert monitoring mode. The goal is to watch the attacker's every move to understand the full scope of their compromise. Which systems have they accessed? Which accounts are compromised? What data are they targeting?</li><li><strong>Full Scope Understanding:</strong> This surveillance phase continues until the team is confident they have identified *all* of the attacker's implants and persistence mechanisms.</li><li><strong>Coordinated Eradication:</strong> A single, decisive, enterprise-wide action is planned to remove all of the attacker's access points and persistence simultaneously.</li></ol>",
                            "image": "https://images.unsplash.com/photo-1556091212-a1b6379a05de?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Threat Hunting and Deception",
                            "content": "<p>Managing an APT crisis requires proactive measures to find hidden threats and gather intelligence.</p><h3>Proactive Techniques:</h3><ul><li><strong>Threat Hunting:</strong> A proactive search for signs of compromise, based on a hypothesis. For example, 'I hypothesize the APT is using PowerShell for lateral movement. I will now hunt through all logs for anomalous PowerShell activity.'</li><li><strong>Deception Technology (Honeypots):</strong> These are decoy systems designed to be an attractive target for attackers. When an attacker touches a honeypot, it provides a high-fidelity alert. It's also a safe environment to observe the attacker's tools and techniques to gather intelligence for the broader investigation.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1548092372-2d987bde898b?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "APT Detection and Tracking System (Threat Hunting Query)",
                            "language": "sql",
                            "code": "/* This is a conceptual threat hunting query (Splunk-like SPL) designed to find\n   a common APT technique: lateral movement using PsExec.\n*/\n\n// Search for Windows events indicating a service was created (EventCode 7045)\nindex=wineventlog EventCode=7045 ServiceName=\"PSEXESVC\"\n\n// PSEXESVC is the default service name created by the PsExec tool.\n\n// Join this with process creation events (EventCode 4688) to see what commands were run.\n| join host, process_id [\n    search index=wineventlog EventCode=4688\n]\n\n// Group the results to see which accounts are using PsExec to move between which hosts.\n| stats count by user, source_host, destination_host\n\n// A legitimate admin might use PsExec, but seeing it used by an unexpected account\n// or to move to a sensitive server is a strong indicator of lateral movement."
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary motivation for most APT actors?",
                            "options": [
                                "Short-term financial gain through ransomware.",
                                "Website defacement for ideological reasons.",
                                "Long-term espionage, intellectual property theft, or achieving a strategic geopolitical objective.",
                                "Testing the security of corporate networks for fun."
                            ],
                            "correct": 2,
                            "explanation": "APTs are typically nation-state backed and operate with long-term, strategic goals that align with their government's interests, such as military or economic intelligence gathering."
                        },
                        {
                            "id": 2,
                            "question": "Upon discovering a confirmed APT intrusion, what is the most common and dangerous mistake a response team can make?",
                            "options": [
                                "Immediately blocking the C2 IP address they've found.",
                                "Notifying the CISO.",
                                "Starting a covert surveillance operation.",
                                "Preserving evidence for forensic analysis."
                            ],
                            "correct": 0,
                            "explanation": "A premature or partial eradication attempt is a critical error. It alerts the sophisticated actor that they have been discovered, causing them to switch to their other, undiscovered backdoors, making a full cleanup exponentially harder."
                        },
                        {
                            "id": 3,
                            "question": "What is the primary purpose of deploying a honeypot during an APT investigation?",
                            "options": [
                                "To replace a production server that was encrypted.",
                                "To act as a decoy to provide high-fidelity alerts and safely gather intelligence on the attacker's tools and techniques.",
                                "To increase the organization's internet bandwidth.",
                                "To store the incident response plan."
                            ],
                            "correct": 1,
                            "explanation": "A honeypot is a trap. It's a safe, heavily monitored environment where you can observe the adversary's TTPs without putting real assets at risk. Any activity on a honeypot is, by definition, malicious."
                        }
                    ]
                }
            },
            {
                "id": "lesson-9",
                "title": "Insider Threat Crisis Management",
                "duration": "100 min",
                "objectives": [
                    "Identify technical and behavioral indicators of insider threats.",
                    "Use behavioral analytics to detect anomalous activity.",
                    "Understand the difference between malicious, accidental, and compromised insiders.",
                    "Develop investigation procedures that protect privacy and due process.",
                    "Establish clear protocols for coordinating with HR and Legal.",
                    "Plan and execute a coordinated access revocation and termination process.",
                    "Manage communication with the affected employee and the wider organization."
                ],
                "content": {
                    "overview": "An insider threat crisis is one of the most sensitive and complex challenges an organization can face. The adversary is not an external hacker, but a trusted employee. This lesson covers the unique blend of technical investigation, legal process, and human resources management required to navigate these high-stakes situations.",
                    "sections": [
                        {
                            "title": "Types of Insider Threats",
                            "content": "<p>Not all insider incidents are malicious. Understanding the intent is the first step in the investigation.</p><h3>The Three Main Categories:</h3><ul><li><strong>Malicious Insider:</strong> An employee who intentionally and knowingly steals data or causes harm, often for financial gain, revenge, or to take to a new job.</li><li><strong>Accidental Insider:</strong> A well-meaning employee who makes a mistake that causes a security incident, such as emailing a sensitive file to the wrong person or misconfiguring a cloud server.</li><li><strong>Compromised Insider:</strong> An employee whose credentials have been stolen by an external attacker. The employee is a victim, but their account is the vector being used for the attack.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1556742502-ec7c0e9f34b1?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Detection: User Behavior Analytics (UBA)",
                            "content": "<p>Detecting insider threats is not about looking for malware, but about looking for anomalous human behavior. User and Entity Behavior Analytics (UEBA) tools are key to this.</p><h3>Common Indicators:</h3><ul><li><strong>Anomalous Data Access:</strong> An employee in marketing suddenly starts accessing large numbers of files in the engineering source code repository.</li><li><strong>Unusual Work Hours:</strong> An employee who normally works 9-to-5 suddenly starts logging in at 2 AM every night.</li><li><strong>Data Aggregation & Exfiltration:</strong> An employee downloads terabytes of data from multiple sources to their local machine and then uploads it to a personal cloud storage account.</li><li><strong>Use of Unauthorized Devices:</strong> Plugging in a personal USB drive when policy prohibits it.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1516321497487-e288fb19713f?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "The Tripartite Investigation: A Non-Negotiable Partnership",
                            "content": "<p>An insider threat investigation is NOT a solo security activity. From the moment of suspicion, it must be managed as a three-way partnership to protect the investigation, the company, and the employee's rights.</p><h3>The Core Team:</h3><ul><li><strong>Information Security:</strong> Leads the technical investigation, gathering and analyzing digital evidence in a forensically sound manner.</li><li><strong>Human Resources (HR):</strong> Provides context on the employee, manages all communication with the employee, and ensures all actions comply with labor laws and company policy.</li><li><strong>Legal Department:</strong> Provides oversight to ensure the investigation is conducted legally, advises on privacy issues, and preserves attorney-client privilege.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Follow Due Process</strong></div><p>Jumping to conclusions can lead to wrongful termination lawsuits and destroy company morale. The investigation must be objective, fact-based, and handled with extreme discretion until a conclusion is reached.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "User Behavior Analytics System (UEBA Alert Pseudocode)",
                            "language": "json",
                            "code": "{\n  \"alert_id\": \"UEBA-ALERT-98765\",\n  \"timestamp\": \"2025-09-06T03:15:00Z\",\n  \"user\": \"john.doe\",\n  \"risk_score\": 95,\n  \"summary\": \"High-risk score for john.doe based on multiple anomalous behaviors.\",\n  \"contributing_factors\": [\n    {\n      \"type\": \"Anomalous Data Access\",\n      \"details\": \"User accessed 5,280 files on the 'Project_Titan' SharePoint site, a 5000% increase from their weekly baseline.\",\n      \"risk_contribution\": 40\n    },\n    {\n      \"type\": \"Anomalous Work Hours\",\n      \"details\": \"User logged in at 02:30 AM local time, which has not occurred in the past 180 days.\",\n      \"risk_contribution\": 25\n    },\n    {\n      \"type\": \"Anomalous Data Egress\",\n      \"details\": \"User uploaded 15 GB of data to a personal cloud storage domain (mega.nz).\",\n      \"risk_contribution\": 30\n    }\n  ]\n}"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "An employee's password is stolen in a phishing attack, and an external hacker uses their account to steal data. This is an example of what kind of insider threat?",
                            "options": [
                                "Malicious Insider",
                                "Accidental Insider",
                                "Compromised Insider",
                                "There is no insider threat."
                            ],
                            "correct": 2,
                            "explanation": "In this scenario, the employee is a victim, not the perpetrator. Their account has been compromised, and they are an unwitting pawn in an external attack."
                        },
                        {
                            "id": 2,
                            "question": "User and Entity Behavior Analytics (UEBA) systems are primarily designed to detect what?",
                            "options": [
                                "Malware and viruses.",
                                "Deviations from a baseline of normal user and system activity.",
                                "Unpatched software vulnerabilities.",
                                "Firewall misconfigurations."
                            ],
                            "correct": 1,
                            "explanation": "UEBA is not signature-based. It works by learning what is 'normal' for each user and then flagging activities that are anomalous for that specific user, which is a key method for detecting insider threats."
                        },
                        {
                            "id": 3,
                            "question": "Which three departments form the essential 'tripartite' team for managing a malicious insider threat investigation?",
                            "options": [
                                "Security, Marketing, and Sales",
                                "Security, Facilities, and the Help Desk",
                                "Security, Human Resources, and Legal",
                                "Security, IT Operations, and Finance"
                            ],
                            "correct": 2,
                            "explanation": "This partnership is non-negotiable. Security handles the technical evidence, while HR and Legal provide the procedural, legal, and employment-related oversight required to conduct a fair and defensible investigation."
                        }
                    ]
                }
            },
            {
                "id": "lesson-10",
                "title": "Supply Chain Attack Crisis Response",
                "duration": "100 min",
                "objectives": [
                    "Assess the vulnerabilities in your software and hardware supply chain.",
                    "Develop a framework for third-party risk management.",
                    "Establish clear communication protocols with vendors and partners.",
                    "Analyze the propagation of impact from a compromised vendor.",
                    "Develop a coordinated response strategy for a multi-organization incident.",
                    "Manage customer notifications when a third party is the root cause.",
                    "Understand the importance of contractual language for incident response."
                ],
                "content": {
                    "overview": "A supply chain attack outsources an attacker's risk by targeting a less-secure third-party vendor to compromise their ultimate target. This lesson covers the immense challenge of managing a crisis where the root cause is outside your control, focusing on vendor management, coordinated response, and communication.",
                    "sections": [
                        {
                            "title": "Understanding the Threat",
                            "content": "<p>A supply chain attack abuses the trust between a vendor and a customer. This can take several forms.</p><h3>Common Scenarios:</h3><ul><li><strong>Software Supply Chain Attack (e.g., SolarWinds):</strong> An attacker injects malicious code into a legitimate software product. The vendor then unknowingly delivers this 'trojanized' update to all its customers.</li><li><strong>Third-Party Service Provider Compromise:</strong> An attacker compromises a Managed Service Provider (MSP), law firm, or other partner that has trusted, often privileged, access to your network. The attacker then uses that trusted connection to pivot into your environment.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1556075798-4825dfaaf498?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "The Crisis Response Challenge",
                            "content": "<p>Responding to a supply chain incident is uniquely difficult because the initial compromise and primary evidence reside on a network you do not own or control.</p><h3>Key Difficulties:</h3><ul><li><strong>Limited Visibility:</strong> You are completely reliant on the compromised vendor for accurate and timely information about the breach.</li><li><strong>Delayed Notification:</strong> You may not find out about the compromise for days, weeks, or even months, giving the attacker a significant head start.</li><li><strong>One-to-Many Impact:</strong> You are not the only victim. The vendor is dealing with a crisis impacting all of their customers simultaneously, which can slow down their response to you.</li><li><strong>Contractual Limitations:</strong> Your ability to demand specific actions or information is governed by the terms of your contract.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1543286386-713bdd548da4?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Preparation is the Best Defense",
                            "content": "<p>Because your response options are limited, a strong proactive posture is the most effective defense against supply chain risk.</p><h3>Proactive Measures:</h3><ol><li><strong>Vendor Risk Management:</strong> Have a formal program to assess the security posture of your critical vendors *before* signing a contract.</li><li><strong>Strong Contractual Language:</strong> Your contracts must include specific clauses for security, including defined breach notification timelines (e.g., 'vendor must notify us within 24 hours of discovery').</li><li><strong>Principle of Least Privilege:</strong> Grant vendors the absolute minimum level of access required for them to function. Do not give an HVAC vendor domain admin rights.</li><li><strong>Network Segmentation & Monitoring:</strong> Any connection from a third party should be on a segmented network with strict access controls and intensive monitoring. Assume that connection will be compromised.</li><li><strong>Software Bill of Materials (SBOM):</strong> Maintain an inventory of all components in your critical software so you can quickly identify if you are using a vulnerable library.</li></ol>",
                            "image": "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Supply Chain Monitoring System (Alert Pseudocode)",
                            "language": "json",
                            "code": "{\n  \"alert_id\": \"SCM-ALERT-12345\",\n  \"timestamp\": \"2025-09-07T10:00:00Z\",\n  \"alert_type\": \"Anomalous Vendor Activity\",\n  \"summary\": \"Vendor account 'hvac_admin' from 'CoolingCorp' accessed a sensitive server outside of normal behavior.\",\n  \"details\": {\n    \"vendor_name\": \"CoolingCorp\",\n    \"vendor_account\": \"hvac_admin\",\n    \"source_ip\": \"198.51.100.88\", // IP not on CoolingCorp's known allow-list\n    \"action_taken\": \"Authentication\",\n    \"target_asset\": \"DC01.mycompany.internal\", // A domain controller\n    \"violated_policy\": \"Vendor access to domain controllers is prohibited.\",\n    \"recommendation\": \"This is a high-confidence indicator of a vendor compromise. Immediately disable the 'hvac_admin' account and investigate all recent activity.\"\n  }\n}"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary challenge when responding to a crisis caused by a compromised third-party vendor?",
                            "options": [
                                "The vendor's software is too expensive.",
                                "The response team has no direct visibility or control over the compromised vendor's network.",
                                "The vendor's employees speak a different language.",
                                "The vendor's office is in a different time zone."
                            ],
                            "correct": 1,
                            "explanation": "The core problem is the lack of visibility and control. The incident happened on a network you don't own, so you cannot perform a direct investigation and must rely on the compromised party to provide accurate and timely information."
                        },
                        {
                            "id": 2,
                            "question": "A document that provides a detailed inventory of all the open-source and third-party components used to build a piece of software is called a:",
                            "options": [
                                "Service Level Agreement (SLA)",
                                "Acceptable Use Policy (AUP)",
                                "Software Bill of Materials (SBOM)",
                                "Purchase Order"
                            ],
                            "correct": 2,
                            "explanation": "An SBOM provides critical transparency into the software supply chain. When a vulnerability is announced in a component like Log4j, an SBOM allows an organization to immediately identify which of their applications are affected."
                        },
                        {
                            "id": 3,
                            "question": "Strictly limiting a vendor's network access to only the specific systems they need to do their job is an application of what security principle?",
                            "options": [
                                "The Principle of Least Privilege",
                                "Defense in Depth",
                                "Open Security",
                                "The Principle of Full Trust"
                            ],
                            "correct": 0,
                            "explanation": "The Principle of Least Privilege is a foundational concept for mitigating supply chain risk. By granting a vendor only the minimum necessary access, you limit the potential damage (or 'blast radius') if that vendor's account is compromised."
                        }
                    ]
                }
            },
            {
                "id": "lesson-11",
                "title": "Cloud Security Crisis Management",
                "duration": "120 min",
                "objectives": [
                    "Adapt crisis management processes for cloud-specific threat vectors.",
                    "Develop coordination plans for incidents spanning multiple cloud providers.",
                    "Establish effective communication channels with cloud provider support.",
                    "Understand the implications of the Shared Responsibility Model during a crisis.",
                    "Manage crises related to container, serverless, and API security.",
                    "Respond to Identity and Access Management (IAM) crises.",
                    "Overcome the challenges of cloud forensics and evidence collection."
                ],
                "content": {
                    "overview": "The cloud shifts the security landscape from a network-centric to an identity-centric world. This lesson focuses on managing crises in cloud environments like AWS, Azure, and GCP, where misconfigurations, compromised credentials, and API abuse are the new front line.",
                    "sections": [
                        {
                            "title": "The Shared Responsibility Model in a Crisis",
                            "content": "<p>During a crisis, it is vital to understand what you are responsible for versus what the Cloud Service Provider (CSP) is responsible for.</p><h3>The Division of Labor:</h3><ul><li><strong>The CSP is responsible for:</strong> Security 'OF' the cloud. This includes the physical data centers, the hypervisor, and their core network infrastructure. If there's an issue with their underlying services, they are responsible for fixing it.</li><li><strong>You, the Customer, are responsible for:</strong> Security 'IN' the cloud. This includes how you configure your IAM policies, your virtual networks, your data encryption, and the security of the operating systems you run.</li></ul><p>In almost all cases, a security crisis in the cloud is due to a customer misconfiguration, not a failure by the CSP.</p>",
                            "image": "https://images.unsplash.com/photo-1588196749597-9ff075ee6b5b?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Identity: The New Crisis Perimeter",
                            "content": "<p>In the cloud, the most common and damaging crises stem from compromised identities, not network breaches.</p><h3>Common Cloud Crisis Scenarios:</h3><ul><li><strong>Exposed Access Keys:</strong> A developer accidentally commits a powerful set of AWS access keys to a public GitHub repository. An attacker finds them within seconds and begins spinning up thousands of crypto-mining servers, resulting in a million-dollar bill.</li><li><strong>Overly Permissive IAM Roles:</strong> A compromised virtual machine has an IAM role attached that grants it full administrative access (`*:*`) to the entire account, allowing the attacker to steal all data and delete all infrastructure.</li><li><strong>Lack of MFA on Root/Admin Accounts:</strong> The most privileged accounts are protected only by a password, which is phished or brute-forced.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1556740714-a8395b3bf30f?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Cloud Forensics and Response",
                            "content": "<p>Traditional forensic techniques do not work in the cloud. You cannot seize a physical hard drive. The response must be API-driven and leverage cloud-native tools.</p><h3>Cloud Response Playbook:</h3><ol><li><strong>Containment:</strong> Isolate the compromised resource using Security Groups (virtual firewalls) or by revoking the IAM role. Do NOT delete the resource, as that destroys the evidence.</li><li><strong>Preservation:</strong> Take a snapshot of the virtual machine's disk and a memory dump (if possible) via the cloud provider's API. This is the equivalent of a forensic image.</li><li><strong>Analysis:</strong> Analyze the logs. The most important log source in a cloud crisis is the API call log (e.g., AWS CloudTrail). This provides a detailed, immutable record of every action the attacker took.</li><li><strong>Coordination:</strong> Open a high-priority support ticket with the cloud provider to inform them of the incident and request any additional logs or assistance they can provide.</li></ol>",
                            "image": "https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Cloud Security Monitoring Automation (AWS Lambda)",
                            "language": "python",
                            "code": "import boto3\n\n# This is a simple AWS Lambda function that can be triggered by a GuardDuty finding.\n# It automatically isolates a potentially compromised EC2 instance.\n\ndef lambda_handler(event, context):\n    \"\"\"Triggered by a GuardDuty finding to isolate an EC2 instance.\"\"\"\n    \n    instance_id = event['detail']['resource']['instanceDetails']['instanceId']\n    region = event['awsRegion']\n    \n    ec2 = boto3.client('ec2', region_name=region)\n    \n    # Get the VPC ID for the instance\n    response = ec2.describe_instances(InstanceIds=[instance_id])\n    vpc_id = response['Reservations'][0]['Instances'][0]['VpcId']\n    \n    # Create a new, highly restrictive security group that allows no traffic\n    sg_response = ec2.create_security_group(\n        GroupName=f'Forensic-Isolation-{instance_id}',\n        Description='Isolates an instance during a security investigation.',\n        VpcId=vpc_id\n    )\n    isolation_sg_id = sg_response['GroupId']\n    \n    # Apply the isolation security group to the instance\n    ec2.modify_instance_attribute(InstanceId=instance_id, Groups=[isolation_sg_id])\n    \n    print(f\"Instance {instance_id} has been isolated with security group {isolation_sg_id}.\")\n    \n    return {\n        'statusCode': 200,\n        'body': f'Successfully isolated {instance_id}'\n    }"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "According to the Shared Responsibility Model, if you misconfigure an IAM policy that leads to a data breach, who is at fault?",
                            "options": [
                                "The Cloud Service Provider (CSP)",
                                "The government",
                                "You, the customer",
                                "The security tool vendor"
                            ],
                            "correct": 2,
                            "explanation": "The CSP is responsible for the security *of* the cloud, but the customer is always responsible for the security *in* the cloud. IAM configuration falls squarely on the customer."
                        },
                        {
                            "id": 2,
                            "question": "What is considered the 'new perimeter' in a cloud environment?",
                            "options": [
                                "The physical firewall in the data center.",
                                "The antivirus on each virtual machine.",
                                "Identity and Access Management (IAM).",
                                "The physical security of the data center building."
                            ],
                            "correct": 2,
                            "explanation": "Because cloud resources are accessed via APIs over the internet, the primary security boundary is no longer the network edge but the credential and permission model that governs who can do what."
                        },
                        {
                            "id": 3,
                            "question": "What is the standard, forensically sound method for preserving disk evidence from a compromised cloud virtual machine?",
                            "options": [
                                "Deleting the virtual machine to stop the attacker.",
                                "Calling the cloud provider and asking them to mail you the physical disk.",
                                "Taking an API-driven snapshot of the virtual machine's disk.",
                                "Running a virus scan on the live machine."
                            ],
                            "correct": 2,
                            "explanation": "Since physical access is impossible, the standard procedure is to use the cloud provider's own tools to create a point-in-time snapshot of the disk. This preserves the state of the disk for later, offline analysis without altering the original evidence."
                        }
                    ]
                }
            },
            {
                "id": "lesson-12",
                "title": "IoT and OT Security Crisis Response",
                "duration": "100 min",
                "objectives": [
                    "Understand the unique vulnerabilities of Industrial Control Systems (ICS) and Operational Technology (OT).",
                    "Manage a crisis involving a compromised SCADA system.",
                    "Develop a response plan for a large-scale IoT botnet.",
                    "Prioritize physical safety over all other concerns during an OT crisis.",
                    "Implement network isolation and segmentation for OT environments.",
                    "Follow emergency shutdown and safety integrity procedures.",
                    "Navigate the regulatory compliance landscape for critical infrastructure."
                ],
                "content": {
                    "overview": "A crisis in an Internet of Things (IoT) or Operational Technology (OT) environment carries stakes far beyond data loss. A successful attack can cause physical destruction, environmental damage, or even loss of life. This lesson covers the highly specialized procedures for managing a crisis where the digital and physical worlds collide.",
                    "sections": [
                        {
                            "title": "IT vs. OT: A Fundamental Difference in Priorities",
                            "content": "<p>The priorities in an OT environment (like a factory, power plant, or water treatment facility) are inverted from a traditional IT environment.</p><h3>The Priority Shift:</h3><ul><li><strong>IT Priorities:</strong> 1. Confidentiality, 2. Integrity, 3. Availability (The CIA Triad).</li><li><strong>OT Priorities:</strong> 1. Safety, 2. Availability, 3. Integrity. (Confidentiality is often a distant last).</li></ul><p>During an OT crisis, the first and most important question for any response action is: 'What is the potential impact on physical safety?'</p>",
                            "image": "https://images.unsplash.com/photo-1619852184799-2c7e6853a7e5?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "The Unique Challenges of OT/ICS Security",
                            "content": "<p>OT environments are often filled with legacy systems and specialized hardware that make standard IT security practices difficult or impossible.</p><h3>Common Challenges:</h3><ul><li><strong>Legacy Systems:</strong> Critical controllers may run on unsupported operating systems like Windows XP because they are certified for a specific physical function and cannot be changed.</li><li><strong>No Downtime:</strong> Many industrial processes run 24/7 and cannot be taken down for patching or scanning without massive financial loss or operational risk.</li><li><strong>Fragile Devices:</strong> A simple network port scan can crash a sensitive Programmable Logic Controller (PLC).</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>The Golden Rule: Do No Harm</strong></div><p>No security-driven action should be taken in an OT environment without the explicit approval and direct supervision of the control engineers who operate the physical process. The first principle is to not make the situation worse.</p></div>",
                            "image": "https://images.unsplash.com/photo-1567093323631-45c110a88b57?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Response and Containment in OT",
                            "content": "<p>The primary strategy for OT crisis response is network isolation and a return to a safe, manual state.</p><h3>Key Response Steps:</h3><ol><li><strong>Assemble the Tripartite Team:</strong> The response must be led by a team of Security, Engineering/Operations, and Site Safety personnel.</li><li><strong>Isolate the OT Network:</strong> The first containment step is often to sever the connection between the corporate IT network and the OT network to prevent the threat from spreading.</li><li><strong>Move to Manual Operations:</strong> If the integrity of the control system is in doubt, operators may need to revert to manual control of physical processes to ensure safety.</li><li><strong>Preserve Evidence:</strong> Collect network traffic captures (PCAPs) and logs from HMIs and engineering workstations for forensic analysis.</li><li><strong>Controlled Recovery:</strong> Recovery is a slow, methodical process of validating and testing every single component before bringing it back online to ensure the integrity of the safety systems.</li></ol>",
                            "image": "https://images.unsplash.com/photo-1533723306924-a20accb1e428?w=800&h=400&fit=crop"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "IoT Device Monitoring System (Anomaly Detection)",
                            "language": "python",
                            "code": "import pandas as pd\n\n# This conceptual script uses a baseline to detect anomalous traffic from IoT devices.\n\n# Load the baseline of normal traffic (e.g., bytes per hour for each device)\n# In a real system, this would come from a database.\nbaseline = {\n    'camera-01': {'avg_bytes_hr': 5000000, 'std_dev': 500000},\n    'hvac-controller-01': {'avg_bytes_hr': 10000, 'std_dev': 1000}\n}\n\ndef check_iot_traffic(device_id, bytes_this_hour):\n    \"\"\"Checks if a device's traffic is anomalous based on its baseline.\"\"\"\n    if device_id not in baseline:\n        print(f\"[!] New unknown device detected: {device_id}\")\n        return\n\n    device_baseline = baseline[device_id]\n    # Anomaly is defined as traffic more than 3 standard deviations from the mean\n    anomaly_threshold = device_baseline['avg_bytes_hr'] + (3 * device_baseline['std_dev'])\n    \n    if bytes_this_hour > anomaly_threshold:\n        print(f\"[!] ANOMALY DETECTED for {device_id}: Sent {bytes_this_hour} bytes. Threshold is {anomaly_threshold}.\")\n        # This could be an indicator of compromise or data exfiltration.\n\n# Example: A camera that normally sends 5MB/hr suddenly sends 50MB.\ncheck_iot_traffic('camera-01', 50000000)"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the absolute highest priority during a crisis involving an Industrial Control System (ICS)?",
                            "options": [
                                "Protecting the confidentiality of the PLC source code.",
                                "Ensuring human safety and the stability of the physical process.",
                                "Preserving forensic evidence from the HMI.",
                                "Restoring the internet connection to the corporate network."
                            ],
                            "correct": 1,
                            "explanation": "In any OT/ICS incident, safety overrides all other cybersecurity concerns. The primary goal is to prevent physical harm to people, the environment, and equipment."
                        },
                        {
                            "id": 2,
                            "question": "Why is performing an active network scan on an OT network considered a high-risk activity?",
                            "options": [
                                "It is not high-risk.",
                                "It can generate too much log data.",
                                "Fragile or legacy OT devices like PLCs can crash or behave unpredictably when scanned, potentially disrupting a physical process.",
                                "It requires too much bandwidth."
                            ],
                            "correct": 2,
                            "explanation": "Unlike robust IT servers, many OT devices are not designed to handle unexpected network traffic. A standard port scan can easily cause them to fail, with potentially dangerous physical consequences."
                        },
                        {
                            "id": 3,
                            "question": "The primary team for managing an OT crisis should be a partnership between which groups?",
                            "options": [
                                "Security, Marketing, and Sales",
                                "Security, Engineering/Operations, and Site Safety",
                                "Security, Legal, and Finance",
                                "Security, HR, and Facilities"
                            ],
                            "correct": 1,
                            "explanation": "This tripartite team is essential. Security understands the cyber threat, Engineering/Operations understands the physical process, and Site Safety understands the potential real-world consequences. All three must work together to manage the crisis safely."
                        }
                    ]
                }
            },
            
        {
            "id": "lesson-13",
            "title": "Crisis Team Organization and Management",
            "duration": "90 min",
            "objectives": [
                "Design an effective crisis team structure with clearly defined roles.",
                "Establish a command and control framework for crisis operations.",
                "Delegate decision-making authority to the appropriate levels.",
                "Develop procedures for resource allocation and surge capacity.",
                "Implement shift management and rotation schedules for extended crises.",
                "Coordinate with external experts, vendors, and contractors.",
                "Define training requirements and performance metrics for the crisis team.",
                "Promote stress management and resilience for crisis responders."
            ],
            "content": {
                "overview": "Technology and plans are essential, but crises are ultimately managed by people. This lesson focuses on the human element of crisis management: how to structure your teams, establish clear lines of authority, and manage the intense stress and operational tempo of a prolonged incident to ensure peak performance and prevent burnout.",
                "sections": [
                    {
                        "title": "The Tiered Response Structure",
                        "content": "<p>A mature crisis management program uses a tiered structure to ensure the right people are focused on the right problems.</p><h3>The Three Tiers:</h3><ul><li><strong>Tier 1: Technical Incident Response Team (T-IRT):</strong> The 'boots on the ground'. Composed of security analysts, forensic investigators, and IT engineers. They are focused on the hands-on technical remediation of the incident.</li><li><strong>Tier 2: Crisis Management Team (CMT):</strong> The 'strategic command'. Composed of senior leaders (CISO, Legal, HR, Comms, business units). They are focused on the business impact of the crisis, making strategic decisions, and managing stakeholders. They do NOT do the technical work.</li><li><strong>Tier 3: Executive Leadership:</strong> The CEO and board. They are briefed by the CMT and are responsible for the ultimate fiduciary and legal oversight of the crisis.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit-crop"
                    },
                    {
                        "title": "Command and Control: The Incident Commander",
                        "content": "<p>During a crisis, there must be one person in charge of the overall response. This role is often called the Incident Commander or Crisis Manager. They are typically a senior leader like the CISO.</p><h3>Role of the Incident Commander:</h3><ul><li>Does not perform technical work.</li><li>Maintains overall situational awareness.</li><li>Facilitates the CMT meetings.</li><li>Ensures all teams (Technical, Legal, Comms) are coordinated.</li><li>Briefs executive leadership.</li><li>Makes the final call on strategic decisions.</li></ul><p>This structure prevents confusion and ensures a single, authoritative source of direction for the response.</p>",
                        "image": "https://images.unsplash.com/photo-1573495782740-62c135d54483?w=800&h=400&fit-crop"
                    },
                    {
                        "title": "Managing the Marathon: Tempo and Burnout",
                        "content": "<p>A major crisis is a marathon, not a sprint. The initial adrenaline rush will fade, and responder fatigue is a major risk that can lead to critical mistakes.</p><h3>Operational Tempo Management:</h3><ul><li><strong>Establish a 'Battle Rhythm':</strong> Immediately set a predictable schedule for all key activities. For example: 'The CMT will meet for 30 minutes every 4 hours. Technical teams will have a shift change briefing at 0700 and 1900 daily.' This creates structure in the chaos.</li><li><strong>Enforce Rotations:</strong> No one should work for more than 12 hours straight. A good leader forces their people to rest. A tired analyst is an ineffective and dangerous analyst.</li><li><strong>Provide Support:</strong> Ensure the response teams have the logistical support they need: food, water, a quiet place to rest, and access to mental health resources.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Lead from the Front</strong></div><p>The leader's demeanor sets the tone for the entire response. A calm, decisive, and empathetic leader inspires confidence. If the leader panics, the team will panic.</p></div>",
                        "image": "https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&h=400&fit-crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Crisis Team Roles and Responsibilities (YAML)",
                        "language": "yaml",
                        "code": "crisis_team_structure:\n  - role: Crisis Manager / Incident Commander\n    holder: CISO\n    responsibilities:\n      - Overall strategic command of the crisis response.\n      - Facilitate all CMT meetings.\n      - Brief executive leadership.\n\n  - role: Technical Response Lead\n    holder: Director of Security Operations\n    responsibilities:\n      - Manage the T-IRT (Tier 1) technical teams.\n      - Provide technical updates and analysis to the CMT.\n      - Recommend containment and eradication strategies.\n\n  - role: Legal Lead\n    holder: General Counsel\n    responsibilities:\n      - Advise on regulatory notification requirements.\n      - Manage attorney-client privilege.\n      - Coordinate with law enforcement and outside counsel.\n\n  - role: Communications Lead\n    holder: VP of Corporate Communications\n    responsibilities:\n      - Develop and execute the crisis communication plan.\n      - Draft all internal and external statements.\n      - Act as the sole media spokesperson."
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "In a tiered crisis response structure, which team is responsible for making strategic business decisions and managing stakeholders?",
                        "options": [
                            "The Technical Incident Response Team (T-IRT)",
                            "The Crisis Management Team (CMT)",
                            "The Help Desk",
                            "The CEO's administrative assistant"
                        ],
                        "correct": 1,
                        "explanation": "The CMT is the strategic (Tier 2) team, focused on the business implications of the crisis, while the T-IRT is the tactical (Tier 1) team, focused on the hands-on technical work."
                    },
                    {
                        "id": 2,
                        "question": "What is the primary role of the Incident Commander?",
                        "options": [
                            "To perform the most complex digital forensics.",
                            "To provide overall strategic leadership and coordination for the crisis response.",
                            "To personally write all press releases.",
                            "To make coffee for the response team."
                        ],
                        "correct": 1,
                        "explanation": "The Incident Commander's job is to lead, not to do. They maintain situational awareness, make key decisions, and coordinate all the different parts of the response, but they delegate the hands-on work to the appropriate teams."
                    },
                    {
                        "id": 3,
                        "question": "Establishing a predictable meeting schedule and enforcing mandatory 12-hour shifts for responders are techniques for what?",
                        "options": [
                            "Making the crisis last longer.",
                            "Managing the operational tempo and preventing team burnout.",
                            "Annoying the response team.",
                            "Justifying a larger budget."
                        ],
                        "correct": 1,
                        "explanation": "These are critical disciplines for managing a prolonged crisis. A predictable 'battle rhythm' and enforced rest prevent the fatigue and burnout that lead to critical mistakes."
                    }
                ]
            }
        },
        {
            "id": "lesson-14",
            "title": "Business Continuity and Disaster Recovery",
            "duration": "100 min",
            "objectives": [
                "Conduct a Business Impact Analysis (BIA) to identify critical systems.",
                "Define and apply Recovery Time Objectives (RTO) and Recovery Point Objectives (RPO).",
                "Differentiate between business continuity and disaster recovery.",
                "Develop strategies for activating alternative processing sites.",
                "Establish procedures for verifying data backups and planning for restoration.",
                "Ensure redundancy for critical communication systems.",
                "Integrate supply chain continuity into overall planning."
            ],
            "content": {
                "overview": "When a cybersecurity crisis causes a major operational disruption, the focus shifts from just fixing the security problem to keeping the business alive. This lesson covers the crucial disciplines of Business Continuity (BC) and Disaster Recovery (DR), and how they integrate with the crisis management process to ensure the organization can survive and recover.",
                "sections": [
                    {
                        "title": "BC vs. DR: A Question of Scope",
                        "content": "<p>These terms are often used interchangeably, but they have distinct meanings.</p><ul><li><strong>Disaster Recovery (DR):</strong> A subset of BC. DR is focused specifically on restoring the IT infrastructure, applications, and data after a disaster. It is a technology-centric discipline.</li><li><strong>Business Continuity (BC):</strong> A holistic, business-wide discipline. BC is focused on maintaining critical business *functions* during a disruption. This might involve technology (like failing over to a DR site), but it also includes manual workarounds, people, and processes.</li></ul><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>Simple Example</strong></div><p>A ransomware attack takes down the automated invoicing system. The **Disaster Recovery** plan focuses on restoring the invoicing server from backup. The **Business Continuity** plan focuses on the process of paying employees in the meantime, which might involve cutting manual paper checks.</p></div>",
                        "image": "https://images.unsplash.com/photo-1544197150-b99a580bb7a8?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "The Language of Recovery: RTO and RPO",
                        "content": "<p>The entire DR strategy is driven by two key metrics that are defined by the business, not by IT.</p><h3>The Two Objectives:</h3><ul><li><strong>Recovery Time Objective (RTO):</strong> The maximum acceptable amount of *time* a system or business process can be offline. The RTO dictates how fast your recovery solution needs to be. An RTO of 4 hours requires a much more expensive solution than an RTO of 48 hours.</li><li><strong>Recovery Point Objective (RPO):</strong> The maximum acceptable amount of *data loss*, measured in time. The RPO dictates how frequently you must perform backups. An RPO of 15 minutes means you must back up the data at least every 15 minutes.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "The BIA: The Foundation of all Planning",
                        "content": "<p>As discussed in Lesson 1, the Business Impact Analysis (BIA) is the foundational document for both BC and DR. It is the process of identifying the most critical business functions and their dependencies on technology.</p><h3>The BIA Process:</h3><ol><li>Interview business leaders from every department.</li><li>Identify their most critical processes (e.g., 'processing payroll', 'manufacturing product X').</li><li>For each process, determine the financial and operational impact if it were disrupted.</li><li>Based on that impact, the business leaders assign an RTO and RPO for that process.</li><li>Map the business processes to the underlying IT applications and infrastructure that support them.</li></ol><p>The result is a prioritized list that tells the DR team exactly which systems they need to protect and in what order they must be recovered during a crisis.</p>",
                        "image": "https://images.unsplash.com/photo-1554224155-1696413565d3?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Automated Backup Verification System (PowerShell)",
                        "language": "powershell",
                        "code": "# This is a conceptual PowerShell script to automate the verification of backups.\n# It simulates mounting a recent backup and checking for a key file's existence.\n\nparam (\n    [string]$BackupShare = \"\\\\backup-server\\sql_backups\",\n    [string]$CriticalFile = \"database.mdf\"\n)\n\n# Get the most recent backup file\n$latestBackup = Get-ChildItem -Path $BackupShare | Sort-Object LastWriteTime -Descending | Select-Object -First 1\n\nif (-not $latestBackup) {\n    Send-MailMessage -To \"admins@example.com\" -Subject \"CRITICAL: Backup Verification Failed! No backup found.\"\n    return\n}\n\nWrite-Host \"Verifying latest backup: $($latestBackup.Name)\"\n\n# In a real script, you would mount the backup image here.\n# For this example, we'll just simulate checking the content.\n\n# Mount-BackupImage -Path $latestBackup.FullName -MountPoint \"M:\"\n$filePath = \"M:\\$($CriticalFile)\" # Simulating the mounted path\n\n# Check if the critical file exists in the (simulated) mounted backup\nif (Test-Path $filePath -PathType Leaf) {\n    $verificationStatus = \"SUCCESS\"\n    Write-Host \"Verification successful. Critical file found.\"\n} else {\n    $verificationStatus = \"FAILURE\"\n    Send-MailMessage -To \"admins@example.com\" -Subject \"CRITICAL: Backup Verification Failed! Critical file missing.\"\n}\n\n# Log the result\nAdd-Content -Path \"C:\\logs\\backup_verification.log\" -Value \"$(Get-Date) - $($latestBackup.Name) - $verificationStatus\""
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "The business has determined that the customer order system cannot be down for more than 4 hours. This is an example of what?",
                        "options": [
                            "Recovery Point Objective (RPO)",
                            "Recovery Time Objective (RTO)",
                            "Service Level Agreement (SLA)",
                            "Acceptable Use Policy (AUP)"
                        ],
                        "correct": 1,
                        "explanation": "RTO defines the maximum acceptable downtime. It is a measure of time and dictates the required speed of recovery."
                    },
                    {
                        "id": 2,
                        "question": "A company's plan to restore its IT servers at an alternative data center after a fire is an example of:",
                        "options": [
                            "Business Continuity (BC)",
                            "Disaster Recovery (DR)",
                            "Incident Response (IR)",
                            "Public Relations (PR)"
                        ],
                        "correct": 1,
                        "explanation": "Disaster Recovery is the technology-focused discipline of restoring IT infrastructure and data after a disaster. Business Continuity is the broader discipline of keeping the business functions running, which might include the DR plan."
                    },
                    {
                        "id": 3,
                        "question": "A policy stating that the company cannot afford to lose more than 1 hour of transaction data dictates what?",
                        "options": [
                            "The Recovery Time Objective (RTO) must be 1 hour.",
                            "The Recovery Point Objective (RPO) must be 1 hour or less.",
                            "The company must have a hot site for recovery.",
                            "The company must notify customers within 1 hour."
                        ],
                        "correct": 1,
                        "explanation": "RPO defines the maximum acceptable data loss. An RPO of 1 hour means that backups must be performed at least once every hour to ensure that, in a worst-case scenario, no more than one hour of data is lost."
                    }
                ]
            }
        },
        {
            "id": "lesson-15",
            "title": "Legal and Regulatory Crisis Management",
            "duration": "100 min",
            "objectives": [
                "Navigate the complex web of compliance frameworks during a crisis.",
                "Implement legally defensible evidence preservation techniques.",
                "Maintain a proper chain of custody for all digital evidence.",
                "Understand and implement a legal hold.",
                "Manage mandatory regulatory reporting requirements and timelines.",
                "Establish effective protocols for coordinating with law enforcement.",
                "Address international legal considerations and privacy laws.",
                "Provide litigation support to legal counsel."
            ],
            "content": {
                "overview": "A cybersecurity crisis is also a legal crisis. The actions taken during the response will be heavily scrutinized by regulators, lawyers, and courts. This lesson covers the critical legal considerations during a crisis, focusing on evidence preservation, regulatory reporting, and effective coordination with legal counsel and law enforcement.",
                "sections": [
                    {
                        "title": "Evidence Preservation and Chain of Custody",
                        "content": "<p>When a crisis is likely to result in litigation or criminal investigation, every piece of digital evidence must be handled in a forensically sound manner.</p><h3>Key Principles:</h3><ul><li><strong>Preserve Original Evidence:</strong> Never perform analysis on the original system or media. Always make a bit-for-bit forensic image (a perfect copy) and work on the image.</li><li><strong>Maintain Chain of Custody:</strong> This is a formal, written log that tracks the movement and handling of a piece of evidence from the moment it is collected. It documents who had the evidence, when, and for what purpose. Any gap in this chain can make the evidence inadmissible in court.</li><li><strong>Legal Hold:</strong> When litigation is anticipated, the legal department will issue a 'legal hold'. This is a formal directive to the organization to preserve all data that could be relevant to the case. This overrides normal data deletion and retention policies.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1588196749597-9ff075ee6b5b?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Coordinating with Law Enforcement",
                        "content": "<p>The decision to involve law enforcement is a strategic one made by the Crisis Management Team in consultation with legal counsel. It has both benefits and drawbacks.</p><h3>Pros:</h3><ul><li>Access to greater investigative resources and intelligence.</li><li>Potential to prosecute the attackers.</li><li>May be required by some regulations or insurance policies.</li></ul><h3>Cons:</h3><ul><li>You may lose some control over the investigation.</li><li>Law enforcement's primary goal is prosecution, which may conflict with the company's goal of rapid service restoration.</li><li>The investigation may become public information.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1505664194779-8beace7a2044?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Attorney-Client Privilege",
                        "content": "<p>During a crisis, reports and communications about the incident could be discoverable in a lawsuit and used against the company. To protect this sensitive analysis, organizations often use a 'privileged investigation' model.</p><h3>How it Works:</h3><ol><li>The company hires an external law firm to lead the investigation.</li><li>The law firm then hires the forensic/incident response firm.</li><li>Because the forensic work is being done at the direction of lawyers for the purpose of providing legal advice, the resulting reports and communications may be protected from discovery by attorney-client privilege.</li></ol><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>A Critical Strategy</strong></div><p>This is not something to figure out during a crisis. The decision to use a privileged investigation model and the relationships with the external law and forensic firms should be established *before* an incident as part of the preparation phase.</p></div>",
                        "image": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Evidence Collection Automation (Pseudocode)",
                        "language": "python",
                        "code": "import hashlib\nimport datetime\n\n# This conceptual script automates parts of the forensic evidence collection process.\n\ndef collect_evidence(hostname, case_number):\n    \"\"\"Performs a forensically sound collection from a target host.\"\"\"\n    timestamp = datetime.datetime.utcnow().isoformat() + 'Z'\n    \n    # 1. Capture volatile memory (RAM)\n    print(f\"Capturing memory from {hostname}...\")\n    # ram_image = memory_capture_tool.capture(hostname)\n    ram_image_path = f\"/evidence/{case_number}/{hostname}_ram_{timestamp}.mem\"\n    # save_image(ram_image, ram_image_path)\n    \n    # 2. Calculate hash of the memory image\n    ram_hash = hashlib.sha256(open(ram_image_path,'rb').read()).hexdigest()\n    print(f\"Memory image hash (SHA256): {ram_hash}\")\n    \n    # 3. Create a new entry in the chain of custody log\n    log_chain_of_custody(\n        case_number=case_number,\n        item_id=f\"{hostname}-RAM-01\",\n        description=\"Volatile memory capture from host {hostname}\",\n        timestamp=timestamp,\n        collected_by=\"Automated IR System\",\n        sha256_hash=ram_hash\n    )\n    \n    print(\"Evidence collected and logged in chain of custody.\")\n\ndef log_chain_of_custody(case_number, item_id, description, timestamp, collected_by, sha256_hash):\n    # This function would append a new, immutable record to the official log.\n    pass"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "A formal document that tracks the handling and possession of a piece of evidence from collection to courtroom is known as:",
                        "options": [
                            "A legal hold",
                            "A business impact analysis",
                            "A chain of custody",
                            "An incident report"
                        ],
                        "correct": 2,
                        "explanation": "The chain of custody is a critical legal document that provides an audit trail to prove the integrity of evidence. Any gap in the chain can make the evidence inadmissible."
                    },
                    {
                        "id": 2,
                        "question": "What is the primary purpose of conducting a crisis investigation under attorney-client privilege?",
                        "options": [
                            "To make the investigation take longer.",
                            "To protect sensitive analysis and communications about the incident from being discoverable in a future lawsuit.",
                            "To ensure that law enforcement is not involved.",
                            "To get a discount on forensic services."
                        ],
                        "correct": 1,
                        "explanation": "When legal counsel directs the investigation, the work product (reports, emails, etc.) is created for the purpose of providing legal advice, which is the foundation for asserting privilege and protecting the analysis from opposing counsel."
                    },
                    {
                        "id": 3,
                        "question": "A formal directive from the legal department to preserve all data related to a specific matter, overriding normal deletion policies, is called a:",
                        "options": [
                            "Data backup",
                            "Legal hold",
                            "Press release",
                            "Recovery plan"
                        ],
                        "correct": 1,
                        "explanation": "A legal hold is a mandatory process in anticipation of litigation. Failure to preserve data under a legal hold can result in severe legal penalties for spoliation of evidence."
                    }
                ]
            }
        },
        {
            "id": "lesson-16",
            "title": "Financial Crisis Management in Cybersecurity",
            "duration": "90 min",
            "objectives": [
                "Develop methodologies for estimating the financial cost of a cyber crisis.",
                "Manage budget allocation and emergency spending during a crisis.",
                "Understand and execute the procedures for a cyber insurance claim.",
                "Conduct a financial impact assessment for business interruption.",
                "Develop strategies to protect revenue and mitigate market impact.",
                "Communicate effectively with shareholders and financial markets.",
                "Perform a cost-benefit analysis for different response and recovery options."
            ],
            "content": {
                "overview": "A major cyber crisis is a major financial event. This lesson focuses on the financial dimension of crisis management, covering how to estimate costs, manage emergency spending, navigate the cyber insurance process, and communicate with financial stakeholders to mitigate market impact.",
                "sections": [
                    {
                        "title": "Estimating the Cost of a Crisis",
                        "content": "<p>Understanding the potential financial impact is critical for decision-making. Costs can be broken down into direct and indirect categories.</p><h3>Direct Costs (Hard Costs):</h3><ul><li>Cost of forensic and legal experts.</li><li>Cost of notifying affected customers.</li><li>Regulatory fines and penalties.</li><li>Cost of providing credit monitoring services.</li><li>Overtime for employees.</li><li>Cost of new security technology purchased.</li></ul><h3>Indirect Costs (Soft Costs):</h3><ul><li>Business interruption / lost revenue.</li><li>Damage to brand reputation and loss of customer trust.</li><li>Decline in stock price.</li><li>Loss of intellectual property.</li><li>Increased cost to raise capital in the future.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1554224155-1696413565d3?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Navigating Cyber Insurance",
                        "content": "<p>Cyber insurance can be a critical financial backstop, but it is not a blank check. Policies are complex and have strict requirements.</p><h3>The Claims Process:</h3><ol><li><strong>Immediate Notification:</strong> Your policy will have a strict timeline for notifying the carrier of a potential incident, often 24-48 hours. Failure to do so can void your coverage.</li><li><strong>Panel Counsel/Vendors:</strong> Most carriers require you to use *their* pre-approved panel of law firms and forensic investigators. You cannot just hire your own and expect to be reimbursed.</li><li><strong>Carrier Consent:</strong> The insurance carrier must be consulted on and consent to major decisions, especially the decision to pay a ransom.</li><li><strong>Documentation:</strong> You will need to provide extensive documentation to support your claim, including forensic reports, invoices, and proof of lost revenue.</li></ol>",
                        "image": "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=800&h=400&fit-crop"
                    },
                    {
                        "title": "Cost-Benefit Analysis in Response",
                        "content": "<p>Financial considerations can influence the response strategy. The crisis management team must weigh the costs of different options.</p><h3>Example Scenario: Ransomware</h3><p>A critical system is encrypted. The team must analyze two options:</p><ul><li><strong>Option A: Rebuild from Backup.</strong><ul><li><strong>Costs:</strong> 3 days of business interruption (lost revenue), cost of overtime for the IT team.</li><li><strong>Benefit:</strong> No ransom payment, attacker is fully eradicated.</li></ul></li><li><strong>Option B: Pay the Ransom.</strong><ul><li><strong>Costs:</strong> The ransom payment itself, cost of a negotiator, 1 day of business interruption.</li><li><strong>Benefit:</strong> Potentially faster recovery.</li><li><strong>Risks:</strong> Decryptor may not work, attacker may still have a backdoor, funds criminal activity.</li></ul></li></ul><p>The CMT, with input from the CFO, must weigh these financial and risk variables to make a strategic decision.</p>",
                        "image": "https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Financial Impact Assessment (Python)",
                        "language": "python",
                        "code": "def calculate_breach_cost(direct_costs, business_interruption_hours, revenue_per_hour):\n    \"\"\"Calculates a simplified financial impact of a crisis.\"\"\"\n    \n    # Sum of direct, out-of-pocket expenses\n    total_direct_costs = sum(direct_costs.values())\n    \n    # Calculate lost revenue from downtime\n    lost_revenue = business_interruption_hours * revenue_per_hour\n    \n    # Total quantifiable impact\n    total_cost = total_direct_costs + lost_revenue\n    \n    print(\"--- Financial Impact Assessment ---\")\n    for category, cost in direct_costs.items():\n        print(f\"{category}: ${cost:,}\")\n    print(f\"Lost Revenue (Business Interruption): ${lost_revenue:,}\")\n    print(\"-------------------------------------\")\n    print(f\"Total Estimated Financial Cost: ${total_cost:,}\")\n    print(\"Note: This excludes indirect costs like reputational damage.\")\n    \n    return total_cost\n\n# Example for a ransomware event\ndirect_expenses = {\n    'Forensic Investigators': 150000,\n    'External Legal Counsel': 100000,\n    'Ransom Payment': 0, # Assuming no payment\n    'Overtime for IT': 50000\n}\n\ncalculate_breach_cost(direct_costs=direct_expenses, business_interruption_hours=72, revenue_per_hour=50000)"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "Lost revenue due to operational downtime is an example of what kind of cost?",
                        "options": [
                            "A direct cost",
                            "An indirect cost",
                            "A legal cost",
                            "An insurance premium"
                        ],
                        "correct": 1,
                        "explanation": "While the *impact* is indirect (affecting revenue rather than a direct cash payment), the loss itself is a quantifiable financial cost of business interruption. It's often categorized with direct costs in impact assessments."
                    },
                    {
                        "id": 2,
                        "question": "What is one of the most important first steps after discovering a potential incident, according to most cyber insurance policies?",
                        "options": [
                            "Immediately paying the ransom.",
                            "Notifying the insurance carrier within a strict, predefined timeline.",
                            "Posting about the incident on social media.",
                            "Waiting a week to see if the problem fixes itself."
                        ],
                        "correct": 1,
                        "explanation": "Cyber insurance policies have very strict notification requirements. Failing to notify the carrier promptly can be grounds for denying the entire claim."
                    },
                    {
                        "id": 3,
                        "question": "Why might a cyber insurance policy require you to use a pre-approved 'panel' law firm?",
                        "options": [
                            "Because those firms are the most expensive.",
                            "To ensure the company is represented by a firm with proven expertise in cybersecurity law and to control costs.",
                            "They don't have this requirement.",
                            "To make the claims process more difficult."
                        ],
                        "correct": 1,
                        "explanation": "Insurance carriers maintain a list of vetted, experienced (and often pre-negotiated rate) law and forensic firms. This ensures a certain quality of response and helps the carrier manage the costs and risks of the claim."
                    }
                ]
            }
        },
        {
            "id": "lesson-17",
            "title": "Crisis Leadership and Decision Making",
            "duration": "90 min",
            "objectives": [
                "Understand and apply the core principles of effective crisis leadership.",
                "Utilize structured frameworks for making decisions under pressure and with incomplete information.",
                "Recognize and mitigate common cognitive biases that affect crisis decision-making.",
                "Apply stress management techniques for yourself and your team.",
                "Motivate and lead a team through a high-stress, long-duration event.",
                "Apply ethical frameworks to complex crisis decisions.",
                "Effectively prioritize resources and actions in a time-critical environment.",
                "Communicate decisively and effectively with senior leadership."
            ],
            "content": {
                "overview": "In a crisis, the quality of leadership is the single most important factor for success. This lesson focuses on the 'soft skills' that are actually the hardest skills: how to lead people, make good decisions under extreme pressure, and manage the human element of a cybersecurity crisis.",
                "sections": [
                    {
                        "title": "The Principles of Crisis Leadership",
                        "content": "<p>Effective crisis leaders exhibit a specific set of behaviors that inspire confidence and create order from chaos.</p><h3>Key Attributes:</h3><ul><li><strong>Visibility:</strong> The leader must be present and visible, leading from the front.</li><li><strong>Decisiveness:</strong> Leaders must be able to make decisions quickly with incomplete information, avoiding 'analysis paralysis'.</li><li><strong>Calmness:</strong> The team takes its emotional cues from the leader. A calm and composed leader fosters a calm and focused team.</li><li><strong>Empathy:</strong> A leader must understand and manage the immense stress and fatigue their team is under.</li><li><strong>Clear Communication:</strong> Providing a constant flow of clear, concise, and credible information to the team and stakeholders.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1573495782740-62c135d54483?w=800&h=400&fit-crop"
                    },
                    {
                        "title": "Decision-Making Frameworks",
                        "content": "<p>Relying on intuition alone in a crisis is risky. Structured frameworks can lead to better decisions.</p><h3>The OODA Loop:</h3><p>A framework developed by military strategist John Boyd for decision-making in fast-paced environments.</p><ol><li><strong>Observe:</strong> Gather information from all available sources (e.g., SIEM alerts, team briefings).</li><li><strong>Orient:</strong> Analyze the information and put it into context. This is the most important step. What does this data *mean*?</li><li><strong>Decide:</strong> Based on your orientation, choose a course of action.</li><li><strong>Act:</strong> Execute the decision.</li></ol><p>After acting, the loop immediately begins again, as your action has now changed the situation, requiring new observation.</p>",
                        "image": "https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=800&h=400&fit-crop"
                    },
                    {
                        "title": "Cognitive Biases: The Enemy Within",
                        "content": "<p>Under stress, the human brain relies on mental shortcuts (biases) that can lead to poor decisions.</p><h3>Common Crisis Biases:</h3><ul><li><strong>Confirmation Bias:</strong> The tendency to favor information that confirms your existing beliefs. If you believe the attacker is a simple script kiddie, you might ignore evidence that they are a sophisticated APT.</li><li><strong>Groupthink:</strong> A desire for harmony in a group leads to an irrational or dysfunctional decision-making outcome. People are afraid to speak up and challenge the consensus.</li><li><strong>Availability Heuristic:</strong> Overestimating the likelihood of events that are more recent or emotionally vivid in your memory.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Fighting Bias</strong></div><p>A good crisis leader fights bias by encouraging dissent and diverse viewpoints. They might assign one person to the role of 'devil's advocate' with the specific job of challenging the team's primary assumptions.</p></div>",
                        "image": "https://images.unsplash.com/photo-1556742502-ec7c0e9f34b1?w=800&h=400&fit-crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Ethical Decision-Making Framework (Checklist)",
                        "language": "markdown",
                        "code": "# A Simple Ethical Framework for Crisis Decisions\n\n**Decision to be Made:** (e.g., 'Should we take the customer portal offline to contain a threat, impacting thousands of users?')\n\n### 1. The Utilitarian Test\n*Which option will produce the most good and do the least harm for all stakeholders (customers, employees, shareholders)?*\n\n- **Option A (Take Offline):**\n  - **Harm:** Business interruption, customer frustration.\n  - **Good:** Protects all customer data from further breach.\n- **Option B (Leave Online):**\n  - **Harm:** Potential for massive data theft.\n  - **Good:** No immediate business interruption.\n\n### 2. The Rights Test\n*Which option best respects the rights of all who have a stake? (e.g., right to privacy, right to safety)*\n\n- Does leaving the portal online violate our customers' right to have their private data protected?\n\n### 3. The Justice Test\n*Which option treats people equally or proportionately? Is it fair?*\n\n- Is the harm to customers from a data breach distributed fairly if we leave the system online?\n\n### 4. The Publicity Test\n*How would we feel if our chosen action was reported on the front page of the news tomorrow? Would we be proud to defend it?*\n\n- **Conclusion:** (Based on the above, the ethical choice is likely to take the portal offline, prioritizing data protection over uptime.)"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "The OODA Loop is a framework for what?",
                        "options": [
                            "Budgeting for a crisis.",
                            "Writing a press release.",
                            "A continuous cycle of observation and decision-making under pressure.",
                            "Conducting forensic analysis."
                        ],
                        "correct": 2,
                        "explanation": "The Observe-Orient-Decide-Act loop is a classic model for making effective decisions in fast-moving, high-stress environments like a military engagement or a cyber crisis."
                    },
                    {
                        "id": 2,
                        "question": "The tendency to favor information that confirms your initial assessment, while ignoring contradictory evidence, is known as what?",
                        "options": [
                            "Groupthink",
                            "Confirmation Bias",
                            "The OODA Loop",
                            "Due Diligence"
                        ],
                        "correct": 1,
                        "explanation": "Confirmation bias is a dangerous cognitive shortcut in an investigation. It can cause an analyst to lock onto an incorrect theory early and miss the true nature of the attack."
                    },
                    {
                        "id": 3,
                        "question": "What is the most important attribute for a crisis leader to display to their team?",
                        "options": [
                            "Deep technical expertise in malware reverse engineering.",
                            "A sense of panic to show the situation is serious.",
                            "A calm, decisive, and empathetic demeanor.",
                            "The ability to work for 72 hours straight without sleep."
                        ],
                        "correct": 2,
                        "explanation": "The team's emotional state and focus will mirror their leader's. A leader who projects calm confidence, makes clear decisions, and shows they care about their team's well-being will lead a much more effective response."
                    }
                ]
            }
        },
        {
            "id": "lesson-18",
            "title": "Technology and Tools for Crisis Management",
            "duration": "100 min",
            "objectives": [
                "Understand the role of SIEM in providing centralized visibility for a crisis.",
                "Leverage a SOAR platform to automate and orchestrate response actions.",
                "Utilize threat intelligence platforms to enrich alerts with external context.",
                "Select and use dedicated crisis management and communication software.",
                "Apply forensic analysis tools for deep-dive investigation.",
                "Verify the readiness of backup and recovery solutions.",
                "Integrate monitoring and alerting systems into the crisis workflow."
            ],
            "content": {
                "overview": "Effective crisis management is augmented by a well-integrated technology stack. This lesson provides an overview of the key tools and platforms that support a crisis response, from the centralized visibility provided by a SIEM to the automation power of a SOAR platform and the specialized software used to manage the crisis itself.",
                "sections": [
                    {
                        "title": "The Visibility Foundation: SIEM and EDR",
                        "content": "<p>You cannot respond to what you cannot see. The foundation of any technical response is visibility into your environment.</p><h3>Core Visibility Tools:</h3><ul><li><strong>SIEM (Security Information and Event Management):</strong> The 'single pane of glass'. A SIEM collects, aggregates, and correlates log data from all across the enterprise (networks, servers, applications, cloud). It is the primary tool for investigation and threat hunting.</li><li><strong>EDR (Endpoint Detection and Response):</strong> The 'CCTV for your endpoints'. EDR provides deep visibility into the activity on workstations and servers. It can see which processes are running, what network connections they are making, and what files they are touching. It is also a response tool, allowing analysts to remotely quarantine a host.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1526628953301-3e589a6a8b74?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "The Action Layer: SOAR and Automation",
                        "content": "<p>Security Orchestration, Automation, and Response (SOAR) platforms act as the 'brain' of the modern security operations center, integrating tools and automating playbooks.</p><h3>How SOAR Helps in a Crisis:</h3><ul><li><strong>Speed:</strong> A SOAR playbook can perform enrichment and containment actions in seconds, whereas a human analyst might take 30 minutes. This speed is critical.</li><li><strong>Consistency:</strong> It ensures that the defined process is followed perfectly every single time, reducing the chance of human error under pressure.</li><li><strong>Force Multiplier:</strong> It automates the repetitive, high-volume tasks, freeing up the human experts to focus on the most complex aspects of the crisis.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1515879218367-8466d910aaa4?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Crisis Management and Communication Platforms",
                        "content": "<p>Beyond the core security tools, specialized platforms are used to manage the crisis itself.</p><h3>Key Platforms:</h3><ul><li><strong>Out-of-Band Communication:</strong> A critical requirement is a secure communication channel that does *not* rely on your corporate network (which may be compromised or down). This includes tools like Signal, or dedicated crisis management apps.</li><li><strong>Crisis Management Software:</strong> Platforms designed to manage the crisis lifecycle. They provide tools for incident logging (creating a timeline), task tracking, document management (for the IRP and playbooks), and stakeholder communication.</li><li><strong>Mass Notification Systems:</strong> Tools used to send urgent messages to all employees via multiple channels (email, text, phone call) simultaneously.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Don't Communicate on the Compromised Network</strong></div><p>If your corporate email or Slack instance is compromised, the attacker can read everything you are saying about your response plans. Using a secure, out-of-band channel is non-negotiable for the crisis management team.</p></div>",
                        "image": "https://images.unsplash.com/photo-1556740714-a8395b3bf30f?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Integrated Crisis Response Platform (API Call)",
                        "language": "json",
                        "code": "{\n  \"action\": \"TriggerCrisisPlaybook\",\n  \"source_alert\": {\n    \"siem_id\": \"ALERT-54321\",\n    \"type\": \"Enterprise Ransomware Detected\"\n  },\n  \"playbook_to_run\": \"PB_Ransomware_Crisis_v2\",\n  \"parameters\": {\n    \"severity\": \"Critical\",\n    \"initial_confidence\": \"High\"\n  },\n  \"actions_to_execute\": [\n    {\n      \"tool\": \"MassNotificationSystem\",\n      \"action\": \"Send_Message\",\n      \"target_group\": \"IT_Staff\",\n      \"message\": \"Critical cybersecurity incident in progress. All IT staff report to your designated emergency stations.\"\n    },\n    {\n      \"tool\": \"CrisisManagementPlatform\",\n      \"action\": \"ActivateCMT\",\n      \"incident_title\": \"Ransomware Outbreak - Project Phoenix\"\n    },\n    {\n      \"tool\": \"CollaborationPlatform\",\n      \"action\": \"CreateSecureChannel\",\n      \"channel_name\": \"phoenix-crisis-channel\"\n    }\n  ]\n}"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "Which technology serves as the centralized 'single pane of glass' for collecting and analyzing log data from across an enterprise?",
                        "options": [
                            "EDR",
                            "Firewall",
                            "SIEM",
                            "Antivirus"
                        ],
                        "correct": 2,
                        "explanation": "A SIEM (Security Information and Event Management) platform's core purpose is to provide centralized visibility by aggregating and correlating logs from disparate sources."
                    },
                    {
                        "id": 2,
                        "question": "What is the primary function of a SOAR platform in a crisis?",
                        "options": [
                            "To back up data.",
                            "To integrate disparate security tools and automate response playbooks, increasing speed and consistency.",
                            "To provide a secure channel for executive communication.",
                            "To perform deep forensic analysis of a hard drive."
                        ],
                        "correct": 1,
                        "explanation": "SOAR acts as the connective tissue for the security stack, allowing tools to work together and automating the repetitive tasks that are essential for a rapid and consistent response."
                    },
                    {
                        "id": 3,
                        "question": "Why is it critical to have a secure, 'out-of-band' communication channel for the crisis management team?",
                        "options": [
                            "It is a nice-to-have, but not critical.",
                            "To ensure that the attackers, who may have compromised the corporate email or chat system, cannot read the team's response plans.",
                            "To make it harder for the crisis team to communicate.",
                            "Because they look more professional."
                        ],
                        "correct": 1,
                        "explanation": "If your primary communication channels are compromised, the adversary has a massive advantage. An out-of-band channel (like Signal or a dedicated crisis app) that does not rely on corporate infrastructure is essential for confidential communication."
                    }
                ]
            }
        },
        {
            "id": "lesson-19",
            "title": "Crisis Simulation and Tabletop Exercises",
            "duration": "100 min",
            "objectives": [
                "Understand the critical importance of regular crisis simulation exercises.",
                "Design and develop realistic and challenging exercise scenarios.",
                "Facilitate a tabletop exercise for executive and technical teams.",
                "Define clear evaluation criteria and performance metrics for an exercise.",
                "Conduct a formal debriefing and 'lessons learned' session.",
                "Translate exercise findings into a tracked list of actionable improvements.",
                "Plan and coordinate more advanced, cross-organizational exercises."
            ],
            "content": {
                "overview": "A crisis management plan that has never been tested is not a plan; it's a theory. This lesson covers the vital practice of conducting simulation exercises to test your plans, people, and processes in a safe environment. We will focus on the design and execution of tabletop exercises, the most effective way to build 'muscle memory' for a real crisis.",
                "sections": [
                    {
                        "title": "Why Exercises are Essential",
                        "content": "<p>You do not want the first time your team executes the crisis plan to be during a real, high-stress event. Exercises are the 'practice sessions' that prepare the team for game day.</p><h3>Key Benefits:</h3><ul><li><strong>Identify Gaps:</strong> Exercises are the single best way to find flaws in your plans, gaps in your technology, and misunderstandings in your processes.</li><li><strong>Build Muscle Memory:</strong> They allow team members to practice their specific roles and responsibilities, so their actions become second nature during a real event.</li><li><strong>Improve Coordination:</strong> They bring together the entire crisis team (technical, legal, comms, HR, executive) to practice working as a cohesive unit.</li><li><strong>Raise Awareness:</strong> Involving executives in a realistic exercise is a powerful way to demonstrate the potential impact of a crisis and justify security investments.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1542744173-05336fcc7ad4?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Designing and Facilitating a Tabletop Exercise",
                        "content": "<p>A tabletop exercise is a discussion-based session where a facilitator guides the crisis team through a simulated crisis scenario. It is a 'talk-through', not a hands-on technical test.</p><h3>The Key Roles:</h3><ul><li><strong>Facilitator:</strong> The storyteller and referee. They present the scenario, introduce new challenges ('injects'), and keep the discussion on track.</li><li><strong>Players:</strong> The members of the crisis management team, who respond to the scenario based on their real-world roles.</li><li><strong>Observers/Evaluators:</strong> They watch the exercise, take notes against a set of evaluation criteria, and provide feedback during the debrief.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=800&h=400&fit-crop"
                    },
                    {
                        "title": "The Post-Exercise Debrief: Where the Real Value Is",
                        "content": "<p>The exercise itself is just the beginning. The most important part of the process is the formal debriefing session held immediately after the simulation ends.</p><h3>The Hotwash / Debrief:</h3><p>This is a facilitated, 'blameless' discussion focusing on three key questions:</p><ol><li><strong>What went well?</strong> (What should we sustain?)</li><li><strong>What didn't go well?</strong> (What needs to be improved?)</li><li><strong>What are our specific recommendations for improvement?</strong></li></ol><p>The output of this meeting must be a formal After-Action Report that includes a list of specific, actionable, and tracked improvement items, each with an owner and a due date. Without this follow-up, the exercise was just a conversation.</p>",
                        "image": "https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Comprehensive Crisis Simulation Design (Scenario Inject)",
                        "language": "yaml",
                        "code": "exercise_name: \"Project Nightfall - Enterprise Ransomware Simulation\"\n\nscenario_timeline:\n  - time: \"T+0 (Monday 09:00)\"\n    facilitator_prompt: \"The CISO receives a call from the Director of IT. Multiple servers in the primary data center are unresponsive. System administrators are seeing ransom notes on their screens. The help desk is flooded with calls. What are your immediate actions?\"\n    objectives_tested:\n      - Crisis team activation\n      - Initial incident classification\n\n  - time: \"T+2 Hours (Monday 11:00)\"\n    facilitator_inject: \"The technical team confirms that backups are also encrypted and unusable. The attackers have left a message on an internal server claiming they have also stolen 5TB of sensitive customer and employee data. How does this change your response and who do you need to notify?\"\n    objectives_tested:\n      - Business impact assessment\n      - Legal and regulatory notification triggers\n\n  - time: \"T+6 Hours (Monday 15:00)\"\n    facilitator_inject: \"A journalist from a major news organization has contacted your PR team. They have received a sample of the stolen data from the attackers and are running a story in one hour. What is your immediate communication strategy?\"\n    objectives_tested:\n      - Media relations management\n      - External communication strategy"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "What is the primary format of a tabletop exercise?",
                        "options": [
                            "A hands-on technical challenge where analysts respond to a live attack.",
                            "A discussion-based session where a facilitator guides the team through a simulated scenario.",
                            "A written exam on the contents of the crisis management plan.",
                            "An audit of the company's firewall rules."
                        ],
                        "correct": 1,
                        "explanation": "A tabletop is a 'talk-through' exercise. It's designed to test plans, processes, and decision-making by having participants discuss their roles and intended actions, rather than performing them technically."
                    },
                    {
                        "id": 2,
                        "question": "What is the most important output of a crisis simulation exercise?",
                        "options": [
                            "A score showing whether the team 'passed' or 'failed'.",
                            "A video recording of the entire session.",
                            "A formal After-Action Report with a tracked list of specific, actionable improvements.",
                            "A verbal agreement to 'do better next time'."
                        ],
                        "correct": 2,
                        "explanation": "The entire purpose of the exercise is to find and fix gaps. Without a formal process to capture, assign, and track the identified improvements, the value of the exercise is lost."
                    },
                    {
                        "id": 3,
                        "question": "In a tabletop exercise, what is the role of the 'facilitator'?",
                        "options": [
                            "To act as the Incident Commander and make all the decisions.",
                            "To take notes for the After-Action Report.",
                            "To present the scenario, introduce new challenges ('injects'), and keep the discussion on track.",
                            "To represent the company's legal department."
                        ],
                        "correct": 2,
                        "explanation": "The facilitator is the neutral guide of the exercise. They are the storyteller who runs the simulation, challenges the players, and ensures the exercise meets its objectives without taking a side or becoming a player themselves."
                    }
                ]
            }
        },
        {
            "id": "lesson-20",
            "title": "International and Cross-Border Crisis Management",
            "duration": "90 min",
            "objectives": [
                "Develop strategies for coordinating a crisis response across multiple nations and time zones.",
                "Understand and navigate cultural considerations in crisis communication.",
                "Address the legal challenges of cross-border data transfers during an investigation.",
                "Establish protocols for cooperating with international law enforcement agencies.",
                "Utilize global threat intelligence and information sharing protocols.",
                "Manage the diplomatic considerations of a multi-national incident."
            ],
            "content": {
                "overview": "In a global economy, a major crisis rarely stays within one country's borders. This lesson explores the immense legal, logistical, and cultural complexities of managing a crisis that spans multiple jurisdictions, requiring a coordinated response across different laws, languages, and time zones.",
                "sections": [
                    {
                        "title": "The Challenge of Jurisdiction",
                        "content": "<p>The biggest challenge in an international crisis is determining which laws apply. The answer is often 'all of them'.</p><h3>Jurisdictional Nexus:</h3><p>Your crisis could be subject to the laws of:</p><ul><li>The country where your company is headquartered.</li><li>The country where the affected server or data center is physically located.</li><li>The country where the affected data subjects (your customers or employees) reside. This is the principle behind laws like GDPR.</li></ul><p>This means a single data breach could trigger notification requirements in dozens of different countries, each with its own specific deadline and format.</p>",
                        "image": "https://images.unsplash.com/photo-1543286386-713bdd548da4?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Logistics: The 'Follow the Sun' Model",
                        "content": "<p>Managing a 24/7 crisis response across the globe requires a structured logistical model to ensure continuous operation and smooth handovers.</p><h3>The 'Follow the Sun' Approach:</h3><p>A single, global crisis management effort is handed off between three regional headquarters as the workday begins in each location.</p><ol><li>The crisis begins in the US. The US team manages the response during their workday.</li><li>At the end of their day, they conduct a formal handover to the team in the Asia-Pacific (APAC) region.</li><li>The APAC team manages the crisis during their workday and then hands it off to the team in the Europe, Middle East, and Africa (EMEA) region.</li><li>The EMEA team manages the crisis and then hands it back to the US team.</li></ol><p>This ensures a continuous, 24-hour response cycle without requiring any single team to work around the clock.</p>",
                        "image": "https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Cultural and Communication Barriers",
                        "content": "<p>Communication styles and expectations vary significantly across cultures. A message that is considered direct and clear in one culture may be seen as blunt and rude in another.</p><h3>Key Considerations:</h3><ul><li><strong>Language:</strong> Customer notifications and regulatory filings must be accurately translated into the local language.</li><li><strong>Communication Style:</strong> Some cultures prefer a direct, low-context communication style, while others prefer a more indirect, high-context approach. Messaging must be adapted.</li><li><strong>Local Expertise:</strong> It is critical to have local legal and communications experts on the ground in each major region. They can navigate the local regulatory landscape and cultural nuances far more effectively than a central headquarters team.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "International Cyber Crisis Simulation (Scenario)",
                        "language": "markdown",
                        "code": "# Exercise Scenario: Project Global Storm\n\n**Synopsis:** A supply chain attack has compromised a third-party payment processor based in Ireland. This processor handles transactions for our e-commerce platforms in North America, the EU, and Japan.\n\n### Inject 1 (T+0): Initial Alert\n- **Time:** 10:00 US Eastern Time\n- **Event:** The Irish Data Protection Commission publicly announces an investigation into 'PaymentPros' for a major data breach. We use PaymentPros for all our online stores.\n\n### Inject 2 (T+4 Hours): Technical Confirmation\n- **Time:** 14:00 US Eastern Time\n- **Event:** Our SOC finds evidence of suspicious API calls from our systems to an IP address mentioned in a security firm's blog post about the PaymentPros breach.\n\n### Inject 3 (T+10 Hours): Handoff to APAC\n- **Time:** 20:00 US Eastern Time (10:00 Tokyo Time)\n- **Event:** The US team must conduct a formal handover to the APAC crisis team. Japan's privacy regulator (PPC) has just issued a formal inquiry to our Tokyo office. The Japanese media is now covering the story.\n\n### Key Challenges for this Simulation:\n- Coordinating a response across three time zones.\n- Navigating notification requirements for GDPR (Ireland), state laws (US), and APPI (Japan).\n- Developing a consistent but culturally adapted communication plan for customers in three different regions."
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "If a US-based company has a data breach that affects customers in Germany, which country's data protection laws are most likely to apply?",
                        "options": [
                            "Only US laws.",
                            "Neither, as it is an international incident.",
                            "Both US laws and Germany's implementation of the EU GDPR.",
                            "Only the laws of the country where the server was located."
                        ],
                        "correct": 2,
                        "explanation": "Jurisdiction for data privacy laws is typically based on the location of the data subject (the person). Therefore, the company would have to comply with US laws for its American customers and the EU's GDPR for its German customers."
                    },
                    {
                        "id": 2,
                        "question": "The 'Follow the Sun' model is a strategy for what?",
                        "options": [
                            "Choosing a data center location.",
                            "Managing a continuous, 24/7 crisis response by handing off control between regional teams.",
                            "Tracking the location of an attacker.",
                            "A type of solar-powered hacking."
                        ],
                        "correct": 1,
                        "explanation": "This model allows a global organization to maintain a constant operational tempo by passing leadership of the crisis from one region to the next as their respective workdays begin, preventing burnout on any single team."
                    },
                    {
                        "id": 3,
                        "question": "What is a major legal challenge when managing an international data breach?",
                        "options": [
                            "There are no legal challenges.",
                            "The internet is the same everywhere.",
                            "Each country has different and sometimes conflicting data privacy laws and breach notification requirements.",
                            "It is hard to find translators."
                        ],
                        "correct": 2,
                        "explanation": "The complex and varied patchwork of international laws is a primary challenge. An action that is legally required in one country might be restricted in another, requiring careful guidance from local legal experts."
                    }
                ]
            }
        },
        {
            "id": "lesson-21",
            "title": "Industry-Specific Crisis Management",
            "duration": "90 min",
            "objectives": [
                "Adapt crisis management plans for the unique requirements of the healthcare sector (HIPAA).",
                "Understand the specific protocols and regulations for the financial services industry.",
                "Navigate the unique challenges of crisis response in government and defense.",
                "Address the safety-critical nature of crises in the energy and utilities sectors.",
                "Tailor response strategies for retail, manufacturing, education, and other key industries."
            ],
            "content": {
                "overview": "While the core principles of crisis management are universal, the specific priorities, risks, and regulatory pressures vary dramatically by industry. This lesson explores how to tailor your crisis management program to the unique context of your specific sector.",
                "sections": [
                    {
                        "title": "Healthcare: Protecting Patients and PHI",
                        "content": "<h3>Primary Driver: HIPAA</h3><p>The Health Insurance Portability and Accountability Act (HIPAA) is the dominant force in healthcare cybersecurity.</p><ul><li><strong>Top Priority:</strong> Patient safety and the confidentiality and availability of Protected Health Information (PHI).</li><li><strong>Crisis Scenario Focus:</strong> Ransomware attacks on hospitals that disrupt patient care, breaches of electronic health record (EHR) databases.</li><li><strong>Unique Challenge:</strong> A crisis that impacts medical devices or hospital operations can have immediate life-or-death consequences, making the 'patient safety' consideration paramount in every decision.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1538688273824-7883ea9f586a?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Financial Services: Protecting Capital and Trust",
                        "content": "<h3>Primary Drivers: NYDFS, PCI DSS, SEC</h3><p>The financial sector is one of the most heavily regulated and targeted industries.</p><ul><li><strong>Top Priority:</strong> Maintaining the integrity of financial transactions, protecting customer financial data, and ensuring market stability.</li><li><strong>Crisis Scenario Focus:</strong> Data breaches of credit card data, fraudulent wire transfers, attacks on trading platforms, and APTs targeting economic data.</li><li><strong>Unique Challenge:</strong> Extremely short regulatory notification deadlines (e.g., 72 hours for NYDFS) and the risk of a crisis causing systemic market disruption or loss of confidence.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1501167786227-4cba60f6d58f?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Energy & Utilities: Protecting Critical Infrastructure",
                        "content": "<h3>Primary Drivers: NERC CIP, TSA Directives</h3><p>This sector is a primary target for nation-state adversaries seeking to cause widespread disruption.</p><ul><li><strong>Top Priority:</strong> Physical safety and the continuous, reliable operation of the electrical grid, water systems, and pipelines. This is an OT/ICS-heavy environment.</li><li><strong>Crisis Scenario Focus:</strong> SCADA system compromises, remote manipulation of industrial controllers (PLCs), and attacks designed to cause a blackout or physical damage.</li><li><strong>Unique Challenge:</strong> The direct link between a cyber crisis and a massive, real-world physical impact on the public. The response requires a tight integration of cybersecurity and control engineering.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1619852184799-2c7e6853a7e5?w=800&h=400&fit-crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Industry-Specific Crisis Scenario (Retail)",
                        "language": "markdown",
                        "code": "# Crisis Scenario: 'Holiday Havoc' - Retail Sector\n\n**Industry:** Retail & E-commerce\n\n**Threat Actor:** A financially motivated cybercrime group (e.g., FIN7).\n\n**Scenario:** It is the week of Black Friday, the busiest and most profitable week of the year. The threat actor gains access to the e-commerce platform's backend database via a SQL injection vulnerability.\n\n### Crisis Injects:\n\n1.  **T+0:** The e-commerce website and point-of-sale (POS) systems in all physical stores go down. No transactions can be processed.\n2.  **T+2 Hours:** The attacker contacts the company. They claim to have stolen the entire customer database, including millions of credit card numbers. They demand a ransom to not leak the data and to provide information on the vulnerability they used.\n3.  **T+8 Hours:** Customers are complaining on social media that their credit cards, which were only used on your site, are now seeing fraudulent charges.\n\n### Key Industry-Specific Challenges:\n- **Massive Financial Impact:** Every hour of downtime during a peak sales period results in millions in lost revenue.\n- **PCI DSS Compliance:** A breach of credit card data triggers a major compliance crisis with payment card brands, leading to heavy fines.\n- **Customer Trust:** A breach during the holiday season can permanently destroy customer trust and brand loyalty."
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "In a crisis at a hospital, which factor would take the highest priority over all others?",
                        "options": [
                            "The financial cost of the incident.",
                            "The reputational damage to the hospital.",
                            "The potential for immediate impact on patient safety.",
                            "The need to preserve forensic evidence."
                        ],
                        "correct": 2,
                        "explanation": "In healthcare, patient safety is the absolute, non-negotiable top priority. A response action that could disrupt patient care or impact medical devices would only be taken as a last resort to prevent an even greater safety risk."
                    },
                    {
                        "id": 2,
                        "question": "A cybersecurity crisis at an electric utility that threatens to cause a blackout is primarily a concern for which environment?",
                        "options": [
                            "The corporate IT network.",
                            "The cloud environment.",
                            "The Operational Technology (OT) network.",
                            "The marketing department's website."
                        ],
                        "correct": 2,
                        "explanation": "The systems that control physical infrastructure like the power grid are part of the OT network. A crisis in this environment has direct real-world consequences."
                    },
                    {
                        "id": 3,
                        "question": "Which industry is most directly impacted by the Payment Card Industry Data Security Standard (PCI DSS)?",
                        "options": [
                            "Healthcare",
                            "Energy",
                            "Education",
                            "Financial Services and Retail"
                        ],
                        "correct": 3,
                        "explanation": "PCI DSS is a security standard mandated by the major credit card brands for any organization that stores, processes, or transmits cardholder data. This makes it a primary driver for cybersecurity programs in banking and retail."
                    }
                ]
            }
        },
        {
            "id": "lesson-22",
            "title": "Emerging Threats and Future Preparedness",
            "duration": "90 min",
            "objectives": [
                "Analyze how AI-powered attacks will shape future crises.",
                "Understand the long-term crisis implications of quantum computing.",
                "Prepare for crises involving 5G, edge computing, and autonomous systems.",
                "Develop response strategies for deepfake and disinformation campaigns.",
                "Consider threat vectors against space-based assets, biotech, and cryptocurrency.",
                "Adapt crisis management frameworks for next-generation threats."
            ],
            "content": {
                "overview": "The threat landscape is not static. The crises of tomorrow will be driven by technologies that are on the cutting edge today. This lesson looks to the future, exploring how emerging technologies like AI, quantum computing, and deepfakes will create new types of crises and require new levels of preparedness.",
                "sections": [
                    {
                        "title": "AI and the Automation of Crisis",
                        "content": "<p>Artificial intelligence will be a powerful tool for both attackers and defenders.</p><h3>Future Crisis Scenarios:</h3><ul><li><strong>AI-Powered Attacks:</strong> Adversaries will use AI to conduct hyper-realistic spear-phishing campaigns at scale, discover new vulnerabilities automatically, and create malware that can adapt its behavior to evade detection.</li><li><strong>Autonomous System Compromise:</strong> A crisis could involve an attack on a fleet of autonomous vehicles or drones, causing them to malfunction in a way that creates a major public safety incident.</li><li><strong>AI-Driven Defense:</strong> On the defensive side, AI will be critical for detecting these sophisticated attacks by identifying subtle anomalies in massive datasets that are impossible for humans to analyze.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1620712943543-285f212a5a54?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Deepfakes and the Disinformation Crisis",
                        "content": "<p>Deepfakes—highly realistic, AI-generated fake videos or audio—will move beyond a technical threat to become a major driver of reputational and social crises.</p><h3>Potential Scenarios:</h3><ul><li><strong>Reputational Sabotage:</strong> An attacker releases a convincing deepfake video of a CEO making false, damaging statements, causing the company's stock to crash and creating a massive PR crisis.</li><li><strong>CEO Fraud 2.0:</strong> An attacker uses a deepfake audio of a CFO's voice to authorize a multi-million dollar fraudulent wire transfer.</li></ul><p>Responding to a disinformation crisis will require extremely rapid and credible communication to counter the fake narrative, along with new forensic techniques to prove that the media is synthetic.</p>",
                        "image": "https://images.unsplash.com/photo-1611162617474-5b21e879e113?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "The Quantum Threat to Trust",
                        "content": "<p>The long-term threat of quantum computing is that it will be able to break the public-key cryptography that underpins virtually all secure communication and digital trust today.</p><h3>The 'Harvest Now, Decrypt Later' Crisis:</h3><p>The immediate crisis is not that an attacker will break your VPN today. The crisis is that a nation-state adversary is likely *already* recording and storing your encrypted data with the expectation that they will be able to decrypt it in 10-15 years when they have a viable quantum computer. This means that any data that needs to remain secret for longer than that is already at risk. The response is a long-term, strategic migration to post-quantum cryptographic standards.</p>",
                        "image": "https://images.unsplash.com/photo-1635070049035-5a79a8385075?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "AI-Driven Threat Detection System (Conceptual)",
                        "language": "python",
                        "code": "class AnomalyDetectionModel:\n    def __init__(self, training_data):\n        # In a real system, this would be a complex machine learning model (e.g., an autoencoder)\n        # trained on months of baseline network and endpoint data.\n        self.model = self.train(training_data)\n\n    def predict(self, new_event):\n        \"\"\"Analyzes a new event and returns an anomaly score.\"\"\"\n        # The model reconstructs the event based on its training.\n        reconstruction_error = self.model.calculate_reconstruction_error(new_event)\n        \n        # If the reconstruction error is high, it means the model has never seen\n        # anything like this event before, and it is therefore anomalous.\n        return reconstruction_error\n\n# --- Example Usage ---\n# event = A new, never-before-seen type of PowerShell command.\n# model = AnomalyDetectionModel(baseline_data)\n# anomaly_score = model.predict(event)\n\n# if anomaly_score > 0.95: # High anomaly score\n#     alert(\"High-confidence anomaly detected, potentially a zero-day attack.\")"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "A crisis caused by the release of a convincing but fake video of a CEO making false statements would be an example of what kind of threat?",
                        "options": [
                            "A quantum computing attack",
                            "A deepfake and disinformation campaign",
                            "A ransomware attack",
                            "A DDoS attack"
                        ],
                        "correct": 1,
                        "explanation": "This is a classic example of how deepfake technology can be weaponized to cause a massive reputational crisis, requiring a rapid and effective public relations and communication response."
                    },
                    {
                        "id": 2,
                        "question": "The 'Harvest Now, Decrypt Later' scenario is a crisis related to what emerging technology?",
                        "options": [
                            "Artificial Intelligence",
                            "5G Networking",
                            "The Internet of Things (IoT)",
                            "Quantum Computing"
                        ],
                        "correct": 3,
                        "explanation": "This scenario describes the threat of an adversary capturing today's encrypted data with the intent of decrypting it in the future once they have a cryptographically relevant quantum computer. It makes long-term data protection a present-day crisis."
                    },
                    {
                        "id": 3,
                        "question": "How can AI be used by attackers to enhance social engineering attacks?",
                        "options": [
                            "By making websites load slower.",
                            "By automatically generating highly personalized and grammatically perfect spear-phishing emails at scale.",
                            "By shutting down the attacker's own servers.",
                            "AI cannot be used for social engineering."
                        ],
                        "correct": 1,
                        "explanation": "AI can analyze vast amounts of public data to craft phishing emails that are tailored to an individual's interests and writing style, making them far more convincing and difficult to detect than traditional, generic phishing messages."
                    }
                ]
            }
        },
        {
            "id": "lesson-23",
            "title": "Crisis Recovery and Resilience Building",
            "duration": "90 min",
            "objectives": [
                "Develop a comprehensive strategy for post-crisis recovery.",
                "Implement system hardening and vulnerability remediation procedures.",
                "Use resilience assessment methodologies to measure organizational robustness.",
                "Build adaptive capacity to better respond to future crises.",
                "Integrate lessons learned from a crisis back into the planning cycle.",
                "Drive a process of continuous improvement for technology, processes, and people.",
                "Update training and exercise programs based on real-world events.",
                "Foster a culture of security and resilience throughout the organization."
            ],
            "content": {
                "overview": "The end of a crisis is the beginning of the next one's preparation. This lesson focuses on the critical Post-Crisis phase, covering the methodical process of technical recovery, the integration of lessons learned, and the strategic goal of not just recovering, but building a more resilient organization that is stronger and better prepared for the future.",
                "sections": [
                    {
                        "title": "From Response to Recovery",
                        "content": "<p>Recovery is a distinct phase that begins after the immediate threat has been contained and eradicated. It is a methodical process of returning to normal, secure operations.</p><h3>Key Recovery Activities:</h3><ul><li><strong>System Rebuilding:</strong> Wiping and rebuilding affected systems from known-good 'gold images'.</li><li><strong>Data Restoration:</strong> Restoring data from verified clean backups.</li><li><strong>Vulnerability Remediation:</strong> Ensuring the root cause vulnerability has been patched or mitigated before bringing systems back online.</li><li><strong>Security Hardening:</strong> Taking the opportunity to improve the security posture of the rebuilt systems beyond their pre-crisis state.</li><li><strong>Phased Restoration:</strong> Bringing systems back online in a controlled, prioritized order, with intensive monitoring at each step.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "The Lessons Learned Cycle",
                        "content": "<p>This is the most critical part of the post-crisis phase. A 'blameless post-mortem' or After-Action Review must be conducted to analyze both the incident and the response to it.</p><h3>The Goal: Continuous Improvement</h3><p>The findings from this review are not just for a report that sits on a shelf. They must be translated into a tracked list of actionable improvements that feed directly back into the 'Pre-Crisis' (Readiness) phase.</p><ul><li><strong>People:</strong> 'Our communication was chaotic. We need to update our training and run a tabletop exercise on this specific scenario.'</li><li><strong>Process:</strong> 'Our escalation procedure was unclear. We need to revise the IR plan and get it approved by leadership.'</li><li><strong>Technology:</strong> 'We couldn't see the lateral movement. We need to invest in a better EDR solution.'</li></ul>",
                        "image": "https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Building Organizational Resilience",
                        "content": "<p>The ultimate goal is not just to recover from a crisis, but to become more resilient. Resilience is the ability to absorb the impact of a crisis and continue to function.</p><h3>Characteristics of a Resilient Organization:</h3><ul><li><strong>Adaptive Capacity:</strong> They can adapt their response to novel, unexpected situations, not just follow a rigid plan.</li><li><strong>Culture of Security:</strong> Every employee understands their role in protecting the organization.</li><li><strong>Assumes Breach:</strong> They operate on a 'Zero Trust' principle, assuming that a compromise will happen and designing their systems to limit the blast radius.</li><li><strong>Continuous Learning:</strong> They treat every incident, big or small, as an opportunity to learn and improve.</li></ul><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>Antifragility</strong></div><p>The strategic goal is to become 'antifragile'—an organization that doesn't just survive crises, but actually becomes stronger, smarter, and more robust because of them.</p></div>",
                        "image": "https://images.unsplash.com/photo-1542626991-a2f575a45b67?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Resilience Measurement Automation (Pseudocode)",
                        "language": "python",
                        "code": "# This conceptual script measures a component of resilience: adaptive capacity,\n# by tracking how often the IR team deviates from a standard playbook to handle a novel threat.\n\ndef analyze_playbook_executions(case_data):\n    \"\"\"Analyzes incident response case data.\"\"\"\n    \n    total_cases = len(case_data)\n    manual_intervention_cases = 0\n    \n    for case in case_data:\n        # Check if an analyst had to manually override or deviate from the automated playbook\n        if case.get('playbook_deviation_flag') == True:\n            manual_intervention_cases += 1\n            \n    # A moderate number of deviations is healthy; it shows the team can adapt.\n    # Too many deviations might mean the playbooks are bad.\n    # Too few might mean the team is too rigid or not facing novel threats.\n    adaptive_capacity_score = (manual_intervention_cases / total_cases) * 100\n    \n    print(f\"Adaptive Capacity Score: {adaptive_capacity_score:.2f}%\")\n    print(\"(Percentage of incidents requiring manual deviation from standard automation)\")\n    \n    return adaptive_capacity_score"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "The primary goal of the 'Lessons Learned' or 'Post-Mortem' process is to:",
                        "options": [
                            "Determine which individual employee to blame for the incident.",
                            "Complete the paperwork so the incident ticket can be closed.",
                            "Identify and implement improvements to people, process, and technology to prevent the incident from recurring.",
                            "Calculate the final cost of the incident for the insurance claim."
                        ],
                        "correct": 2,
                        "explanation": "The entire purpose of the post-crisis review is to learn and improve. It's the critical feedback loop that makes the organization stronger and more resilient for the next crisis."
                    },
                    {
                        "id": 2,
                        "question": "What is a key activity during the technical recovery phase after a ransomware attack?",
                        "options": [
                            "Immediately paying the ransom to get the decryption key.",
                            "Restoring data from backups without checking if the backups are also infected.",
                            "Wiping affected systems and rebuilding them from known-good images *before* restoring data from verified clean backups.",
                            "Quickly reconnecting the infected servers to the network to restore service."
                        ],
                        "correct": 2,
                        "explanation": "A methodical rebuild is essential. You must create a clean, patched system first and only then restore the data. Restoring data onto a still-compromised system will just lead to reinfection."
                    },
                    {
                        "id": 3,
                        "question": "An organization that not only survives a crisis but becomes stronger and more robust as a result is demonstrating what quality?",
                        "options": [
                            "Resilience (or Antifragility)",
                            "Vulnerability",
                            "Inflexibility",
                            "Ignorance"
                        ],
                        "correct": 0,
                        "explanation": "Resilience is the ability to absorb and adapt to disruptions. The highest level of resilience, sometimes called antifragility, is when an organization actively uses the stress of a crisis to learn, adapt, and improve."
                    }
                ]
            }
        },
        {
            "id": "lesson-24",
            "title": "Crisis Management Metrics and Evaluation",
            "duration": "90 min",
            "objectives": [
                "Define and calculate key performance indicators (KPIs) for crisis management.",
                "Measure Mean Time to Detect (MTTD) and Mean Time to Respond (MTTR).",
                "Develop a framework for analyzing the total cost of a crisis.",
                "Assess the effectiveness of communication and response plans.",
                "Measure stakeholder satisfaction and trust post-crisis.",
                "Use metrics to continuously improve the crisis management program.",
                "Benchmark your program's performance against industry standards."
            ],
            "content": {
                "overview": "To improve your crisis management program, you must be able to measure it. This final lesson focuses on developing a data-driven approach to evaluation. We will explore the key metrics used to measure the speed, effectiveness, and business impact of your response, enabling you to demonstrate value and drive continuous improvement.",
                "sections": [
                    {
                        "title": "Time-Based Metrics: MTTD and MTTR",
                        "content": "<p>The most fundamental metrics in incident and crisis response are based on time. They measure the speed and efficiency of your program.</p><ul><li><strong>MTTD (Mean Time To Detect):</strong> The average time it takes from the start of an incident (the initial compromise) to its discovery by the security team. This is a measure of your detection capabilities. A lower MTTD is better.</li><li><strong>MTTR (Mean Time To Respond/Resolve):</strong> The average time it takes from the moment an incident is detected until it is fully contained, eradicated, and resolved. This is a measure of your response efficiency. A lower MTTR is better.</li></ul><h3>Dwell Time:</h3><p>The total time an adversary is in your network is **Dwell Time = MTTD + MTTR**. This is the single most important high-level metric for the effectiveness of a security operations program. The goal of the entire program is to reduce dwell time.</p>",
                        "image": "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=400&fit=crop"
                    },
                    {
                        "title": "Effectiveness and Cost Metrics",
                        "content": "<p>Beyond just time, it's critical to measure the effectiveness of the response and its overall financial impact.</p><h3>Key Metrics:</h3><ul><li><strong>Total Cost of Crisis:</strong> A calculation that includes direct costs (experts, fines) and indirect costs (lost revenue, brand damage). This is the key metric for the board of directors.</li><li><strong>Plan Effectiveness Score:</strong> After an exercise or a real event, evaluators can score how well the team followed the plan and met its objectives.</li><li><strong>Lessons Learned Implementation Rate:</strong> What percentage of the action items from the After-Action Report were completed on time? This measures the program's commitment to actual improvement.</li><li><strong>Stakeholder Satisfaction:</strong> Post-crisis surveys of customers and employees can provide a qualitative measure of how well the communication and response were perceived.</li></ul>",
                        "image": "https://images.unsplash.com/photo-1563986768609-322da13575f3?w=800&h=400&fit-crop"
                    },
                    {
                        "title": "The Maturity Model and Benchmarking",
                        "content": "<p>Metrics are most powerful when used to track improvement over time. A maturity model provides a framework for this.</p><h3>How it Works:</h3><ol><li><strong>Assess Your Current State:</strong> Use a framework (like the Cybersecurity Capability Maturity Model - C2M2) to grade your program's capabilities across multiple domains (e.g., from Level 0 'Non-existent' to Level 3 'Managed and Repeatable').</li><li><strong>Define Your Target State:</strong> Determine what level of maturity is appropriate for your organization's risk profile.</li><li><strong>Create a Roadmap:</strong> Develop a multi-year plan of projects and initiatives to close the gap between your current and target states.</li><li><strong>Measure and Report:</strong> Use your KPIs (like MTTD and MTTR) to show progress along the roadmap.</li></ol><p>This transforms crisis management from a series of reactive events into a managed, strategic program that can demonstrate continuous, measurable improvement to executive leadership.</p>",
                        "image": "https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&h=400&fit=crop"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Crisis Metrics Dashboard (Conceptual Data)",
                        "language": "json",
                        "code": "{\n  \"dashboard_name\": \"Quarterly Crisis Management Review - Q3 2025\",\n  \"key_metrics\": [\n    {\n      \"metric_name\": \"Dwell Time (Days)\",\n      \"current_value\": 28,\n      \"previous_value\": 45,\n      \"trend\": \"down_is_good\",\n      \"comment\": \"Significant improvement due to EDR deployment in Q2.\"\n    },\n    {\n      \"metric_name\": \"Mean Time to Respond (Hours)\",\n      \"current_value\": 8.5,\n      \"previous_value\": 12.2,\n      \"trend\": \"down_is_good\",\n      \"comment\": \"SOAR automation playbooks are reducing initial response time.\"\n    },\n    {\n      \"metric_name\": \"Lessons Learned Implementation Rate\",\n      \"current_value\": \"92%\",\n      \"previous_value\": \"75%\",\n      \"trend\": \"up_is_good\",\n      \"comment\": \"New project management oversight is ensuring follow-through.\"\n    },\n    {\n      \"metric_name\": \"Phishing Simulation Click Rate\",\n      \"current_value\": \"4.5%\",\n      \"previous_value\": \"7.8%\",\n      \"trend\": \"down_is_good\",\n      \"comment\": \"Targeted awareness training is proving effective.\"\n    }\n  ]\n}"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "The total time an attacker is present in a network, from initial compromise to full eradication, is known as:",
                        "options": [
                            "RTO",
                            "RPO",
                            "Dwell Time",
                            "The Golden Hour"
                        ],
                        "correct": 2,
                        "explanation": "Dwell Time is the sum of Mean Time to Detect (MTTD) and Mean Time to Respond (MTTR). It is the single most important metric for measuring the overall effectiveness of a security operations program."
                    },
                    {
                        "id": 2,
                        "question": "What does Mean Time to Respond (MTTR) measure?",
                        "options": [
                            "The average time it takes to discover that an incident has occurred.",
                            "The average time from when an incident is detected until it is fully resolved.",
                            "The total cost of a crisis.",
                            "The number of people on the crisis management team."
                        ],
                        "correct": 1,
                        "explanation": "MTTR is a measure of response efficiency. It tracks how quickly the team can act to contain and remediate a threat once they are aware of it."
                    },
                    {
                        "id": 3,
                        "question": "What is the primary purpose of using a maturity model in a crisis management program?",
                        "options": [
                            "To provide a framework for assessing current capabilities, defining a target state, and measuring improvement over time.",
                            "To create a report that is difficult for auditors to understand.",
                            "To determine if the crisis was handled perfectly.",
                            "To replace the need for hands-on exercises."
                        ],
                        "correct": 0,
                        "explanation": "A maturity model provides a structured, strategic approach. It allows a program to move beyond being purely reactive and to plan and measure its own evolution and improvement."
                    }
                ]
            }
        }
    ]
}
      // =====================================================
      // GLOBAL VARIABLES
      // =====================================================
      let currentUser = null;
      let currentLessonIndex = 0;
      let courseProgress = {};
      let userStats = {};
      let quizState = {
        currentQuestion: 0,
        answers: [],
        score: 0,
        isComplete: false,
        timeStarted: null,
        timeCompleted: null,
        currentQuestionIndex: 0,
      };

      // Enhanced session tracking
      let courseSession = {
        startTime: null,
        totalStudyTime: 0,
        lessonsStarted: 0,
        lessonsCompleted: 0,
        pageLoadTime: new Date(),
        lastActive: new Date(),
        interactions: 0,
        completedSections: [],
        totalTime: 0,
        interactionCount: 0,
        lastActivityTime: new Date(),
      };

      // Music Player Variables
      let audioPlayer = new Audio();

      // Achievement notification system
      let notificationQueue = [];
      let isShowingNotification = false;

      // =====================================================
      // INITIALIZATION
      // =====================================================
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          showLoadingScreen();
          await checkAuth();

          if (currentUser) {
            // Initialize session tracking
            startCourseSession();

            // Load course data and progress
            await loadCourseData();
            await loadUserProfile();
            await loadProgress();

            // Initialize UI
            initializeEventListeners();
            renderSidebar();
            loadLesson(currentLessonIndex);

            // Initialize additional features
            initMusicPlayer();
            addMusicIndicator();
            initializeActivityTracking();

            hideLoadingScreen();
          } else {
            openAuthModal();
          }
        } catch (error) {
          console.error("Error initializing course:", error);
          hideLoadingScreen();
          showToast("Failed to initialize course system", "error");
        }
      });

      // =====================================================
      // AUTHENTICATION SYSTEM
      // =====================================================
      async function checkAuth() {
        try {
          const {
            data: { session },
            error,
          } = await supabase.auth.getSession();

          if (error) {
            console.error("Auth error:", error);
            currentUser = null;
            openAuthModal();
            return;
          }

          if (!session) {
            currentUser = null;
            openAuthModal();
            return;
          }

          currentUser = session.user;
          updateUIWithUser();
        } catch (error) {
          console.error("Error checking auth:", error);
          currentUser = null;
          openAuthModal();
        }
      }

      function updateUIWithUser() {
        if (!currentUser) return;

        const name =
          currentUser.user_metadata?.full_name ||
          currentUser.email.split("@")[0];
        const userElements = document.querySelectorAll("[data-user-name]");
        userElements.forEach((el) => (el.textContent = name));
      }

      // =====================================================
      // USER PROFILE & STATS MANAGEMENT
      // =====================================================
      async function loadUserProfile() {
        try {
          // 🔍 Step 1: Try to fetch existing profile
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", currentUser.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (!profile) {
            // 🆕 Step 2: Create new profile if missing
            await createUserProfile();
          } else {
            // ✅ Step 3: Use existing profile
            userStats = profile;
            await updateLastActivity();
          }
        } catch (error) {
          console.error("❌ Error loading user profile:", error);
          showToast("Failed to load user profile", "error");
        }
      }
      async function createUserProfile() {
        try {
          const newProfile = {
            id: currentUser.id,
            full_name: currentUser.user_metadata?.full_name || "",
            email: currentUser.email,
            level: "Script Kiddie",
            total_points: 0,
            completed_courses: 0,
            current_streak: 0,
            total_certificates: 0,
            total_achievements: 0,
            sections_visited: 0,
            bonus_points: 0,
            in_progress_courses: 0,
            settings_changed: 0,
            midnight_sessions: 0,
            early_sessions: 0,
            weekend_sessions: 0,
            last_activity: new Date().toISOString(),
            created_at: new Date().toISOString(),
          };

          const { error } = await supabase
            .from("profiles")
            .insert([newProfile]);

          if (!error) {
            userStats = newProfile;
            // Award first login achievement
            setTimeout(() => checkAndUnlockAchievement("first_login"), 1000);
          }
        } catch (error) {
          console.error("Error creating user profile:", error);
        }
      }

      async function updateLastActivity() {
        try {
          const now = new Date();

          // Update activity tracking
          courseSession.lastActivityTime = now;

          // Update database
          await supabase
            .from("profiles")
            .update({
              last_activity: now.toISOString(),
            })
            .eq("id", currentUser.id);

          // Check time-based achievements
          await checkTimeBasedAchievements(now);
        } catch (error) {
          console.error("Error updating last activity:", error);
        }
      }

      // =====================================================
      // COURSE SESSION MANAGEMENT
      // =====================================================
      function startCourseSession() {
        courseSession.startTime = new Date();
        courseSession.pageLoadTime = new Date();

        logUserActivity("course_session_start", {
          course_id: COURSE_DATA.id,
          course_title: COURSE_DATA.title,
          user_agent: navigator.userAgent,
          screen_resolution: `${screen.width}x${screen.height}`,
        });

        // Check daily streak
        checkDailyStreak();
      }

      function initializeActivityTracking() {
        // Track page focus/blur for accurate study time
        document.addEventListener("visibilitychange", handleVisibilityChange);

        // Track user interactions
        ["click", "keydown", "scroll", "mousemove"].forEach((event) => {
          document.addEventListener(event, trackUserInteraction, {
            passive: true,
          });
        });

        // Periodic activity updates
        setInterval(updateStudyTime, 60000); // Every minute

        // Save session data before page unload
        window.addEventListener("beforeunload", saveSessionData);
      }

      function handleVisibilityChange() {
        if (document.hidden) {
          courseSession.lastActivityTime = new Date();
        } else {
          // Page became visible again - update activity
          updateLastActivity();
        }
      }

      function trackUserInteraction() {
        courseSession.interactionCount++;
        courseSession.lastActivityTime = new Date();

        // Throttle activity updates
        if (courseSession.interactionCount % 50 === 0) {
          updateLastActivity();
        }
      }

      function updateStudyTime() {
        if (!courseSession.startTime || document.hidden) return;

        const now = new Date();
        const sessionDuration = now - courseSession.startTime;
        courseSession.totalStudyTime = Math.floor(sessionDuration / 1000 / 60); // in minutes

        // Update progress with study time
        saveProgress();
      }

      function saveSessionData() {
        if (!currentUser || !courseSession.startTime) return;

        const sessionData = {
          user_id: currentUser.id,
          course_id: COURSE_DATA.id,
          session_duration: courseSession.totalStudyTime,
          lessons_viewed: courseSession.lessonsStarted,
          lessons_completed: courseSession.lessonsCompleted,
          interactions: courseSession.interactionCount,
          session_date: courseSession.startTime.toISOString().split("T")[0],
        };

        // Store in localStorage as backup
        localStorage.setItem(
          "course_session_backup",
          JSON.stringify(sessionData)
        );

        // Try to save to database
        logUserActivity("course_session_end", sessionData);
      }

      // =====================================================
      // COURSE DATA & PROGRESS MANAGEMENT
      // =====================================================
      async function loadCourseData() {
        try {
          // Update course info in UI
          document.getElementById("courseTitle").textContent =
            COURSE_DATA.title;
          document.getElementById("totalLessons").textContent =
            COURSE_DATA.lessons.length;

          // Log course access
          logUserActivity("course_access", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
          });
        } catch (error) {
          console.error("Error loading course data:", error);
        }
      }

      async function loadProgress() {
        try {
          // Get existing progress from database
          const { data, error } = await supabase
            .from("course_progress")
            .select("*")
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (data) {
            courseProgress = JSON.parse(data.lesson_progress || "{}");
            currentLessonIndex = data.current_lesson || 0;

            // Update session tracking
            courseSession.lessonsStarted = Object.keys(courseProgress).length;
            courseSession.lessonsCompleted = Object.values(
              courseProgress
            ).filter((p) => p.completed).length;
          } else {
            // Initialize new progress
            courseProgress = {};
            currentLessonIndex = 0;
            await saveProgress();

            // Award first course start achievement
            await checkAndUnlockAchievement("first_course_start");
          }

          updateProgressDisplay();
        } catch (error) {
          console.error("Error loading progress:", error);
          showToast("Failed to load progress", "error");
        }
      }

      async function saveProgress() {
        try {
          if (!currentUser) return;

          const now = new Date();
          const progressData = {
            user_id: currentUser.id,
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            current_lesson: currentLessonIndex,
            lesson_progress: JSON.stringify(courseProgress),
            progress: calculateOverallProgress(),
            lessons_completed: getCompletedLessonsCount(),
            lessons_started: Object.keys(courseProgress).length,
            study_time_minutes: courseSession.totalStudyTime,
            last_accessed: now.toISOString(),
            updated_at: now.toISOString(),
          };

          // Upsert progress
          const { error } = await supabase
            .from("course_progress")
            .upsert([progressData]);

          if (error) throw error;

          // Update user stats
          await updateUserStats();

          updateProgressDisplay();
        } catch (error) {
          console.error("Error saving progress:", error);
          showToast("Failed to save progress", "error");
        }
      }

      async function updateUserStats() {
        try {
          // Get all course progress for this user
          const { data: allProgress, error } = await supabase
            .from("course_progress")
            .select("progress, course_id, study_time_minutes")
            .eq("user_id", currentUser.id);

          if (error) throw error;

          // Calculate stats
          const completedCourses =
            allProgress?.filter((p) => p.progress >= 100).length || 0;
          const inProgressCourses =
            allProgress?.filter((p) => p.progress > 0 && p.progress < 100)
              .length || 0;
          const totalStudyTime =
            allProgress?.reduce(
              (sum, p) => sum + (p.study_time_minutes || 0),
              0
            ) || 0;

          // Calculate points (500 per completed course + achievement points)
          const coursePoints = completedCourses * 500;
          const bonusPoints = userStats.bonus_points || 0;
          const totalPoints = coursePoints + bonusPoints;

          // Update profile
          const updateData = {
            completed_courses: completedCourses,
            in_progress_courses: inProgressCourses,
            total_points: totalPoints,
            total_study_time: totalStudyTime,
            last_activity: new Date().toISOString(),
          };

          const { error: updateError } = await supabase
            .from("profiles")
            .update(updateData)
            .eq("id", currentUser.id);

          if (updateError) throw updateError;

          // Update local stats
          Object.assign(userStats, updateData);
        } catch (error) {
          console.error("Error updating user stats:", error);
        }
      }

      function calculateOverallProgress() {
        const completedLessons = getCompletedLessonsCount();
        return Math.round(
          (completedLessons / COURSE_DATA.lessons.length) * 100
        );
      }

      function getCompletedLessonsCount() {
        return Object.values(courseProgress).filter(
          (lesson) => lesson.completed
        ).length;
      }

      function updateProgressDisplay() {
        const completedCount = getCompletedLessonsCount();
        const progressPercent = calculateOverallProgress();

        // Update UI elements
        const elements = {
          completedLessons: completedCount,
          courseProgressPercent: `${progressPercent}%`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });

        // Update progress bar
        const progressBar = document.getElementById("courseProgressFill");
        if (progressBar) progressBar.style.width = `${progressPercent}%`;
      }

      // =====================================================
      // LESSON MANAGEMENT
      // =====================================================
      function loadLesson(index) {
        if (index < 0 || index >= COURSE_DATA.lessons.length) return;

        const lesson = COURSE_DATA.lessons[index];
        currentLessonIndex = index;

        // Mark lesson as started and track activity
        if (!courseProgress[lesson.id]) {
          courseProgress[lesson.id] = {
            started: true,
            completed: false,
            startedAt: new Date().toISOString(),
            timeSpent: 0,
          };

          courseSession.lessonsStarted++;
          saveProgress();

          // Log lesson start
          logUserActivity("lesson_start", {
            lesson_id: lesson.id,
            lesson_title: lesson.title,
            lesson_index: index,
          });
        }

        // Update lesson start time for time tracking
        courseProgress[lesson.id].currentSessionStart = new Date();

        // Update sidebar and navigation
        renderSidebar();
        updateNavigationButtons();

        // Update header info
        updateLessonHeader(lesson, index);

        // Render lesson content
        renderLessonContent(lesson);

        // Smooth scroll and animations
        window.scrollTo({ top: 0, behavior: "smooth" });
        document.getElementById("contentBody").scrollTop = 0;

        const contentBody = document.getElementById("contentBody");
        contentBody.classList.add("fade-in");
        setTimeout(() => contentBody.classList.remove("fade-in"), 500);

        // Check lesson-based achievements
        checkLessonAchievements(index + 1);
      }

      function updateLessonHeader(lesson, index) {
        const elements = {
          currentLessonNumber: index + 1,
          currentLessonTitle: lesson.title,
          navInfo: `Lesson ${index + 1} of ${COURSE_DATA.lessons.length}`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });
      }

      function renderSidebar() {
        const lessonNav = document.getElementById("lessonNav");
        if (!lessonNav) return;

        lessonNav.innerHTML = "";

        COURSE_DATA.lessons.forEach((lesson, index) => {
          const lessonItem = document.createElement("div");
          lessonItem.className = "lesson-item";

          // Determine lesson status
          const lessonProgress = courseProgress[lesson.id];
          const isCompleted = lessonProgress?.completed || false;
          const isInProgress = lessonProgress?.started || false;
          const isLocked = !isCompleted && !canAccessLesson(index);
          const isActive = index === currentLessonIndex;

          // Apply status classes
          if (isCompleted) lessonItem.classList.add("completed");
          if (isLocked) lessonItem.classList.add("locked");
          if (isActive) lessonItem.classList.add("active");

          // Determine status display
          let statusClass = "not-started";
          let statusIcon = index + 1;

          if (isCompleted) {
            statusClass = "completed";
            statusIcon = "✓";
          } else if (isInProgress) {
            statusClass = "in-progress";
            statusIcon = "◐";
          }

          // Create lesson item HTML
          lessonItem.innerHTML = `
            <div class="lesson-status ${statusClass}">${statusIcon}</div>
            <div class="lesson-info">
                <div class="lesson-title">${lesson.title}</div>
                <div class="lesson-meta">
                    ${
                      isCompleted
                        ? "Completed"
                        : isInProgress
                        ? "In Progress"
                        : isLocked
                        ? "Locked"
                        : "Not Started"
                    }
                </div>
            </div>
            <div class="lesson-duration">${lesson.duration}</div>
        `;

          // Add click handler if not locked
          if (!isLocked) {
            lessonItem.addEventListener("click", () => {
              if (index !== currentLessonIndex) {
                // Track lesson time before switching
                trackLessonTime();

                currentLessonIndex = index;
                loadLesson(index);
                closeSidebar();
              }
            });
          }

          lessonNav.appendChild(lessonItem);
        });
      }

      function canAccessLesson(index) {
        if (index === 0) return true; // First lesson always accessible

        // Can access if previous lesson is completed
        const previousLessonId = COURSE_DATA.lessons[index - 1].id;
        return courseProgress[previousLessonId]?.completed || false;
      }

      function trackLessonTime() {
        const currentLesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonProgress = courseProgress[currentLesson.id];

        if (lessonProgress?.currentSessionStart) {
          const sessionTime = Math.floor(
            (new Date() - new Date(lessonProgress.currentSessionStart)) /
              1000 /
              60
          );
          lessonProgress.timeSpent =
            (lessonProgress.timeSpent || 0) + sessionTime;
          delete lessonProgress.currentSessionStart;
        }
      }

      // =====================================================
      // LESSON CONTENT RENDERING
      // =====================================================
      function renderLessonContent(lesson) {
        const contentContainer = document.getElementById("lessonContent");
        if (!contentContainer) return;

        let contentHTML = `
        <div class="content-section">
            <h2>Learning Objectives</h2>
            <ul>
                ${lesson.objectives.map((obj) => `<li>${obj}</li>`).join("")}
            </ul>
        </div>
        
        <div class="content-section">
            <h2>Overview</h2>
            <p>${lesson.content.overview}</p>
        </div>
    `;

        // Render content sections
        lesson.content.sections.forEach((section) => {
          contentHTML += `
            <div class="content-section">
                <h2>${section.title}</h2>
                ${section.content}
                ${
                  section.image
                    ? `<img src="${section.image}" alt="${section.title}" class="content-image" loading="lazy">`
                    : ""
                }
            </div>
        `;
        });

        // Render code examples
        if (
          lesson.content.codeExamples &&
          lesson.content.codeExamples.length > 0
        ) {
          contentHTML += `<div class="content-section"><h2>Code Examples</h2></div>`;

          lesson.content.codeExamples.forEach((example, index) => {
            const codeId = `code-${lesson.id}-${index}`;
            contentHTML += `
                <div class="code-section">
                    <div class="code-header">
                        <span class="code-title">${example.title}</span>
                        <button class="copy-btn" onclick="copyCode('${codeId}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <pre class="code-block"><code id="${codeId}" class="language-${
              example.language
            }">${escapeHtml(example.code)}</code></pre>
                </div>
            `;
          });
        }

        // Render quiz
        contentHTML += renderQuiz(lesson.quiz);

        contentContainer.innerHTML = contentHTML;

        // Highlight code syntax if Prism is available
        setTimeout(() => {
          if (window.Prism) {
            Prism.highlightAll();
          }
        }, 100);
      }

      // =====================================================
      // QUIZ SYSTEM
      // =====================================================
      function renderQuiz(quiz) {
        const currentLessonProgress =
          courseProgress[COURSE_DATA.lessons[currentLessonIndex].id];
        const isCompleted = currentLessonProgress?.completed || false;

        let quizHTML = `
        <div class="quiz-section" id="quizSection">
            <div class="quiz-header">
                <h2 class="quiz-title">
                    <i class="fas fa-clipboard-check"></i>
                    Knowledge Check
                </h2>
                <p class="quiz-info">
                    Complete this quiz with ${quiz.passingScore}% or higher to unlock the next lesson.
                </p>
            </div>
    `;

        if (isCompleted) {
          const savedScore = currentLessonProgress.quizScore || 0;
          quizHTML += `
            <div class="quiz-results show">
                <div class="quiz-score pass">${savedScore}%</div>
                <div class="quiz-message">
                    <strong>Lesson Completed!</strong><br>
                    You've successfully passed this lesson's quiz.
                </div>
            </div>
        `;
        } else {
          // Render quiz questions
          quiz.questions.forEach((question, qIndex) => {
            quizHTML += `
                <div class="quiz-question ${
                  qIndex === 0 ? "active" : ""
                }" data-question="${qIndex}">
                    <div class="question-header">
                        <span class="question-number">Question ${
                          qIndex + 1
                        }</span>
                        <span class="question-progress">${qIndex + 1}/${
              quiz.questions.length
            }</span>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="question-options">
                        ${question.options
                          .map(
                            (option, oIndex) => `
                            <div class="option" data-option="${oIndex}" onclick="selectOption(${qIndex}, ${oIndex})">
                                <span class="option-letter">${String.fromCharCode(
                                  65 + oIndex
                                )}</span>
                                <span class="option-text">${option}</span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
            `;
          });

          quizHTML += `
            <div class="quiz-controls">
                <button class="btn btn-secondary" id="prevQuestionBtn" onclick="previousQuestion()" disabled>
                    <i class="fas fa-chevron-left"></i>
                    Previous
                </button>
                <div>
                    <button class="btn btn-secondary" id="nextQuestionBtn" onclick="nextQuestion()" disabled>
                        Next
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn btn-primary" id="submitQuizBtn" onclick="submitQuiz()" style="display: none;">
                        <i class="fas fa-check"></i>
                        Submit Quiz
                    </button>
                </div>
            </div>

            <div class="quiz-results" id="quizResults">
                <div class="quiz-score" id="quizScore">0%</div>
                <div class="quiz-message" id="quizMessage"></div>
                <div class="quiz-actions">
                    <button class="btn btn-primary" id="continueBtn" onclick="completeLesson()" style="display: none;">
                        <i class="fas fa-arrow-right"></i>
                        Continue to Next Lesson
                    </button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">
                        <i class="fas fa-redo"></i>
                        Retake Quiz
                    </button>
                </div>
            </div>
        `;
        }

        quizHTML += "</div>";
        return quizHTML;
      }

      // Quiz interaction functions
      function selectOption(questionIndex, optionIndex) {
        // Clear previous selections
        document
          .querySelectorAll(`[data-question="${questionIndex}"] .option`)
          .forEach((opt) => {
            opt.classList.remove("selected");
          });

        // Select current option
        const selectedOption = document.querySelector(
          `[data-question="${questionIndex}"] [data-option="${optionIndex}"]`
        );
        selectedOption.classList.add("selected");

        // Store answer
        quizState.answers[questionIndex] = optionIndex;

        // Update navigation
        const isLastQuestion =
          questionIndex ===
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length - 1;
        if (isLastQuestion) {
          document.getElementById("submitQuizBtn").style.display =
            "inline-flex";
          document.getElementById("nextQuestionBtn").style.display = "none";
        } else {
          document.getElementById("nextQuestionBtn").disabled = false;
        }
      }

      function nextQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const nextQuestionEl = currentQuestionEl.nextElementSibling;

        if (
          nextQuestionEl &&
          nextQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          nextQuestionEl.classList.add("active");
          quizState.currentQuestion++;
          updateQuizNavigation();
        }
      }

      function previousQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const prevQuestionEl = currentQuestionEl.previousElementSibling;

        if (
          prevQuestionEl &&
          prevQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          prevQuestionEl.classList.add("active");
          quizState.currentQuestion--;
          updateQuizNavigation();
        }
      }

      function updateQuizNavigation() {
        const totalQuestions =
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length;
        const prevBtn = document.getElementById("prevQuestionBtn");
        const nextBtn = document.getElementById("nextQuestionBtn");
        const submitBtn = document.getElementById("submitQuizBtn");

        prevBtn.disabled = quizState.currentQuestion === 0;

        const hasAnswer =
          quizState.answers[quizState.currentQuestion] !== undefined;
        const isLastQuestion = quizState.currentQuestion === totalQuestions - 1;

        if (isLastQuestion) {
          nextBtn.style.display = "none";
          submitBtn.style.display = hasAnswer ? "inline-flex" : "none";
        } else {
          nextBtn.style.display = "inline-flex";
          nextBtn.disabled = !hasAnswer;
          submitBtn.style.display = "none";
        }
      }

      async function submitQuiz() {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const quiz = lesson.quiz;
        let correctAnswers = 0;

        // Hide questions and controls
        document
          .querySelectorAll(".quiz-question")
          .forEach((q) => (q.style.display = "none"));
        document.querySelector(".quiz-controls").style.display = "none";

        // Calculate score and highlight answers
        quiz.questions.forEach((question, index) => {
          const userAnswer = quizState.answers[index];
          const correctAnswer = question.correct;
          const isCorrect = userAnswer === correctAnswer;

          if (isCorrect) correctAnswers++;

          // Highlight answers
          const questionEl = document.querySelector(
            `[data-question="${index}"]`
          );
          const options = questionEl.querySelectorAll(".option");

          options[correctAnswer].classList.add("correct");
          if (userAnswer !== correctAnswer && userAnswer !== undefined) {
            options[userAnswer].classList.add("incorrect");
          }
        });

        const score = Math.round(
          (correctAnswers / quiz.questions.length) * 100
        );
        const passed = score >= quiz.passingScore;

        // Update quiz results UI
        const quizScore = document.getElementById("quizScore");
        const quizMessage = document.getElementById("quizMessage");
        const quizActions = document.querySelector(".quiz-actions");

        quizScore.textContent = `${score}%`;
        quizScore.className = `quiz-score ${passed ? "pass" : "fail"}`;

        if (passed) {
          quizMessage.innerHTML = `
            <strong>Congratulations!</strong><br>
            You passed with ${score}%. You can now proceed to the next lesson.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-primary" onclick="completeLesson()">
                <i class="fas fa-arrow-right"></i>
                Continue to Next Lesson
            </button>
        `;

          // Mark lesson as completed
          await markLessonComplete(score);
        } else {
          quizMessage.innerHTML = `
            <strong>Not quite there yet.</strong><br>
            You scored ${score}%. You need ${quiz.passingScore}% to pass. Review the material and try again.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-secondary" onclick="retakeQuiz()">
                <i class="fas fa-redo"></i>
                Retake Quiz
            </button>
        `;
        }

        document.getElementById("quizResults").classList.add("show");

        // Log quiz completion
        logUserActivity("quiz_completed", {
          lesson_id: lesson.id,
          lesson_title: lesson.title,
          score: score,
          passed: passed,
          attempts: (courseProgress[lesson.id]?.quizAttempts || 0) + 1,
        });

        // Scroll to results
        document
          .getElementById("quizResults")
          .scrollIntoView({ behavior: "smooth" });
      }

      function retakeQuiz() {
        // Reset quiz state
        quizState = {
          currentQuestion: 0,
          answers: [],
          score: 0,
          isComplete: false,
        };

        // Track quiz retry
        const lessonId = COURSE_DATA.lessons[currentLessonIndex].id;
        if (!courseProgress[lessonId]) courseProgress[lessonId] = {};
        courseProgress[lessonId].quizAttempts =
          (courseProgress[lessonId].quizAttempts || 0) + 1;

        // Reload lesson content
        loadLesson(currentLessonIndex);

        // Scroll to quiz
        setTimeout(() => {
          document
            .getElementById("quizSection")
            .scrollIntoView({ behavior: "smooth" });
        }, 500);
      }

      async function markLessonComplete(score) {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonId = lesson.id;

        // Track lesson completion time
        trackLessonTime();

        // Update lesson progress
        courseProgress[lessonId] = {
          ...courseProgress[lessonId],
          completed: true,
          quizScore: score,
          completedAt: new Date().toISOString(),
          finalScore: score,
        };

        // Update session tracking
        courseSession.lessonsCompleted++;

        // Save progress to database
        await saveProgress();

        // Update UI
        renderSidebar();
        updateNavigationButtons();

        // Check various achievements
        await checkLessonCompletionAchievements();
        await checkPerfectScoreAchievements(score);
        await checkStudyTimeAchievements();

        // Log lesson completion
        logUserActivity("lesson_completed", {
          lesson_id: lessonId,
          lesson_title: lesson.title,
          final_score: score,
          time_spent: courseProgress[lessonId].timeSpent || 0,
          lesson_number: currentLessonIndex + 1,
        });

        showToast("Lesson completed successfully!", "success");
      }

      async function completeLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          // Move to next lesson
          currentLessonIndex++;
          loadLesson(currentLessonIndex);
        } else {
          // Course completion
          await completeCourse();
        }
      }

      async function completeCourse() {
        try {
          const completionTime = courseSession.totalStudyTime;

          // Update course progress to 100% completed
          await supabase
            .from("course_progress")
            .update({
              progress: 100,
              completed_at: new Date().toISOString(),
              completion_time_minutes: completionTime,
            })
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Award course completion achievements
          await checkAndUnlockAchievement("course_completion_1");
          await checkSpeedCompletionAchievements(completionTime);
          await checkCourseStreakAchievements();

          // Update user stats
          await updateUserStats();

          // Show completion message
          showToast(
            "Congratulations! Course completed successfully!",
            "certificate"
          );

          // Log course completion
          logUserActivity("course_completed", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            completion_time_minutes: completionTime,
            total_lessons: COURSE_DATA.lessons.length,
            average_quiz_score: calculateAverageQuizScore(),
          });

          // Redirect to dashboard after delay
          setTimeout(() => {
            window.location.href = "/dashboard.html";
          }, 3000);
        } catch (error) {
          console.error("Error completing course:", error);
          showToast("Error marking course as complete", "error");
        }
      }

      // =====================================================
      // ACHIEVEMENT INTEGRATION SYSTEM
      // =====================================================
      async function checkAndUnlockAchievement(
        achievementId,
        skipNotification = false
      ) {
        try {
          // Prevent duplicate checks
          const cacheKey = `achievement_${achievementId}_${currentUser.id}`;
          if (sessionStorage.getItem(cacheKey)) return false;

          // Check if already unlocked
          const { data: existing, error } = await supabase
            .from("user_achievements")
            .select("id")
            .eq("user_id", currentUser.id)
            .eq("achievement_id", achievementId)
            .single();

          if (existing) {
            sessionStorage.setItem(cacheKey, "true");
            return false;
          }

          // Award achievement
          const achievementData = {
            user_id: currentUser.id,
            achievement_id: achievementId,
            unlocked_at: new Date().toISOString(),
            points_awarded: getAchievementPoints(achievementId),
            context: "course_system",
          };

          const { data, error: insertError } = await supabase
            .from("user_achievements")
            .insert([achievementData])
            .select()
            .single();

          if (insertError) {
            if (insertError.code === "23505") return false; // Already exists
            throw insertError;
          }

          // Update user points
     await supabase.rpc('increment_user_stats', {
  user_id_param: currentUser.id,
  points_to_add: achievementData.points_awarded,
  achievements_to_add: 1
});

          // Cache and queue notification
          sessionStorage.setItem(cacheKey, "true");

          if (!skipNotification) {
            queueAchievementNotification({
              id: achievementId,
              name: getAchievementName(achievementId),
              description: getAchievementDescription(achievementId),
              points: achievementData.points_awarded,
              rarity: getAchievementRarity(achievementId),
              icon: getAchievementIcon(achievementId),
            });
          }

          return true;
        } catch (error) {
          console.error("Error unlocking achievement:", error);
          return false;
        }
      }

      // Helper functions for achievement data (replace with your actual achievement definitions)
      function getAchievementPoints(id) {
        const pointsMap = {
          first_course_start: 75,
          first_lesson: 100,
          course_completion_1: 500,
          perfect_score: 250,
          speed_demon: 750,
          marathon_learner: 500,
          night_owl: 200,
          early_bird: 200,
          weekend_warrior: 150,
          // Add more as needed
        };
        return pointsMap[id] || 100;
      }

      function getAchievementName(id) {
        const nameMap = {
          first_course_start: "Learning Initiated",
          first_lesson: "First Steps",
          course_completion_1: "Course Conqueror",
          perfect_score: "Perfectionist",
          speed_demon: "Speed Demon",
          // Add more as needed
        };
        return nameMap[id] || "Achievement Unlocked";
      }

      function getAchievementDescription(id) {
        const descMap = {
          first_course_start: "Start your first cybersecurity course",
          first_lesson: "Complete your first lesson",
          course_completion_1: "Complete your first course",
          perfect_score: "Score 100% on any quiz",
          speed_demon: "Complete a course in under 2 hours",
          // Add more as needed
        };
        return descMap[id] || "Achievement description";
      }

      function getAchievementRarity(id) {
        const rarityMap = {
          first_course_start: "common",
          first_lesson: "bronze",
          course_completion_1: "silver",
          perfect_score: "gold",
          speed_demon: "legendary",
          // Add more as needed
        };
        return rarityMap[id] || "common";
      }

      function getAchievementIcon(id) {
        const iconMap = {
          first_course_start: "fas fa-play",
          first_lesson: "fas fa-baby",
          course_completion_1: "fas fa-trophy",
          perfect_score: "fas fa-star",
          speed_demon: "fas fa-rocket",
          // Add more as needed
        };
        return iconMap[id] || "fas fa-award";
      }

      async function checkLessonAchievements(lessonNumber) {
        if (lessonNumber === 1) {
          await checkAndUnlockAchievement("first_lesson");
        }

        // Check if user has completed multiple lessons in one day
        const today = new Date().toISOString().split("T")[0];
        const todayCompletions = Object.values(courseProgress).filter(
          (p) => p.completed && p.completedAt?.startsWith(today)
        ).length;

        if (todayCompletions >= 3) {
          await checkAndUnlockAchievement("lesson_marathon");
        }
      }

      async function checkLessonCompletionAchievements() {
        const completedCount = getCompletedLessonsCount();

        // Lesson-based achievements
        const lessonMilestones = [1, 5, 10, 25, 50, 100];
        for (const milestone of lessonMilestones) {
          if (completedCount >= milestone) {
            await checkAndUnlockAchievement(`lessons_${milestone}`);
          }
        }

        // Course completion achievements
        if (completedCount === COURSE_DATA.lessons.length) {
          await checkAndUnlockAchievement("course_completion_1");

          // Check for additional course completion achievements
          const { data: allCourses } = await supabase
            .from("course_progress")
            .select("course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100);

          const totalCompleted = allCourses?.length || 0;

          const courseMilestones = [1, 5, 10, 25];
          for (const milestone of courseMilestones) {
            if (totalCompleted >= milestone) {
              await checkAndUnlockAchievement(`course_completion_${milestone}`);
            }
          }
        }
      }

      async function checkPerfectScoreAchievements(score) {
        if (score === 100) {
          await checkAndUnlockAchievement("perfect_score");

          // Check for consecutive perfect scores
          const recentScores = Object.values(courseProgress)
            .filter((p) => p.completed && p.quizScore)
            .slice(-5) // Last 5 completed
            .map((p) => p.quizScore);

          if (
            recentScores.length >= 3 &&
            recentScores.every((s) => s === 100)
          ) {
            await checkAndUnlockAchievement("perfectionist_streak");
          }
        }
      }

      async function checkSpeedCompletionAchievements(completionTime) {
        // Speed demon: Complete course in under 2 hours (120 minutes)
        if (completionTime <= 120) {
          await checkAndUnlockAchievement("speed_demon");
        }

        // Quick learner: Complete course in under 4 hours (240 minutes)
        if (completionTime <= 240) {
          await checkAndUnlockAchievement("quick_learner");
        }
      }

      async function checkStudyTimeAchievements() {
        const totalTime = courseSession.totalStudyTime;

        // Marathon learner: Study for 8+ hours in a course session
        if (totalTime >= 480) {
          // 8 hours
          await checkAndUnlockAchievement("marathon_learner");
        }

        // Dedicated learner: Study for 4+ hours
        if (totalTime >= 240) {
          // 4 hours
          await checkAndUnlockAchievement("dedicated_learner");
        }
      }

      async function checkCourseStreakAchievements() {
        try {
          // Check for consecutive course completions
          const { data: recentCourses, error } = await supabase
            .from("course_progress")
            .select("completed_at, course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100)
            .order("completed_at", { ascending: false })
            .limit(10);

          if (error || !recentCourses) return;

          // Check for courses completed on consecutive days
          let consecutiveDays = 1;
          for (let i = 1; i < recentCourses.length; i++) {
            const prevDate = new Date(
              recentCourses[i - 1].completed_at
            ).toDateString();
            const currentDate = new Date(
              recentCourses[i].completed_at
            ).toDateString();
            const dayDiff =
              Math.abs(new Date(prevDate) - new Date(currentDate)) /
              (1000 * 60 * 60 * 24);

            if (dayDiff <= 1) {
              consecutiveDays++;
            } else {
              break;
            }
          }

          if (consecutiveDays >= 3) {
            await checkAndUnlockAchievement("learning_streak");
          }
        } catch (error) {
          console.error("Error checking course streak achievements:", error);
        }
      }

      // =====================================================
      // TIME-BASED ACHIEVEMENTS
      // =====================================================
      async function checkTimeBasedAchievements(timestamp) {
        const hour = timestamp.getHours();
        const dayOfWeek = timestamp.getDay();

        // Night owl (after midnight, before 6 AM)
        if (hour >= 0 && hour < 6) {
          await incrementTimeBasedCounter("midnight_sessions", "night_owl");
        }

        // Early bird (4 AM to 6 AM)
        if (hour >= 4 && hour < 6) {
          await incrementTimeBasedCounter("early_sessions", "early_bird");
        }

        // Weekend warrior (Saturday = 6, Sunday = 0)
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          await incrementTimeBasedCounter(
            "weekend_sessions",
            "weekend_warrior"
          );
        }
      }

      async function incrementTimeBasedCounter(counterType, achievementId) {
        try {
          const dateStr = new Date().toISOString().split("T")[0];
          const cacheKey = `${counterType}_${currentUser.id}_${dateStr}`;

          // Prevent multiple increments per day
          if (sessionStorage.getItem(cacheKey)) return;

          // Update counter
          await supabase
            .from("profiles")
            .update({
              [counterType]: supabase.sql`${counterType} + 1`,
            })
            .eq("id", currentUser.id);

          // Cache to prevent double counting
          sessionStorage.setItem(cacheKey, "true");

          // Check related achievement
          if (achievementId) {
            await checkAndUnlockAchievement(achievementId, true);
          }
        } catch (error) {
          console.error(`Error incrementing ${counterType}:`, error);
        }
      }

      async function checkDailyStreak() {
        try {
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("last_activity, current_streak, last_streak_date")
            .eq("id", currentUser.id)
            .single();

          if (error) throw error;

          const now = new Date();
          const today = now.toDateString();
          const lastActivity = profile.last_activity
            ? new Date(profile.last_activity)
            : null;
          const lastStreakDate = profile.last_streak_date
            ? new Date(profile.last_streak_date).toDateString()
            : null;

          let newStreak = profile.current_streak || 0;
          let shouldUpdateStreak = false;

          if (!lastActivity) {
            // First time user
            newStreak = 1;
            shouldUpdateStreak = true;
          } else {
            const daysSinceLastActivity = Math.floor(
              (now - lastActivity) / (1000 * 60 * 60 * 24)
            );

            if (lastStreakDate === today) {
              // Already counted today's streak
              return newStreak;
            } else if (
              daysSinceLastActivity === 1 ||
              (daysSinceLastActivity === 0 && lastStreakDate !== today)
            ) {
              // Consecutive day or same day but not counted yet
              newStreak += 1;
              shouldUpdateStreak = true;
            } else if (daysSinceLastActivity > 1) {
              // Streak broken
              newStreak = 1;
              shouldUpdateStreak = true;
            }
          }

          if (shouldUpdateStreak) {
            await supabase
              .from("profiles")
              .update({
                current_streak: newStreak,
                last_activity: now.toISOString(),
                last_streak_date: now.toISOString(),
              })
              .eq("id", currentUser.id);

            userStats.current_streak = newStreak;

            showToast(`Daily streak: ${newStreak} days!`, "success");
            await checkStreakAchievements(newStreak);
          }

          return newStreak;
        } catch (error) {
          console.error("Error checking daily streak:", error);
          return 0;
        }
      }

      async function checkStreakAchievements(currentStreak) {
        const streakMilestones = [3, 7, 14, 30, 100, 365];

        for (const milestone of streakMilestones) {
          if (currentStreak >= milestone) {
            await checkAndUnlockAchievement(`streak_${milestone}`);
          }
        }
      }

      // =====================================================
      // USER ACTIVITY LOGGING
      // =====================================================
      async function logUserActivity(activityType, metadata = {}) {
        try {
          const now = new Date();

          const activityData = {
            user_id: currentUser.id,
            activity_type: activityType,
            timestamp: now.toISOString(),
            course_id: COURSE_DATA.id,
            lesson_index: currentLessonIndex,
            session_duration: courseSession.totalStudyTime,
            metadata: JSON.stringify(metadata),
            created_at: now.toISOString(),
          };

          // Try to log to activities table
          const { error } = await supabase
            .from("user_activities")
            .insert([activityData]);

          if (error && error.code !== "42P01") {
            console.warn("Activity logging failed:", error.message);
          }

          // Always update last activity in profile
          await supabase
            .from("profiles")
            .update({ last_activity: now.toISOString() })
            .eq("id", currentUser.id);
        } catch (error) {
          console.error("Error logging user activity:", error);
        }
      }

      // =====================================================
      // NAVIGATION SYSTEM
      // =====================================================
      function updateNavigationButtons() {
        const prevBtn = document.getElementById("prevLessonBtn");
        const nextBtn = document.getElementById("nextLessonBtn");

        if (!prevBtn || !nextBtn) return;

        // Previous button
        prevBtn.disabled = currentLessonIndex === 0;

        // Next button logic
        const isLastLesson =
          currentLessonIndex === COURSE_DATA.lessons.length - 1;
        const canGoNext =
          currentLessonIndex < COURSE_DATA.lessons.length - 1 &&
          canAccessLesson(currentLessonIndex + 1);

        if (isLastLesson) {
          const isCurrentCompleted =
            courseProgress[COURSE_DATA.lessons[currentLessonIndex].id]
              ?.completed;
          nextBtn.disabled = !isCurrentCompleted;
          nextBtn.innerHTML = '<i class="fas fa-trophy"></i> Complete Course';
        } else {
          nextBtn.disabled = !canGoNext;
          nextBtn.innerHTML = 'Next <i class="fas fa-chevron-right"></i>';
        }
      }

      // Navigation button event handlers
      function goToPreviousLesson() {
        if (currentLessonIndex > 0) {
          trackLessonTime(); // Track time spent on current lesson
          currentLessonIndex--;
          loadLesson(currentLessonIndex);
        }
      }

      function goToNextLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          const canGoNext = canAccessLesson(currentLessonIndex + 1);
          if (canGoNext) {
            trackLessonTime();
            currentLessonIndex++;
            loadLesson(currentLessonIndex);
          } else {
            showToast("Complete the current lesson quiz to proceed", "warning");
          }
        } else {
          // Complete course
          completeCourse();
        }
      }

      // =====================================================
      // SIDEBAR FUNCTIONS
      // =====================================================
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.toggle("open");
        if (overlay) overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.remove("open");
        if (overlay) overlay.classList.remove("active");
      }

      // =====================================================
      // ACHIEVEMENT NOTIFICATION SYSTEM
      // =====================================================
      function queueAchievementNotification(achievement) {
        notificationQueue.push(achievement);
        processNotificationQueue();
      }

      function processNotificationQueue() {
        if (isShowingNotification || notificationQueue.length === 0) return;

        isShowingNotification = true;
        const achievement = notificationQueue.shift();
        showAchievementNotification(achievement);

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          isShowingNotification = false;
          processNotificationQueue();
        }, duration + 500);
      }

      function showAchievementNotification(achievement) {
        const notification = document.getElementById("achievementNotification");
        if (!notification) return;

        const icon = document.getElementById("notificationIcon");
        const title = document.getElementById("notificationTitle");
        const description = document.getElementById("notificationDescription");
        const points = document.getElementById("notificationPoints");

        if (icon) {
          icon.innerHTML = `<i class="${achievement.icon}"></i>`;
          icon.className = `notification-icon ${achievement.rarity}`;
        }
        if (title) title.textContent = achievement.name;
        if (description) description.textContent = achievement.description;
        if (points) points.textContent = `+${achievement.points} Points`;

        notification.className = `achievement-notification ${achievement.rarity}`;
        notification.classList.add("show");

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          notification.classList.remove("show");
        }, duration);
      }

      // =====================================================
      // UTILITY FUNCTIONS
      // =====================================================
      function calculateAverageQuizScore() {
        const scores = Object.values(courseProgress)
          .filter((p) => p.completed && p.quizScore)
          .map((p) => p.quizScore);

        if (scores.length === 0) return 0;
        return Math.round(
          scores.reduce((sum, score) => sum + score, 0) / scores.length
        );
      }

      async function resetProgress() {
        if (
          !confirm(
            "Are you sure you want to reset your progress? This action cannot be undone."
          )
        ) {
          return;
        }

        try {
          // Track lesson time before reset
          trackLessonTime();

          // Reset local state
          courseProgress = {};
          currentLessonIndex = 0;
          courseSession = {
            startTime: new Date(),
            totalStudyTime: 0,
            lessonsStarted: 0,
            lessonsCompleted: 0,
            pageLoadTime: new Date(),
            interactionCount: 0,
            lastActivityTime: new Date(),
          };

          // Delete from database
          await supabase
            .from("course_progress")
            .delete()
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Log reset activity
          logUserActivity("progress_reset", {
            course_id: COURSE_DATA.id,
            reset_reason: "manual",
          });

          // Reinitialize
          await saveProgress();
          renderSidebar();
          loadLesson(0);

          showToast("Progress reset successfully", "success");
        } catch (error) {
          console.error("Error resetting progress:", error);
          showToast("Failed to reset progress", "error");
        }
      }

      function copyCode(codeId) {
        const codeElement = document.getElementById(codeId);
        if (!codeElement) return;

        const text = codeElement.textContent;

        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast("Code copied to clipboard!", "success");

            // Track code copy for achievements
            logUserActivity("code_copied", {
              code_section: codeId,
              lesson_id: COURSE_DATA.lessons[currentLessonIndex].id,
            });
          })
          .catch((err) => {
            console.error("Failed to copy code:", err);
            showToast("Failed to copy code", "error");

            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
              document.execCommand("copy");
              showToast("Code copied to clipboard!", "success");
            } catch (fallbackError) {
              showToast(
                "Copy failed - please select and copy manually",
                "error"
              );
            }
            document.body.removeChild(textArea);
          });
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // =====================================================
      // UI FEEDBACK SYSTEMS
      // =====================================================
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const messageEl = document.getElementById("toastMessage");

        if (!toast || !messageEl) {
          console.log(`Toast: ${message} (${type})`);
          return;
        }

        messageEl.textContent = message;
        toast.className = `toast ${type} show`;

        setTimeout(() => {
          toast.classList.remove("show");
        }, 4000);
      }

      function showLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) loadingScreen.classList.remove("hidden");
      }

      function hideLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) {
          setTimeout(() => {
            loadingScreen.classList.add("hidden");
          }, 1000);
        }
      }

      // =====================================================
      // MUSIC PLAYER INTEGRATION
      // =====================================================
      function initMusicPlayer() {
        const btnText = document.getElementById("music-button-text");
        const icon = document.getElementById("music-icon");
        const dropdown = document.getElementById("music-dropdown-content");

        if (!btnText || !icon || !dropdown) return;

        function setUI(state) {
          btnText.textContent =
            state === "Playing" ? "PAUSE MUSIC" : "STUDY MUSIC";
          icon.className =
            state === "Playing"
              ? "fa-solid fa-circle-pause"
              : "fa-solid fa-music";
        }

        // Load saved music state
        const savedSrc = localStorage.getItem("cybersec_music_src");
        const savedTime = parseFloat(
          localStorage.getItem("cybersec_music_time") || 0
        );

        if (savedSrc) {
          audioPlayer.src = savedSrc;
          audioPlayer.currentTime = savedTime;
          audioPlayer
            .play()
            .then(() => setUI("Playing"))
            .catch(() => setUI("Stopped"));
        }

        // Music button click handler
        document
          .getElementById("music-dropdown")
          .querySelector("button")
          .addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown.style.display =
              dropdown.style.display === "block" ? "none" : "block";

            if (audioPlayer.src && !audioPlayer.paused) {
              audioPlayer.pause();
              setUI("Stopped");
            } else if (audioPlayer.src) {
              audioPlayer.play().then(() => setUI("Playing"));
            }
          });

        // Music selection handlers
        dropdown.querySelectorAll("a[data-src]").forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.src = link.dataset.src;
            audioPlayer.play().then(() => setUI("Playing"));
            localStorage.setItem("cybersec_music_src", link.dataset.src);
            dropdown.style.display = "none";
          });
        });

        // Stop music handler
        const stopLink = document.getElementById("stop-music-link");
        if (stopLink) {
          stopLink.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.removeAttribute("src");
            setUI("Stopped");
            localStorage.removeItem("cybersec_music_src");
            localStorage.removeItem("cybersec_music_time");
            dropdown.style.display = "none";
          });
        }

        // Save music state before page unload
        window.addEventListener("beforeunload", () => {
          if (!audioPlayer.paused && audioPlayer.src) {
            localStorage.setItem("cybersec_music_src", audioPlayer.src);
            localStorage.setItem(
              "cybersec_music_time",
              audioPlayer.currentTime
            );
          }
        });

        // Close dropdown when clicking outside
        window.addEventListener("click", (e) => {
          if (!e.target.closest("#music-dropdown")) {
            dropdown.style.display = "none";
          }
        });
      }

      // Show initial music indicator
      function addMusicIndicator() {
        const musicBtn = document.querySelector("#music-dropdown");
        if (musicBtn) {
          const indicator = document.createElement("div");
          indicator.className = "music-indicator";
          indicator.innerHTML = `<i class="fa-solid fa-music"></i> Try Study Music!`;

          musicBtn.style.position = "relative";
          musicBtn.appendChild(indicator);

          setTimeout(() => indicator.remove(), 3000);
        }
      }

      // Initialize Event Listeners
      function initializeEventListeners() {
        // Navigation buttons
        document
          .getElementById("prevLessonBtn")
          ?.addEventListener("click", goToPreviousLesson);
        document
          .getElementById("nextLessonBtn")
          ?.addEventListener("click", goToNextLesson);

        // Reset progress button
        document
          .getElementById("resetProgressBtn")
          ?.addEventListener("click", resetProgress);

        // Mobile menu toggle
        document
          .getElementById("menuToggle")
          ?.addEventListener("click", toggleSidebar);
        document
          .getElementById("sidebarOverlay")
          ?.addEventListener("click", closeSidebar);

        // Keyboard shortcuts
        document.addEventListener("keydown", handleKeyboardShortcuts);

        // Window resize handler
        window.addEventListener("resize", handleWindowResize);

        // Content interaction tracking
        document.getElementById("contentBody")?.addEventListener(
          "scroll",
          debounce(() => {
            trackUserInteraction();
          }, 1000)
        );
      }

      // Keyboard Shortcuts
      function handleKeyboardShortcuts(e) {
        if (document.querySelector(".quiz-question.active")) return;

        if (e.key === "ArrowLeft" && e.ctrlKey) {
          e.preventDefault();
          goToPreviousLesson();
        } else if (e.key === "ArrowRight" && e.ctrlKey) {
          e.preventDefault();
          goToNextLesson();
        }
      }

      // Window Resize Handler
      function handleWindowResize() {
        if (window.innerWidth > 768) {
          closeSidebar();
        }
      }

      // Debounce Helper
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Initialize responsive behavior
      if (window.innerWidth <= 768) {
        document.getElementById("menuToggle").style.display = "inline-flex";
      }

      // Auto-save progress periodically
      setInterval(async () => {
        if (currentUser && Object.keys(courseProgress).length > 0) {
          await saveProgress();
        }
      }, 60000); // Save every minute

      // System initialization logging
      console.log("CyberSec Academy Course System Initialized");
      console.log("Current Course:", COURSE_DATA.title);
      console.log("Total Lessons:", COURSE_DATA.lessons.length);

      // Google OAuth Integration
      const googleBtn = document.querySelector(".btn-google");
      if (googleBtn) {
        googleBtn.addEventListener("click", async () => {
          const { data, error } = await supabase.auth.signInWithOAuth({
            provider: "google",
            options: {
              redirectTo:
                window.location.origin +
                "/courses/crisis-management-in-cybersecurity.html",
            },
          });

          if (error) {
            console.error("Google login error:", error.message);
            showToast("Google login failed: " + error.message, "error");
          }
        });
      }

      // Check for existing session
      supabase.auth.getSession().then(({ data }) => {
        if (data.session) {
          console.log("User already logged in:", data.session.user);
          currentUser = data.session.user;
          startCourseSession();
        }
      });

      // Add missing auth modal functions
      function openAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "flex";
        }
      }

      function closeAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "none";
        }
      }

      // Add auth tab switching functionality
      document.getElementById("tabSignIn")?.addEventListener("click", () => {
        document.getElementById("tabSignIn").classList.add("active");
        document.getElementById("tabSignUp").classList.remove("active");
        document.getElementById("signInForm").style.display = "block";
        document.getElementById("signUpForm").style.display = "none";
      });

      document.getElementById("tabSignUp")?.addEventListener("click", () => {
        document.getElementById("tabSignUp").classList.add("active");
        document.getElementById("tabSignIn").classList.remove("active");
        document.getElementById("signUpForm").style.display = "block";
        document.getElementById("signInForm").style.display = "none";
      });

      document
        .getElementById("closeAuthModal")
        ?.addEventListener("click", closeAuthModal);

      // Improved error handling for auth session
      supabase.auth.onAuthStateChange((event, session) => {
        if (event === "SIGNED_IN") {
          currentUser = session.user;
          closeAuthModal();
          startCourseSession();
        } else if (event === "SIGNED_OUT") {
          currentUser = null;
          openAuthModal();
        }
      });

      // Add form submission handlers
      document
        .getElementById("emailSignInForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signInEmail").value;
          const password = document.getElementById("signInPassword").value;

          try {
            const { data, error } = await supabase.auth.signInWithPassword({
              email,
              password,
            });

            if (error) throw error;

            closeAuthModal();
          } catch (error) {
            showToast(error.message, "error");
          }
        });

      document
        .getElementById("emailSignUpForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signUpEmail").value;
          const password = document.getElementById("signUpPassword").value;
          const name = document.getElementById("signUpName").value;

          try {
            const { data, error } = await supabase.auth.signUp({
              email,
              password,
              options: {
                data: {
                  full_name: name,
                },
              },
            });

            if (error) throw error;

            showToast(
              "Account created successfully! Please check your email.",
              "success"
            );
          } catch (error) {
            showToast(error.message, "error");
          }
        });
    </script>
  </body>
</html>
