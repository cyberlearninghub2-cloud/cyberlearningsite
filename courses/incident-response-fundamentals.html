





<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Exo+2:wght@700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css"
    />
    <link rel="stylesheet" href="assets/css/coursepages.css">
    <meta name="robots" content="noindex, nofollow">
    <!-- ========== Start: SEO & Schema Enhancement ========== -->
    <title>Incident Response Fundamentals Course | CipherHall</title>
    <meta name="description" content="Enroll in our comprehensive Incident Response course. Master the NIST framework, from preparation and detection to containment, eradication, and recovery.">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />
    <link rel="canonical" href="https://www.cipherhall.com/courses/incident-response-fundamentals.html" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Course",
      "name": "Incident Response Fundamentals",
      "description": "A comprehensive, 40-lesson journey from foundational principles to advanced management of cybersecurity incidents, covering preparation, detection, containment, and recovery.",
      "provider": {
        "@type": "Organization",
        "name": "CipherHall",
        "sameAs": "https://www.cipherhall.com"
      },
      "hasCourseInstance": {
        "@type": "CourseInstance",
        "courseMode": "Online",
        "instructor": {
          "@type": "Person",
          "name": "Maria Flores"
        }
      }
    }
    </script>
    <!-- ========== End: SEO & Schema Enhancement ========== -->
</head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loader-icon">
        <i class="fas fa-graduation-cap"></i>
      </div>
      <div class="loader-text">Loading Course Content...</div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Music Player (fixed at top right) -->
    <div class="header-controls">
      <div class="music-dropdown" id="music-dropdown">
        <button class="btn btn-secondary">
          <span id="music-button-text">STUDY MUSIC</span>
          <i id="music-icon" class="fa-solid fa-music"></i>
        </button>
        <div class="music-dropdown-content" id="music-dropdown-content">
          <a
            href="#"
            data-src="https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3"
            >1. Coffee Shop Vibes</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-16.mp3"
            >2. City Lights Lofi</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3"
            >3. Mellow Thoughts</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-13.mp3"
            >4. Rainy Mood</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3"
            >5. Time Alone</a
          >
          <a href="#" id="stop-music-link"
            ><i class="fa-solid fa-stop-circle"></i> Stop Music</a
          >
        </div>
      </div>

      <button class="btn btn-secondary" id="resetProgressBtn">
        <i class="fas fa-redo"></i>
        Reset Progress
      </button>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal" style="display: none">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <span class="close" id="closeAuthModal">&times;</span>
        <div class="auth-tabs">
          <button id="tabSignIn" class="auth-tab active">Sign In</button>
          <button id="tabSignUp" class="auth-tab">Sign Up</button>
        </div>
        <div
          id="authLoader"
          style="display: none; text-align: center; padding: 2rem"
        >
          <i
            class="fas fa-spinner fa-spin fa-2x"
            style="color: var(--color-green)"
          ></i>
          <p style="margin-top: 0.5rem">Authenticating...</p>
        </div>
        <div id="signInForm" class="auth-form">
          <h2>Sign In to CipehrHall</h2>
          <button id="googleSignIn" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignInForm">
            <input
              type="email"
              id="signInEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signInPassword"
              placeholder="Password"
              required
            />
            <button type="submit" class="btn btn-primary">Sign In</button>
          </form>
        </div>
        <div id="signUpForm" class="auth-form" style="display: none">
          <h2>Join CipherHall</h2>
          <button id="googleSignUp" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignUpForm">
            <input
              type="text"
              id="signUpName"
              placeholder="Full Name"
              required
            />
            <input
              type="email"
              id="signUpEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signUpPassword"
              placeholder="Password (min. 8 characters)"
              required
            />
            <button type="submit" class="btn btn-secondary">
              Create Account
            </button>
          </form>
        </div>
        <div id="authMessage"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="course-info">
          <h1 class="course-title" id="courseTitle">Loading...</h1>
          <div class="course-progress">
            <div class="progress-header">
              <span class="progress-label">Course Progress</span>
              <span class="progress-percentage" id="courseProgressPercent"
                >0%</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="courseProgressFill"
                style="width: 0%"
              ></div>
            </div>
            <div class="progress-stats">
              <span id="completedLessons">0</span>
              <span id="totalLessons">0</span>
            </div>
          </div>
          <a href="/dashboard.html" class="back-to-dashboard">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
          </a>
        </div>
      </div>

      <nav class="lesson-nav" id="lessonNav">
        <!-- Lessons will be loaded dynamically -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="content-header">
        <div class="lesson-header">
          <div class="lesson-header-left">
            <span class="lesson-number" id="currentLessonNumber">1</span>
            <h1 class="lesson-header-title" id="currentLessonTitle">
              Loading...
            </h1>
          </div>
          <div class="lesson-actions">
            <button class="mbtn btn-primary" id="menuToggle">
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </header>

      <div class="content-body" id="contentBody">
        <div class="lesson-content" id="lessonContent">
          <!-- Lesson content will be loaded dynamically -->
        </div>
      </div>

      <footer class="lesson-navigation">
        <div class="nav-info" id="navInfo">Lesson 1 of 10</div>
        <div class="nav-controls">
          <button class="btn btn-secondary" id="prevLessonBtn" disabled>
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button class="btn btn-primary" id="nextLessonBtn" disabled>
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </footer>
    </main>

    <!-- Achievement Notification -->
    <div id="achievementNotification" class="achievement-notification">
      <div class="notification-header">
        <div class="notification-icon" id="notificationIcon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="notification-content">
          <h3 id="notificationTitle">Achievement Unlocked!</h3>
          <p id="notificationDescription">Description here...</p>
        </div>
      </div>
      <div class="notification-reward" id="notificationReward">
        <i class="fas fa-coins"></i>
        <span id="notificationPoints">+100 Points</span>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage"></span>
    </div>

    <script>
      // =====================================================
      // SYNCHRONIZED COURSE SYSTEM WITH DASHBOARD INTEGRATION
      // =====================================================

      // Supabase Configuration - Replace with your config
      const supabaseUrl = "https://lzcmzulemfubjaksoqor.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6Y216dWxlbWZ1Ympha3NvcW9yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzM5MDgsImV4cCI6MjA3MDkwOTkwOH0.crhPH4YWtRsr1BJTpAQcmPbWSpwIWRbzoI4sRb2_fPI";
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      // =====================================================
      // COURSE DATA STRUCTURE - REPLACE WITH YOUR COURSE JSON
      // =====================================================
      const COURSE_DATA =  {
        "id": "incident-response-planning",
        "title": "Incident Response Fundamentals",
        "description": "A comprehensive, 40-lesson journey from foundational principles to advanced management of cybersecurity incidents, covering preparation, detection, containment, and recovery.",
        "category": "cybersecurity",
        "difficulty": "Beginner to Advanced",
        "duration": "80 hours",
        "instructor": "Dr. Kenji Tanaka",
        "lessons": [
            {
                "id": "lesson-1-ir-overview",
                "title": "Lesson 1: Incident Response Overview",
                "duration": "120 min",
                "objectives": [
                    "Define a security incident and differentiate it from an event",
                    "Distinguish between Incident Response (IR), Business Continuity (BC), and Disaster Recovery (DR)",
                    "Recognize key legal and regulatory drivers for incident response",
                    "Understand the potential business costs and impacts of security incidents"
                ],
                "content": {
                    "overview": "This lesson introduces the fundamental concepts of incident response. You will learn what constitutes a security incident, how it differs from other business disruptions, and why a formal response capability is a critical business function in the modern threat landscape.",
                    "sections": [
                        {
                            "title": "Definition of Security Incidents",
                            "content": "<p>A security incident is an event that violates an organization's security policies, acceptable use policies, or standard security practices. It is a breach of the core principles of information security.</p><h3>The C-I-A Triad:</h3><ul><li><strong>Confidentiality Breach:</strong> An unauthorized disclosure of sensitive information. <em>Example: A customer database is stolen and leaked.</em></li><li><strong>Integrity Breach:</strong> An unauthorized modification or destruction of data. <em>Example: A ransomware attack encrypts critical files.</em></li><li><strong>Availability Breach:</strong> A disruption of access to resources or assets. <em>Example: A Denial-of-Service (DoS) attack makes a website inaccessible.</em></li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Event vs. Incident</strong></div><p>An 'event' is any observable occurrence on a system or network. Millions of events happen every day. An 'incident' is an event that has been analyzed and confirmed to be a security violation. The job of a SOC is to find the incidents among the events.</p></div>",
                            "image": "https://images.unsplash.com/photo-1548092372-6a7e3206a5a2?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "IR vs. Business Continuity vs. Disaster Recovery",
                            "content": "<p>These three concepts are related but have distinct goals and scopes. Understanding their differences is key to effective planning.</p><h3>Scope and Goals:</h3><ul><li><strong>Incident Response (IR):</strong> Focuses on detecting, containing, and recovering from a security breach. Its primary goal is to limit damage and restore security. <em>'The house is on fire, put out the fire!'</em></li><li><strong>Disaster Recovery (DR):</strong> Focuses on restoring IT systems and infrastructure after a major outage (e.g., natural disaster, massive hardware failure). Its goal is to get the technology working again. <em>'The house burned down, rebuild the house.'</em></li><li><strong>Business Continuity (BC):</strong> The most comprehensive of the three. It focuses on maintaining critical business operations during and after a disruption of any kind. Its goal is to keep the business running. <em>'The house burned down, let's work from the hotel until it's rebuilt.'</em></li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Interdependencies</strong></div><p>A major security incident (like ransomware) will trigger the IR plan. If it's severe enough to take down critical systems, it will also trigger the DR plan. The overarching BC plan dictates which systems need to be recovered first.</p></div>",
                            "image": "https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Cost of Security Incidents",
                            "content": "<p>The impact of a security incident goes far beyond the immediate technical costs. The true cost is a combination of direct expenses, long-term business impact, and reputational damage.</p><h3>Common Costs:</h3><ul><li><strong>Direct Costs:</strong> Forensic investigation, overtime for IT staff, legal fees, public relations campaigns, credit monitoring for affected customers.</li><li><strong>Indirect Costs:</strong> Lost revenue due to operational downtime, loss of competitive advantage from stolen IP, increased insurance premiums.</li><li><strong>Intangible Costs:</strong> Damage to brand reputation, loss of customer trust, negative impact on stock price.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>The Numbers Don't Lie</strong></div><p>Studies consistently show that organizations with a tested incident response plan have a significantly lower average cost of a breach compared to those without one. Preparation pays for itself.</p></div>",
                            "image": "https://images.unsplash.com/photo-1556741533-4020f1b29a28?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Lab: Incident Classification Exercise (Markdown)",
                        "language": "markdown",
                        "code": "| # | Scenario                                                  | Classification      | Justification (CIA Triad)         |\n|---|-----------------------------------------------------------|---------------------|-----------------------------------|\n| 1 | An employee loses an unencrypted company laptop           | Incident (Confirmed)  | Breach of Confidentiality         |\n| 2 | A firewall blocks a port scan from the internet         | Event (Informational) | Policy enforcement, no impact     |\n| 3 | A server's hard drive fails due to age                      | Business Disruption | Availability issue, but not a security violation |\n| 4 | Ransomware encrypts the main file server                | Incident (Confirmed)  | Breach of Integrity & Availability  |"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "A ransomware attack that encrypts files is a breach of which two principles?", "options": ["Confidentiality and Availability", "Integrity and Availability", "Confidentiality and Integrity", "Policy and Procedure"], "correct": 1, "explanation": "It's an integrity breach because data is modified without authorization, and an availability breach because the data is no longer accessible." },
                        { "id": 2, "question": "Which plan is focused on restoring IT systems after a major datacenter outage?", "options": ["Incident Response Plan", "Business Continuity Plan", "Disaster Recovery Plan", "Communications Plan"], "correct": 2, "explanation": "Disaster Recovery (DR) specifically deals with recovering IT infrastructure from a disaster-level event." },
                        { "id": 3, "question": "Lost customer trust and damage to brand reputation are examples of what kind of incident cost?", "options": ["Direct Costs", "Indirect Costs", "Intangible Costs", "Containment Costs"], "correct": 2, "explanation": "Intangible costs are non-monetary impacts that can have a severe, long-term effect on the business." },
                        { "id": 4, "question": "What is the key difference between a security event and a security incident?", "options": ["Events are always malicious, incidents are not", "An incident is an event that has been analyzed and confirmed to be a security violation", "Events happen on the network, incidents happen on endpoints", "There is no difference"], "correct": 1, "explanation": "An incident is a verified security violation, elevated from the status of a mere event after analysis." },
                        { "id": 5, "question": "The primary goal of an Incident Response plan is to:", "options": ["Ensure the business can continue to make money during a crisis", "Restore operations to a secondary site after a flood", "Limit the damage from a security breach and restore security", "Discipline employees who violate policy"], "correct": 2, "explanation": "The core purpose of IR is to manage the cybersecurity breach itself: detect it, contain it, and eradicate the threat." }
                    ]
                }
            },
            {
                "id": "lesson-2-ir-frameworks",
                "title": "Lesson 2: IR Framework and Standards",
                "duration": "120 min",
                "objectives": [
                    "Understand the phases of the NIST SP 800-61 incident response lifecycle",
                    "Learn the SANS/GIAC PICERL framework for incident handling",
                    "Gain awareness of the ISO 27035 standard for IR management",
                    "Compare and contrast the major industry frameworks"
                ],
                "content": {
                    "overview": "You don't have to invent incident response from scratch. This lesson introduces the major industry-standard frameworks that provide a structured, repeatable, and defensible process for handling security incidents. Adopting a framework ensures a consistent and comprehensive approach.",
                    "sections": [
                        {
                            "title": "NIST SP 800-61 Framework",
                            "content": "<p>The National Institute of Standards and Technology (NIST) Special Publication 800-61, 'Computer Security Incident Handling Guide', is one of the most widely adopted frameworks, especially within the U.S. government and large enterprises. It defines a four-phase lifecycle.</p><h3>The NIST IR Lifecycle:</h3><ol><li><strong>Preparation:</strong> Establishing the tools, processes, and people to handle incidents *before* one occurs. This includes training, tool deployment, and policy development.</li><li><strong>Detection & Analysis:</strong> Identifying an incident from the sea of events, validating it, and determining its scope and impact.</li><li><strong>Containment, Eradication & Recovery:</strong> The 'doing' phase. Isolate affected systems (containment), remove the threat (eradication), and restore systems to normal operation (recovery).</li><li><strong>Post-Incident Activity:</strong> The 'learning' phase. Documenting the incident, conducting a lessons-learned session, and making improvements to prevent recurrence.</li></ol><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>It's a Cycle</strong></div><p>The output of the Post-Incident Activity phase feeds directly back into the Preparation phase. This creates a continuous cycle of improvement for the IR program.</p></div>",
                            "image": "https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "SANS Incident Response Process",
                            "content": "<p>The SANS Institute, a leading provider of cybersecurity training, offers a similar but slightly more granular framework known by the acronym PICERL. It's popular in the commercial sector.</p><h3>The SANS (PICERL) Process:</h3><ul><li><strong>Preparation:</strong> Same as NIST; getting ready ahead of time.</li><li><strong>Identification:</strong> The process of confirming a suspected event is a real incident.</li><li><strong>Containment:</strong> Limiting the scope and magnitude of the incident. This can include short-term and long-term steps.</li><li><strong>Eradication:</strong> Removing the root cause of the incident and any artifacts the attacker left behind.</li><li><strong>Recovery:</strong> Restoring systems and validating that they are clean and operating normally.</li><li><strong>Lessons Learned:</strong> A formal review of the response to identify improvements.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Subtle Differences</strong></div><p>SANS breaks NIST's 'Detection & Analysis' phase into 'Identification', and splits 'Containment, Eradication & Recovery' into three distinct phases. The underlying philosophy is very similar.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "ISO 27035 Standard",
                            "content": "<p>ISO/IEC 27035 is an international standard that provides guidance on information security incident management. It's less of a step-by-step process and more of a high-level framework for building an IR program that integrates with a broader Information Security Management System (ISMS), like ISO 27001.</p><h3>ISO 27035 Principles:</h3><ul><li><strong>Plan and Prepare:</strong> Establishing the policy, team, and resources.</li><li><strong>Detect and Report:</strong> Identifying and reporting security events.</li><li><strong>Assess and Decide:</strong> Assessing the events to determine if they are incidents.</li><li><strong>Respond:</strong> Executing actions to contain, eradicate, and recover.</li><li><strong>Learn Lessons:</strong> Identifying improvements.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Framework vs. Standard</strong></div><p>Frameworks like NIST and SANS provide a 'how-to' guide. A standard like ISO 27035 provides the 'what to do', allowing organizations to achieve a formal certification of their program.</p></div>",
                            "image": "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Framework Phase Comparison",
                        "language": "markdown",
                        "code": "| Goal                       | NIST SP 800-61 Phase                      | SANS PICERL Phase  |\n|----------------------------|-------------------------------------------|--------------------|\n| Get ready                  | Preparation                               | Preparation        |\n| Confirm it's an incident   | Detection & Analysis                      | Identification     |\n| Stop the bleeding          | Containment, Eradication & Recovery       | Containment        |\n| Remove the threat          | Containment, Eradication & Recovery       | Eradication        |\n| Get back to normal         | Containment, Eradication & Recovery       | Recovery           |\n| Improve for next time      | Post-Incident Activity                    | Lessons Learned    |"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "In the NIST framework, which phase involves activities like training, policy development, and tool deployment?", "options": ["Detection & Analysis", "Preparation", "Containment, Eradication & Recovery", "Post-Incident Activity"], "correct": 1, "explanation": "Preparation is the proactive phase focused on building the capability to respond to incidents before they occur." },
                        { "id": 2, "question": "What does the 'C' in the SANS PICERL framework stand for?", "options": ["Communication", "Containment", "Classification", "Collection"], "correct": 1, "explanation": "PICERL stands for Preparation, Identification, Containment, Eradication, Recovery, and Lessons Learned." },
                        { "id": 3, "question": "A 'lessons learned' meeting is a key part of which phase in both NIST and SANS frameworks?", "options": ["Identification", "Recovery", "Post-Incident Activity / Lessons Learned", "Preparation"], "correct": 2, "explanation": "Both frameworks emphasize the importance of a post-mortem review to drive continuous improvement." },
                        { "id": 4, "question": "Which of the following provides an auditable international standard for building an IR program, rather than a step-by-step guide?", "options": ["NIST SP 800-61", "SANS PICERL", "ISO 27035", "The C-I-A Triad"], "correct": 2, "explanation": "ISO 27035 is a formal standard that specifies the requirements for an incident management program, often used for certification." },
                        { "id": 5, "question": "Isolating a compromised server from the network is an action taken during which phase?", "options": ["Preparation", "Post-Incident Activity", "Detection", "Containment"], "correct": 3, "explanation": "Containment actions are designed to limit the impact of the incident and prevent the threat from spreading further." }
                    ]
                }
            },
            {
                "id": "lesson-3-ir-team",
                "title": "Lesson 3: IR Team Structure and Roles",
                "duration": "120 min",
                "objectives": [
                    "Understand different models for structuring a Computer Security Incident Response Team (CSIRT)",
                    "Define the key roles and responsibilities within a CSIRT",
                    "Identify key stakeholders outside the core team and their importance",
                    "Develop a basic communication and escalation hierarchy"
                ],
                "content": {
                    "overview": "An effective incident response is a team sport. This lesson covers how to structure a response team, define clear roles and responsibilities for its members, and establish communication pathways with other key stakeholders throughout the organization.",
                    "sections": [
                        {
                            "title": "CSIRT/CERT Team Composition",
                            "content": "<p>A Computer Security Incident Response Team (CSIRT), sometimes called a Computer Emergency Response Team (CERT), is the core group of people responsible for responding to incidents. There are several ways to structure this team.</p><h3>Common Team Models:</h3><ul><li><strong>Centralized Team:</strong> A single, full-time IR team that handles all incidents for the entire organization. Common in small to medium-sized businesses.</li><li><strong>Distributed Team:</strong> Multiple IR teams, perhaps one for each business unit or geographic region. Local teams handle most incidents, with a central team providing coordination and support. Common in large, multinational corporations.</li><li><strong>Coordinating Team:</strong> A central team (like a national CERT) that provides guidance, threat intelligence, and assistance to other, independent organizations.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Virtual Teams</strong></div><p>In many organizations, the IR 'team' is a virtual one. Members are pulled from their regular duties (e.g., a network engineer, a systems admin, a developer) to respond to an incident when it occurs. In this model, clearly defined roles are even more critical.</p></div>",
                            "image": "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Roles and Responsibilities Matrix",
                            "content": "<p>During a crisis, there is no time to figure out who is supposed to do what. Clearly defined roles are essential to avoid confusion and ensure all necessary actions are taken.</p><h3>Key IR Roles:</h3><ul><li><strong>Incident Commander:</strong> The overall leader and decision-maker for a specific incident. They manage the response effort, allocate resources, and communicate with leadership.</li><li><strong>Triage/First Responder:</strong> The initial analyst who validates a potential incident, collects initial evidence, and performs initial assessment.</li><li><strong>Lead Investigator/Forensic Analyst:</strong> The technical expert who performs the deep-dive investigation into the incident's root cause.</li><li><strong>Communications Lead:</strong> Manages all internal and external communications, ensuring a consistent and accurate message.</li><li><strong>Legal Counsel:</strong> Provides guidance on legal and regulatory obligations, including breach notification and evidence handling.</li><li><strong>HR Representative:</strong> Manages any issues related to employees (e.g., if the incident is an insider threat).</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>One Person, Multiple Hats</strong></div><p>In smaller teams, a single person may cover multiple roles. What matters is that all responsibilities are explicitly assigned to someone.</p></div>",
                            "image": "https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Stakeholder Identification",
                            "content": "<p>The core IR team cannot operate in a vacuum. A major incident will impact many parts of the business, and these stakeholders must be identified and included in the communication plan from the beginning.</p><h3>Key Stakeholders:</h3><ul><li><strong>Executive Leadership (CEO, CIO, CISO):</strong> Need high-level updates on business impact and response status.</li><li><strong>Public Relations / Corporate Communications:</strong> Manages the external message to media and customers.</li><li><strong>Department Heads:</strong> Need to know if their teams or business processes are affected.</li><li><strong>Help Desk / IT Support:</strong> Are often the first to receive reports from users and are key for deploying remediation actions.</li><li><strong>Law Enforcement:</strong> May need to be engaged depending on the nature of the incident.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Identify Them Before the Crisis</strong></div><p>The IR plan must include a contact list for all key stakeholders, including their names, roles, and 24/7 contact information. This is not something you want to be searching for at 2 AM.</p></div>",
                            "image": "https://images.unsplash.com/photo-1543269865-cbf427effbad?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Sample Roles & Responsibilities (RACI Matrix)",
                        "language": "markdown",
                        "code": "| Task                        | Incident Commander | Triage Analyst | Legal      | PR         |\n|-----------------------------|--------------------|----------------|------------|------------|\n| Validate Incident           | A (Accountable)    | R (Responsible)| I (Informed) | C (Consulted)|\n| Approve containment actions   | R/A                | I              | C          | I          |\n| Write public breach notice  | A                  | C              | R          | R          |\n| Coordinate with Law Enforcement| R/A                | I              | C          | I          |\n\n*R=Responsible, A=Accountable, C=Consulted, I=Informed*"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "Which person has overall authority and makes the final decisions during an active incident response?", "options": ["Triage Analyst", "Incident Commander", "Legal Counsel", "Forensic Analyst"], "correct": 1, "explanation": "The Incident Commander is the single point of leadership responsible for managing the entire response effort for a given incident." },
                        { "id": 2, "question": "A virtual incident response team is one where:", "options": ["All members work remotely from home", "The team only exists on paper and is never activated", "Members are pulled from their normal, day-to-day jobs to respond to an incident", "The team is outsourced to a third-party vendor"], "correct": 2, "explanation": "A virtual team is comprised of individuals from different departments (IT, networking, etc.) who have part-time IR responsibilities." },
                        { "id": 3, "question": "In a RACI matrix, what does 'Accountable' mean?", "options": ["The person who does the work", "The person who must be kept up-to-date", "The person with the final authority and ownership", "The person who provides input"], "correct": 2, "explanation": "The 'Accountable' person has the ultimate ownership of the task. There should only be one 'A' per task." },
                        { "id": 4, "question": "Why is it important to identify stakeholders outside the core IT/security team in the IR plan?", "options": ["To have more people to blame if things go wrong", "Because incidents can impact legal, HR, and public relations, requiring their involvement", "To increase the budget for the security team", "It is not important; IR should be kept within the security team"], "correct": 1, "explanation": "A significant incident is a business crisis, not just an IT problem. Involving legal, HR, and PR stakeholders is crucial for managing the business impact." },
                        { "id": 5, "question": "An IR team model with multiple teams for different business units, all reporting to a central coordinating body, is known as a:", "options": ["Centralized model", "Virtual model", "Distributed model", "Ad-hoc model"], "correct": 2, "explanation": "The distributed model is common in large, geographically or organizationally diverse companies where localized response is more efficient." }
                    ]
                }
            },
            {
                "id": "lesson-4-incident-classification",
                "title": "Lesson 4: Incident Classification and Severity",
                "duration": "120 min",
                "objectives": [
                    "Learn common incident categories based on attack vectors",
                    "Understand criteria for assessing the severity and business impact of an incident",
                    "Use a matrix to assign a priority level to an incident",
                    "Define thresholds for escalating an incident to leadership"
                ],
                "content": {
                    "overview": "Not all incidents are created equal. A proper classification and severity assessment process is critical for prioritizing response efforts, allocating the right resources, and ensuring that the most critical incidents receive immediate attention. This lesson covers how to categorize, assess, and prioritize incidents.",
                    "sections": [
                        {
                            "title": "Incident Categories and Types",
                            "content": "<p>Classifying incidents into categories provides a common language for tracking and reporting. It helps to quickly understand the nature of the threat. Most categorization schemes are based on the initial attack vector or the observed impact.</p><h3>Common Categories (based on NIST):</h3><ul><li><strong>Unauthorized Access:</strong> An individual gains logical or physical access to a system without permission. Includes credential abuse and privilege escalation.</li><li><strong>Denial of Service (DoS):</strong> An attack that prevents or impairs the normal authorized use of networks, systems, or applications.</li><li><strong>Malicious Code:</strong> The installation of malware such as a virus, worm, Trojan horse, or ransomware.</li><li><strong>Improper Usage:</strong> A person violates acceptable use policies.</li><li><strong>Scans/Probes/Attempted Access:</strong> Any activity that seeks to find and identify vulnerabilities. Often considered an 'event' until a compromise is confirmed.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Be Consistent</strong></div><p>Choose a categorization scheme and use it consistently. This will allow you to generate meaningful metrics later, such as 'Our top incident category last quarter was Malicious Code'.</p></div>",
                            "image": "https://images.unsplash.com/photo-1573497491208-6b1acb260507?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Severity Assessment Criteria",
                            "content": "<p>Severity assessment determines how serious the incident is. This is not just a technical exercise; it must be based on the actual or potential business impact.</p><h3>Key Assessment Criteria:</h3><ul><li><strong>Functional Impact:</strong> How much is the incident currently disrupting business operations? (e.g., Is one user affected, or is the entire company offline?)</li><li><strong>Informational Impact:</strong> What is the sensitivity of the data involved? (e.g., Was public information accessed, or was regulated PII or trade secrets stolen?)</li><li><strong>Recoverability:</strong> How difficult will it be to recover from the incident? (e.g., Can the system be restored from backup in an hour, or will it require a complete rebuild over several days?)</li><li><strong>Scope of the Breach:</strong> How many systems are affected? Has the attacker moved laterally?</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>It Can Change</strong></div><p>The initial severity assessment is a preliminary judgment. As the investigation progresses and you learn more about the incident's scope and impact, the severity level may need to be raised or lowered.</p></div>",
                            "image": "https://images.unsplash.com/photo-1516321497487-e288fb19713f?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Impact vs. Likelihood Matrix",
                            "content": "<p>A simple and effective way to formalize severity is to use a matrix that plots the potential impact against the likelihood or current scope. This helps to assign a clear priority level.</p><h3>Example Priority Levels:</h3><ul><li><strong>P1 (Critical):</strong> A high-impact incident that is actively in progress or has a widespread scope. Requires immediate, 24/7 response. <em>Example: A ransomware outbreak encrypting multiple servers.</em></li><li><strong>P2 (High):</strong> A high or medium-impact incident that has been contained or has a limited scope. Requires an urgent response during business hours. <em>Example: A single workstation infected with malware that has been isolated from the network.</em></li><li><strong>P3 (Medium):</strong> A medium or low-impact incident. <em>Example: A user reported a phishing email, but no one clicked the link.</em></li><li><strong>P4 (Low):</strong> A low-impact informational event. <em>Example: External port scan detected and blocked by the firewall.</em></li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Define Escalation Thresholds</strong></div><p>Your IR plan must clearly state what happens at each priority level. For example: 'All P1 incidents require the CISO and Legal Counsel to be notified immediately, regardless of the time of day.'</p></div>",
                            "image": "https://images.unsplash.com/photo-1542626991-cbc4e32524cc?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Severity Assessment Matrix Example",
                        "language": "markdown",
                        "code": "| Impact / Scope      | Limited (1 system)  | Department-wide     | Enterprise-wide      |\n|---------------------|---------------------|---------------------|----------------------|\n| **High (PII, downtime)**| P2 - High           | P1 - Critical       | P1 - Critical        |\n| **Medium (Internal data)** | P3 - Medium         | P2 - High           | P1 - Critical        |\n| **Low (Public data)**    | P4 - Low            | P3 - Medium         | P2 - High            |"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "An attacker defacing a company's public website is an example of which incident category?", "options": ["Denial of Service", "Improper Usage", "Unauthorized Access / Integrity Breach", "Scans/Probes"], "correct": 2, "explanation": "The attacker gained unauthorized access to modify the website's content, which is a breach of data integrity." },
                        { "id": 2, "question": "The sensitivity of the data involved in an incident (e.g., public data vs. regulated PII) is known as the:", "options": ["Functional Impact", "Recoverability", "Informational Impact", "Technical Scope"], "correct": 2, "explanation": "Informational Impact specifically assesses the confidentiality and sensitivity of the data that was accessed or stolen." },
                        { "id": 3, "question": "What is the primary purpose of assigning a severity level (e.g., P1, P2, P3) to an incident?", "options": ["To track time for billing purposes", "To decide which framework to use", "To prioritize the incident and allocate the appropriate level of resources", "To determine which analyst will investigate"], "correct": 2, "explanation": "Severity assessment and prioritization are crucial for managing limited resources and ensuring the most serious threats are dealt with immediately." },
                        { "id": 4, "question": "An active ransomware outbreak affecting the entire company's file servers would most likely be classified as what priority level?", "options": ["P4 (Low)", "P3 (Medium)", "P2 (High)", "P1 (Critical)"], "correct": 3, "explanation": "This has a high functional impact (enterprise-wide downtime) and high informational impact (data is inaccessible/potentially lost), making it a P1 Critical incident." },
                        { "id": 5, "question": "The initial severity assessment of an incident should be considered:", "options": ["Final and unchangeable", "A preliminary judgment that may change as more information is discovered", "Only a guess and should be ignored", "A task for the CEO to perform"], "correct": 1, "explanation": "The first responder makes a quick initial assessment. As the investigation reveals the true scope, the severity level must be re-evaluated and adjusted." }
                    ]
                }
            },
            {
                "id": "lesson-5-ir-policy",
                "title": "Lesson 5: IR Policy and Procedures",
                "duration": "120 min",
                "objectives": [
                    "Understand the difference between a policy, a standard, and a procedure",
                    "Learn the key components of a formal Incident Response Policy",
                    "Develop Standard Operating Procedures (SOPs) for specific incident types",
                    "Use flowcharts and decision trees to guide response actions"
                ],
                "content": {
                    "overview": "Formal documentation is the backbone of a mature incident response program. This lesson covers how to create the hierarchical documentation needed to guide your team, from a high-level policy that sets direction to detailed procedures that provide step-by-step instructions.",
                    "sections": [
                        {
                            "title": "IR Policy Development",
                            "content": "<p>An Incident Response Policy is a high-level, formal document that establishes the authority and framework for the IR program. It is the 'why' and the 'who'. It is not a technical document.</p><h3>Key Policy Components:</h3><ul><li><strong>Purpose and Scope:</strong> Defines why the policy exists and what systems, networks, and people it applies to.</li><li><strong>Roles and Responsibilities:</strong> Formally defines the CSIRT and key roles like the Incident Commander. Grants them the authority to act.</li><li><strong>Definition of an Incident:</strong> Establishes the official company definition of a security incident.</li><li><strong>Reporting Requirements:</strong> Mandates that all employees and contractors must report suspected incidents.</li><li><strong>Communication Plan:</strong> Outlines the requirements for communicating with leadership, stakeholders, and external parties.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Executive Approval</strong></div><p>The IR Policy must be approved by senior management (e.g., the CISO or CIO). This executive sign-off gives the IR team the official authority to take necessary actions during a crisis, such as taking a critical server offline.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Standard Operating Procedures (SOPs)",
                            "content": "<p>If the policy is the 'why', a Standard Operating Procedure (SOP) is the detailed 'how'. An SOP, also called a playbook or runbook, provides step-by-step instructions for handling a specific type of incident. They are critical for ensuring consistency and completeness.</p><h3>Example SOPs:</h3><ul><li><strong>Phishing Incident SOP:</strong> Steps to analyze a reported phishing email, identify other recipients, remove the email from inboxes, and block indicators.</li><li><strong>Malware Incident SOP:</strong> Steps to isolate an infected machine, identify the malware, determine its C2 channels, and safely remove it.</li><li><strong>DoS Attack SOP:</strong> Steps to identify the attack type, contact the upstream ISP for traffic filtering, and enable mitigation services.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Living Documents</strong></div><p>SOPs are not 'set it and forget it'. They must be regularly reviewed and updated based on lessons learned from real incidents and tabletop exercises.</p></div>",
                            "image": "https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Decision Trees and Flowcharts",
                            "content": "<p>For complex procedures, a visual flowchart or decision tree can be much easier for an analyst to follow under pressure than a wall of text. They map out the logical flow of an investigation, including key decision points.</p><h3>Example Decision Point:</h3><p>An analyst is investigating a suspicious login alert.</p><ul><li><strong>Start:</strong> A user logged in from a new country.</li><li><strong>Step 1:</strong> Is the user a known remote employee or currently traveling? (Check HR travel schedule).</li><li><strong>Decision (Yes):</strong> Contact the user to verify the login. If they confirm, document and close. If not, proceed to next step.</li><li><strong>Decision (No):</strong> Proceed to next step immediately.</li><li><strong>Step 2:</strong> Disable the user's account and reset their password.</li><li><strong>Step 3:</strong> Begin full compromised account investigation.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Keep Them Accessible</strong></div><p>SOPs and flowcharts are useless if no one can find them during a crisis. Store them in a centralized, well-known location like a company wiki or shared document repository that is accessible to the entire team.</p></div>",
                            "image": "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Documentation Hierarchy",
                        "language": "markdown",
                        "code": "1.  **Policy (High-Level, Mandatory):** 'We will respond to all security incidents in a structured manner.'\n2.  **Standard (Mandatory):** 'All incident response procedures must follow the SANS PICERL framework.'\n3.  **Procedure (SOP):** 'Step-by-step instructions for handling a ransomware incident.'\n4.  **Guideline (Recommended):** 'Best practices for collecting volatile memory from a compromised Windows host.'"
                    },
                    {
                        "title": "Phishing SOP (Simplified Pseudocode)",
                        "language": "bash",
                        "code": "# Triage: Is the reported email actually a phish?\n  # Analyze headers, links, and attachments.\n\n# Identification: Scope the incident.\n  # Search mail logs to find all other recipients.\n\n# Containment: Stop further damage.\n  # Remove the email from all recipient inboxes.\n  # Block sender, IP, and malicious domains.\n  # Check proxy/DNS logs: did anyone click the link?\n\n# Eradication/Recovery:\n  # If user clicked and entered credentials, force password reset.\n  # If user ran malware, trigger Malware Incident SOP.\n\n# Lessons Learned:\n  # Add indicators to threat intelligence.\n  # Use the phish as a template for user awareness training."
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "Which document is a high-level statement that grants the IR team the authority to act?", "options": ["Standard Operating Procedure (SOP)", "Incident Report", "IR Policy", "Network Diagram"], "correct": 2, "explanation": "The policy is the formal, management-approved document that establishes the IR program and gives the team its mandate." },
                        { "id": 2, "question": "A detailed, step-by-step guide for handling a specific event, like a malware infection, is called a:", "options": ["Policy", "Standard", "Standard Operating Procedure (SOP) / Playbook", "Guideline"], "correct": 2, "explanation": "An SOP (or playbook/runbook) provides the detailed 'how-to' instructions for a specific incident type." },
                        { "id": 3, "question": "What is the primary benefit of using a flowchart or decision tree in an SOP?", "options": ["They are easier to store", "They visually represent the workflow and help analysts make decisions under pressure", "They automatically update themselves", "They satisfy all legal requirements"], "correct": 1, "explanation": "Visual aids like flowcharts can significantly improve an analyst's ability to follow a complex procedure correctly during a stressful incident." },
                        { "id": 4, "question": "The statement 'All firewall change requests must be approved by two people' is an example of a:", "options": ["Procedure", "Guideline", "Policy or Standard", "Suggestion"], "correct": 2, "explanation": "This is a mandatory rule. Policies are high-level ('why'), standards are mandatory rules ('what'), and procedures are the step-by-step instructions ('how')." },
                        { "id": 5, "question": "IR policies, standards, and procedures should be:", "options": ["Written once and never changed", "Kept secret from everyone except the CISO", "Reviewed and updated regularly based on lessons learned and exercises", "As long and complicated as possible"], "correct": 2, "explanation": "These are living documents that must evolve as the organization and the threat landscape change." }
                    ]
                }
            },
            {
                "id": "lesson-6-ir-plan",
                "title": "Lesson 6: IR Plan Development",
                "duration": "120 min",
                "objectives": [
                    "Identify the essential components of a formal Incident Response Plan",
                    "Develop comprehensive contact lists and communication plans",
                    "Understand how to pre-plan resource allocation for an incident",
                    "Grasp the importance of testing and validating the plan"
                ],
                "content": {
                    "overview": "The Incident Response Plan is the central document that brings all the pieces of your program together. This lesson covers how to construct a comprehensive IR plan, from defining its structure and components to the critical processes of testing and validation.",
                    "sections": [
                        {
                            "title": "Plan Components and Structure",
                            "content": "<p>A formal IR Plan is the master document for the program. It references the IR Policy and provides the overarching strategy for incident handling. It should be structured for clarity and quick access during a crisis.</p><h3>Typical IR Plan Sections:</h3><ul><li><strong>1. Mission, Strategy, and Goals:</strong> States the purpose of the plan.</li><li><strong>2. Approach to Incident Response:</strong> Defines the framework to be used (e.g., NIST, SANS).</li><li><strong>3. Roles and Responsibilities:</strong> Defines the team and key stakeholders.</li><li><strong>4. Incident Response Phases:</strong> Details the organization's specific processes for each phase (Preparation, Identification, Containment, etc.).</li><li><strong>5. Communication Plan:</strong> Specifies who to contact, when, and how.</li><li><strong>6. Metrics and Reporting:</strong> Defines what will be tracked and how incidents will be reported.</li><li><strong>7. Appendices:</strong> Includes contact lists, severity matrices, network diagrams, etc.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Make It Actionable</strong></div><p>While comprehensive, the plan must be easy to use during an actual incident. Use clear headings, checklists, and visual aids. An overly complex, 100-page document will not be read during a crisis.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Contact Lists and Communication Plans",
                            "content": "<p>Knowing who to call is one of the most critical components of the plan. This information must be accurate, up-to-date, and readily available.</p><h3>What to Include:</h3><ul><li><strong>Internal Contacts:</strong> The full CSIRT, executive leadership, legal, HR, PR, heads of business units, and key IT personnel (network, server, database admins). Include names, titles, office phones, mobile phones, and primary/secondary email addresses.</li><li><strong>External Contacts:</strong> Key third parties like your ISP, managed security service provider (MSSP), external legal counsel, cyber insurance provider, and local law enforcement.</li></ul><h3>Communication Matrix:</h3><p>Define what triggers a communication. For example:</p><ul><li><strong>P1 Incident:</strong> Incident Commander must notify CISO and Legal Counsel by phone within 30 minutes of classification.</li><li><strong>Data Breach Confirmation:</strong> Legal Counsel must notify CEO and PR lead immediately.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Out-of-Band Communications</strong></div><p>What if your primary communication systems (like email and corporate chat) are compromised or unavailable during an incident? The plan must define a secure, out-of-band communication method, such as a dedicated Signal group or personal cell phone tree.</p></div>",
                            "image": "https://images.unsplash.com/photo-1587593673759-24b3b5e4a7a8?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Plan Testing and Validation",
                            "content": "<p>An untested plan is not a real plan. Regular testing is essential to ensure the plan works, the tools are ready, and the team is prepared to execute it.</p><h3>Methods for Testing:</h3><ul><li><strong>Plan Walk-through / Read-through:</strong> The simplest test. The team gets together and reads through the plan to check for errors and outdated information.</li><li><strong>Tabletop Exercise:</strong> The most common method. The team gathers in a room and works through a simulated incident scenario presented by a facilitator. The goal is to talk through the plan's steps and identify gaps in a no-fault environment.</li><li><strong>Functional Drill / Live Exercise:</strong> A hands-on test of a specific capability. For example, a drill to see if the team can actually acquire a forensic image from a server.</li><li><strong>Full-Scale Simulation:</strong> A realistic, unannounced exercise that may involve a 'red team' to simulate attackers. This is the most complex and mature form of testing.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>The Goal is Improvement</strong></div><p>The purpose of testing is not to pass or fail. The purpose is to find the weaknesses in your plan, processes, and tools so you can fix them *before* a real incident strikes.</p></div>",
                            "image": "https://images.unsplash.com/photo-1581092446346-b333a466a93b?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Communication Plan Matrix Example",
                        "language": "markdown",
                        "code": "| Event                             | Recipient(s)          | Method | Timing               |\n|-----------------------------------|-----------------------|--------|----------------------|\n| P1 Incident Declaration           | CISO, Legal Counsel   | Phone  | Within 30 minutes    |\n| Confirmed Data Breach (PII)       | CEO, PR, HR           | Email  | Within 1 hour        |\n| Incident Status Update            | Stakeholder Group     | Email  | Every 4 business hrs |\n| Incident Closure                  | All Involved          | Email  | At end of incident   |"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "The central, master document that outlines the entire incident response program and strategy is the:", "options": ["Standard Operating Procedure (SOP)", "Incident Response Plan", "Contact List", "Forensic Report"], "correct": 1, "explanation": "The IR Plan is the overarching document that governs the entire program and brings all the different components together." },
                        { "id": 2, "question": "What is the most critical reason for maintaining an up-to-date stakeholder contact list?", "options": ["For sending holiday cards", "To ensure rapid and effective communication during a crisis", "To track employee performance", "For creating an email distribution list"], "correct": 1, "explanation": "During an incident, time is of the essence. You cannot afford to waste time searching for contact information for key decision-makers and support personnel." },
                        { "id": 3, "question": "A discussion-based exercise where the IR team talks through their response to a simulated incident scenario is called a:", "options": ["Full-Scale Simulation", "Functional Drill", "Tabletop Exercise", "Plan Read-through"], "correct": 2, "explanation": "Tabletop exercises are the most popular method for testing an IR plan because they effectively reveal gaps in logic and process without requiring complex technical setups." },
                        { "id": 4, "question": "Why must an IR plan include a procedure for out-of-band communications?", "options": ["Because email is not a secure communication method", "To ensure the team can communicate even if corporate email and chat systems are compromised or unavailable", "To save money on phone bills", "For communicating with the media"], "correct": 1, "explanation": "Attackers may target communication systems. Having a pre-defined alternate channel (like Signal or a phone tree) is crucial for maintaining command and control." },
                        { "id": 5, "question": "The primary goal of testing an incident response plan is to:", "options": ["Assign blame for failures", "Find weaknesses in the plan so they can be fixed before a real incident", "Pass a compliance audit", "Impress executive leadership"], "correct": 1, "explanation": "The ultimate purpose of any exercise is to identify areas for improvement in a safe-to-fail environment." }
                    ]
                }
            },
            {
                "id": "lesson-7-ir-tools",
                "title": "Lesson 7: Tools and Technology Setup",
                "duration": "120 min",
                "objectives": [
                    "Identify the major categories of incident response tools",
                    "Understand the importance of preparing forensic and analysis tools in advance",
                    "Select and prepare secure communication and documentation platforms",
                    "Assemble a basic incident response toolkit"
                ],
                "content": {
                    "overview": "Having the right tools ready to go is a cornerstone of the preparation phase. This lesson covers the essential categories of software and hardware that form an incident responder's toolkit, from forensic imaging devices to analysis sandboxes and secure communication platforms.",
                    "sections": [
                        {
                            "title": "IR Tool Categories and Selection",
                            "content": "<p>Incident response relies on a wide range of tools. It's helpful to categorize them by their function within the IR lifecycle.</p><h3>The 'Go-Bag' Categories:</h3><ul><li><strong>Detection & Analysis:</strong> SIEM, EDR, IDS/IPS, Network Analyzers (e.g., Wireshark), Threat Intelligence Platforms.</li><li><strong>Forensics & Evidence Collection:</strong> Forensic imaging tools (e.g., FTK Imager, dd), memory capture tools (e.g., Volatility), write blockers (hardware devices that prevent altering a drive).</li><li><strong>Malware Analysis:</strong> Sandboxes (e.g., Cuckoo Sandbox, ANY.RUN), disassemblers (e.g., Ghidra), debuggers.</li><li><strong>Communication & Case Management:</strong> Ticketing systems (e.g., JIRA, TheHive), secure chat platforms, wikis for documentation.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Commercial vs. Open-Source</strong></div><p>There is a rich ecosystem of both commercial and open-source IR tools. Many teams use a combination. A key consideration is support; commercial tools typically offer dedicated support, while open-source tools rely on the community.</p></div>",
                            "image": "https://images.unsplash.com/photo-1510511233900-1982d92bd835?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Forensic Tool Preparation",
                            "content": "<p>When an incident strikes, you cannot start downloading tools onto a potentially compromised machine. A pre-approved and validated set of forensic tools must be ready on a trusted device, often a dedicated incident response laptop.</p><h3>Key Preparations:</h3><ul><li><strong>Dedicated IR Analysis Machine:</strong> A laptop or VM with all necessary analysis software pre-installed and updated. This machine should be hardened and isolated from the primary corporate network.</li><li><strong>Forensic 'Flyaway' Kit:</strong> A physical kit containing necessary hardware. This includes sterile (clean) USB drives and external hard drives, a hardware write blocker, network cables, and a bootable forensic Linux distribution (like SIFT or REMnux).</li><li><strong>Chain of Custody Forms:</strong> Have pre-printed chain of custody forms ready to document every piece of evidence you collect.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Hashing is Mandatory</strong></div><p>All of your pre-approved forensic tools should be cryptographically hashed (e.g., using SHA-256). Before using a tool on a system, you should re-hash it to ensure it hasn't been tampered with.</p></div>",
                            "image": "https://images.unsplash.com/photo-1593110022831-292911b3b194?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Communication and Evidence Platforms",
                            "content": "<p>How the team communicates and where they store their findings is just as important as the forensic tools they use. These platforms must be secure, reliable, and prepared in advance.</p><h3>Platform Choices:</h3><ul><li><strong>Case Management System:</strong> A dedicated platform for tracking incidents and evidence is highly recommended. Tools like TheHive or JIRA provide a central location for timelines, tasks, and artifacts, ensuring nothing is lost.</li><li><strong>Secure Communications:</strong> As mentioned before, a secure out-of-band communication channel is non-negotiable. This should be a platform that is completely separate from corporate infrastructure.</li><li><strong>Evidence Repository:</strong> A secure, access-controlled location for storing all collected evidence, such as disk images, memory captures, and malware samples. Access must be strictly logged and audited.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Don't Investigate on a Live, Compromised System</strong></div><p>The golden rule of forensics. Never perform analysis on the original system. You could alter evidence. Always acquire a forensic image or memory capture and perform your analysis on a separate, dedicated machine.</p></div>",
                            "image": "https://images.unsplash.com/photo-1531482615713-2c65a4494a52?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Creating a Disk Image with `dd` and a Write Blocker",
                        "language": "bash",
                        "code": "# Assume /dev/sdb is the suspect drive connected via a hardware write blocker.\n# Assume /dev/sdc is our sterile evidence drive.\n\n# 1. Verify the write blocker is working (attempt to write, should fail).\n\n# 2. Hash the suspect drive before imaging.\nsha256sum /dev/sdb > evidence_drive.sha256\n\n# 3. Create a bit-for-bit image of the drive.\n# The 'if' is the input, 'of' is the output. 'bs' is block size.\ndd if=/dev/sdb of=/media/evidence/drive_image.dd bs=4M conv=noerror,sync\n\n# 4. Hash the resulting image file.\nsha256sum /media/evidence/drive_image.dd >> evidence_drive.sha256\n\n# 5. Verify that the two hashes match to ensure a perfect copy was made."
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "A hardware device that prevents any data from being written to a hard drive during forensic acquisition is called a:", "options": ["Firewall", "Router", "Write Blocker", "Sandbox"], "correct": 2, "explanation": "A write blocker is an essential piece of hardware that ensures the integrity of the original evidence by making it physically impossible to alter." },
                        { "id": 2, "question": "What is the golden rule when it comes to analyzing a potentially compromised system?", "options": ["Perform all analysis on the original live system to save time", "Immediately turn the system off and on again", "Acquire a forensic image and analyze the copy on a separate, trusted machine", "Ask the user of the system to tell you what happened"], "correct": 2, "explanation": "Working on the original evidence risks contaminating it. The standard of care is to always work on a bit-for-bit copy." },
                        { "id": 3, "question": "A bootable Linux USB drive containing a suite of pre-installed forensic and IR tools is an example of:", "options": ["A business continuity plan", "A dedicated forensic environment", "A security policy", "A denial of service attack"], "correct": 1, "explanation": "Distributions like SIFT, Tsurugi, or REMnux are purpose-built, trusted environments for performing forensic analysis." },
                        { "id": 4, "question": "The primary purpose of using a case management system like TheHive during an incident is to:", "options": ["Automatically contain the threat", "Send emails to executives", "Provide a centralized platform for tracking tasks, evidence, and timelines", "Analyze malware samples"], "correct": 2,
                         "explanation": "A case management system provides the workflow and documentation hub for the entire incident, ensuring a coordinated and well-documented response." },
                        { "id": 5, "question": "Why is it important to cryptographically hash your forensic tools before an incident?", "options": ["To make the tools run faster", "To prove the integrity of your tools and ensure they haven't been tampered with", "To encrypt the evidence you collect", "To comply with software licensing"], "correct": 1, "explanation": "In a legal proceeding, you may need to prove that the tools you used were valid and unaltered. Hashing provides this proof of integrity." }
                    ]
                }
            },
            {
                "id": "lesson-8-training-awareness",
                "title": "Lesson 8: Training and Awareness",
                "duration": "120 min",
                "objectives": [
                    "Understand the importance of continuous training for the IR team",
                    "Learn how to design and conduct effective tabletop exercises",
                    "Develop realistic simulation scenarios to test specific skills",
                    "Explore methods for assessing and tracking the team's skills and readiness"
                ],
                "content": {
                    "overview": "A plan and tools are useless without a well-trained team to execute. This lesson focuses on the human element of incident response: how to train the core IR team, practice the plan through realistic exercises, and ensure that your responders are ready for a real-world crisis.",
                    "sections": [
                        {
                            "title": "IR Team Training Programs",
                            "content": "<p>Incident response is a highly skilled profession that requires continuous learning to keep up with evolving threats. A formal training program is a key part of the 'Preparation' phase.</p><h3>Training Areas:</h3><ul><li><strong>Technical Training:</strong> Deep-dive courses on specific tools (e.g., SIEM, EDR), forensic techniques (memory, network, host), malware analysis, and cloud platforms. Industry certifications like GCIH or GCFA are common goals.</li><li><strong>Procedural Training:</strong> Regular sessions to review the IR plan and all SOPs. Everyone must know the established procedures by heart.</li><li><strong>Cross-Training:</strong> Encouraging team members to learn the basics of other roles. A network analyst should understand basic host forensics, and vice versa. This builds a more resilient team.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Attend Conferences and Workshops</strong></div><p>Cybersecurity is a community. Encourage your team to attend conferences and workshops to learn about the latest attack techniques and defensive strategies from peers in the industry.</p></div>",
                            "image": "https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Tabletop Exercise Design",
                            "content": "<p>A tabletop exercise is a guided, discussion-based simulation where the IR team and stakeholders talk through their response to a hypothetical incident. It is the single most effective way to validate your IR plan and team coordination.</p><h3>Designing an Effective Tabletop:</h3><ol><li><strong>Set Clear Objectives:</strong> What do you want to test? (e.g., 'Test our internal communication plan' or 'Validate our ransomware SOP').</li><li><strong>Develop a Realistic Scenario:</strong> Create a plausible scenario relevant to your organization. The scenario should unfold in stages ('injects') to mimic a real investigation.</li><li><strong>Identify Participants:</strong> Include the entire core IR team and representatives from key stakeholder groups (Legal, PR, etc.).</li><li><strong>Appoint a Facilitator:</strong> A skilled facilitator is key. They guide the discussion, introduce new injects ('The CEO is asking for an update, what do you tell her?'), and keep the exercise on track.</li><li><strong>Conduct a 'No-Fault' Post-mortem:</strong> The goal is to learn, not to blame. After the exercise, discuss what went well and what needs improvement.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Start Simple</strong></div><p>Your first tabletop exercise doesn't need to be a complex, multi-day affair. Start with a simple, two-hour exercise focused on a single scenario, like a reported phishing email, and build from there.</p></div>",
                            "image": "https://images.unsplash.com/photo-1543269865-cbf427effbad?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Simulation Scenarios",
                            "content": "<p>To test technical skills, hands-on simulations are required. These can range from small drills to full-scale, adversarial 'red team vs. blue team' exercises.</p><h3>Types of Simulations:</h3><ul><li><strong>Functional Drills:</strong> Small-scale, hands-on tests of a specific tool or procedure. <em>Example: 'Today, we will practice acquiring and hashing a disk image from a live server.'</em></li><li><strong>Cyber Ranges:</strong> A dedicated, virtualized environment where the team can practice responding to simulated attacks in a safe sandbox without impacting the production network.</li><li><strong>Adversary Emulation:</strong> A practice where the security team (the 'blue team') tries to detect and respond to an internal attack team (the 'red team') that is actively emulating the TTPs of a real-world threat actor.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Focus on Process, Not Just Tools</strong></div><p>Even in a technical simulation, the goal is not just to test a tool, but to test the human process around it. Can the analyst not only *run* the memory capture tool but also *document* the evidence correctly and *communicate* their findings effectively?</p></div>",
                            "image": "https://images.unsplash.com/photo-1614064548237-02f8f17374b2?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Tabletop Exercise Inject Example",
                        "language": "markdown",
                        "code": "**Scenario:** Ransomware Incident\n\n*   **Inject 1 (10:00 AM):** The help desk reports that multiple users in the finance department cannot open any files on the main file server. The files have a `.L0CKED` extension.\n    *   _Question to team: What are your immediate first responder actions? Who do you notify?_ \n\n*   **Inject 2 (10:30 AM):** A forensic analyst finds a ransom note on the server. The note demands $1 million in Bitcoin. At the same time, a reporter from a major news outlet contacts your PR department asking about a 'rumored cyber attack'.\n    *   _Question to team: What is your containment strategy? How does the Comms Lead respond to the reporter?_"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary purpose of conducting a tabletop exercise?", "options": ["To test the performance of network hardware", "To practice writing code", "To validate the IR plan and identify process gaps in a discussion-based setting", "To assign blame for security failures"], "correct": 2, "explanation": "A tabletop exercise is designed to be a safe, 'no-fault' environment where the team can talk through a scenario to find and fix weaknesses in their plans and procedures." },
                        { "id": 2, "question": "A hands-on, competitive exercise where a 'blue team' defends against a live 'red team' is called:", "options": ["A plan walk-through", "A policy review", "Adversary Emulation", "A business impact analysis"], "correct": 2, "explanation": "Adversary emulation, or red team vs. blue team exercises, are a mature form of testing that provides a highly realistic simulation of an attack." },
                        { "id": 3, "question": "In a tabletop exercise, what is the role of the facilitator?", "options": ["To take notes and nothing else", "To act as the Incident Commander", "To guide the discussion, introduce new information (injects), and keep the exercise focused", "To represent the legal department"], "correct": 2, "explanation": "A skilled, neutral facilitator is crucial for keeping the exercise moving and ensuring that its objectives are met." },
                        { "id": 4, "question": "Why is cross-training important for an IR team?", "options": ["It makes the team more resilient if a key member is unavailable", "It ensures everyone gets the same salary", "It is a compliance requirement for all regulations", "It is not important"], "correct": 0, "explanation": "Cross-training builds depth. If your only network forensics expert is on vacation when an incident strikes, a host forensics analyst with some network cross-training is invaluable." },
                        { "id": 5, "question": "The 'no-fault' post-mortem after an exercise is designed to:", "options": ["Determine which team members should be fired", "Focus on improving processes and plans, not blaming individuals", "Write a report for the marketing team", "Decide on a new firewall vendor"], "correct": 1, "explanation": "A successful debrief requires a culture of trust where team members can speak openly about challenges and mistakes without fear of punishment, all in the name of process improvement." }
                    ]
                }
            },
            {
                "id": "lesson-9-detection-methods",
                "title": "Lesson 9: Incident Detection Methods",
                "duration": "120 min",
                "objectives": [
                    "Understand how automated systems like SIEM and EDR detect incidents",
                    "Learn about manual detection techniques used in threat hunting",
                    "Recognize the importance of third-party and user-generated reports",
                    "Configure basic detection alerts in a lab environment"
                ],
                "content": {
                    "overview": "The 'Detection and Analysis' phase begins when an organization learns that an incident may have occurred. This lesson explores the various ways potential incidents are brought to light, from sophisticated automated security systems to a simple phone call from a vigilant employee.",
                    "sections": [
                        {
                            "title": "Automated Detection Systems",
                            "content": "<p>Most modern security incidents are first detected by specialized security tools designed to find anomalous or malicious activity. These form the foundation of a Security Operations Center (SOC).</p><h3>Key Detection Tools:</h3><ul><li><strong>SIEM (Security Information and Event Management):</strong> Correlates logs from across the enterprise to find suspicious patterns. <em>Example: Detects 100 failed logins followed by a success from a new country.</em></li><li><strong>EDR (Endpoint Detection and Response):</strong> Monitors activity directly on endpoints (laptops, servers) to detect malicious processes and behaviors. <em>Example: Detects Microsoft Word spawning a PowerShell process.</em></li><li><strong>IDS/IPS (Intrusion Detection/Prevention System):</strong> Analyzes network traffic for known attack signatures. <em>Example: Detects a packet matching a known SQL injection pattern.</em></li><li><strong>Network Security Monitoring (NSM):</strong> Tools like Zeek analyze network traffic to find anomalies. <em>Example: Detects DNS tunneling activity.</em></li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Alert Fidelity</strong></div><p>A key challenge is 'alert fatigue'. These systems can generate thousands of alerts per day. The 'analysis' part of this phase is crucial for sorting through the noise to find the high-fidelity alerts that indicate a real incident.</p></div>",
                            "image": "https://images.unsplash.com/photo-1614064548237-02f8f17374b2?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Manual Detection Techniques",
                            "content": "<p>Some advanced threats are designed to evade automated defenses. Manual detection, often called 'threat hunting', is a proactive process where skilled analysts search for signs of compromise that have not triggered an automated alert.</p><h3>Threat Hunting Examples:</h3><ul><li><strong>Hypothesis-Driven Search:</strong> An analyst reads a threat intelligence report about a new technique and forms a hypothesis: 'If attackers are using this technique, I would see X in my DNS logs'. They then proactively search for X.</li><li><strong>Anomaly Detection:</strong> Using statistical analysis or visualization to find outliers. For example, looking for the rarest user-agent strings in proxy logs or the process names that occur on the fewest number of machines.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Proactive vs. Reactive</strong></div><p>Automated detection is reactive; it responds to alerts that have already fired. Threat hunting is proactive; it actively seeks out hidden threats, assuming a breach has already occurred.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542831371-d531d209121f?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Third-Party and User Reporting",
                            "content": "<p>Not all detections come from internal tools. Sometimes the first notification of a breach comes from an outside source.</p><h3>External and Internal Sources:</h3><ul><li><strong>User Reporting:</strong> This is a critical and often overlooked detection source. A user reporting a suspicious email, a slow computer, or a strange pop-up can be the first sign of a major incident. A clear, easy-to-use reporting process is essential.</li><li><strong>Third-Party Notifications:</strong> An external entity notifies you of a problem. This could be law enforcement (like the FBI), a security researcher who discovered a vulnerability, or even a customer who found their data exposed.</li><li><strong>Public Disclosures:</strong> Finding your company's data for sale on a dark web forum.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Train Your Users</strong></div><p>Your employees can be your best sensors. A robust security awareness program that teaches users how to spot and report phishing and other suspicious activity is one of the best investments you can make in incident detection.</p></div>",
                            "image": "https://images.unsplash.com/photo-1550087752-92b3f1140e6c?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Example SIEM Alert Logic (Pseudocode)",
                        "language": "sql",
                        "code": "# Alert for Impossible Travel\nALERT impossible_travel on (index=authentication status=success)\n\n# Get the time and location of the user's last successful login\nlast_login = lookup_last_login(user)\n\n# Calculate distance and time difference\ndistance = geo_distance(current_login.location, last_login.location)\ntime_diff = current_login.time - last_login.time\nspeed = distance / time_diff\n\n# If the calculated speed is > 700 mph, trigger the alert\nIF speed > 700 THEN CREATE 'High Priority Alert'"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "A system that correlates logs from many different sources to find suspicious patterns is called a(n):", "options": ["EDR", "IDS", "SIEM", "NSM"], "correct": 2, "explanation": "A SIEM (Security Information and Event Management) is a log aggregation and correlation platform, providing a central view of security data." },
                        { "id": 2, "question": "Proactively searching through data for hidden threats that haven't triggered an automated alert is known as:", "options": ["Alert Triage", "Incident Reporting", "Threat Hunting", "Patch Management"], "correct": 2, "explanation": "Threat hunting is a human-driven, proactive practice that complements automated detection systems." },
                        { "id": 3, "question": "Which of the following is a critical but often overlooked source of incident reports?", "options": ["The company CEO", "Vigilant employees reporting suspicious activity", "Security vendors", "The finance department"], "correct": 1, "explanation": "End users are on the front lines and can often be the first to notice something is wrong. A strong security awareness culture encourages this reporting." },
                        { "id": 4, "question": "An EDR (Endpoint Detection and Response) tool provides visibility into what?", "options": ["The company's cloud configuration", "Activity happening on the corporate network", "Activity happening directly on endpoints like laptops and servers", "The company's financial records"], "correct": 2,
                         "explanation": "EDR's strength is providing deep, host-level telemetry, such as which process made a network connection or which file was modified." },
                        { "id": 5, "question": "A notification from the FBI that your company's IP addresses are involved in a botnet is an example of what kind of detection?", "options": ["Automated Detection", "Threat Hunting", "User Reporting", "Third-Party Notification"], "correct": 3, "explanation": "This is a classic example of being notified of a compromise by an external third party." }
                    ]
                }
            },
            {
                "id": "lesson-10-triage",
                "title": "Lesson 10: Initial Assessment and Triage",
                "duration": "120 min",
                "objectives": [
                    "Define the role and actions of a first responder",
                    "Learn how to perform a rapid initial impact assessment",
                    "Understand the importance of immediate evidence preservation",
                    "Know when and how to mobilize additional resources"
                ],
                "content": {
                    "overview": "Once a potential incident is detected, the clock starts ticking. This lesson covers the critical first steps of triage and initial assessment. A first responder must quickly determine if a detected event is a real incident, assess its initial scope and impact, and preserve evidence, all while avoiding actions that could tip off an attacker or destroy forensic data.",
                    "sections": [
                        {
                            "title": "First Responder Actions",
                            "content": "<p>A first responder (often a Tier 1 SOC analyst) is the first person to analyze a new alert. Their actions in the first few minutes are critical and should follow a defined procedure.</p><h3>Initial Checklist:</h3><ol><li><strong>Create a Case/Ticket:</strong> Start the documentation process immediately. Log every action you take with a timestamp.</li><li><strong>Validate the Alert:</strong> Is this a real incident or a false positive? This involves enriching the alert with other data. For example, if an IP is flagged by threat intelligence, check firewall and proxy logs to see if it actually connected to your network.</li><li><strong>Assess Scope:</strong> Identify the user(s) and asset(s) involved. Is it one machine or many? Is it a regular user account or an administrator?</li><li><strong>Preserve Evidence:</strong> Take immediate steps to preserve volatile data before it is lost.</li><li><strong>Escalate:</strong> Based on the initial findings, classify the incident's severity and escalate to the appropriate person (e.g., a senior analyst or the Incident Commander) as defined in the IR plan.</li></ol><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Don't Play Hero</strong></div><p>The first responder's job is not to fully solve the incident. Their job is to perform a rapid initial analysis, secure the scene, and escalate. Premature or unauthorized containment actions can make the situation worse.</p></div>",
                            "image": "https://images.unsplash.com/photo-1618498263386-339c9a7593c6?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Initial Impact Assessment",
                            "content": "<p>This is a rapid, preliminary assessment of the incident's business impact to inform the severity level and guide initial response priorities. It's based on the questions asked during triage.</p><h3>Key Questions:</h3><ul><li><strong>Who is affected?</strong> Is it a single user, a department, or the whole company? Are customers affected?</li><li><strong>What systems are affected?</strong> Are they critical production systems or low-impact user workstations?</li><li><strong>What is the nature of the data involved?</strong> Is sensitive or regulated data at risk?</li><li><strong>What is the current operational impact?</strong> Are business processes currently down?</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Initial vs. Detailed Assessment</strong></div><p>This initial assessment should take minutes, not hours. It provides the information needed for prioritization. A more detailed business impact analysis will be performed later in the investigation.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542337829-9173cace55f1?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Evidence Preservation",
                            "content": "<p>Evidence, especially digital evidence, is volatile. Some data (like the contents of memory) can be lost with a simple reboot. The first responder must prioritize preserving this data.</p><h3>Order of Volatility:</h3><p>Collect evidence starting with the most volatile and moving to the least volatile.</p><ol><li><strong>Memory (RAM):</strong> Contains running processes, network connections, command history. Highly volatile.</li><li><strong>System and Process State:</strong> Who is logged in, what network ports are open.</li><li><strong>Network Traffic:</strong> Active connections and packet captures.</li><li><strong>File System Data:</strong> Files on the hard drive. Data in the Recycle Bin or temporary directories is more volatile than standard files.</li><li><strong>Archived Logs and Backups:</strong> Least volatile.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Don't Reboot!</strong></div><p>Unless part of a specific containment strategy approved by the Incident Commander, do not reboot a compromised machine. You will destroy all the volatile memory evidence, which may be the only place the attacker's tools reside (in the case of fileless malware).</p></div>",
                            "image": "https://images.unsplash.com/photo-1593110022831-292911b3b194?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Triage Analyst Documentation Snippet",
                        "language": "markdown",
                        "code": "## Case IR-2023-087: Suspicious PowerShell Alert ##\n\n- **14:05 UTC:** Alert received from EDR. `powershell.exe` spawned from `winword.exe` on host `FIN-LT-123`.\n- **14:07 UTC:** Validated alert. This is a highly anomalous parent-child relationship.\n- **14:10 UTC:** Enriched host data. `FIN-LT-123` belongs to user Jane Doe in the Finance dept.\n- **14:12 UTC:** Checked proxy logs. Host made connection to `http://evil-domain.com/payload.ps1` 2 minutes before the alert.\n- **14:15 UTC:** Initial Assessment: Confirmed incident. Probable malicious macro execution.\n- **14:16 UTC:** Escalated to Senior Analyst (P2 High priority) and recommended immediate host isolation via EDR."
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the very first step a first responder should take when they begin working on a new alert?", "options": ["Reboot the affected machine", "Call the CEO", "Create a ticket and start documenting their actions", "Run a vulnerability scan"], "correct": 2, "explanation": "The documentation trail must start the moment the investigation begins. Creating a ticket or case file is step one." },
                        { "id": 2, "question": "The 'order of volatility' dictates that you should collect which type of evidence first?", "options": ["Data from hard drives", "Logs from the SIEM", "Data from system memory (RAM)", "Backup tapes"], "correct": 2, "explanation": "Memory is the most volatile and will be lost on a reboot, so it must be captured first to preserve evidence of running processes and network connections." },
                        { "id": 3, "question": "The primary goal of the initial assessment and triage phase is to:", "options": ["Determine the incident's root cause and attribute it to an attacker", "Write a final report for regulators", "Quickly validate an alert, assess its impact for prioritization, and escalate appropriately", "Eradicate the malware from all systems"], "correct": 2, "explanation": "Triage is about making fast, informed decisions to understand the 'what' and 'how bad' so that the response can be prioritized correctly." },
                        { "id": 4, "question": "Why is it a bad idea to prematurely reboot a compromised system during an investigation?", "options": ["It can take a long time to start up again", "It will erase volatile memory evidence, which might be the only trace of the attacker", "It will automatically patch the system", "It will alert the user that something is wrong"], "correct": 1,
                         "explanation": "Many modern threats are 'fileless' and exist only in memory. A reboot will wipe this evidence, making the investigation much harder, if not impossible." },
                        { "id": 5, "question": "Determining if a system belongs to the CEO or an intern is part of which triage activity?", "options": ["Evidence Preservation", "Initial Impact Assessment", "Escalation", "Final Reporting"], "correct": 1, "explanation": "Assessing the 'who' and 'what' of the affected assets is a key part of the initial impact assessment to understand the business risk." }
                    ]
                }
            },
            {
                "id": "lesson-11-forensics-fundamentals",
                "title": "Lesson 11: Digital Forensics Fundamentals",
                "duration": "150 min",
                "objectives": [
                    "Understand proper evidence handling and documentation procedures",
                    "Define and maintain the chain of custody for all evidence",
                    "Learn techniques for creating forensically sound disk images",
                    "Recognize legal requirements for evidence to be admissible in court"
                ],
                "content": {
                    "overview": "Digital forensics is the science of collecting, preserving, and analyzing digital evidence in a way that is legally defensible. This lesson covers the fundamental principles that every incident responder must know to ensure that the evidence they collect is not contaminated and will stand up to scrutiny.",
                    "sections": [
                        {
                            "title": "Evidence Handling Procedures",
                            "content": "<p>Proper evidence handling ensures the integrity of the evidence from collection to courtroom. Every action taken must be deliberate and documented.</p><h3>Core Principles:</h3><ul><li><strong>Preserve the Original:</strong> Always work on a forensic copy, never the original evidence. The original should be secured in a safe, access-controlled location.</li><li><strong>Document Everything:</strong> Keep a detailed log of every person who handled the evidence, every action taken, and the date/time of each action.</li><li><strong>Prove Integrity:</strong> Use cryptographic hashing (e.g., SHA-256) to create a digital 'fingerprint' of the original evidence and your forensic copy. If the hashes match, you can prove your copy is an exact replica.</li><li><strong>Use Trusted Tools:</strong> Use well-known, validated forensic tools for all collection and analysis.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Think Like a Scientist</strong></div><p>Digital forensics is a scientific process. You form a hypothesis, you gather data, you analyze the data, and you reach a conclusion, all while documenting your steps so that another examiner could reproduce your results.</p></div>",
                            "image": "https://images.unsplash.com/photo-1526374965328-7f61d4e18c66?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Chain of Custody",
                            "content": "<p>The chain of custody is the single most important document in forensics. It is a formal record that shows the complete history of the evidence, from the moment it was collected to the moment it is presented in court. A broken chain of custody can make evidence inadmissible.</p><h3>What to Record on the Form:</h3><ul><li>A unique evidence item number.</li><li>A detailed description of the item (e.g., 'Seagate 1TB HDD, model ST1000, serial #XYZ').</li><li>The exact date and time it was collected.</li><li>The exact location where it was found.</li><li>The name and signature of the person who collected it.</li><li>Every time the evidence is transferred to another person or location, an entry must be made with the names, signatures, date, and time.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>It's a Log of People</strong></div><p>The chain of custody tracks the people who have had physical or logical control over the evidence. This proves that it was never left unattended or handled by an unauthorized person.</p></div>",
                            "image": "https://images.unsplash.com/photo-1589998059171-988d887df646?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Forensic Imaging Techniques",
                            "content": "<p>A forensic image is a bit-for-bit, sector-by-sector copy of a storage device. It includes all files, deleted files, and unallocated space. This is different from a simple backup, which only copies active files.</p><h3>The Imaging Process:</h3><ol><li><strong>Use a Write Blocker:</strong> Connect the original drive (the 'suspect' drive) to your forensic workstation via a hardware write blocker. This is mandatory.</li><li><strong>Use a Sterile Evidence Drive:</strong> The drive where you will store the image must be forensically 'wiped' (overwritten with zeros) before use.</li><li><strong>Create Hashes:</strong> Calculate the hash of the original suspect drive before you begin.</li><li><strong>Acquire the Image:</strong> Use a tool like FTK Imager or `dd` to perform the bit-for-bit copy.</li><li><strong>Verify Hashes:</strong> After the copy is complete, calculate the hash of the image file you created. It must match the hash of the original drive. This proves your copy is an exact duplicate.</li><li><strong>Document:</strong> Record all steps, tools used, and hash values in your case notes.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Live vs. Dead-box Forensics</strong></div><p>The process above describes 'dead-box' forensics, where the machine is powered off. For live systems, a 'live response' is needed to capture volatile memory *before* powering the system down to create the disk image.</p></div>",
                            "image": "https://images.unsplash.com/photo-1593110022831-292911b3b194?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Example Chain of Custody Form Entry",
                        "language": "markdown",
                        "code": "| Date/Time       | Evidence ID   | Description                  | Collected By | Transferred To | Purpose       |\n|-----------------|---------------|------------------------------|--------------|----------------|---------------|\n| 2023-08-08 14:30| IR-2023-087-01| Dell Laptop, S/N: ABC123     | Bob Smith    |                | Collection    |\n| 2023-08-08 16:00| IR-2023-087-01| Dell Laptop, S/N: ABC123     | Bob Smith    | Evidence Locker| Secure Storage|\n| 2023-08-09 09:00| IR-2023-087-01| Dell Laptop, S/N: ABC123     | Alice Jones  |                | Analysis      |"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary purpose of a chain of custody document?", "options": ["To track how much time was spent on an investigation", "To create a legal record of who handled the evidence at all times", "To store the password for the evidence container", "To list the files found on a hard drive"], "correct": 1, "explanation": "The chain of custody provides a verifiable record that proves the evidence has been properly secured and handled from collection to court." },
                        { "id": 2, "question": "What is the most important difference between a forensic image and a standard backup?", "options": ["The forensic image is smaller", "A backup is faster to create", "A forensic image is a bit-for-bit copy that includes deleted files and unallocated space", "A backup is encrypted by default"], "correct": 2, "explanation": "Forensic images are exact replicas that are necessary to recover deleted data and other artifacts that backups would miss." },
                        { "id": 3, "question": "What is the main reason for using a hardware write blocker when creating a forensic image?", "options": ["To speed up the copy process", "To prevent accidental modification of the original evidence", "To encrypt the image file", "To compress the image file"], "correct": 1, "explanation": "A write blocker ensures that the forensic process does not alter the original drive in any way, which is fundamental to preserving the integrity of the evidence." },
                        { "id": 4, "question": "Using SHA-256 to create a unique digital fingerprint of a file or a disk is known as:", "options": ["Encrypting", "Hashing", "Compressing", "Deleting"], "correct": 1,
                         "explanation": "Hashing creates a unique, fixed-size string from a piece of data. It is used to verify the integrity of evidence by comparing the hash of the original to the hash of the copy." },
                        { "id": 5, "question": "Legally, if the chain of custody for a piece of evidence is broken:", "options": ["The case is automatically won", "The evidence may be considered contaminated and inadmissible in court", "The investigator receives a promotion", "Nothing happens"], "correct": 1, "explanation": "A broken or incomplete chain of custody creates doubt about the integrity of the evidence, which is often grounds for a judge to exclude it from the legal proceedings." }
                    ]
                }
            },
            {
                "id": "lesson-12-malware-analysis",
                "title": "Lesson 12: Malware Analysis Basics",
                "duration": "150 min",
                "objectives": [
                    "Differentiate between static and dynamic malware analysis",
                    "Understand how to set up a safe sandbox environment",
                    "Analyze malware behavior to understand its capabilities",
                    "Extract Indicators of Compromise (IOCs) for wider detection and blocking"
                ],
                "content": {
                    "overview": "To effectively eradicate a threat, you must understand it. This lesson introduces the basics of malware analysis, covering the two primary methods for dissecting malicious software to determine what it does, how it works, and how to detect it elsewhere in your environment.",
                    "sections": [
                        {
                            "title": "Static vs. Dynamic Analysis",
                            "content": "<p>Malware analysis is generally divided into two main approaches. They are often used together to build a complete picture of the malware.</p><h3>The Two Approaches:</h3><ul><li><strong>Static Analysis:</strong> Analyzing the malware sample without actually running it. This is the safer first step. Techniques include examining the file's strings (for readable text like IP addresses or messages), looking at its metadata, and running it through a disassembler to inspect its code.</li><li><strong>Dynamic Analysis:</strong> Running the malware in a safe, isolated environment (a 'sandbox') to observe its behavior. This shows what the malware *does* when it executes: what files it creates, what registry keys it modifies, what network connections it makes.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Start with Static</strong></div><p>Static analysis is always the first step. It's fast, safe, and can often give you enough information (like C2 domains) to begin containment actions immediately, even before you take the time to run a full dynamic analysis.</p></div>",
                            "image": "https://images.unsplash.com/photo-1547756536-cde55c3f2c65?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Sandbox Environment Setup",
                            "content": "<p>Dynamic analysis must *never* be done on a production machine or your corporate network. It requires a dedicated, isolated sandbox environment to safely contain the malware.</p><h3>Sandbox Requirements:</h3><ul><li><strong>Isolation:</strong> The sandbox must be completely isolated from your corporate network and the internet (or have its internet access routed through a special, monitored proxy). This is often achieved using a virtual machine with its network adapter in a 'host-only' or 'NAT' mode.</li><li><strong>Instrumentation:</strong> The sandbox needs tools to monitor the malware's activity. This includes process monitors (like ProcMon), registry snapshot tools, and network packet capture tools (like Wireshark).</li><li><strong>Clean Snapshots:</strong> Before running the malware, you take a 'clean' snapshot of the virtual machine. After the analysis is complete, you can instantly revert to this clean state, wiping all traces of the malware.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Automated Sandboxes</strong></div><p>Tools like Cuckoo Sandbox automate this entire process. You submit a malware sample, and it automatically runs it in a clean VM, collects all the behavioral data, and provides a comprehensive report.</p></div>",
                            "image": "https://images.unsplash.com/photo-1593064390382-2c63824f5a83?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Behavioral Analysis Techniques",
                            "content": "<p>When you run malware in a sandbox, you are looking for common malicious behaviors that reveal the malware's purpose.</p><h3>What to Look For:</h3><ul><li><strong>Persistence Mechanisms:</strong> How does the malware ensure it runs again after a reboot? Look for the creation of new scheduled tasks, services, or registry 'Run' keys.</li><li><strong>Network Callbacks (C2):</strong> Does the malware try to connect to an external command-and-control (C2) server? Capture the IP address, domain name, and protocol used.</li><li><strong>File System Changes:</strong> What files does it create, modify, or delete? Does it drop other malicious files?</li><li><strong>Defense Evasion:</strong> Does the malware try to detect if it's running in a VM? Does it try to disable security software?</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Be Patient</strong></div><p>Some malware is designed to be evasive. It might 'sleep' for a period of time before executing its main payload to evade automated sandboxes that only run for a few minutes.</p></div>",
                            "image": "https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "IOC Extraction Methods",
                            "content": "<p>The primary goal of malware analysis during an incident is to extract Indicators of Compromise (IOCs). These are the technical artifacts that can be used to find and block the malware elsewhere in the environment.</p><h3>Key IOCs to Extract:</h3><ul><li><strong>File Hashes (MD5, SHA-256):</strong> The cryptographic fingerprint of the malware file(s).</li><li><strong>C2 IP Addresses and Domains:</strong> The network locations the malware communicates with.</li><li><strong>Registry Keys:</strong> Persistence or configuration keys created by the malware.</li><li><strong>Mutexes:</strong> A 'mutually exclusive object' the malware creates in memory to ensure only one instance of itself is running.</li><li><strong>File Names/Paths:</strong> Specific files created or modified by the malware.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Feed the Machine</strong></div><p>Once extracted, these IOCs are fed back into your security tools. The C2 IPs are blocked at the firewall, the file hashes are added to your EDR's blocklist, and the SIEM is used to search for any other systems communicating with the malicious domains.</p></div>",
                            "image": "https://images.unsplash.com/photo-1563905788977-62b714f520b2?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Static Analysis with `strings`",
                        "language": "bash",
                        "code": "# The 'strings' command prints all human-readable text from a binary file.\n# This can reveal hard-coded domains, IPs, file paths, or messages.\n\nstrings malware.exe | grep -i 'http://'\nstrings malware.exe | grep -E '[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}'"
                    },
                    {
                        "title": "IOC Summary Report (Example)",
                        "language": "markdown",
                        "code": "## Malware Analysis Report: Trojan.Generic.123 ##\n\n- **File Hashes:**\n  - MD5: 123abc...\n  - SHA256: 456def...\n- **Network IOCs:**\n  - C2 Domain: `update.evil-domain.net`\n  - C2 IP: `1.2.3.4`\n  - User-Agent: `Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36`\n- **Host IOCs:**\n  - Persistence: `HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run\\WindowsUpdate`\n  - File Created: `C:\\Users\\Admin\\AppData\\Local\\Temp\\updater.exe`\n  - Mutex: `Global\\MyMutex123`"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "Running malware in an isolated VM to see what it does is known as:", "options": ["Static Analysis", "Dynamic Analysis", "Threat Hunting", "Forensic Imaging"], "correct": 1, "explanation": "Dynamic analysis involves executing the code in a controlled environment to observe its behavior." },
                        { "id": 2, "question": "What is the primary reason for using a 'clean snapshot' in a malware analysis VM?", "options": ["To ensure the malware has the latest updates", "To easily revert the VM to its original, uninfected state after analysis", "To back up the malware sample", "To improve the VM's network speed"], "correct": 1, "explanation": "Snapshots allow you to instantly clean and reset your analysis environment for the next sample without having to rebuild the VM from scratch." },
                        { "id": 3, "question": "Looking at the readable text inside a malware binary without running it is an example of:", "options": ["Static Analysis", "Dynamic Analysis", "Live Forensics", "Network Monitoring"], "correct": 0, "explanation": "Static analysis is the examination of a file without executing it. Using the `strings` command is a classic static analysis technique." },
                        { "id": 4, "question": "The domain names, IP addresses, file hashes, and registry keys derived from malware analysis are collectively known as:", "options": ["Alerts", "Indicators of Compromise (IOCs)", "Logs", "Vulnerabilities"], "correct": 1,
                         "explanation": "IOCs are the forensic artifacts of an intrusion that can be used to detect the same threat on other systems." },
                        { "id": 5, "question": "The ultimate goal of performing malware analysis during an active incident is to:", "options": ["Publish a research paper", "Reverse engineer the entire malware binary", "Extract actionable IOCs to help with containment and eradication", "Determine which country the attacker is from"], "correct": 2, "explanation": "During an IR engagement, the focus is on a rapid analysis to get the IOCs needed to find and remove the threat from the environment quickly." }
                    ]
                }
            },
            {
                "id": "lesson-13-network-forensics",
                "title": "Lesson 13: Network Forensics",
                "duration": "120 min",
                "objectives": [
                    "Understand sources of network evidence (PCAP, NetFlow, logs)",
                    "Learn basic packet capture and analysis techniques using Wireshark",
                    "Reconstruct network timelines to trace an attacker's activity",
                    "Analyze network traffic to detect lateral movement"
                ],
                "content": {
                    "overview": "Network traffic provides a rich source of evidence for an investigation, showing how an attacker got in, how they communicated with their infrastructure, and how they moved around inside the network. This lesson covers the fundamentals of network forensics and how to analyze traffic to answer key investigative questions.",
                    "sections": [
                        {
                            "title": "Network Traffic Analysis",
                            "content": "<p>Network forensics involves capturing, recording, and analyzing network traffic to uncover the source and extent of an attack. There are several types of network evidence, each with its own level of detail.</p><h3>Sources of Network Evidence:</h3><ul><li><strong>Full Packet Capture (PCAP):</strong> The most detailed evidence. A PCAP file contains the full content of every packet that traversed a network segment. It is resource-intensive to capture and store but provides ground truth.</li><li><strong>NetFlow/IPFIX:</strong> A summary record of network conversations. It shows who talked to whom, for how long, and with how much data, but does not contain the actual content of the conversation. It's like a phone bill versus a recording of the phone call.</li><li><strong>Log Files:</strong> Logs from devices like firewalls, proxies, and DNS servers provide crucial context about what traffic was allowed, blocked, or requested.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>The Funnel of Analysis</strong></div><p>Start with the least detailed data (logs and NetFlow) to find suspicious activity. Once you have identified a specific timeframe and set of IPs, pivot to the highly detailed PCAP data for a deep-dive analysis of that specific conversation.</p></div>",
                            "image": "https://images.unsplash.com/photo-1594917951231-98745c43d779?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Packet Capture Techniques",
                            "content": "<p>Wireshark is the world's foremost network protocol analyzer and the standard tool for analyzing PCAP files. It allows you to filter and inspect individual packets and reconstruct higher-level sessions.</p><h3>Basic Wireshark Skills:</h3><ul><li><strong>Display Filters:</strong> The most important skill. Learn how to filter the millions of packets in a capture to find what you're looking for (e.g., `ip.addr == 1.2.3.4`, `tcp.port == 80`, `dns.qry.name contains 'evil'`).</li><li><strong>Follow TCP/UDP Stream:</strong> This feature reconstructs an entire conversation from a series of packets, allowing you to see things like the commands an attacker typed in a shell or the files they downloaded.</li><li><strong>Exporting Objects:</strong> Wireshark can automatically carve files (like images, executables, or documents) out of HTTP traffic.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Where to Capture</strong></div><p>Capturing traffic requires a network TAP or a switch's SPAN/mirror port. This allows you to get a copy of all the traffic flowing through a critical point, like the internet egress point or the link to a server farm.</p></div>",
                            "image": "https://images.unsplash.com/photo-1544890225-2fde1e46f71b?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Timeline Reconstruction",
                            "content": "<p>By combining evidence from logs and network traffic, you can build a detailed timeline of an attacker's activities. Time synchronization between all your systems is absolutely critical for this process.</p><h3>Building the Timeline:</h3><ol><li><strong>Initial Compromise:</strong> A proxy log shows a user downloading a suspicious file at 10:00 AM.</li><li><strong>C2 Beacon:</strong> NetFlow data shows the user's machine starting to communicate with a known malicious IP every 5 minutes, beginning at 10:05 AM.</li><li><strong>Lateral Movement:</strong> At 11:30 AM, firewall logs show the compromised machine initiating an RDP connection to a critical server.</li><li><strong>Data Exfiltration:</strong> PCAP analysis of traffic from the server at 1:00 PM shows a large encrypted file being transferred to an external IP.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>NTP is Your Best Friend</strong></div><p>If the clock on your firewall is 5 minutes different from the clock on your web server, creating an accurate timeline is impossible. Use the Network Time Protocol (NTP) to ensure all systems have synchronized clocks.</p></div>",
                            "image": "https://images.unsplash.com/photo-1461749280684-dccba630e2f6?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Wireshark Display Filter Examples",
                        "language": "bash",
                        "code": "# Show all traffic to or from a specific IP\nip.addr == 192.168.1.100\n\n# Show all HTTP POST requests\nhttp.request.method == \"POST\"\n\n# Show all DNS queries that are NOT for 'google.com'\ndns && !(dns.qry.name == \"google.com\")\n\n# Show all TCP packets with the SYN flag set (connection attempts)\ntcp.flags.syn == 1"
                    },
                    {
                        "title": "`tcpdump` Command for Live Packet Capture",
                        "language": "bash",
                        "code": "# tcpdump is a command-line packet analyzer.\n\n# Capture 1000 packets on interface eth0 and save to a file\ntcpdump -i eth0 -c 1000 -w capture.pcap\n\n# Capture all traffic on any interface going to or from host 1.2.3.4, and don't resolve hostnames\ntcpdump -i any -n host 1.2.3.4 -w capture.pcap"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "Which source of network evidence provides the most detail, including the full content of conversations?", "options": ["NetFlow", "Firewall Logs", "Full Packet Capture (PCAP)", "DNS Logs"], "correct": 2, "explanation": "PCAP contains the complete packet data, whereas NetFlow and logs are metadata or summaries of the traffic." },
                        { "id": 2, "question": "The world's most popular graphical tool for analyzing network packet captures is:", "options": ["Volatility", "Nmap", "Wireshark", "Metasploit"], "correct": 2, "explanation": "Wireshark is the de facto industry standard for interactive PCAP analysis." },
                        { "id": 3, "question": "An investigator right-clicks a TCP session in Wireshark and selects 'Follow TCP Stream'. What are they trying to do?", "options": ["Filter the packets by IP address", "Reconstruct the application-layer data from the conversation, like an HTTP request or chat messages", "Check the system clock", "Export all files from the capture"], "correct": 1, "explanation": "'Follow Stream' is a powerful feature that pieces together the raw packets into a readable format, showing the actual data exchanged." },
                        { "id": 4, "question": "Why is accurate time synchronization (e.g., using NTP) so important for network forensics?", "options": ["It makes the network run faster", "It is required for software licensing", "It is essential for accurately correlating events from different systems to build a timeline", "It prevents DoS attacks"], "correct": 2, "explanation": "Without synchronized time, you cannot reliably determine the sequence of events when analyzing logs from a firewall, a server, and a proxy together." },
                        { "id": 5, "question": "Observing traffic from a compromised workstation connecting to multiple other workstations via RDP or SMB is a strong indicator of what?", "options": ["Initial Access", "Data Exfiltration", "Lateral Movement", "A DoS attack"], "correct": 2, "explanation": "Lateral movement is the process of an attacker moving from one compromised machine to others within the same network. RDP (port 3389) and SMB (port 445) are common protocols used for this." }
                    ]
                }
            },
            {
                "id": "lesson-14-host-investigation",
                "title": "Lesson 14: Host-Based Investigation",
                "duration": "150 min",
                "objectives": [
                    "Understand the fundamentals of live response and memory analysis",
                    "Learn key areas to investigate within the Windows and Linux file systems",
                    "Analyze Windows Registry for evidence of persistence and execution",
                    "Examine system event logs for investigative leads"
                ],
                "content": {
                    "overview": "While network forensics shows how attackers move between systems, host-based forensics reveals what they did *on* each system. This lesson dives into the critical artifacts on Windows and Linux hosts that can provide definitive evidence of compromise, persistence, and execution.",
                    "sections": [
                        {
                            "title": "Memory Analysis Fundamentals",
                            "content": "<p>Memory (RAM) forensics is the analysis of a computer's volatile memory. It provides a snapshot of the system's runtime state and is crucial for finding 'fileless' malware and other threats that may not leave a trace on the hard drive.</p><h3>What You Can Find in Memory:</h3><ul><li><strong>Running Processes:</strong> A list of all processes running at the time of capture, including hidden or malicious ones.</li><li><strong>Network Connections:</strong> Active and recent network connections, linking processes to specific IPs and ports.</li><li><strong>Command History:</strong> Commands typed into shells by the attacker.</li><li><strong>Loaded Modules/DLLs:</strong> Can reveal process injection, where malicious code is loaded into a legitimate process.</li><li><strong>Encryption Keys and Passwords:</strong> In some cases, sensitive data can be recovered directly from memory.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Volatility Framework</strong></div><p>The Volatility Framework is a powerful, open-source tool for parsing memory images and extracting these artifacts. It is an essential tool for any digital forensic investigator.</p></div>",
                            "image": "https://images.unsplash.com/photo-1550751827-4138d04d47ee?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "File System Forensics",
                            "content": "<p>The file system contains a wealth of information about user activity and program execution. Knowing where to look is key to finding evidence quickly.</p><h3>Key Locations of Interest:</h3><ul><li><strong>Windows:</strong> User profiles (`C:\\Users\\<username>`), temporary directories (`AppData\\Local\\Temp`), prefetch files (`Windows\\Prefetch`), Recycle Bin.</li><li><strong>Linux:</strong> User home directories (`/home/<username>`), log files (`/var/log`), command history (`.bash_history`), temporary directories (`/tmp`).</li><li><strong>Timestamps (MAC):</strong> Examine file timestamps - Modified, Accessed, and Created. For example, finding a system file in `C:\\Windows\\System32` with a recent creation time is highly suspicious.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Look in the Shadows</strong></div><p>On Windows, Volume Shadow Copies can contain previous versions of files, even if the attacker deleted or modified the original. They are a gold mine for recovering deleted data.</p></div>",
                            "image": "https://images.unsplash.com/photo-1599691888286-93e433f064b8?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Registry Analysis",
                            "content": "<p>The Windows Registry is a massive database containing system and application configuration settings. Attackers frequently modify the Registry to establish persistence.</p><h3>Common Persistence Locations:</h3><ul><li><strong>Run Keys:</strong> Keys that cause a program to be executed at user logon (e.g., `HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run`). This is the most common persistence technique.</li><li><strong>Services:</strong> Attackers may create a malicious service to ensure their code runs with system privileges.</li><li><strong>Userinit:</strong> Attackers can modify the `Userinit` key to launch a malicious program alongside the legitimate `userinit.exe` process during logon.</li></ul><h3>Other Investigative Clues:</h3><ul><li><strong>MRU Lists:</strong> 'Most Recently Used' lists can show which files a user recently opened or which commands they ran.</li><li><strong>USB Device History:</strong> The Registry tracks every USB device that has ever been connected to the system.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Analyze Offline</strong></div><p>Similar to file systems, Registry analysis should be performed on an extracted copy of the registry hives from a forensic image, not by browsing the live registry on a potentially compromised machine.</p></div>",
                            "image": "https://images.unsplash.com/photo-1563206767-5b18f218e8de?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Common Volatility Commands",
                        "language": "bash",
                        "code": "# Analyze a Windows memory image named 'memdump.vmem'\n\n# List running processes\nvol.py -f memdump.vmem --profile=Win7SP1x64 pslist\n\n# Show active network connections\nvol.py -f memdump.vmem --profile=Win7SP1x64 netscan\n\n# Dump command prompt history\nvol.py -f memdump.vmem --profile=Win7SP1x64 cmdscan"
                    },
                    {
                        "title": "Linux: Finding recently modified files",
                        "language": "bash",
                        "code": "# Find all files in the /etc directory modified in the last 2 days\nfind /etc -mtime -2\n\n# Find all files created in the last 60 minutes in a user's home directory\nfind /home/user -cmin -60"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "Which of the following would be found in a computer's volatile memory (RAM) but potentially not on its hard drive?", "options": ["Installed software", "User documents", "Active network connections", "Archived email"], "correct": 2, "explanation": "Active network connections, running processes, and command history exist in volatile memory and are lost when the computer is turned off." },
                        { "id": 2, "question": "The Volatility Framework is a tool used for:", "options": ["Analyzing network packet captures", "Analyzing forensic images of memory (RAM)", "Creating firewall rules", "Scanning for vulnerabilities"], "correct": 1, "explanation": "Volatility is the industry-standard open-source tool for parsing the complex structures within a memory dump to extract forensic artifacts." },
                        { "id": 3, "question": "In Windows, the most common way for attackers to make their malware run automatically at startup is by adding an entry to:", "options": ["The Recycle Bin", "A Registry 'Run' key", "A temporary internet files folder", "The system's hosts file"], "correct": 1, "explanation": "The Run keys in the Registry are a simple and effective persistence mechanism and one of the first places an investigator should look." },
                        { "id": 4, "question": "On a Windows system, what is the significance of prefetch files (`.pf`)?", "options": ["They contain user passwords", "They are copies of deleted files", "They are a record of which programs have been run on the system, which can prove execution", "They store the user's internet browsing history"], "correct": 2,
                         "explanation": "Windows creates a prefetch file for an executable the first time it is run. The existence of `malware.exe.pf` is strong evidence that `malware.exe` was executed on that system." },
                        { "id": 5, "question": "On a Linux system, a user's command history is typically stored in what file?", "options": ["/var/log/syslog", "/etc/passwd", "~/.bash_history", "/tmp/history.log"], "correct": 2, "explanation": "The `.bash_history` file in a user's home directory contains a log of the commands they have typed into the shell, providing a valuable timeline of their activity." }
                    ]
                }
            },
            {
                "id": "lesson-15-containment",
                "title": "Lesson 15: Containment Strategies",
                "duration": "120 min",
                "objectives": [
                    "Differentiate between short-term and long-term containment strategies",
                    "Understand various techniques for network segmentation and system isolation",
                    "Weigh the pros and cons of different containment actions",
                    "Develop a decision-making framework for choosing a containment strategy"
                ],
                "content": {
                    "overview": "Containment is the phase where you take active measures to stop the bleeding. The goal is to limit the damage and prevent the attacker from advancing further into your network. This lesson covers the different strategies for containment, their risks, and how to choose the right one for a given situation.",
                    "sections": [
                        {
                            "title": "Short-term vs. Long-term Containment",
                            "content": "<p>Containment is often a multi-step process. Initial, rapid actions are followed by more robust, long-term solutions.</p><h3>Containment Timeline:</h3><ul><li><strong>Short-term Containment:</strong> These are immediate, temporary actions taken to stop the ongoing attack. The focus is on speed. <em>Example: Disconnecting a compromised host from the network.</em></li><li><strong>Long-term Containment:</strong> These are more permanent and comprehensive fixes implemented after an initial investigation. The focus is on rebuilding clean systems and preventing re-entry. <em>Example: Re-imaging the compromised host from a known-good gold image and forcing a password reset for the user.</em></li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Don't Act Too Soon</strong></div><p>Acting too quickly can tip off the attacker, causing them to destroy evidence or change their tactics. Containment actions should be taken deliberately, after an initial assessment gives you an idea of the scope of the compromise.</p></div>",
                            "image": "https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "System Isolation Methods",
                            "content": "<p>Isolating a compromised host is the most common containment strategy. This can be done at different levels of the technology stack.</p><h3>Isolation Techniques:</h3><ul><li><strong>Network Isolation (via EDR):</strong> The most precise method. Use the EDR agent to apply a host-based firewall rule that blocks all network connections except for the connection to the EDR server itself. This allows you to continue investigating the machine remotely while preventing it from attacking other systems.</li><li><strong>Switch Port Shutdown:</strong> Disabling the port on the network switch that the compromised device is connected to. This is a physical disconnection.</li><li><strong>VLAN Shunting:</strong> Moving the compromised host's switch port into an isolated 'quarantine' VLAN that has no access to the production network but may have access to a forensics network.</li><li><strong>Unplugging the Cable:</strong> The most basic method. Simple and effective, but you lose all remote visibility into the machine.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Monitor and Respond</strong></div><p>The decision to contain should not be made in a vacuum. It's often better to monitor an attacker's activity for a short period to understand their goals and the full scope of their access before you take containment actions and they realize they've been discovered.</p></div>",
                            "image": "https://images.unsplash.com/photo-1599691888286-93e433f064b8?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Containment Decision Making",
                            "content": "<p>Choosing the right containment strategy requires balancing the need to stop the attack with the potential for business disruption.</p><h3>Factors to Consider:</h3><ul><li><strong>Criticality of the Asset:</strong> You would be much more hesitant to immediately disconnect a revenue-generating production server than a user's laptop.</li><li><strong>Confidence in the Breach:</strong> How sure are you that the system is actually compromised? Containment actions on a false positive can cause unnecessary downtime.</li><li><strong>Attacker's Current Activity:</strong> Is the attacker actively exfiltrating data right now? This would warrant more immediate and drastic action.</li><li><strong>Your Technical Capabilities:</strong> Do you have an EDR solution that allows for surgical isolation, or is unplugging the cable your only option?</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Get Authorization</strong></div><p>Taking a critical system offline is a business decision, not just a technical one. The decision to contain a critical asset must be made by the Incident Commander in consultation with business stakeholders, as outlined in the IR plan.</p></div>",
                            "image": "https://images.unsplash.com/photo-1543286386-2e659306cd6c?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Containment Strategy Decision Tree (Pseudocode)",
                        "language": "bash",
                        "code": "IF incident_type == 'Ransomware' AND is_spreading == true:\n  shutdown_affected_network_segment()\nELSE IF asset_type == 'User_Workstation' AND confidence == 'High':\n  isolate_host_with_EDR()\nELSE IF asset_type == 'Critical_Server' AND business_impact == 'High':\n  # Monitor activity while urgently seeking containment approval from Incident Commander.\n  escalate_to_IC()\nELSE:\n  # Continue investigation before taking containment actions.\n  continue_monitoring()"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary goal of the containment phase in incident response?", "options": ["To find the root cause of the incident", "To limit the damage and prevent the threat from spreading", "To write the final incident report", "To restore systems from backup"], "correct": 1, "explanation": "Containment is all about stopping the bleeding and preventing a localized compromise from becoming an enterprise-wide disaster." },
                        { "id": 2, "question": "Using an EDR agent to apply a host-based firewall rule that blocks all network traffic except to the security team is an example of what?", "options": ["Network Isolation", "Eradication", "Recovery", "Threat Hunting"], "correct": 0, "explanation": "This is a precise and effective form of network isolation that allows for continued remote investigation while stopping the threat." },
                        { "id": 3, "question": "Re-imaging a compromised laptop from a known-good gold image is what kind of activity?", "options": ["Short-term containment", "Identification", "Long-term containment / Eradication", "Post-incident activity"], "correct": 2, "explanation": "This action is part of the longer-term fix, designed to completely remove the threat and rebuild a clean system." },
                        { "id": 4, "question": "What is a major risk of taking containment actions too early in an investigation?", "options": ["It can save the company from further damage", "It can tip off the attacker, causing them to hide their tracks or destroy evidence", "It can help in attributing the attack", "It makes writing the report easier"], "correct": 1, "explanation": "Prematurely blocking an attacker's access might cause them to deploy ransomware or delete logs. It's often better to understand the scope first through quiet monitoring." },
                        { "id": 5, "question": "The decision to take a critical, revenue-generating server offline for containment must be made by whom?", "options": ["The junior help desk analyst who discovered the alert", "The CEO of the company", "The Incident Commander, in consultation with business leadership", "The public relations team"], "correct": 2, "explanation": "This is a significant business decision. The Incident Commander has the authority to make the call, but must do so with an understanding of the business impact, which requires consulting with stakeholders." }
                    ]
                }
            },
            {
                "id": "lesson-16-eradication",
                "title": "Lesson 16: Eradication Techniques",
                "duration": "120 min",
                "objectives": [
                    "Understand the goal of the eradication phase",
                    "Learn procedures for effective malware removal and system cleaning",
                    "Implement system hardening and vulnerability remediation to prevent re-infection",
                    "Manage compromised accounts and credentials"
                ],
                "content": {
                    "overview": "Once the incident is contained, the next step is eradication: removing the attacker and all their artifacts from your environment. This lesson covers the techniques for thoroughly cleaning up a compromised system and closing the security gaps that allowed the attacker in.",
                    "sections": [
                        {
                            "title": "Malware Removal Procedures",
                            "content": "<p>Eradication means eliminating the root cause of the incident. This isn't just about deleting a single malicious file; it's about removing all components of the intrusion.</p><h3>The Rebuild vs. Repair Dilemma:</h3><ul><li><strong>Repair:</strong> Attempting to remove the malware and clean the existing operating system. This is risky, as it's very difficult to be 100% sure you've found and removed every component (like rootkits). This is generally not recommended for critical systems.</li><li><strong>Rebuild (Re-image):</strong> The preferred and most effective method. Wipe the system completely and restore it from a known-good 'gold image'. This ensures that any hidden backdoors or rootkits are completely eliminated.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Don't Restore from a Tainted Backup!</strong></div><p>When rebuilding, make sure your backup is from a date *before* the initial compromise occurred. Restoring from a recent backup could simply re-introduce the malware onto your clean system.</p></div>",
                            "image": "https://images.unsplash.com/photo-1544197150-b99a5808e7ee?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "System Hardening and Vulnerability Remediation",
                            "content": "<p>Simply removing the malware is not enough. You must also fix the vulnerability that allowed the attacker to get in. If you don't close the door, they will just walk right back in.</p><h3>Eradication Includes Prevention:</h3><ul><li><strong>Patch the Vulnerability:</strong> The most critical step. If the attacker exploited a specific vulnerability (e.g., in Apache Struts or an unpatched operating system), that vulnerability must be patched before the system is brought back online.</li><li><strong>Implement System Hardening:</strong> Apply security best practices to the rebuilt system. This includes disabling unnecessary services, enforcing strong password policies, configuring a host-based firewall, and implementing application whitelisting.</li><li><strong>Improve Monitoring:</strong> Enhance logging and monitoring on the rebuilt system to ensure you can detect any future attempts to compromise it.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Root Cause Analysis</strong></div><p>Eradication is driven by the findings of the investigation. You must understand the root cause of the incident to know what needs to be fixed to truly eradicate the threat.</p></div>",
                            "image": "https://images.unsplash.com/photo-1605152334438-6b3a69a4891e?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Account Management",
                            "content": "<p>Attackers rely on compromised credentials for access and persistence. Eradicating their access requires a full audit and reset of potentially compromised accounts.</p><h3>Credential Reset Plan:</h3><ul><li><strong>Disable Temporarily:</strong> Immediately disable any user accounts known to have been used by the attacker.</li><li><strong>Force Password Resets:</strong> Force a password reset for all users on the compromised systems. In a large-scale breach, you may need to force a password reset for *all* users in the entire domain.</li><li><strong>Audit Privileged Accounts:</strong> Scrutinize all administrative and service accounts. Attackers often create new, hidden admin accounts for persistence. Check for any accounts created since the date of the compromise.</li><li><strong>Reset Secrets:</strong> Any API keys, service account passwords, or other 'secrets' on the compromised system must be considered compromised and should be revoked and re-issued.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>The Kerberos 'Golden Ticket'</strong></div><p>In a full domain compromise, attackers can steal the `krbtgt` password hash, allowing them to forge Kerberos tickets for any user. Eradicating this requires resetting the `krbtgt` password twice, a complex and high-impact procedure.</p></div>",
                            "image": "https://images.unsplash.com/photo-1554224155-83e8b835d07a?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Eradication Checklist (Simplified)",
                        "language": "markdown",
                        "code": "## Eradication for Server SRV-01 ##\n\n1.  [X] Containment: Host isolated via EDR.\n2.  [X] Forensics: Disk image and memory capture acquired.\n3.  [ ] **Vulnerability Remediation:**\n    *   [ ] Identify root cause vulnerability (CVE-2023-XXXX).\n    *   [ ] Apply vendor patch to the gold image.\n4.  [ ] **System Rebuild:**\n    *   [ ] Wipe the existing server disks.\n    *   [ ] Deploy the newly patched gold image.\n5.  [ ] **Account Management:**\n    *   [ ] Reset passwords for all service accounts on the server.\n    *   [ ] Revoke and re-issue all API keys stored on the server.\n6.  [ ] **Monitoring:**\n    *   [ ] Apply enhanced logging configuration.\n    *   [ ] Place server in a high-monitoring group for 7 days."
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary goal of the eradication phase?", "options": ["To remove the threat and its artifacts from the environment", "To identify the incident", "To restore business operations", "To notify customers of a breach"], "correct": 0, "explanation": "Eradication is the active removal of the attacker's presence, including malware, backdoors, and compromised accounts." },
                        { "id": 2, "question": "What is the most reliable method for eradicating malware from a critical server?", "options": ["Running a single antivirus scan", "Manually deleting suspicious files", "Wiping the system and rebuilding from a known-good, patched image", "Unplugging it from the network permanently"], "correct": 2, "explanation": "Rebuilding from a trusted image is the only way to be confident that all traces of a sophisticated attacker, including rootkits, have been removed." },
                        { "id": 3, "question": "Besides removing the malware, what other critical step must be taken during eradication?", "options": ["Paying the ransom", "Identifying and fixing the vulnerability that allowed the initial compromise", "Writing a thank you note to the attacker for pointing out the vulnerability", "Deleting all logs"], "correct": 1, "explanation": "If you don't patch the vulnerability and fix the root cause, you haven't truly eradicated the threat, as the attacker can simply get back in the same way." },
                        { "id": 4, "question": "If an attacker has compromised user accounts, what is a necessary eradication step?", "options": ["Asking users if their password was stolen", "Doing nothing, as the attacker will eventually move on", "Disabling and resetting the passwords for all potentially compromised accounts", "Creating more user accounts for them to use"], "correct": 2, "explanation": "You must assume all credentials on a compromised system have been stolen. Resetting them is the only way to eradicate the attacker's access." },
                        { "id": 5, "question": "When rebuilding a system from backup as part of eradication, why is the date of the backup so important?", "options": ["It doesn't matter", "You should always use the most recent backup available", "You must use a backup from a date prior to the initial compromise to avoid re-introducing the malware", "Older backups are faster to restore"], "correct": 2, "explanation": "If the initial compromise happened a month ago, any backup from the last month could contain the attacker's tools and backdoors. This would undo all your eradication efforts." }
                    ]
                }
            },
            {
                "id": "lesson-17-recovery",
                "title": "Lesson 17: Recovery Planning",
                "duration": "120 min",
                "objectives": [
                    "Understand the goal of the recovery phase",
                    "Develop strategies for safely restoring systems to production",
                    "Learn the importance of monitoring for reinfection after recovery",
                    "Validate that recovered systems are fully functional and secure"
                ],
                "content": {
                    "overview": "Recovery is the final phase of the response, where cleaned systems are carefully brought back into the production environment. This lesson covers the process of restoring services, the critical need for post-recovery monitoring, and the steps to validate that business operations have returned to normal.",
                    "sections": [
                        {
                            "title": "Recovery Strategy Development",
                            "content": "<p>The goal of recovery is to carefully restore systems and services to normal business operations. This should be a planned, phased approach, not a rush to turn everything back on at once.</p><h3>Key Strategy Points:</h3><ul><li><strong>Phased Restoration:</strong> Bring systems back online in a logical order of priority, as defined by the business. For example, restore the database server before the web server that connects to it.</li><li><strong>Pre-Recovery Checklist:</strong> Before a system goes back into production, it must pass a final check. Has it been rebuilt from the gold image? Has the vulnerability been patched? Has the password been reset? Has enhanced monitoring been applied?</li><li><strong>Go/No-Go Decision:</strong> The Incident Commander, in consultation with business owners, must make a formal 'go' decision to place a system back into production.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>When is the Incident 'Over'?</strong></div><p>An incident is not over when the malware is gone. It is over when the systems are recovered, validated, and normal business operations have resumed. The Incident Commander makes the final declaration that the incident is closed.</p></div>",
                            "image": "https://images.unsplash.com/photo-1579548122216-3841a12d1b5a?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "System Restoration Procedures",
                            "content": "<p>This is the hands-on process of returning a system to service. It's often performed by the IT operations team, guided by the security team.</p><h3>Example Restoration Flow:</h3><ol><li>A server has been successfully rebuilt and hardened during eradication.</li><li>The server is placed on the network in a 'staging' VLAN.</li><li>Connectivity to other necessary systems (like databases, authentication servers) is tested.</li><li>The application owner or business unit runs tests to validate that the application is fully functional.</li><li>After all tests pass, the server's VLAN is changed to place it back into the production network.</li><li>Traffic is slowly re-introduced to the server while it is under close observation.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Communicate with Users</strong></div><p>Throughout the recovery process, it's important to communicate with the end-users and business owners. Let them know which services are being restored and what the expected timeline is. Managing expectations is key.</p></div>",
                            "image": "https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Monitoring for Reinfection",
                            "content": "<p>Attackers often have more than one way into a network. Once you bring a system back online, you must assume they will try to regain access. Heightened monitoring during the recovery phase is critical.</p><h3>Post-Recovery Monitoring:</h3><ul><li><strong>High-Alert Status:</strong> All restored systems should be placed in a special group in your SIEM/EDR that has more sensitive alerting thresholds for a period of time (e.g., 7-14 days).</li><li><strong>IOC Monitoring:</strong> Continuously monitor for any signs of the IOCs from the original incident (file hashes, C2 domains, etc.). Any new hit on those IOCs is a critical alert.</li><li><strong>Behavioral Analysis:</strong> Pay close attention to the behavior of the restored systems. Do they look identical to other clean systems of the same type, or are there any anomalous processes or network connections?</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>The 'Whack-a-Mole' Problem</strong></div><p>If you have not truly eradicated the root cause or the attacker's secondary backdoors, you may find yourself playing 'whack-a-mole', where systems get reinfected shortly after being cleaned. This is a sign of an incomplete eradication and requires a deeper investigation.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "System Recovery Validation Checklist",
                        "language": "markdown",
                        "code": "## Recovery Checklist for Server SRV-01 ##\n\n- [X] Server rebuilt from gold image (image version 2.1 patched on YYYY-MM-DD).\n- [X] All application data restored from last known-good backup.\n- [X] All service account passwords have been reset.\n- [X] Server passed functional testing by the application owner.\n- [X] Enhanced monitoring agent is installed and checking in.\n- [X] **Approval to Go-Live:**\n  - [X] Incident Commander: Bob Smith\n  - [X] Business Owner: Alice Jones\n  - **GO LIVE at: 2023-08-10 16:00 UTC**"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary goal of the recovery phase?", "options": ["To safely restore systems and business operations to a normal, secure state", "To conduct a lessons learned session", "To find the initial attack vector", "To collect forensic evidence from affected systems"], "correct": 0, "explanation": "Recovery is the process of getting the business back to normal operations after the threat has been eradicated." },
                        { "id": 2, "question": "What is the most important security activity to perform immediately after a system is recovered?", "options": ["Take it offline again for more patching", "Place it under heightened monitoring to watch for signs of reinfection", "Delete all logs from the incident", "Announce to the public that the incident is over"], "correct": 1, "explanation": "Attackers often leave multiple backdoors. Increased scrutiny of recovered systems is critical to ensure they don't immediately get compromised again." },
                        { "id": 3, "question": "Who makes the final 'go/no-go' decision to bring a critical service back into production?", "options": ["The help desk", "The security intern", "The Incident Commander, in consultation with the system's business owner", "The public relations department"], "correct": 2, "explanation": "This is a risk-based decision that must balance the need for the service with the confirmation that it is secure. The IC and the business owner make this call together." },
                        { "id": 4, "question": "If a cleaned system gets reinfected with the same malware shortly after being brought back online, it is likely a sign of what?", "options": ["A successful recovery", "An incomplete eradication, meaning the attacker still has another way in", "A new and unrelated attack", "A hardware failure"], "correct": 1, "explanation": "This 'whack-a-mole' scenario indicates that the eradication was not complete. You may have removed one piece of malware but missed the attacker's persistence mechanism or secondary backdoor." },
                        { "id": 5, "question": "An incident is considered officially closed when:", "options": ["The malware is removed from one machine", "The CISO says it is", "The Incident Commander declares that systems are recovered and normal operations have resumed", "The first news article about the breach is published"], "correct": 2, "explanation": "The incident lifecycle isn't complete until the recovery is finished and verified. The Incident Commander's declaration is the formal end to the response effort." }
                    ]
                }
            },
            {
                "id": "lesson-18-communication",
                "title": "Lesson 18: Incident Communication",
                "duration": "120 min",
                "objectives": [
                    "Develop protocols for clear and effective internal communication during a crisis",
                    "Understand external notification requirements and best practices",
                    "Learn how to interact with media and manage public relations",
                    "Practice crisis communication in a simulated environment"
                ],
                "content": {
                    "overview": "Technical response is only one part of handling an incident. Effective communication is arguably just as important for managing the crisis, maintaining stakeholder confidence, and meeting legal obligations. This lesson covers the art and science of communicating during a security incident.",
                    "sections": [
                        {
                            "title": "Internal Communication Protocols",
                            "content": "<p>During a crisis, communication must be clear, concise, consistent, and controlled. A formal communication plan ensures the right information gets to the right people at the right time.</p><h3>Key Principles:</h3><ul><li><strong>Single Source of Truth:</strong> All official communications should come from the Communications Lead or the Incident Commander. This prevents conflicting messages and confusion.</li><li><strong>Regular Cadence:</strong> Provide updates at regular, predictable intervals (e.g., every 4 hours for a major incident). This prevents stakeholders from constantly pinging the technical team for status.</li><li><strong>Audience-Specific Content:</strong> Tailor the message to the audience. Executives need high-level summaries of business impact, while IT staff need specific technical details.</li><li><strong>Use Pre-approved Templates:</strong> Have templates ready for different types of updates to save time and ensure consistency.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Stick to the Facts</strong></div><p>Do not speculate, especially in writing. Report only what you know and have confirmed. It's better to say 'The investigation is ongoing' than to provide an incorrect root cause that you have to retract later.</p></div>",
                            "image": "https://images.unsplash.com/photo-1543269664-56d93c1b41a6?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "External Notification Requirements",
                            "content": "<p>In many cases, you are legally required to notify external parties of a breach. This process is extremely sensitive and must be handled in close coordination with legal counsel.</p><h3>Who to Notify:</h3><ul><li><strong>Affected Individuals:</strong> If personally identifiable information (PII) was breached, you are often required by law (like GDPR or state data breach laws) to notify the affected individuals.</li><li><strong>Regulators:</strong> Many industries (like finance and healthcare) and jurisdictions have specific requirements to notify regulatory bodies of a security incident.</li><li><strong>Law Enforcement:</strong> In cases of serious criminal activity, you will need to coordinate with the FBI or other law enforcement agencies.</li><li><strong>Cyber Insurance Provider:</strong> Your insurance policy will have strict requirements about when and how you must notify them of an incident to be eligible for coverage.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Legal is in Charge</strong></div><p>All external notifications, especially those to customers and regulators, must be reviewed and approved by your legal department *before* they are sent. This is a legal process, not just a technical one.</p></div>",
                            "image": "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Media Relations Guidelines",
                            "content": "<p>If an incident becomes public, you will be contacted by the media. How your organization handles this interaction can have a massive impact on its reputation.</p><h3>Media Interaction Rules:</h3><ul><li><strong>Designate a Spokesperson:</strong> All media inquiries must be routed to a single, trained spokesperson (usually from the PR or corporate communications department). No one else on the IR team should ever speak to the media.</li><li><strong>Be Prepared:</strong> Work with PR and Legal to prepare a holding statement as soon as a major incident is suspected. This gives you a consistent message while the investigation is ongoing.</li><li><strong>Be Honest, but Careful:</strong> Be transparent about the incident and show empathy for those affected. However, do not provide technical details or speculative information that could compromise the investigation or create legal liability.</li><li><strong>Bridge, Don't Dodge:</strong> Learn to 'bridge' from a difficult question to a key message you want to deliver. ('That's an important question, and our investigation is working to answer it. What I can tell you right now is that our top priority is protecting our customers.')</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Never Say 'No Comment'</strong></div><p>The phrase 'no comment' is often interpreted as an admission of guilt. It's better to say, 'We are in the early stages of an active investigation, and I can't share details that might compromise that process, but we are committed to providing more information as soon as we can.'</p></div>",
                            "image": "https://images.unsplash.com/photo-1455849318743-b2233052fcff?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Internal Stakeholder Update Email Template",
                        "language": "markdown",
                        "code": "**INCIDENT UPDATE**\n\n**Incident ID:** IR-2023-087\n**Priority:** P1 Critical\n**Update Time:** 2023-08-08 18:00 UTC\n\n**Executive Summary:**\nWe are currently responding to a ransomware incident affecting the main file server. The incident is actively contained, and we are now moving to the eradication and recovery phase.\n\n**Business Impact:**\n- Finance department file access is currently offline.\n- No other business units are directly affected at this time.\n- No evidence of data exfiltration has been found.\n\n**Next Steps:**\n- Begin server restoration from last known-good backup.\n- Estimated time to recovery is 4-6 hours.\n\n**Next Update:** 22:00 UTC"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary benefit of having a single, designated spokesperson during an incident?", "options": ["It ensures a clear and consistent message is delivered to the media and public", "It is cheaper", "It makes the technical team feel less important", "It guarantees positive media coverage"], "correct": 0, "explanation": "Controlling the message is key. Routing all inquiries to one person prevents contradictory statements and reduces confusion." },
                        { "id": 2, "question": "When communicating with executive leadership, your updates should primarily focus on:", "options": ["Deeply technical details of the malware's code", "Blaming specific employees", "High-level business impact, response status, and recovery estimates", "Your personal feelings about the incident"], "correct": 2, "explanation": "Executives need information that helps them make business decisions. Tailor your message to focus on impact, what's being done, and what to expect." },
                        { "id": 3, "question": "All external communications to customers or regulators about a data breach must be reviewed and approved by whom?", "options": ["The junior SOC analyst", "The head of marketing", "The legal department", "The IT help desk"], "correct": 2, "explanation": "Breach notification is a legal process with specific requirements and liabilities. Legal counsel must be in charge of this communication." },
                        { "id": 4, "question": "Instead of saying 'no comment' to a reporter, what is a better approach?", "options": ["Run away from the reporter", "Politely explain that you cannot share details that would compromise an active investigation", "Make up a story", "Give them the home phone number of the CEO"], "correct": 1, "explanation": "This approach is transparent about the process without revealing sensitive details, which is much better for managing public perception than 'no comment'." },
                        { "id": 5, "question": "Establishing a regular, predictable cadence for internal updates during a long incident helps to:", "options": ["Make the incident last longer", "Increase panic among stakeholders", "Prevent the technical team from being constantly interrupted with requests for status", "Hide information from leadership"], "correct": 2, "explanation": "If stakeholders know they will get an update every four hours, they are less likely to distract the response team with constant interruptions." }
                    ]
                }
            },
            {
                "id": "lesson-19-legal",
                "title": "Lesson 19: Legal and Regulatory Aspects",
                "duration": "120 min",
                "objectives": [
                    "Understand how to preserve evidence in a legally defensible manner",
                    "Navigate the complexities of different breach notification laws",
                    "Learn best practices for coordinating with law enforcement",
                    "Define and implement legal hold procedures"
                ],
                "content": {
                    "overview": "Incident response does not happen in a vacuum. It is governed by a complex web of laws, regulations, and potential legal actions. This lesson covers the key legal aspects that every incident responder must be aware of to protect the organization and ensure the response is compliant.",
                    "sections": [
                        {
                            "title": "Evidence Preservation Requirements",
                            "content": "<p>When an incident could lead to a lawsuit or criminal prosecution, the bar for evidence preservation becomes much higher. Every piece of data related to the incident may be subject to legal discovery.</p><h3>Attorney-Client Privilege:</h3><ul><li>To protect the confidentiality of your investigation's findings, it is often best practice to conduct the incident response work under the direction of legal counsel.</li><li>Communications and reports produced for the purpose of seeking legal advice may be protected from discovery by the attorney-client privilege.</li><li>Mark sensitive documents and communications with 'Privileged and Confidential - Prepared at the Direction of Legal Counsel'.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Engage Counsel Early</strong></div><p>Involve your internal or external legal counsel the moment a significant incident is suspected. They will guide the entire response process to ensure legal and regulatory risks are managed correctly.</p></div>",
                            "image": "https://images.unsplash.com/photo-1589216532372-1c2a3679003a?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Breach Notification Laws",
                            "content": "<p>There is no single federal data breach law in the United States. Instead, there is a patchwork of laws in all 50 states, plus industry-specific and international laws.</p><h3>Examples of Key Regulations:</h3><ul><li><strong>State Laws:</strong> Each state has its own definition of PII and its own requirements for notification timelines and methods.</li><li><strong>GDPR (General Data Protection Regulation):</strong> If you handle the data of EU residents, a breach may require notification to a data protection authority within 72 hours. Fines for non-compliance are severe.</li><li><strong>HIPAA (Health Insurance Portability and Accountability Act):</strong> For healthcare organizations, a breach of protected health information (PHI) has strict notification requirements.</li><li><strong>NYDFS (New York Department of Financial Services):</strong> Requires financial institutions in New York to report certain cybersecurity events within 72 hours.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>It's a Legal Question</strong></div><p>Determining *if* you have to notify, *who* you have to notify, and *when* you have to notify is a legal determination. The technical team's job is to provide the facts of the breach to Legal so they can make this assessment.</p></div>",
                            "image": "https://images.unsplash.com/photo-1555949963-ff980877a232?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Law Enforcement Coordination",
                            "content": "<p>Deciding whether to involve law enforcement (like the FBI or Secret Service) is a strategic decision that should be made by executive leadership and legal counsel.</p><h3>Pros of Involving Law Enforcement:</h3><ul><li>They can bring significant technical and intelligence resources to an investigation that a private company does not have.</li><li>They have the legal authority to seize servers, issue subpoenas, and pursue attribution and prosecution of the attackers.</li><li>Involving them shows that the company is taking the incident seriously.</li></ul><h3>Cons of Involving Law Enforcement:</h3><ul><li>You may lose some control over the investigation. Their primary goal is prosecution, while yours is business recovery.</li><li>They may require you to leave compromised systems online for monitoring, which may conflict with your desire to contain and eradicate quickly.</li><li>The investigation becomes part of a public criminal record.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Build Relationships in Advance</strong></div><p>Don't let the first time you talk to the FBI be during a crisis. Proactively build relationships with your local law enforcement field office and programs like InfraGard. This makes coordination much smoother when an incident does occur.</p></div>",
                            "image": "https://images.unsplash.com/photo-1614064548237-02f8f17374b2?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Example Legal Hold Notification",
                        "language": "markdown",
                        "code": "**MEMORANDUM - PRIVILEGED AND CONFIDENTIAL**\n\n**TO:** All IT Staff\n**FROM:** Legal Department\n**DATE:** 2023-08-08\n**SUBJECT:** Legal Hold Notice for Matter IR-2023-087\n\nAs a result of a pending investigation, you are hereby instructed to preserve all data related to the server 'SRV-01' and user account 'j.doe'. This includes, but is not limited to, all emails, documents, system logs, and backups.\n\nAll routine data destruction or auto-deletion policies for this data are suspended until further notice. You may not delete, alter, or destroy any related information.\n\nFailure to comply with this legal hold can result in serious legal sanctions.\n"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "Why might an incident response investigation be conducted 'under the direction of legal counsel'?", "options": ["Because lawyers are better at forensics", "To potentially protect investigation reports from legal discovery under attorney-client privilege", "To increase the cost of the investigation", "Because it's required by the IT department"], "correct": 1, "explanation": "Conducting the work for the purpose of seeking legal advice is the foundation for asserting attorney-client privilege, which can be crucial in subsequent lawsuits." },
                        { "id": 2, "question": "Under GDPR, what is the required timeframe for notifying a supervisory authority of a data breach?", "options": ["Within 90 days", "Within 1 year", "Within 72 hours of becoming aware of it", "There is no time limit"], "correct": 2, "explanation": "GDPR's stringent 72-hour notification window is a major driver for organizations to have a rapid detection and response capability." },
                        { "id": 3, "question": "A formal instruction from the legal department to preserve all data related to a specific matter is called a:", "options": ["Disaster Recovery Plan", "Chain of Custody", "Legal Hold", "Press Release"], "correct": 2, "explanation": "A legal hold overrides all standard data retention and destruction policies to ensure evidence is preserved for potential litigation." },
                        { "id": 4, "question": "The decision to involve law enforcement in an incident response should be made by:", "options": ["The forensic analyst", "The help desk", "Executive leadership and legal counsel", "The marketing team"], "correct": 2,
                         "explanation": "This is a strategic business and legal decision with significant pros and cons that must be weighed by senior leadership." },
                        { "id": 5, "question": "Who is responsible for determining if a specific incident requires customer notification under a state data breach law?", "options": ["The technical incident response team", "The public relations department", "The legal department", "The Chief Financial Officer"], "correct": 2, "explanation": "The technical team provides the facts ('what was breached'), and the legal team provides the analysis ('do the facts of this breach meet the legal definition requiring notification under this specific law')." }
                    ]
                }
            },
            {
                "id": "lesson-20-documentation",
                "title": "Lesson 20: Incident Documentation",
                "duration": "120 min",
                "objectives": [
                    "Understand the importance of contemporaneous note-taking",
                    "Learn how to create and maintain a detailed incident timeline",
                    "Master the components and structure of a final incident report",
                    "Properly document evidence in case files"
                ],
                "content": {
                    "overview": "'If it wasn't written down, it didn't happen.' Meticulous documentation is not optional in incident response; it is a core requirement. This lesson covers the best practices for documenting your investigation, from the first analyst's notes to the final executive report.",
                    "sections": [
                        {
                            "title": "Contemporaneous Documentation",
                            "content": "<p>Contemporaneous documentation means taking notes as you perform your work, not trying to remember what you did hours or days later. This is the foundation of a reliable investigation.</p><h3>Best Practices for Note-Taking:</h3><ul><li><strong>Use a Centralized System:</strong> All responders should document their actions in a single, shared location, such as a case management system, wiki page, or shared document. This creates a master timeline.</li><li><strong>Timestamp Everything:</strong> Every entry in the log must have a timestamp (preferably in UTC to avoid time zone confusion).</li><li><strong>Be Factual and Objective:</strong> Write down what you did and what you observed. Avoid speculation, jokes, or emotional language. Your notes may become evidence in a legal case.</li><li><strong>Log Commands and Results:</strong> Copy and paste the exact commands you ran and their output into your notes.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>The 'Shift Handover' Test</strong></div><p>Your documentation should be clear enough that another analyst could come on shift, read your notes, and pick up the investigation right where you left off without having to ask you what you did.</p></div>",
                            "image": "https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Timeline Creation",
                            "content": "<p>A detailed timeline is one of the most important artifacts produced during an investigation. It reconstructs the sequence of events, from the initial compromise to the final recovery. It is built by correlating evidence from all sources.</p><h3>What to Include in a Timeline:</h3><ul><li>Timestamp (UTC)</li><li>Source of the evidence (e.g., Firewall Log, Sysmon Event, Analyst Observation)</li><li>A brief, factual description of the event</li><li>The MITRE ATT&CK Tactic/Technique it corresponds to (if applicable)</li><li>The event's relevance to the investigation</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Start from the Middle</strong></div><p>You often start your timeline with the event you detected first (the 'middle' of the attack). The investigation then works backward to find the initial compromise and forward to find the full scope and impact.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542438408-abb2021e1837?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Final Incident Report Writing",
                            "content": "<p>The final incident report is the formal summary of the entire response effort. It is written after the incident is closed and is often tailored for different audiences.</p><h3>Key Sections of an Incident Report:</h3><ul><li><strong>Executive Summary:</strong> A one-page, high-level overview for a non-technical audience. What happened, what was the impact, and what is being done to prevent it from happening again?</li><li><strong>Detailed Timeline of Events:</strong> A narrative description of the attack, supported by the full event timeline in an appendix.</li><li><strong>Root Cause Analysis:</strong> A detailed explanation of the security failures (technical, procedural, or otherwise) that allowed the incident to occur.</li><li><strong>Response Actions Taken:</strong> A summary of the containment, eradication, and recovery steps.</li><li><strong>Lessons Learned and Recommendations:</strong> Actionable recommendations for improving security controls, policies, and procedures to prevent recurrence. This is the most important section.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Be Prepared for an Audience</strong></div><p>The final report will be read by executives, lawyers, regulators, and auditors. It must be professional, well-written, and based entirely on the facts documented during the investigation.</p></div>",
                            "image": "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Incident Timeline Example (Markdown)",
                        "language": "markdown",
                        "code": "| Timestamp (UTC)   | ATT&CK ID  | Source           | Event Description                                      |\n|-------------------|------------|------------------|--------------------------------------------------------|\n| 2023-08-08 13:15:02 | T1190      | Proxy Log        | User `j.doe` downloaded `invoice.exe` from `1.2.3.4`.  |\n| 2023-08-08 13:16:45 | T1059.001  | EDR (Sysmon)     | `invoice.exe` spawned `powershell.exe` with encoded command.|\n| 2023-08-08 13:20:10 | T1071.001  | Firewall Log     | Host `192.168.1.100` beaconed to C2 server `4.5.6.7`.    |"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "The principle of 'contemporaneous note-taking' means you should:", "options": ["Document your actions at the end of the day", "Document your actions as you are performing them", "Have someone else take notes for you", "Only document the final conclusion"], "correct": 1, "explanation": "Contemporaneous notes are more accurate and reliable because they are created in real-time, reducing the chance of forgetting or misremembering key details." },
                        { "id": 2, "question": "When documenting actions in a case log, what is the best practice for timestamps?", "options": ["Use your local time zone", "Do not use timestamps", "Use UTC (Coordinated Universal Time) for all entries", "Make up a timestamp"], "correct": 2, "explanation": "UTC is the global standard and eliminates all confusion when correlating events between team members and systems in different time zones." },
                        { "id": 3, "question": "Which section of the final incident report is intended for a non-technical, leadership audience?", "options": ["The deep-dive forensic analysis", "The command-line history", "The Executive Summary", "The network packet capture"], "correct": 2, "explanation": "The Executive Summary is a crucial section that boils down the entire incident into a concise overview of the business impact and overall response." },
                        { "id": 4, "question": "What is the most important and actionable section of a final incident report?", "options": ["The list of responders", "The timeline of events", "The executive summary", "The recommendations for preventing recurrence"], "correct": 3, "explanation": "The ultimate goal of the report and the entire Post-Incident phase is to drive improvement. The recommendations are the roadmap for achieving that goal." },
                        { "id": 5, "question": "When taking notes, an analyst should:", "options": ["Include their personal opinions and speculation about who the attacker might be", "Be factual, objective, and avoid emotional language", "Only document actions that were successful", "Write in code to keep it secret"], "correct": 1, "explanation": "Incident notes can become legal evidence. They must be professional and stick to the observable facts." }
                    ]
                }
            },
            
            {
                "id": "lesson-21-recovery-ops",
                "title": "Lesson 21: Recovery Operations",
                "duration": "120 min",
                "objectives": [
                    "Execute system restoration from known-good sources",
                    "Coordinate the resumption of business operations with stakeholders",
                    "Perform intensive monitoring and validation of recovered systems",
                    "Conduct performance testing to ensure systems meet operational requirements"
                ],
                "content": {
                    "overview": "With the threat eradicated, this lesson details the methodical process of recovery. The focus is on safely restoring services, validating system integrity and performance, and ensuring the business returns to normal operations without risking immediate re-infection.",
                    "sections": [
                        {
                            "title": "System Restoration Procedures",
                            "content": "<p>System restoration is the technical process of bringing cleaned and hardened systems back online. This must be a deliberate, phased process, not a rush to flip a switch.</p><h3>Restoration Steps:</h3><ol><li><strong>Use Gold Images:</strong> All systems should be rebuilt from a hardened 'gold image' that has been patched for the vulnerability that was exploited.</li><li><strong>Restore Data Carefully:</strong> Restore application and user data only from backups that have been verified to be clean and from a point in time before the compromise occurred.</li><li><strong>Test in Staging:</strong> Before connecting a system to the production network, bring it up in an isolated 'staging' environment to test its core functionality and connectivity.</li></ol><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Documentation is Key</strong></div><p>Document every step of the restoration process for each system. This creates an audit trail proving that the system was properly cleaned and validated before being put back into service.</p></div>",
                            "image": "https://images.unsplash.com/photo-1579548122216-3841a12d1b5a?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Monitoring and Validation",
                            "content": "<p>Once a system is back on the production network, it enters a period of heightened scrutiny. You must validate that it is both secure and fully functional.</p><h3>Validation Activities:</h3><ul><li><strong>Intensive Monitoring:</strong> The recovered systems should be placed in a high-priority monitoring group in your SIEM and EDR for at least 7-14 days. Alert thresholds should be lowered to flag any minor anomaly.</li><li><strong>Vulnerability Scanning:</strong> Perform a credentialed vulnerability scan against the recovered system to ensure the patch was applied correctly and that no other critical vulnerabilities exist.</li><li><strong>User Acceptance Testing (UAT):</strong> The system's business owner or a designated user must test the application to confirm it is performing its business function correctly.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Look for Beacons of Hope (for the Attacker)</strong></div><p>Pay extremely close attention to any outbound network connections from the recovered system. An attacker whose initial backdoor was removed may have another one that will try to call home once the system is back online.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Post-Recovery Monitoring SIEM Query (Pseudocode)",
                        "language": "sql",
                        "code": "index=* host IN recovered_systems_list\n| `comment(\"Searching only on the list of recently recovered systems\")`\n| stats count by process_name, destination_ip, destination_port\n| `comment(\"Baseline this against known-good systems of the same type to spot anomalies\")`"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is a 'gold image' in the context of system recovery?", "options": ["A backup stored on a gold-plated hard drive", "The original installation disk for the operating system", "A hardened, patched, and standardized template used to build servers", "A photograph of the server before it was compromised"], "correct": 2, "explanation": "A gold image is a pre-configured and security-hardened baseline image that allows for rapid and consistent deployment of clean systems." },
                        { "id": 2, "question": "What is User Acceptance Testing (UAT) in the recovery phase?", "options": ["Security team testing the firewall rules", "The system's business owner testing to confirm the application works correctly", "A test of the backup and restore process", "A final phishing test for the user"], "correct": 1, "explanation": "UAT is a critical final step where the actual users of a system validate that its functionality has been restored to their satisfaction." },
                        { "id": 3, "question": "For what reason should recovered systems be placed under heightened monitoring?", "options": ["To gather marketing data", "To see if they perform faster than before", "To quickly detect any signs of re-infection from a secondary attacker backdoor", "Because it is required by the software vendor"], "correct": 2, "explanation": "The period immediately following recovery is the most likely time for an attacker who had another foothold to attempt to regain access. Intensive monitoring is key to spotting this." }
                    ]
                }
            },
            {
                "id": "lesson-22-post-incident-activities",
                "title": "Lesson 22: Post-Incident Activities",
                "duration": "120 min",
                "objectives": [
                    "Conduct a formal 'lessons learned' meeting",
                    "Perform a Root Cause Analysis (RCA) to identify underlying failures",
                    "Translate findings into actionable process and technology improvements",
                    "Understand how to use metrics to demonstrate the value of the IR program"
                ],
                "content": {
                    "overview": "The incident is closed, but the work is not done. The post-incident phase is where the organization learns and improves. This lesson covers the critical process of conducting a lessons learned review to identify the root causes of the incident and drive meaningful change to prevent it from happening again.",
                    "sections": [
                        {
                            "title": "Lessons Learned Process",
                            "content": "<p>A lessons learned meeting is a formal, 'no-fault' post-mortem discussion involving all members of the incident response team. The goal is to honestly review the entire response process and identify areas for improvement.</p><h3>Key Discussion Points:</h3><ul><li><strong>What went well?</strong> What tools, processes, or people were particularly effective?</li><li><strong>What didn't go well?</strong> Where were the bottlenecks? Did a procedure fail? Was there a gap in visibility?</li><li><strong>What could be improved?</strong> Generate specific, actionable recommendations. Instead of 'we need better communication', a better recommendation is 'we need to create a formal stakeholder communication template and a regular update cadence'.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>No Fault, No Blame</strong></div><p>The success of a lessons learned session depends on creating a psychologically safe environment. The goal is to fix processes, not to blame people. The focus should be on 'what happened?' and 'how can we do better?', not 'who messed up?'.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542626991-cbc4e32524cc?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Root Cause Analysis (RCA)",
                            "content": "<p>Root Cause Analysis is a systematic process for digging deeper than the proximate cause to find the fundamental reason an incident was able to occur. Fixing the root cause provides a more permanent solution.</p><h3>The '5 Whys' Technique:</h3><p>A simple but effective RCA method is to repeatedly ask 'why' until you reach a fundamental process or policy failure.</p><ul><li><strong>Problem:</strong> A server was compromised by a public-facing web vulnerability.</li><li><strong>1. Why?</strong> Because the vulnerability was not patched.</li><li><strong>2. Why?</strong> Because the server was missed during the last patch cycle.</li><li><strong>3. Why?</strong> Because the server was not in the official asset inventory.</li><li><strong>4. Why?</strong> Because there is no formal process for adding new servers to the inventory when they are deployed.</li><li><strong>5. Why?</strong> Because the server deployment policy is undocumented. <em>(This is the root cause).</em></li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Proximate Cause vs. Root Cause</strong></div><p>The proximate cause was the unpatched vulnerability. The root cause was the broken policy. Fixing only the patch gets one server fixed; fixing the root cause ensures all future servers are properly inventoried and patched.</p></div>",
                            "image": "https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Action Item Tracking from Lessons Learned",
                        "language": "markdown",
                        "code": "| # | Finding                                 | Recommendation                               | Owner       | Due Date     | Status      |\n|---|-----------------------------------------|----------------------------------------------|-------------|--------------|-------------|\n| 1 | No documented asset inventory process     | Develop and implement a formal policy.       | Bob Smith   | 2023-09-30   | In Progress |\n| 2 | Communication with leadership was ad-hoc. | Create standard communication templates.       | Alice Jones | 2023-09-15   | Completed   |"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary goal of a 'lessons learned' or post-mortem meeting?", "options": ["To assign blame for the incident", "To identify process and technology gaps in a 'no-fault' environment to drive improvement", "To complete a compliance form", "To calculate the total cost of the incident"], "correct": 1, "explanation": "The entire purpose of the post-incident phase is to learn from the event and make the organization more resilient in the future." },
                        { "id": 2, "question": "The '5 Whys' is a technique used in what process?", "options": ["Malware Analysis", "Root Cause Analysis (RCA)", "Network Packet Capture", "Incident Classification"], "correct": 1, "explanation": "The '5 Whys' helps an investigator move past the immediate technical cause to find the underlying policy or process failure that allowed the incident to happen." },
                        { "id": 3, "question": "What is the most important output of a lessons learned session?", "options": ["A very long meeting transcript", "A list of specific, actionable recommendations with assigned owners and due dates", "A diagram of the attack path", "An email to the entire company about the incident"], "correct": 1, "explanation": "Without actionable follow-up items, the lessons learned meeting is just a discussion. The goal is to drive concrete change." },
                        { "id": 4, "question": "Finding that a server was compromised because an employee wrote their password on a sticky note is the ____ cause. Finding out the company has no password policy or security awareness training is the ____ cause.", "options": ["root / proximate", "only / other", "proximate / root", "simple / complex"], "correct": 2, "explanation": "The sticky note is the immediate (proximate) cause. The lack of a security program to prevent that behavior is the fundamental (root) cause." }
                    ]
                }
            },
            {
                "id": "lesson-23-ir-metrics",
                "title": "Lesson 23: Incident Metrics and Reporting",
                "duration": "120 min",
                "objectives": [
                    "Develop meaningful metrics (KPIs) to measure IR program effectiveness",
                    "Create dashboards and reports for executive leadership",
                    "Use trend analysis to identify recurring problems",
                    "Benchmark your program against industry standards"
                ],
                "content": {
                    "overview": "'You can't improve what you don't measure.' This lesson focuses on developing and tracking key metrics and Key Performance Indicators (KPIs) for your incident response program. Well-chosen metrics allow you to demonstrate your team's value, justify investments, and identify trends that require strategic attention.",
                    "sections": [
                        {
                            "title": "IR Metrics Development",
                            "content": "<p>Good metrics are crucial for managing an IR program. They show how busy your team is (operational metrics) and how effective it is (effectiveness metrics).</p><h3>Key IR Metrics:</h3><ul><li><strong>Mean Time to Detect (MTTD):</strong> The average time from when an incident starts to when your team detects it. A lower MTTD is better.</li><li><strong>Mean Time to Respond (MTTR):</strong> The average time from when an incident is detected to when it is contained. This is a primary measure of your team's efficiency. A lower MTTR is better.</li><li><strong>Number of Incidents by Severity:</strong> Tracks the volume and seriousness of incidents over time.</li><li><strong>Incident Sources:</strong> What percentage of incidents are detected by automated tools vs. user reporting vs. third parties? An increase in user reporting can be a positive sign of a healthy security culture.</li><li><strong>Incidents by Category:</strong> What are the most common types of attacks you are seeing (e.g., phishing, malware, DoS)?</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Automate Collection</strong></div><p>Use your case management system or SIEM to automatically track these metrics. Timestamps for detection, containment, and recovery should be logged for every single incident to make calculating MTTD/MTTR straightforward.</p></div>",
                            "image": "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Executive Reporting",
                            "content": "<p>Metrics must be presented to leadership in a way that is easy to understand and clearly demonstrates the program's value and challenges. This usually takes the form of a monthly or quarterly dashboard.</p><h3>What to Show Leadership:</h3><ul><li><strong>High-Level Trends:</strong> Use simple charts (bar, line) to show trends over time. Is the total number of incidents going up or down? Is the MTTR improving?</li><li><strong>Alignment with Business Goals:</strong> Frame your metrics in terms of business risk. For example, show the number of incidents that affected critical business applications.</li><li><strong>Return on Investment (ROI):</strong> Use metrics to justify budget requests. 'Our MTTR has decreased by 30% since we implemented a SOAR platform, saving an estimated X hours of manual labor per incident.'</li><li><strong>Peer Benchmarking:</strong> Show how your organization's metrics (like MTTD) compare to the industry average. This provides valuable context.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Keep it Simple</strong></div><p>Avoid overly technical jargon. Use red/yellow/green indicators to show status at a glance. An executive should be able to understand the health of your IR program in 60 seconds from looking at your dashboard.</p></div>",
                            "image": "https://images.unsplash.com/photo-1563986768609-322da13575f3?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "Example Metrics Dashboard Layout (Markdown)",
                        "language": "markdown",
                        "code": "## Q3 Incident Response KPIs ##\n\n- **Mean Time to Respond (MTTR):**\n  - Current: 4.5 hours (Green - Improved from 5.2 hours in Q2)\n\n- **Incidents by Severity:**\n  - P1 (Critical): 3\n  - P2 (High): 15\n  - P3 (Medium): 42\n\n- **Top Incident Categories:**\n  1. Phishing / Business Email Compromise (45%)\n  2. Malware on Endpoint (30%)\n  3. Improper Usage (15%)\n\n- **Detection Source:**\n  - Automated Alert: 80%\n  - User Reported: 18% (Yellow - Goal is >20%)\n  - Third Party: 2%"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What does 'Mean Time to Respond' (MTTR) measure?", "options": ["The average time it takes to write a final report", "The average time from when an incident starts to when it's detected", "The average time from when an incident is detected to when it is contained", "The average number of people on the IR team"], "correct": 2, "explanation": "MTTR is a key efficiency metric that measures how quickly the team can act to stop an active incident once they know about it." },
                        { "id": 2, "question": "A steady decrease in your MTTR over several months likely indicates that:", "options": ["The attackers are getting slower", "Your team's processes and tools are becoming more efficient", "You are experiencing fewer incidents", "Your security budget is too high"], "correct": 1, "explanation": "An improving MTTR is a strong indicator of a maturing response capability, often driven by better procedures, training, and automation." },
                        { "id": 3, "question": "When presenting metrics to executive leadership, you should:", "options": ["Focus on deep technical details and use as much jargon as possible", "Use simple charts and frame the data in terms of business risk and program effectiveness", "Show them the raw logs from every incident", "Only show metrics that look good and hide any that show problems"], "correct": 1, "explanation": "Executives need concise, high-level information that helps them understand the business's risk posture and the value of the security program." },
                        { "id": 4, "question": "Tracking the percentage of incidents detected by users is a good way to measure the effectiveness of your:", "options": ["Firewall rules", "Security awareness training program", "Backup strategy", "Patch management program"], "correct": 1, "explanation": "When users become better at spotting and reporting suspicious activity, it's a direct result of effective security awareness training." }
                    ]
                }
            },
            {
                "id": "lesson-24-advanced-threats",
                "title": "Lesson 24: Advanced Threat Response",
                "duration": "120 min",
                "objectives": [
                    "Learn investigative techniques specific to Advanced Persistent Threats (APTs)",
                    "Develop response strategies for malicious insider threats",
                    "Understand how to handle incidents originating from a supply chain compromise",
                    "Analyze tactics used by nation-state actors"
                ],
                "content": {
                    "overview": "This lesson moves into advanced territory, focusing on response strategies for the most sophisticated and challenging types of incidents. We will cover the unique considerations when investigating threats from nation-state actors, malicious insiders, and compromises in the software supply chain.",
                    "sections": [
                        {
                            "title": "APT Investigation Techniques",
                            "content": "<p>Responding to an Advanced Persistent Threat (APT) is a marathon, not a sprint. The attacker may have been in your network for months. The goal is a complete and total eradication, which requires extreme diligence.</p><h3>APT Response Strategy:</h3><ul><li><strong>Prolonged Monitoring ('Silent Running'):</strong> Unlike a standard incident, you do not contain an APT immediately. You silently monitor their activity to understand the full scope of their compromise. What accounts do they have? What systems have they touched? What is their goal?</li><li><strong>Deception Technology:</strong> Use honeypots and honeytokens to observe the attacker's tools and techniques in a safe environment.</li><li><strong>Coordinated Eradication:</strong> The eradication must be a swift, coordinated action where all backdoors are removed, all compromised accounts are reset, and all vulnerabilities are patched *simultaneously*. A piecemeal approach will fail, as the attacker will use a persistence mechanism you missed to get right back in.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Attribution is Hard</strong></div><p>While interesting, attributing an attack to a specific APT group is secondary to the main goal of getting them out of your network. Focus on eradicating the TTPs you observe, regardless of who is behind them.</p></div>",
                            "image": "https://images.unsplash.com/photo-1614064548237-02f8f17374b2?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Insider Threat Response",
                            "content": "<p>Insider threat incidents are exceptionally sensitive, as they involve an employee. The response must be handled with extreme confidentiality and in close partnership with HR and Legal.</p><h3>Unique Considerations:</h3><ul><li><strong>Confidentiality is Paramount:</strong> The investigation must be kept to a very small, need-to-know group to avoid alerting the subject and to protect their privacy until guilt is confirmed.</li><li><strong>Intent Matters:</strong> The first step is often to determine if the insider is acting maliciously (e.g., stealing data for a competitor) or if their actions were unintentional (e.g., a non-malicious policy violation).</li><li><strong>Evidence Collection:</strong> Collection must be done carefully to remain covert. It may also involve sources not typical in external threat cases, such as HR records.</li><li><strong>HR-Led Action:</strong> The final action taken against a malicious insider (e.g., termination, legal action) will be led by HR and Legal, with the security team providing the documented evidence.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Get Legal and HR Involved Immediately</strong></div><p>Do not start a formal insider threat investigation without explicit direction from your legal and human resources departments. There are significant employee privacy and legal implications that they must manage.</p></div>",
                            "image": "https://images.unsplash.com/photo-1556742054-e0e6d6a2f778?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "When responding to a confirmed APT incident, what is the initial recommended strategy?", "options": ["Immediately block their IP addresses and reset all passwords", "Shut down the entire network", "Silently monitor the attacker's activity to understand the full scope of the compromise", "Send a strongly worded email to the attacker"], "correct": 2, "explanation": "With APTs, immediate containment is risky as you may only be burning one of their many access methods. A period of covert monitoring is crucial to find all their backdoors before attempting a coordinated eradication." },
                        { "id": 2, "question": "An incident involving a trusted employee stealing company data requires extremely close coordination with which two departments?", "options": ["Marketing and Sales", "Facilities and Maintenance", "Legal and Human Resources (HR)", "Finance and Accounting"], "correct": 2, "explanation": "Insider threats are primarily a legal and HR issue, with cybersecurity providing the technical evidence to support their actions." },
                        { "id": 3, "question": "An incident where a legitimate software update from a trusted vendor is Trojanized to distribute malware is known as a:", "options": ["Phishing attack", "Denial-of-Service attack", "Supply Chain Incident", "Password spray attack"], "correct": 2, "explanation": "A supply chain attack compromises a trusted third-party vendor or software package to gain access to their customers." },
                        { "id": 4, "question": "What is the primary purpose of a 'coordinated eradication' in an APT response?", "options": ["To slowly remove one backdoor at a time", "To ensure all attacker access methods are removed simultaneously to prevent them from getting back in", "To ask the attacker nicely to leave", "To focus only on patching the initial vulnerability"], "correct": 1, "explanation": "An APT will have multiple persistence mechanisms. You must find them all and remove them all at the same time in a single, decisive action." }
                    ]
                }
            },
            {
                "id": "lesson-25-cloud-ir",
                "title": "Lesson 25: Cloud Incident Response",
                "duration": "120 min",
                "objectives": [
                    "Understand the unique challenges of responding to incidents in the cloud",
                    "Learn to investigate compromises in IaaS, PaaS, and SaaS environments",
                    "Explore tools and techniques for cloud forensics",
                    "Develop response strategies for container security incidents"
                ],
                "content": {
                    "overview": "Incident response in the cloud is different. The ephemeral nature of resources, the shared responsibility model, and the reliance on APIs require new tools and techniques. This lesson covers how to adapt your IR process for incidents in AWS, Azure, and GCP.",
                    "sections": [
                        {
                            "title": "Cloud-Specific IR Challenges",
                            "content": "<p>The cloud operating model introduces new challenges that traditional on-premises IR methodologies don't fully address.</p><h3>Key Challenges:</h3><ul><li><strong>Shared Responsibility Model:</strong> You are responsible for securing what's *in* the cloud, but the Cloud Service Provider (CSP) is responsible for securing the cloud *itself*. Your investigation may require requesting logs or support from your CSP.</li><li><strong>Ephemeral Resources:</strong> Cloud resources like containers and serverless functions can be created and destroyed in seconds. The evidence you need to investigate might disappear before you can collect it if your logging is not configured correctly.</li><li><strong>API-Driven Everything:</strong> Most actions in the cloud are done via API. Attackers can abuse this to programmatically create or destroy infrastructure. Control plane logs (like AWS CloudTrail) are the most critical source of evidence.</li><li><strong>Data Acquisition:</strong> You can't just unplug a hard drive from an S3 bucket. Acquiring forensic data like disk snapshots and memory dumps is done via API calls, not physical access.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Logging, Logging, Logging</strong></div><p>In the cloud, you can't investigate what you don't log. Comprehensive, centralized logging for all cloud services (especially the control plane logs) must be enabled and secured *before* an incident occurs.</p></div>",
                            "image": "https://images.unsplash.com/photo-1607513746974-2c6444f49e75?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "Container Security Incidents",
                            "content": "<p>Containers (like Docker and Kubernetes) are a common way to deploy applications in the cloud, and they present their own IR challenges.</p><h3>Container IR Strategy:</h3><ul><li><strong>Compromised Image in Registry:</strong> The incident may be in the supply chain. An attacker may have pushed a malicious image to your container registry. The response would be to scan the registry, remove the bad image, and rebuild all running containers from a known-good source.</li><li><strong>Container Escape:</strong> An attacker exploits a vulnerability to 'escape' the container and gain access to the underlying host node. The response is to treat the host as fully compromised. The container should be isolated and saved for forensics, and the host should be cordoned off and rebuilt.</li><li><strong>Lateral Movement in Cluster:</strong> An attacker inside one container may try to attack other containers or the Kubernetes control plane itself. The response involves using network policies to isolate the compromised container and analyzing API server logs for signs of abuse.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Focus on the Host and Orchestrator</strong></div><p>While analyzing the compromised container is useful, the highest priority is to secure the container host and the orchestrator (Kubernetes). These are the keys to the kingdom in a containerized environment.</p></div>",
                            "image": "https://images.unsplash.com/photo-1579543183319-a16eee1b1fd3?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "codeExamples": [
                    {
                        "title": "AWS CLI command for Disk Snapshot (Forensics)",
                        "language": "bash",
                        "code": "# Take a forensic snapshot of an EC2 instance's EBS volume.\n# The snapshot is a point-in-time copy of the disk you can attach to a forensic workstation for analysis.\naws ec2 create-snapshot --volume-id vol-0123456789abcdef0 --description \"Forensic snapshot for case IR-2023-091\""
                    },
                    {
                        "title": "Kubernetes `kubectl` Command for Host Cordoning",
                        "language": "bash",
                        "code": "# The 'cordon' command marks a node as unschedulable. This prevents any new pods/containers from being scheduled on the compromised host.\nkubectl cordon k8s-node-01"
                    }
                ],
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "In the cloud's shared responsibility model, what is the customer always responsible for?", "options": ["Securing the physical datacenter", "Patching the hypervisor", "Securing their own data and configuring their cloud services correctly", "Managing the power and cooling"], "correct": 2, "explanation": "The customer is always responsible for the security *of* their workloads *in* the cloud, which includes their data, identity and access management, and network configurations." },
                        { "id": 2, "question": "What is the single most important log source for investigating incidents in a public cloud environment?", "options": ["Application logs", "Operating system logs", "The cloud provider's control plane logs (e.g., AWS CloudTrail, Azure Activity Log)", "Network flow logs"], "correct": 2, "explanation": "The control plane log is the ground truth audit trail of every action and API call made in your cloud account, from creating a VM to changing a security group." },
                        { "id": 3, "question": "The term 'ephemeral' in the context of cloud IR means that:", "options": ["Cloud resources are permanent and never change", "Cloud resources can be created and destroyed very quickly, making evidence volatile", "The cloud is less secure than on-premises", "All data in the cloud is automatically encrypted"], "correct": 1, "explanation": "Ephemerality is a key challenge; if logging is insufficient, a compromised container might be deleted before an investigator can ever examine it." },
                        { "id": 4, "question": "A 'container escape' refers to an attacker doing what?", "options": ["Deleting a container", "Exploiting a vulnerability to break out of a container and gain access to the underlying host server", "Starting a new container", "Scanning a container for vulnerabilities"], "correct": 1, "explanation": "A container escape is a critical security event that escalates a compromise from a single application container to the host it runs on, with much broader impact." }
                    ]
                }
            },
            {
                "id": "lesson-26-mobile-ir",
                "title": "Lesson 26: Mobile Device Incidents",
                "duration": "120 min",
                "objectives": [
                    "Learn fundamental mobile forensics techniques",
                    "Develop response plans for Bring Your Own Device (BYOD) environments",
                    "Understand how to respond to mobile malware and phishing",
                    "Use Mobile Device Management (MDM) tools for response actions"
                ],
                "content": {
                    "overview": "Mobile devices are endpoints, and they are increasingly targeted by attackers. This lesson covers the unique aspects of responding to incidents on iOS and Android devices, the challenges of BYOD, and the critical role of Mobile Device Management platforms in a response.",
                    "sections": [
                        {
                            "title": "Mobile Forensics Techniques",
                            "content": "<p>Mobile forensics differs significantly from traditional computer forensics due to the closed nature of mobile operating systems and the use of flash storage.</p><h3>Data Acquisition Challenges:</h3><ul><li><strong>Logical Acquisition:</strong> This acquires the files and data accessible to the user through normal means, like a backup. It is the easiest method but does not get deleted data.</li><li><strong>File System Acquisition:</strong> This acquires all files in the device's file system, including system files and some deleted data. It often requires 'rooting' (Android) or 'jailbreaking' (iOS), which is an invasive process.</li><li><strong>Physical Acquisition:</strong> A bit-for-bit copy of the flash memory. This is the most comprehensive method but is difficult to achieve on modern, encrypted devices.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>MDM is Your Primary Source</strong></div><p>For most corporate incidents, you won't perform deep forensics. Your primary source of evidence will be the logs from your Mobile Device Management (MDM) or Unified Endpoint Management (UEM) solution, which provides information about the device's health, installed apps, and compliance status.</p></div>",
                            "image": "https://images.unsplash.com/photo-1585250184288-5175908b083c?w=800&h=400&fit=crop"
                        },
                        {
                            "title": "BYOD Incident Handling",
                            "content": "<p>Bring Your Own Device (BYOD) policies create significant legal and privacy challenges for incident response. Since the device is owned by the employee, the company's right to investigate it is limited.</p><h3>BYOD Response Strategy:</h3><ul><li><strong>Clear, Upfront Policy:</strong> The BYOD policy that employees sign must clearly state what actions the company is authorized to take in the event of a security incident. This includes the right to perform a remote wipe of corporate data.</li><li><strong>Containerization:</strong> The best approach for BYOD. Use an MDM solution to create an encrypted, managed 'container' on the device. All corporate data (email, apps, files) lives inside this container. During an incident, you can legally wipe the container without touching the employee's personal photos and data.</li><li><strong>Focus on Corporate Data:</strong> The investigation must focus solely on the potential compromise of company data. Investigating the employee's personal data is a major privacy violation.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Get Consent</strong></div><p>You cannot simply seize an employee's personal phone and perform a forensic analysis without their consent or a court order. Your BYOD policy is the legal basis for any response actions you take on a personal device.</p></div>",
                            "image": "https://images.unsplash.com/photo-1544228943-8588824f19b2?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the biggest challenge when responding to an incident on a personal device in a BYOD environment?", "options": ["Mobile devices have no logs", "The employee's privacy rights limit the company's ability to investigate", "Mobile devices are not powerful enough to get malware", "The screens are too small"], "correct": 1, "explanation": "The legal and privacy line between the employee's personal data and the company's data is the central challenge in any BYOD incident." },
                        { "id": 2, "question": "What is the primary function of a Mobile Device Management (MDM) solution in incident response?", "options": ["To analyze malware", "To provide a secure, manageable container for corporate data and allow for remote actions like wiping that container", "To track the user's physical location at all times", "To perform a physical forensic acquisition"], "correct": 1, "explanation": "An MDM is the key response tool, allowing the company to enforce policy, check for compliance, and take remote action on the corporate data it manages." },
                        { "id": 3, "question": "A remote command sent from an MDM to delete only the company's email and files from an employee's phone is called a:", "options": ["Full Wipe", "Device Brick", "Selective Wipe", "Logical Acquisition"], "correct": 2, "explanation": "A selective wipe is the ideal containment action in a BYOD scenario, as it removes the corporate data (which the company has a right to do) without destroying the employee's personal data." }
                    ]
                }
            },
            {
                "id": "lesson-27-iot-ot-incidents",
                "title": "Lesson 27: IoT and OT Incidents",
                "duration": "120 min",
                "objectives": [
                    "Understand unique challenges of responding to incidents involving Industrial Control Systems (ICS)",
                    "Respond to compromises of Internet of Things (IoT) devices",
                    "Analyze the intersection of OT and IT networks during an investigation",
                    "Balance security needs with the primary requirement of safety in OT environments"
                ],
                "content": {
                    "overview": "This lesson explores the highly specialized fields of incident response for Internet of Things (IoT) and Operational Technology (OT) / Industrial Control Systems (ICS). These 'non-traditional' IT environments require different tools, techniques, and, most importantly, a different mindset, where physical safety often takes precedence.",
                    "sections": [
                        {
                            "title": "IoT Device Compromise Response",
                            "content": "<p>'IoT' covers a massive range of devices, from security cameras and smart TVs to medical devices. They are often unmanaged, unpatched, and have poor security, making them a common target.</p><h3>IoT IR Challenges:</h3><ul><li><strong>Lack of Visibility:</strong> Most IoT devices do not have EDR agents and produce minimal logs, making it very difficult to investigate a compromise directly. Analysis is almost entirely network-based.</li><li><strong>Containment through Segmentation:</strong> The best containment strategy is network segmentation. All IoT devices should be on their own isolated network segment that cannot initiate connections to the corporate network. Response often involves identifying the compromised device via its network traffic and blocking its MAC address.</li><li><strong>The 'Reboot and Pray' Problem:</strong> For many simple IoT devices, the only 'eradication' method is to reboot it (which may clear memory-resident malware) and change its default password. A full-scale compromise may require a factory reset or complete replacement.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Mirai Botnet</strong></div><p>The Mirai botnet was a wake-up call for IoT security. It worked by constantly scanning the internet for IoT devices (like cameras and routers) that were still using their factory-default passwords, compromising them, and using them to launch massive DDoS attacks.</p></div>",
                            "image": "https://images.unsplash.com/photo-1544890225-2fde1e46f71b?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Safety vs. Security in OT",
                            "content": "<p>When responding to an incident in an OT environment (e.g., a power plant, manufacturing floor), the overriding priority is safety. A security action that could cause a physical process to become unstable or unsafe must be avoided at all costs.</p><h3>The Priority Inversion:</h3><ul><li><strong>In IT:</strong> The security priority is Confidentiality, then Integrity, then Availability (CIA).</li><li><strong>In OT:</strong> The priority is Availability and Safety first, then Integrity, then Confidentiality. Keeping the physical process running safely is paramount.</li></ul><h3>Response Coordination:</h3><p>Incident response in an OT environment is not led by the security team. It is led by the plant or operations engineering team. The security team acts as a subject matter expert, providing analysis and recommending actions that the operations team must approve and implement, ensuring they will not impact safety.</p><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>'Do No Harm'</strong></div><p>This is the absolute first principle of OT IR. Never take an action on an OT system without the explicit approval and supervision of the engineering staff who manage it. The consequences of a mistake are not just data loss; they can be physical damage or human injury.</p></div>",
                            "image": "https://images.unsplash.com/photo-1614113168853-39f1577f152d?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "In an Operational Technology (OT) environment, what is the highest priority during an incident response?", "options": ["Ensuring the confidentiality of the data", "Maintaining the safety and availability of the physical process", "Finding the attacker's identity", "Completing the report within 24 hours"], "correct": 1, "explanation": "The primary mission of an OT system is to safely control the physical world. The security response must support, and never undermine, that mission." },
                        { "id": 2, "question": "What is the most effective security control and containment strategy for a network of IoT devices?", "options": ["Installing antivirus on each device", "Placing them on an isolated network segment with strict firewall rules", "Training the IoT devices not to click on phishing links", "Requiring multi-factor authentication for each device"], "correct": 1, "explanation": "Since IoT devices are often unmanageable, the best way to control them is at the network layer. Segmentation limits the damage they can do if compromised." },
                        { "id": 3, "question": "Who leads the incident response effort during a cybersecurity incident affecting a factory floor control system?", "options": ["The IT security team", "The plant's engineering and operations team", "The company's legal counsel", "The CEO"], "correct": 1, "explanation": "The OT engineers are the experts on the physical process. The IR team advises them on security matters, but the operations team has the final say on any action that could affect the system." },
                        { "id": 4, "question": "Analysis of a compromised IoT device is most often performed using what type of evidence?", "options": ["A full forensic image of the hard drive", "A memory dump from the device", "The device's own internal logs", "Network traffic analysis of the device's connections"], "correct": 3, "explanation": "Because most IoT devices lack logging and are difficult to image, analyzing the network traffic to and from the device is often the only way to investigate its activity." }
                    ]
                }
            },
            {
                "id": "lesson-28-soar",
                "title": "Lesson 28: Automation and Orchestration",
                "duration": "120 min",
                "objectives": [
                    "Integrate a SOAR (Security Orchestration, Automation, and Response) platform with other tools",
                    "Develop automated response workflows (playbooks)",
                    "Differentiate between automation and orchestration",
                    "Understand the value of automating repetitive IR tasks"
                ],
                "content": {
                    "overview": "To scale incident response and reduce responder fatigue, teams turn to automation. This lesson covers SOAR platforms, which allow you to automate and orchestrate the manual, repetitive tasks in your IR processes, freeing up analysts to focus on what matters most: critical thinking and investigation.",
                    "sections": [
                        {
                            "title": "SOAR Platform Integration",
                            "content": "<p>A SOAR platform acts as a force multiplier for the IR team. It sits in the middle of your security stack, integrating with all your other tools via APIs.</p><h3>How SOAR Works:</h3><ul><li><strong>Ingestion:</strong> It ingests alerts from your detection sources (like the SIEM or EDR).</li><li><strong>Orchestration:</strong> For each alert, it triggers a 'playbook'—a pre-defined workflow.</li><li><strong>Automation:</strong> The playbook executes automated actions by making API calls to other tools.</li><li><strong>Case Management:</strong> It provides a central hub for managing cases, documenting evidence, and tracking metrics.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Automation vs. Orchestration</strong></div><p><strong>Automation</strong> is performing a single task without human intervention (e.g., a script to block an IP). <strong>Orchestration</strong> is stringing together multiple automated tasks across different tools to achieve a full workflow (e.g., analyze a phishing email, find all recipients, delete the emails, and block the IP).</p></div>",
                            "image": "https://images.unsplash.com/photo-1593064390382-2c63824f5a83?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Playbook Development",
                            "content": "<p>A playbook codifies your Standard Operating Procedures (SOPs) into an automated workflow. The goal is to automate the mundane, repeatable tasks that an analyst would normally perform manually.</p><h3>Example: Phishing Playbook</h3><ol><li><strong>Trigger:</strong> Alert from phishing inbox.</li><li><strong>Enrichment (Automated):</strong> Extract URL. Submit to sandbox. Check reputation of sender IP. Search SIEM to see if anyone clicked the link.</li><li><strong>Decision (Human-in-the-loop):</strong> Post all findings to a chat channel and ask an analyst: 'Is this malicious?'.</li><li><strong>Containment (Automated on 'Yes'):</strong> Delete the email from all inboxes. Block sender domain and IP. Add URL to proxy blocklist.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Start by Automating Enrichment</strong></div><p>The safest and often most valuable place to start with SOAR is by automating data enrichment. Automatically gathering all the necessary context for an alert can save an analyst 15-30 minutes per investigation, which adds up incredibly quickly.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542708944-9721d234a413?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What does SOAR stand for?", "options": ["Security Observation, Analysis, and Remediation", "System Orchestration and Automated Response", "Security Orchestration, Automation, and Response", "Software Observation and Risk Assessment"], "correct": 2, "explanation": "SOAR focuses on three key capabilities: Orchestrating workflows, Automating tasks, and facilitating a Response." },
                        { "id": 2, "question": "In a SOAR platform, what is a 'playbook'?", "options": ["The user manual for the software", "A step-by-step, automated workflow that codifies an IR procedure", "A list of compromised user accounts", "A report sent to the CEO"], "correct": 1, "explanation": "A playbook is the executable, automated version of a Standard Operating Procedure (SOP)." },
                        { "id": 3, "question": "What is the primary benefit of using a SOAR platform?", "options": ["It reduces the MTTR by automating manual, repetitive tasks and standardizing processes", "It replaces the need for a SIEM", "It makes your network physically more secure", "It makes all security alerts false positives"], "correct": 0, "explanation": "SOAR's core value proposition is making the response process faster and more consistent, which directly reduces Mean Time to Respond (MTTR)." },
                        { "id": 4, "question": "Automatically gathering IP reputation, file hashes, and user information when an alert comes in is an example of what?", "options": ["Automated Containment", "Automated Enrichment", "Automated Eradication", "Automated Reporting"], "correct": 1, "explanation": "Enrichment is the process of adding context to an alert. Automating this step is a huge time-saver for analysts." }
                    ]
                }
            },
            {
                "id": "lesson-29-threat-intel",
                "title": "Lesson 29: Threat Intelligence Integration",
                "duration": "120 min",
                "objectives": [
                    "Integrate threat intelligence into the IR process",
                    "Use intelligence for attribution analysis and threat actor profiling",
                    "Understand the value of intelligence sharing communities",
                    "Conduct an investigation driven by threat intelligence"
                ],
                "content": {
                    "overview": "Threat intelligence provides critical context that transforms an investigation from analyzing isolated events to understanding a broader campaign. This lesson covers how to effectively use threat intelligence to identify attacker infrastructure, profile adversaries, and pivot your investigation to find previously unknown compromises.",
                    "sections": [
                        {
                            "title": "Threat Intelligence in IR",
                            "content": "<p>Threat Intelligence (TI) is evidence-based knowledge about an existing or emerging threat. In incident response, it provides crucial context.</p><h3>Levels of Intelligence:</h3><ul><li><strong>Strategic:</strong> High-level information about the threat landscape and adversary motivations. Used by leadership to inform risk decisions.</li><li><strong>Operational:</strong> Information about adversary TTPs (Tactics, Techniques, and Procedures). Used by IR teams to build detections and guide threat hunts.</li><li><strong>Tactical:</strong> Specific, technical indicators of compromise (IOCs), like IP addresses, domains, and file hashes. Used by SOCs for real-time blocking and detection.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Pyramid of Pain</strong></div><p>This concept states that it is trivial for attackers to change some IOCs (like hash values and IP addresses), but very difficult and costly for them to change their core TTPs. A mature defense focuses on detecting and responding to TTPs, not just IOCs.</p></div>",
                            "image": "https://images.unsplash.com/photo-1599373922312-5b9340d8a5a5?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Intelligence-Driven Investigation",
                            "content": "<p>Threat intelligence allows an investigator to pivot from a single indicator to uncover an entire campaign.</p><h3>The Pivot Workflow:</h3><ol><li><strong>Initial IOC:</strong> Your EDR detects a malicious file hash on a workstation.</li><li><strong>Enrich:</strong> You look up this hash in your Threat Intelligence Platform (TIP). The TIP tells you this hash is associated with the threat actor APT41 and provides a list of C2 domains they commonly use.</li><li><strong>Pivot and Hunt:</strong> You now take that list of C2 domains and search your SIEM and DNS logs to see if *any* other hosts in your network have tried to communicate with them.</li><li><strong>Discover New Compromises:</strong> Your search reveals two other hosts that were beaconing to one of those domains but had not been detected by your EDR. You have just pivoted from one IOC to discover two more compromised machines.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Intelligence Sharing</strong></div><p>Sharing your own indicators with a trusted community (like an ISAC - Information Sharing and Analysis Center) is a critical part of the ecosystem. The indicators you share from your incident today may help another company prevent one tomorrow.</p></div>",
                            "image": "https://images.unsplash.com/photo-1563905788977-62b714f520b2?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "Specific, technical indicators like malicious IP addresses and file hashes are what kind of threat intelligence?", "options": ["Strategic", "Operational", "Tactical", "Hypothetical"], "correct": 2, "explanation": "Tactical intelligence consists of the concrete, technical IOCs that can be used for immediate, automated detection and blocking." },
                        { "id": 2, "question": "What is the primary idea behind the 'Pyramid of Pain'?", "options": ["Incident response is always painful", "The goal of a defense should be to target the adversary's TTPs, which are much harder for them to change than simple IOCs like IP addresses", "Strategic intelligence is the most important", "Incident reports should be formatted as a pyramid"], "correct": 1, "explanation": "Forcing an attacker to change their fundamental tools and techniques (the top of the pyramid) inflicts much more 'pain' on them than forcing them to use a new IP address (the bottom)." },
                        { "id": 3, "question": "An ISAC is an organization that facilitates what?", "options": ["Software development", "Threat intelligence sharing among organizations in a specific industry sector (e.g., finance, healthcare)", "The sale of cybersecurity products", "Government regulation"], "correct": 1, "explanation": "Information Sharing and Analysis Centers (ISACs) are a key part of the threat intelligence ecosystem, enabling trusted, sector-specific collaboration." }
                    ]
                }
            },
            {
                "id": "lesson-30-ir-program-management",
                "title": "Lesson 30: IR Program Management",
                "duration": "120 min",
                "objectives": [
                    "Establish governance and oversight for the IR program",
                    "Manage budget planning and resource allocation",
                    "Handle vendor and MSSP relationships effectively",
                    "Drive a culture of continuous improvement for the program"
                ],
                "content": {
                    "overview": "An incident response capability is more than just a technical team; it's a formal program that must be managed. This lesson covers the business and management aspects of running a successful IR program, from governance and budgeting to vendor management and long-term strategy.",
                    "sections": [
                        {
                            "title": "Program Governance",
                            "content": "<p>Program governance establishes the framework of authority, accountability, and oversight for the entire incident response capability.</p><h3>Governance Components:</h3><ul><li><strong>Steering Committee:</strong> A senior leadership group (often including the CISO, CIO, Head of Legal, and key business leaders) that provides strategic direction, approves the IR policy, and oversees the program's budget and effectiveness.</li><li><strong>Formal Charter:</strong> A document that formally establishes the IR team, outlines its mission and authority, and defines its scope of operations.</li><li><strong>Defined Metrics and Reporting:</strong> The program must have clear KPIs (as discussed in Lesson 23) that are regularly reported to the steering committee to demonstrate performance and justify resources.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>From Ad-Hoc to Mature</strong></div><p>Governance is what elevates an IR team from an ad-hoc, reactive group to a mature, recognized business program with a formal mandate and executive support.</p></div>",
                            "image": "https://images.unsplash.com/photo-1552664730-d307ca884978?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Vendor Management",
                            "content": "<p>Most organizations rely on third-party vendors for some aspect of their IR capability. This can range from tool providers to full-service incident response retainers.</p><h3>Managing IR Vendors:</h3><ul><li><strong>IR Retainers:</strong> Many companies contract with a specialized cybersecurity firm to have their expert responders on call. When selecting a retainer, review the Service Level Agreement (SLA) carefully. What is the guaranteed response time? How many hours are included?</li><li><strong>Managed Security Service Providers (MSSPs):</strong> If you outsource your SOC, it is critical to have a clearly defined process for how the MSSP escalates a confirmed incident to your internal IR team. This must be practiced via regular drills.</li><li><strong>Tool Vendors:</strong> Manage your relationship with your key security tool vendors. Ensure you have access to technical support and a clear understanding of their product roadmap.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Pre-Approved Contracts</strong></div><p>The middle of a crisis is not the time to be negotiating contracts and legal terms with a third-party IR firm. Have a retainer in place *before* you need it, with all Master Service Agreements and Statements of Work signed and ready to go.</p></div>",
                            "image": "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "A senior leadership group that provides strategic direction and budget oversight for the IR program is known as a:", "options": ["Technical Response Team", "Steering Committee", "Focus Group", "Red Team"], "correct": 1, "explanation": "A steering committee provides the necessary governance and executive sponsorship for a successful IR program." },
                        { "id": 2, "question": "What is the primary advantage of having a pre-signed incident response retainer with a third-party cybersecurity firm?", "options": ["It guarantees you will never have a security incident", "It gets you a discount on their software", "It eliminates the need for an internal security team", "It dramatically reduces the time to get expert help during a crisis by handling legal and contractual issues in advance"], "correct": 3, "explanation": "A retainer ensures that when you have a major incident, you can get expert help on the phone in hours, not days or weeks." },
                        { "id": 3, "question": "The continuous cycle of testing, learning, and improving the IR program based on exercises and real incidents is a hallmark of:", "options": ["A brand new program", "A mature program focused on continuous improvement", "A program with no budget", "A program that is about to be outsourced"], "correct": 1, "explanation": "Maturity in IR is defined by the commitment to a continuous improvement lifecycle, driven by the lessons learned process." }
                    ]
                }
            },
            {
                "id": "lesson-31-ransomware-response",
                "title": "Lesson 31: Ransomware Response",
                "duration": "120 min",
                "objectives": [
                    "Identify key indicators of an active ransomware outbreak",
                    "Execute rapid containment strategies to stop the spread",
                    "Evaluate recovery options, including restoration from backup",
                    "Understand the technical and business considerations around making a ransom payment"
                ],
                "content": {
                    "overview": "Ransomware is one of the most destructive and high-pressure incidents a team can face. This lesson provides a dedicated look at ransomware response, focusing on the speed required for containment, the critical importance of backups, and the complex decision-making process around the ransom itself.",
                    "sections": [
                        {
                            "title": "Ransomware Detection and Containment",
                            "content": "<p>Modern ransomware moves incredibly fast, often spreading across the network in minutes. Detection and containment must be equally rapid.</p><h3>Detection Indicators:</h3><ul><li><strong>High Volume of File Modifications:</strong> EDR or File Integrity Monitoring (FIM) tools detect a single process rapidly reading, encrypting, and renaming thousands of files.</li><li><strong>Known Ransomware File Extensions:</strong> Files being renamed with extensions like `.L0CKED`, `.crypted`, etc.</li><li><strong>Deletion of Volume Shadow Copies:</strong> Ransomware often runs `vssadmin.exe delete shadows` to prevent easy restoration. This is a very high-fidelity indicator.</li></ul><h3>Containment is about Speed:</h3><p>The primary goal is to stop the encryption from spreading. Isolate the infected hosts IMMEDIATELY. This is not a scenario for quiet monitoring. Every second counts. If multiple machines are affected, consider shutting down entire network segments to create a firebreak.</p><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Identify Patient Zero</strong></div><p>While isolating all affected hosts, the investigation must race to find 'Patient Zero'—the first machine that was compromised. This is critical for finding the initial access vector (e.g., a phishing email) and understanding the root cause.</p></div>",
                            "image": "https://images.unsplash.com/photo-1614064548237-02f8f17374b2?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Recovery and Negotiation",
                            "content": "<p>Once contained, the focus shifts to recovery. This is where the quality of your backup and recovery plan is truly tested.</p><h3>Recovery Options:</h3><ol><li><strong>Restore from Backup (The Best Option):</strong> Wipe the affected systems and restore from known-good, offline, and immutable backups. This is the only guaranteed way to recover without paying. You MUST test your backups regularly to ensure they work.</li><li><strong>Use Public Decryptors:</strong> For some older or weaker ransomware variants, law enforcement or security researchers have released free decryptor tools.</li><li><strong>Pay the Ransom (The Last Resort):</strong> This is a complex business and legal decision, not a technical one.</li></ol><h3>To Pay or Not to Pay?:</h3><p>This decision is made by executive leadership and legal counsel. Factors to consider:</p><ul><li><strong>Is there any other way to recover the data?</strong> If backups failed, there may be no choice.</li><li><strong>Will the decryptor even work?</strong> There is no guarantee.</li><li><strong>Will you be targeted again?</strong> Paying proves you are a willing customer.</li><li><strong>Is it legal?</strong> Paying a ransom to a sanctioned entity may be illegal.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Double Extortion</strong></div><p>Modern ransomware gangs don't just encrypt your data; they also steal it first. They then threaten to leak the data publicly if you don't pay. This turns a ransomware incident into a data breach, even if you can restore from backups, and may trigger breach notification requirements.</p></div>",
                            "image": "https://images.unsplash.com/photo-1548092372-6a7e3206a5a2?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the most urgent and critical first step when an active ransomware outbreak is detected?", "options": ["Begin writing the final incident report", "Perform a root cause analysis", "Immediately isolate the affected hosts to prevent the encryption from spreading", "Calculate the total cost of the incident"], "correct": 2, "explanation": "With ransomware, speed is everything. The immediate priority is to contain the blast radius and stop more files from being encrypted." },
                        { "id": 2, "question": "Observing the command `vssadmin.exe delete shadows` is a strong indicator of what?", "options": ["A normal backup process", "A user trying to free up disk space", "A ransomware attack attempting to prevent system restoration", "A software installation"], "correct": 2, "explanation": "This is a classic ransomware TTP. Deleting shadow copies makes it much harder for a victim to recover files without paying." },
                        { "id": 3, "question": "The strategy where attackers steal data *before* encrypting it and threaten to leak it is called:", "options": ["Phishing", "Denial of Service", "Double Extortion", "Insider Trading"], "correct": 2, "explanation": "Double extortion adds data theft to the encryption, putting additional pressure on the victim to pay and turning the event into a data breach." },
                        { "id": 4, "question": "The decision to pay a ransom should be made by:", "options": ["The forensic investigator", "The IT help desk", "Executive leadership, in consultation with legal counsel and cyber insurance", "The public relations team"], "correct": 2, "explanation": "This is a major business, financial, and legal decision with serious consequences and must be made at the highest levels of the organization." }
                    ]
                }
            },
            {
                "id": "lesson-32-data-breach-response",
                "title": "Lesson 32: Data Breach Response",
                "duration": "120 min",
                "objectives": [
                    "Understand the specific steps of responding to a confirmed data breach",
                    "Perform data classification and impact assessment for notification purposes",
                    "Manage the breach notification process for customers and regulators",
                    "Implement post-breach services like credit monitoring"
                ],
                "content": {
                    "overview": "When sensitive data is stolen, an incident becomes a data breach, triggering a host of legal and public relations requirements. This lesson details the specific workflow for a data breach, focusing on the critical steps of data analysis, notification, and managing the public fallout.",
                    "sections": [
                        {
                            "title": "Data Classification and Impact Assessment",
                            "content": "<p>Once you confirm data was exfiltrated, the next critical question is: *what* data was it? This determination drives the rest of the response.</p><h3>The Analysis Process:</h3><ol><li><strong>Identify the Scope:</strong> Forensic analysis must determine the exact servers, databases, or file shares that were accessed by the attacker.</li><li><strong>Analyze the Data:</strong> A data analysis team, working with legal counsel, must analyze the compromised data to determine what specific data elements were present.</li><li><strong>Classify the Data:</strong> The data is then classified. Was it public information? Confidential intellectual property? Or, most importantly, was it regulated data like Personally Identifiable Information (PII) or Protected Health Information (PHI)?</li></ol><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Legal Holds the Definitions</strong></div><p>The definition of PII varies by jurisdiction. The legal team is responsible for determining if the compromised data elements (e.g., name, address, Social Security Number, driver's license number) meet the legal definition of PII in the relevant states or countries, which is what triggers notification laws.</p></div>",
                            "image": "https://images.unsplash.com/photo-1555949963-ff980877a232?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Notification Procedures",
                            "content": "<p>If regulated data was breached, you must notify the affected individuals and, in many cases, regulators. This is a highly managed process run by legal and public relations.</p><h3>Notification Steps:</h3><ul><li><strong>Identify Affected Population:</strong> The data analysis determines the exact list of individuals whose PII was compromised.</li><li><strong>Draft the Notification Letter:</strong> Legal counsel will draft a formal notification letter that complies with all relevant laws. It typically explains what happened, what data was involved, what the company is doing in response, and what steps the individual can take to protect themselves.</li><li><strong>Notify Regulators:</strong> Fulfill any legal requirements to notify authorities like State Attorneys General or Data Protection Authorities.</li><li><strong>Set Up a Call Center:</strong> For a large breach, you must set up a dedicated call center to handle the influx of questions from affected individuals.</li><li><strong>Offer Credit Monitoring:</strong> It is standard practice to offer free credit and identity theft monitoring services to all affected individuals for 1-2 years.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Timing is Everything</strong></div><p>Do not notify until the investigation is complete and you are certain about the scope and nature of the data. Premature, inaccurate notification can create more confusion and damage trust. However, you must also comply with the legal deadlines (like GDPR's 72 hours), which creates intense pressure.</p></div>",
                            "image": "https://images.unsplash.com/photo-1587593673759-24b3b5e4a7a8?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the key event that turns a security incident into a data breach?", "options": ["A server goes offline", "An employee violates the AUP", "The confirmed, unauthorized acquisition of sensitive, regulated data", "The detection of malware on a workstation"], "correct": 2, "explanation": "A data breach specifically refers to an incident where confidential data like PII or PHI is stolen by an unauthorized party." },
                        { "id": 2, "question": "Who is primarily responsible for determining if stolen data meets the legal definition of PII and requires notification?", "options": ["The forensic analyst", "The legal department", "The help desk", "The CEO"], "correct": 1, "explanation": "This is a legal analysis. The technical team provides the 'what', and the legal team provides the 'so what' in terms of legal obligations." },
                        { "id": 3, "question": "Why is it common practice to offer free credit monitoring after a PII data breach?", "options": ["Because it is a fun gift for customers", "To help victims detect if the stolen information is being used for identity theft or financial fraud", "To meet a technical compliance requirement", "To increase the company's profits"], "correct": 1, "explanation": "Offering credit monitoring is a standard part of the response, designed to help protect the victims from further harm and to show that the company is taking the event seriously." }
                    ]
                }
            },
            {
                "id": "lesson-33-bec-response",
                "title": "Lesson 33: Business Email Compromise",
                "duration": "120 min",
                "objectives": [
                    "Recognize common Business Email Compromise (BEC) attack patterns",
                    "Conduct financial investigations related to fraudulent transfers",
                    "Understand the process for attempting to recover fraudulently wired funds",
                    "Implement preventative measures to reduce BEC risk"
                ],
                "content": {
                    "overview": "Business Email Compromise (BEC) is a form of phishing where attackers impersonate executives to trick employees into making unauthorized wire transfers. It is one of the most financially damaging types of cybercrime. This lesson covers how to respond to a BEC incident, with a focus on the race to recover the money.",
                    "sections": [
                        {
                            "title": "BEC Attack Patterns",
                            "content": "<p>BEC attacks rely on social engineering, not malware. The attacker's goal is to trick an employee in the finance or HR department into sending money or sensitive information.</p><h3>Common Scenarios:</h3><ul><li><strong>CEO Fraud:</strong> The attacker spoofs or compromises the CEO's email and instructs the CFO to immediately process an urgent, confidential wire transfer for a fake acquisition.</li><li><strong>Vendor Email Compromise:</strong> The attacker compromises the email account of one of your company's real vendors. They then find a real invoice and send a follow-up email from the legitimate account telling you the vendor's bank account has changed and to send the payment to a new, fraudulent account.</li><li><strong>Gift Card Scams:</strong> An attacker impersonates a boss and asks a subordinate to urgently buy hundreds of dollars in gift cards for a customer event and send them the codes.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>No Malware Involved</strong></div><p>Since most BEC attacks don't involve a malicious link or attachment, they often bypass traditional email security filters. The 'payload' is the psychological manipulation in the email's text.</p></div>",
                            "image": "https://images.unsplash.com/photo-1584433144853-6d3c470876d2?w=800&h=400&fit-crop"
                        },
                        {
                            "title": "Financial Investigation and Recovery",
                            "content": "<p>If a fraudulent transfer is made, time is absolutely critical. There is a very short window where funds can be recovered.</p><h3>The Recovery Scramble:</h3><ol><li><strong>Immediately contact your bank:</strong> Notify your bank's fraud department of the fraudulent transfer. Provide all details: amount, receiving bank, account number, time. They can initiate a recall request.</li><li><strong>Contact the FBI:</strong> File a complaint with the FBI's Internet Crime Complaint Center (IC3). They have a Recovery Asset Team that works with banks to freeze fraudulent transfers, but they must be notified very quickly.</li><li><strong>Investigate Internally:</strong> Analyze email logs and headers to confirm the scope of the compromise. Did the attacker compromise an internal account or just spoof a display name? If an account was compromised, it must be secured immediately.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>The First 72 Hours are Critical</strong></div><p>The chance of recovering fraudulently wired funds drops dramatically after 72 hours. An immediate, practiced response is essential.</p></div>",
                            "image": "https://images.unsplash.com/photo-1556741533-4020f1b29a28?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary goal of a Business Email Compromise (BEC) attacker?", "options": ["To install ransomware", "To trick an employee into making a fraudulent wire transfer or sending sensitive data", "To perform a Denial-of-Service attack", "To steal the company's website"], "correct": 1, "explanation": "BEC is a financially motivated crime focused on wire transfer fraud through social engineering." },
                        { "id": 2, "question": "In a BEC incident where money was transferred, what are the two most critical and time-sensitive phone calls to make?", "options": ["Your company's CEO and the press", "Your bank's fraud department and the FBI (via IC3)", "The IT help desk and your mobile phone provider", "The vendor who was impersonated and your travel agent"], "correct": 1, "explanation": "The financial institutions and law enforcement have established processes (like the FBI's Recovery Asset Team) to try and stop fraudulent transfers, but they can only act if they are notified immediately." },
                        { "id": 3, "question": "The most effective preventative control against BEC attacks is:", "options": ["A stronger firewall", "A process that requires out-of-band, verbal confirmation for all wire transfer requests", "A better antivirus", "Faster internet"], "correct": 1, "explanation": "Since BEC is social engineering, the best defense is a human process control. Requiring a phone call to a known number to verify any change in payment instructions or unusual request would stop most BEC attacks." }
                    ]
                }
            },
            {
                "id": "lesson-34-supply-chain",
                "title": "Lesson 34: Supply Chain Incidents",
                "duration": "120 min",
                "objectives": [
                    "Understand the risks of a third-party software or service compromise",
                    "Develop response plans for incidents originating from the supply chain",
                    "Conduct vendor assessments as part of post-incident improvement",
                    "Review contracts and SLAs for third-party security requirements"
                ],
                "content": {
                    "overview": "You are only as secure as the weakest link in your supply chain. This lesson covers how to respond when an incident originates not from a direct attack, but from a compromise of one of your trusted third-party vendors or software providers.",
                    "sections": [
                        {
                            "title": "Third-Party Breach Response",
                            "content": "<p>A supply chain incident occurs when a threat actor compromises a third-party and uses that access to attack the third-party's customers.</p><h3>Types of Supply Chain Attacks:</h3><ul><li><strong>Software Supply Chain:</strong> An attacker injects malicious code into a legitimate software product or update. When customers install the trusted update, they are unknowingly installing a backdoor. <em>(Example: SolarWinds).</em></li><li><strong>Managed Service Provider (MSP) Compromise:</strong> An attacker compromises an MSP, which gives them administrative access to all of the MSP's customers. They can then use this access to deploy ransomware or steal data from the customers.</li></ul><h3>Response Steps:</h3><ol><li><strong>Validate the Notification:</strong> Your first notification may come from the vendor themselves. Verify it is legitimate.</li><li><strong>Scope the Impact:</strong> Work to determine which of your systems run the compromised software or are managed by the compromised vendor.</li><li><strong>Follow Vendor Guidance:</strong> The vendor will release IOCs and guidance. Use these to hunt for signs of compromise in your own environment.</li><li><strong>Contain and Isolate:</strong> Isolate any systems running the compromised software until they can be patched or cleaned. You may need to temporarily revoke the remote access of a compromised MSP.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>You Are a Victim and an Investigator</strong></div><p>In these incidents, your organization is a victim. You will be conducting your own internal investigation based on the intelligence provided by the compromised vendor, who is conducting their own, larger investigation.</p></div>",
                            "image": "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is a software supply chain attack?", "options": ["A phishing attack targeting a shipping company", "An attack where malicious code is inserted into a legitimate software update from a trusted vendor", "A hardware failure in a server", "A fraudulent wire transfer"], "correct": 1, "explanation": "The SolarWinds incident is a classic example, where a malicious backdoor was hidden in a trusted software update that was then distributed to thousands of customers." },
                        { "id": 2, "question": "Your Managed Service Provider (MSP) calls to inform you they have been breached. What is your most urgent first question?", "options": ["'Will I get a discount next month?'", "'What is the scope of their access into our environment, and what IOCs should we be hunting for right now?'", "'Who is your CEO?'", "'When was your company founded?'"], "correct": 1, "explanation": "The immediate priority is to understand your own organization's exposure. You need to know what systems the MSP had access to and how to check them for compromise." }
                    ]
                }
            },
            {
                "id": "lesson-35-crisis-management",
                "title": "Lesson 35: Crisis Management",
                "duration": "120 min",
                "objectives": [
                    "Understand how a major security incident becomes a business crisis",
                    "Integrate the technical IR plan with the overall crisis management plan",
                    "Manage communication and decision-making at the executive level",
                    "Coordinate with multiple non-technical stakeholders during a crisis"
                ],
                "content": {
                    "overview": "A severe cybersecurity incident is not just an IT problem; it is a business crisis. This lesson covers how the technical incident response process fits into the larger framework of corporate crisis management, focusing on executive-level communication, decision-making, and stakeholder coordination.",
                    "sections": [
                        {
                            "title": "Crisis Management Integration",
                            "content": "<p>Crisis management is the high-level, strategic leadership of the entire organization's response to a major disruption. Incident response is a critical *input* to the crisis management process.</p><h3>The Two Teams:</h3><ul><li><strong>Incident Response Team (Technical):</strong> This is the team we have been discussing. Their focus is technical: find the attacker, contain the threat, restore the systems. The Incident Commander leads this team.</li><li><strong>Crisis Management Team (Strategic):</strong> This team is led by the CEO or another senior executive and includes the heads of Legal, PR, HR, and other key business units. Their focus is strategic: protect the company's reputation, manage legal and financial risk, and ensure business continuity.</li></ul><h3>Information Flow:</h3><p>The Incident Commander's most important job, outside of managing the technical response, is to provide clear, concise, and regular updates *up* to the Crisis Management Team so they can make informed strategic decisions.</p><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Stay in Your Lane</strong></div><p>The technical team should not be making strategic business decisions. The Crisis Management Team should not be meddling in the technical investigation. A well-defined plan keeps these two essential functions working in parallel, with the Incident Commander as the bridge between them.</p></div>",
                            "image": "https://images.unsplash.com/photo-1543269865-cbf427effbad?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary difference between Incident Response and Crisis Management?", "options": ["There is no difference", "IR is a technical function focused on resolving the security breach; Crisis Management is a strategic business function focused on managing the overall company crisis", "IR is done by senior executives; Crisis Management is done by the help desk", "IR focuses on communication; Crisis Management focuses on forensics"], "correct": 1, "explanation": "These are two distinct but parallel tracks. The IR team solves the technical problem, while the Crisis Management team solves the business problem." },
                        { "id": 2, "question": "Who typically leads the Crisis Management Team during a major cyber incident?", "options": ["The lead forensic investigator", "A senior business executive like the CEO or COO", "The head of the IT help desk", "An external consultant"], "correct": 1, "explanation": "A business crisis requires a business leader. The technical Incident Commander reports to the business-focused Crisis Management lead." }
                    ]
                }
            },
            {
                "id": "lesson-36-ir-maturity",
                "title": "Lesson 36: IR Maturity Assessment",
                "duration": "120 min",
                "objectives": [
                    "Understand Capability Maturity Models and their application to IR",
                    "Conduct a gap analysis of your current IR program",
                    "Develop a roadmap for program improvement",
                    "Benchmark your program against industry best practices"
                ],
                "content": {
                    "overview": "How do you know if your incident response program is effective? This lesson introduces the concept of maturity modeling, providing a structured way to assess the current state of your IR capabilities, identify gaps, and create a strategic roadmap for continuous improvement.",
                    "sections": [
                        {
                            "title": "Capability Maturity Models",
                            "content": "<p>A capability maturity model provides a framework for evaluating the sophistication and effectiveness of a process. For incident response, a common model has several levels.</p><h3>Maturity Levels:</h3><ul><li><strong>Level 0 (Non-Existent):</strong> The organization has no IR capability at all.</li><li><strong>Level 1 (Initial / Ad-Hoc):</strong> Response is chaotic and unplanned. Success depends entirely on the heroics of a few individuals. There are no documented plans or procedures.</li><li><strong>Level 2 (Repeatable / Developing):</strong> The organization has a basic, documented IR plan and team. Response is generally repeatable, but there are few metrics or formal processes for improvement.</li><li><strong>Level 3 (Defined):</strong> The program is well-defined, with formal policies, SOPs, and roles. The team conducts regular exercises.</li><li><strong>Level 4 (Managed):</strong> The program is managed by metrics. The team tracks KPIs like MTTD and MTTR and reports them to leadership.</li><li><strong>Level 5 (Optimizing):</strong> The program has a robust process for continuous improvement based on lessons learned and metrics. Automation and orchestration are heavily used.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>The Goal is to Move Up</strong></div><p>The purpose of a maturity assessment is to identify your current level and build a concrete plan with specific, funded projects to move to the next level.</p></div>",
                            "image": "https://images.unsplash.com/photo-1542626991-cbc4e32524cc?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "An organization with no documented IR plan that handles every incident in a chaotic, ad-hoc manner is at which maturity level?", "options": ["Level 5 (Optimizing)", "Level 3 (Defined)", "Level 1 (Initial / Ad-Hoc)", "Level 4 (Managed)"], "correct": 2, "explanation": "Level 1 is characterized by a lack of formal process, where the response relies entirely on individual effort rather than a defined plan." },
                        { "id": 2, "question": "An organization that heavily uses metrics like MTTD and MTTR to manage its IR program and report to leadership is operating at which minimum maturity level?", "options": ["Level 1 (Initial)", "Level 2 (Repeatable)", "Level 3 (Defined)", "Level 4 (Managed)"], "correct": 3, "explanation": "Level 4 is where a program becomes data-driven and quantitatively managed using formal metrics and KPIs." }
                    ]
                }
            },
            {
                "id": "lesson-37-advanced-forensics",
                "title": "Lesson 37: Advanced Forensics",
                "duration": "120 min",
                "objectives": [
                    "Perform deep-dive analysis of memory images",
                    "Analyze complex network traffic patterns for covert channels",
                    "Understand techniques used by attackers to hide evidence (anti-forensics)",
                    "Explore advanced forensics in cloud and mobile environments"
                ],
                "content": {
                    "overview": "This lesson provides a deeper look into the highly technical discipline of digital forensics, exploring advanced techniques that are used in the most complex and sensitive investigations. We will cover advanced memory and network analysis, as well as the anti-forensics methods attackers use to thwart investigations.",
                    "sections": [
                        {
                            "title": "Anti-Forensics Techniques",
                            "content": "<p>Anti-forensics is the practice of actively trying to subvert a forensic investigation. Incident responders must be able to recognize the signs of these techniques.</p><h3>Common Anti-Forensics Techniques:</h3><ul><li><strong>Log Clearing:</strong> Attackers will often clear or modify event logs on a compromised machine to hide their tracks. This is why sending logs to a central, secure SIEM is so important.</li><li><strong>Data Wiping:</strong> Using tools to securely overwrite data on a hard drive to make it unrecoverable.</li><li><strong>Timestomping:</strong> Modifying the timestamps (Modified, Accessed, Created) of a malicious file to make it blend in with legitimate system files.</li><li><strong>Rootkits:</strong> Malware that operates at a low level (e.g., the kernel) to hide its own files, processes, and network connections from the operating system. Detecting rootkits often requires memory analysis.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Even Deletion is Evidence</strong></div><p>A cleared log file is, itself, evidence. A gap in the logs or a log file that is suddenly much smaller than it should be is a strong indicator of compromise that an investigator should focus on.</p></div>",
                            "image": "https://images.unsplash.com/photo-1547756536-cde55c3f2c65?w=800&h=400&fit-crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "An attacker modifying a file's timestamp to make it look like it was installed at the same time as the operating system is a technique known as:", "options": ["Timestomping", "Log Clearing", "Data Wiping", "Rootkitting"], "correct": 0, "explanation": "Timestomping is an anti-forensics technique designed to make malicious files harder to find during a timeline analysis." },
                        { "id": 2, "question": "Why is centralizing log collection to a SIEM a critical defense against anti-forensics?", "options": ["It makes the logs easier to read", "Once the log is sent off the host to the SIEM, the attacker cannot delete or modify that copy", "It is cheaper than storing logs locally", "It automatically finds malware"], "correct": 1, "explanation": "A write-once SIEM acts as a secure evidence locker. Even if the attacker clears the logs on the local machine, the original copy is safe in the SIEM." }
                    ]
                }
            },
            {
                "id": "lesson-38-ir-environments",
                "title": "Lesson 38: IR in Different Environments",
                "duration": "120 min",
                "objectives": [
                    "Understand the specific regulatory requirements for IR in healthcare (HIPAA)",
                    "Learn about IR requirements in the financial services sector (NYDFS, FFIEC)",
                    "Explore unique considerations for government and small business environments"
                ],
                "content": {
                    "overview": "Incident response is not one-size-fits-all. Different industries have different regulatory requirements, risk profiles, and operational constraints that shape their IR programs. This lesson explores the specific IR considerations for healthcare, finance, government, and small businesses.",
                    "sections": [
                        {
                            "title": "Healthcare IR (HIPAA)",
                            "content": "<p>In healthcare, the primary driver for incident response is the Health Insurance Portability and Accountability Act (HIPAA). The focus is on protecting Protected Health Information (PHI).</p><h3>HIPAA Considerations:</h3><ul><li><strong>Definition of a Breach:</strong> HIPAA has a very specific definition of a breach of PHI. Any impermissible use or disclosure of PHI is presumed to be a breach unless a formal risk assessment proves otherwise.</li><li><strong>Breach Notification Rule:</strong> Requires notification to the affected individuals and the Department of Health and Human Services (HHS) without unreasonable delay, and in no case later than 60 days following the discovery of a breach.</li><li><strong>Business Associates:</strong> The rules apply not just to the healthcare provider, but to all of their 'business associates' (i.e., third-party vendors) that handle PHI.</li></ul>",
                            "image": "https://images.unsplash.com/photo-1538692125883-909953930b5e?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "In the healthcare industry, the primary regulation governing data breach response is:", "options": ["PCI DSS", "SOX", "HIPAA", "GDPR"], "correct": 2, "explanation": "HIPAA and its Breach Notification Rule dictate the specific requirements for responding to an incident involving Protected Health Information (PHI)." }
                    ]
                }
            },
            {
                "id": "lesson-39-emerging-threats",
                "title": "Lesson 39: Emerging Threats and Technologies",
                "duration": "120 min",
                "objectives": [
                    "Consider the IR implications of incidents involving AI/ML systems",
                    "Understand potential future threats from quantum computing",
                    "Learn about investigating incidents involving cryptocurrency and blockchain",
                    "Explore IR in 5G and edge computing environments"
                ],
                "content": {
                    "overview": "The threat landscape and the technology we defend are constantly evolving. This lesson looks to the future, exploring the emerging threats and technologies that will shape the future of incident response, from compromised AI models to investigations on the blockchain.",
                    "sections": [
                        {
                            "title": "Blockchain and Cryptocurrency Incidents",
                            "content": "<p>Incidents involving cryptocurrency theft or fraudulent blockchain transactions present unique challenges for investigation.</p><h3>Investigation Challenges:</h3><ul><li><strong>Anonymity (Pseudonymity):</strong> While all transactions on a public blockchain (like Bitcoin) are public, they are tied to pseudonymous wallet addresses, not real-world identities.</li><li><strong>Irreversibility:</strong> Blockchain transactions are immutable. Once a fraudulent transaction is confirmed, there is no central authority you can call to reverse it. Recovery is extremely difficult.</li><li><strong>Chain Hopping and Mixers:</strong> Attackers use 'mixers' or 'tumblers' to launder stolen cryptocurrency, and 'chain hopping' to switch between different cryptocurrencies, all to obscure the money trail.</li></ul><p>Investigation often relies on specialized blockchain analysis firms that use advanced techniques to de-anonymize transactions and trace the flow of stolen funds.</p>",
                            "image": "https://images.unsplash.com/photo-1631603090989-821237a349b8?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 75,
                    "questions": [
                        { "id": 1, "question": "What is the primary challenge when trying to recover stolen cryptocurrency?", "options": ["It is too slow", "Blockchain transactions are designed to be irreversible, and there is no central authority to appeal to", "It is not worth very much", "The transaction fees are too high"], "correct": 1, "explanation": "The immutable and decentralized nature of most cryptocurrencies makes recovering stolen funds exceptionally difficult once the transaction has been confirmed on the blockchain." }
                    ]
                }
            },
            {
                "id": "lesson-40-final-capstone",
                "title": "Lesson 40: Final Capstone Project",
                "duration": "240 min",
                "objectives": [
                    "Apply all phases of the incident response lifecycle to a complex, end-to-end scenario",
                    "Investigate a multi-vector attack that spans on-premises, cloud, and user endpoints",
                    "Produce a complete incident documentation package, including a timeline and final report",
                    "Present findings and recommendations to stakeholders in a simulated executive briefing"
                ],
                "content": {
                    "overview": "The final capstone project is a comprehensive simulation that requires you to use all the skills you've developed throughout this course. You will be given a large dataset and a scenario brief describing a complex security breach. Your mission is to work through the entire IR lifecycle, from initial detection to the final post-mortem and executive presentation, to manage and resolve the crisis.",
                    "sections": [
                        {
                            "title": "Scenario: Global Corp Inc. Under Attack",
                            "content": "<p><strong>The Situation:</strong> Global Corp, a multinational corporation, has detected a major ransomware outbreak. However, the initial investigation suggests the ransomware was merely a distraction to cover up a much more sophisticated data theft operation by an APT group. You are the Incident Commander.</p><h3>Project Phases:</h3><ol><li><strong>Detection & Triage:</strong> Analyze initial SIEM alerts and logs to validate the incident and perform an initial impact assessment.</li><li><strong>Investigation & Forensics:</strong> Use the provided forensic images and network captures to reconstruct the full attack timeline, from the initial phishing email to the lateral movement, credential theft, and eventual data exfiltration.</li><li><strong>Containment, Eradication & Recovery:</strong> Develop a detailed plan for containment, eradication, and a phased recovery, justifying your decisions.</li><li><strong>Communication & Reporting:</strong> Draft internal stakeholder updates, a public breach notification letter (with Legal's approval), and a final comprehensive incident report.</li><li><strong>Executive Briefing:</strong> Prepare and deliver a 15-minute presentation summarizing your findings and recommendations for the company's executive leadership.</li></ol>",
                            "image": "https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=800&h=400&fit=crop"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 100,
                    "questions": [
                        { "id": 1, "question": "The capstone project requires you to demonstrate proficiency in:", "options": ["Only the technical aspects of IR", "Only the communication aspects of IR", "Both the technical investigation and the strategic management and communication of an incident", "A single phase of the IR lifecycle"], "correct": 2, "explanation": "The capstone is designed to be a holistic exercise, testing your ability to manage a crisis from the command line all the way to the boardroom." }
                    ]
                }
            }
        ]
    }
// =====================================================
      // GLOBAL VARIABLES
      // =====================================================
      let currentUser = null;
      let currentLessonIndex = 0;
      let courseProgress = {};
      let userStats = {};
      let quizState = {
        currentQuestion: 0,
        answers: [],
        score: 0,
        isComplete: false,
      };

      // Enhanced session tracking
      let courseSession = {
        startTime: null,
        totalStudyTime: 0,
        lessonsStarted: 0,
        lessonsCompleted: 0,
        pageLoadTime: new Date(),
        interactionCount: 0,
        lastActivityTime: new Date(),
      };

      // Music Player Variables
      let audioPlayer = new Audio();

      // Achievement notification system
      let notificationQueue = [];
      let isShowingNotification = false;

      // =====================================================
      // INITIALIZATION
      // =====================================================
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          showLoadingScreen();
          await checkAuth();

          if (currentUser) {
            // Initialize session tracking
            startCourseSession();

            // Load course data and progress
            await loadCourseData();
            await loadUserProfile();
            await loadProgress();

            // Initialize UI
            initializeEventListeners();
            renderSidebar();
            loadLesson(currentLessonIndex);

            // Initialize additional features
            initMusicPlayer();
            addMusicIndicator();
            initializeActivityTracking();

            hideLoadingScreen();
          } else {
            openAuthModal();
          }
        } catch (error) {
          console.error("Error initializing course:", error);
          hideLoadingScreen();
          showToast("Failed to initialize course system", "error");
        }
      });

      // =====================================================
      // AUTHENTICATION SYSTEM
      // =====================================================
      async function checkAuth() {
        try {
          const {
            data: { session },
            error,
          } = await supabase.auth.getSession();

          if (error) {
            console.error("Auth error:", error);
            currentUser = null;
            openAuthModal();
            return;
          }

          if (!session) {
            currentUser = null;
            openAuthModal();
            return;
          }

          currentUser = session.user;
          updateUIWithUser();
        } catch (error) {
          console.error("Error checking auth:", error);
          currentUser = null;
          openAuthModal();
        }
      }

      function updateUIWithUser() {
        if (!currentUser) return;

        const name =
          currentUser.user_metadata?.full_name ||
          currentUser.email.split("@")[0];
        const userElements = document.querySelectorAll("[data-user-name]");
        userElements.forEach((el) => (el.textContent = name));
      }

      // =====================================================
      // USER PROFILE & STATS MANAGEMENT
      // =====================================================
      async function loadUserProfile() {
        try {
          // 🔍 Step 1: Try to fetch existing profile
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", currentUser.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (!profile) {
            // 🆕 Step 2: Create new profile if missing
            await createUserProfile();
          } else {
            // ✅ Step 3: Use existing profile
            userStats = profile;
            await updateLastActivity();
          }
        } catch (error) {
          console.error("❌ Error loading user profile:", error);
          showToast("Failed to load user profile", "error");
        }
      }
      async function createUserProfile() {
        try {
          const newProfile = {
            id: currentUser.id,
            full_name: currentUser.user_metadata?.full_name || "",
            email: currentUser.email,
            level: "Script Kiddie",
            total_points: 0,
            completed_courses: 0,
            current_streak: 0,
            total_certificates: 0,
            total_achievements: 0,
            sections_visited: 0,
            bonus_points: 0,
            in_progress_courses: 0,
            settings_changed: 0,
            midnight_sessions: 0,
            early_sessions: 0,
            weekend_sessions: 0,
            last_activity: new Date().toISOString(),
            created_at: new Date().toISOString(),
          };

          const { error } = await supabase
            .from("profiles")
            .insert([newProfile]);

          if (!error) {
            userStats = newProfile;
            // Award first login achievement
            setTimeout(() => checkAndUnlockAchievement("first_login"), 1000);
          }
        } catch (error) {
          console.error("Error creating user profile:", error);
        }
      }

      async function updateLastActivity() {
        try {
          const now = new Date();

          // Update activity tracking
          courseSession.lastActivityTime = now;

          // Update database
          await supabase
            .from("profiles")
            .update({
              last_activity: now.toISOString(),
            })
            .eq("id", currentUser.id);

          // Check time-based achievements
          await checkTimeBasedAchievements(now);
        } catch (error) {
          console.error("Error updating last activity:", error);
        }
      }

      // =====================================================
      // COURSE SESSION MANAGEMENT
      // =====================================================
      function startCourseSession() {
        courseSession.startTime = new Date();
        courseSession.pageLoadTime = new Date();

        logUserActivity("course_session_start", {
          course_id: COURSE_DATA.id,
          course_title: COURSE_DATA.title,
          user_agent: navigator.userAgent,
          screen_resolution: `${screen.width}x${screen.height}`,
        });

        // Check daily streak
        checkDailyStreak();
      }

      function initializeActivityTracking() {
        // Track page focus/blur for accurate study time
        document.addEventListener("visibilitychange", handleVisibilityChange);

        // Track user interactions
        ["click", "keydown", "scroll", "mousemove"].forEach((event) => {
          document.addEventListener(event, trackUserInteraction, {
            passive: true,
          });
        });

        // Periodic activity updates
        setInterval(updateStudyTime, 60000); // Every minute

        // Save session data before page unload
        window.addEventListener("beforeunload", saveSessionData);
      }

      function handleVisibilityChange() {
        if (document.hidden) {
          courseSession.lastActivityTime = new Date();
        } else {
          // Page became visible again - update activity
          updateLastActivity();
        }
      }

      function trackUserInteraction() {
        courseSession.interactionCount++;
        courseSession.lastActivityTime = new Date();

        // Throttle activity updates
        if (courseSession.interactionCount % 50 === 0) {
          updateLastActivity();
        }
      }

      function updateStudyTime() {
        if (!courseSession.startTime || document.hidden) return;

        const now = new Date();
        const sessionDuration = now - courseSession.startTime;
        courseSession.totalStudyTime = Math.floor(sessionDuration / 1000 / 60); // in minutes

        // Update progress with study time
        saveProgress();
      }

      function saveSessionData() {
        if (!currentUser || !courseSession.startTime) return;

        const sessionData = {
          user_id: currentUser.id,
          course_id: COURSE_DATA.id,
          session_duration: courseSession.totalStudyTime,
          lessons_viewed: courseSession.lessonsStarted,
          lessons_completed: courseSession.lessonsCompleted,
          interactions: courseSession.interactionCount,
          session_date: courseSession.startTime.toISOString().split("T")[0],
        };

        // Store in localStorage as backup
        localStorage.setItem(
          "course_session_backup",
          JSON.stringify(sessionData)
        );

        // Try to save to database
        logUserActivity("course_session_end", sessionData);
      }

      // =====================================================
      // COURSE DATA & PROGRESS MANAGEMENT
      // =====================================================
      async function loadCourseData() {
        try {
          // Update course info in UI
          document.getElementById("courseTitle").textContent =
            COURSE_DATA.title;
          document.getElementById("totalLessons").textContent =
            COURSE_DATA.lessons.length;

          // Log course access
          logUserActivity("course_access", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
          });
        } catch (error) {
          console.error("Error loading course data:", error);
        }
      }

      async function loadProgress() {
        try {
          // Get existing progress from database
          const { data, error } = await supabase
            .from("course_progress")
            .select("*")
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (data) {
            courseProgress = JSON.parse(data.lesson_progress || "{}");
            currentLessonIndex = data.current_lesson || 0;

            // Update session tracking
            courseSession.lessonsStarted = Object.keys(courseProgress).length;
            courseSession.lessonsCompleted = Object.values(
              courseProgress
            ).filter((p) => p.completed).length;
          } else {
            // Initialize new progress
            courseProgress = {};
            currentLessonIndex = 0;
            await saveProgress();

            // Award first course start achievement
            await checkAndUnlockAchievement("first_course_start");
          }

          updateProgressDisplay();
        } catch (error) {
          console.error("Error loading progress:", error);
          showToast("Failed to load progress", "error");
        }
      }

      async function saveProgress() {
        try {
          if (!currentUser) return;

          const now = new Date();
          const progressData = {
            user_id: currentUser.id,
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            current_lesson: currentLessonIndex,
            lesson_progress: JSON.stringify(courseProgress),
            progress: calculateOverallProgress(),
            lessons_completed: getCompletedLessonsCount(),
            lessons_started: Object.keys(courseProgress).length,
            study_time_minutes: courseSession.totalStudyTime,
            last_accessed: now.toISOString(),
            updated_at: now.toISOString(),
          };

          // Upsert progress
          const { error } = await supabase
            .from("course_progress")
            .upsert([progressData]);

          if (error) throw error;

          // Update user stats
          await updateUserStats();

          updateProgressDisplay();
        } catch (error) {
          console.error("Error saving progress:", error);
          showToast("Failed to save progress", "error");
        }
      }

      async function updateUserStats() {
        try {
          // Get all course progress for this user
          const { data: allProgress, error } = await supabase
            .from("course_progress")
            .select("progress, course_id, study_time_minutes")
            .eq("user_id", currentUser.id);

          if (error) throw error;

          // Calculate stats
          const completedCourses =
            allProgress?.filter((p) => p.progress >= 100).length || 0;
          const inProgressCourses =
            allProgress?.filter((p) => p.progress > 0 && p.progress < 100)
              .length || 0;
          const totalStudyTime =
            allProgress?.reduce(
              (sum, p) => sum + (p.study_time_minutes || 0),
              0
            ) || 0;

          // Calculate points (500 per completed course + achievement points)
          const coursePoints = completedCourses * 500;
          const bonusPoints = userStats.bonus_points || 0;
          const totalPoints = coursePoints + bonusPoints;

          // Update profile
          const updateData = {
            completed_courses: completedCourses,
            in_progress_courses: inProgressCourses,
            total_points: totalPoints,
            total_study_time: totalStudyTime,
            last_activity: new Date().toISOString(),
          };

          const { error: updateError } = await supabase
            .from("profiles")
            .update(updateData)
            .eq("id", currentUser.id);

          if (updateError) throw updateError;

          // Update local stats
          Object.assign(userStats, updateData);
        } catch (error) {
          console.error("Error updating user stats:", error);
        }
      }

      function calculateOverallProgress() {
        const completedLessons = getCompletedLessonsCount();
        return Math.round(
          (completedLessons / COURSE_DATA.lessons.length) * 100
        );
      }

      function getCompletedLessonsCount() {
        return Object.values(courseProgress).filter(
          (lesson) => lesson.completed
        ).length;
      }

      function updateProgressDisplay() {
        const completedCount = getCompletedLessonsCount();
        const progressPercent = calculateOverallProgress();

        // Update UI elements
        const elements = {
          completedLessons: completedCount,
          courseProgressPercent: `${progressPercent}%`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });

        // Update progress bar
        const progressBar = document.getElementById("courseProgressFill");
        if (progressBar) progressBar.style.width = `${progressPercent}%`;
      }

      // =====================================================
      // LESSON MANAGEMENT
      // =====================================================
      function loadLesson(index) {
        if (index < 0 || index >= COURSE_DATA.lessons.length) return;

        const lesson = COURSE_DATA.lessons[index];
        currentLessonIndex = index;

        // Mark lesson as started and track activity
        if (!courseProgress[lesson.id]) {
          courseProgress[lesson.id] = {
            started: true,
            completed: false,
            startedAt: new Date().toISOString(),
            timeSpent: 0,
          };

          courseSession.lessonsStarted++;
          saveProgress();

          // Log lesson start
          logUserActivity("lesson_start", {
            lesson_id: lesson.id,
            lesson_title: lesson.title,
            lesson_index: index,
          });
        }

        // Update lesson start time for time tracking
        courseProgress[lesson.id].currentSessionStart = new Date();

        // Update sidebar and navigation
        renderSidebar();
        updateNavigationButtons();

        // Update header info
        updateLessonHeader(lesson, index);

        // Render lesson content
        renderLessonContent(lesson);

        // Smooth scroll and animations
        window.scrollTo({ top: 0, behavior: "smooth" });
        document.getElementById("contentBody").scrollTop = 0;

        const contentBody = document.getElementById("contentBody");
        contentBody.classList.add("fade-in");
        setTimeout(() => contentBody.classList.remove("fade-in"), 500);

        // Check lesson-based achievements
        checkLessonAchievements(index + 1);
      }

      function updateLessonHeader(lesson, index) {
        const elements = {
          currentLessonNumber: index + 1,
          currentLessonTitle: lesson.title,
          navInfo: `Lesson ${index + 1} of ${COURSE_DATA.lessons.length}`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });
      }

      function renderSidebar() {
        const lessonNav = document.getElementById("lessonNav");
        if (!lessonNav) return;

        lessonNav.innerHTML = "";

        COURSE_DATA.lessons.forEach((lesson, index) => {
          const lessonItem = document.createElement("div");
          lessonItem.className = "lesson-item";

          // Determine lesson status
          const lessonProgress = courseProgress[lesson.id];
          const isCompleted = lessonProgress?.completed || false;
          const isInProgress = lessonProgress?.started || false;
          const isLocked = !isCompleted && !canAccessLesson(index);
          const isActive = index === currentLessonIndex;

          // Apply status classes
          if (isCompleted) lessonItem.classList.add("completed");
          if (isLocked) lessonItem.classList.add("locked");
          if (isActive) lessonItem.classList.add("active");

          // Determine status display
          let statusClass = "not-started";
          let statusIcon = index + 1;

          if (isCompleted) {
            statusClass = "completed";
            statusIcon = "✓";
          } else if (isInProgress) {
            statusClass = "in-progress";
            statusIcon = "◐";
          }

          // Create lesson item HTML
          lessonItem.innerHTML = `
            <div class="lesson-status ${statusClass}">${statusIcon}</div>
            <div class="lesson-info">
                <div class="lesson-title">${lesson.title}</div>
                <div class="lesson-meta">
                    ${
                      isCompleted
                        ? "Completed"
                        : isInProgress
                        ? "In Progress"
                        : isLocked
                        ? "Locked"
                        : "Not Started"
                    }
                </div>
            </div>
            <div class="lesson-duration">${lesson.duration}</div>
        `;

          // Add click handler if not locked
          if (!isLocked) {
            lessonItem.addEventListener("click", () => {
              if (index !== currentLessonIndex) {
                // Track lesson time before switching
                trackLessonTime();

                currentLessonIndex = index;
                loadLesson(index);
                closeSidebar();
              }
            });
          }

          lessonNav.appendChild(lessonItem);
        });
      }

      function canAccessLesson(index) {
        if (index === 0) return true; // First lesson always accessible

        // Can access if previous lesson is completed
        const previousLessonId = COURSE_DATA.lessons[index - 1].id;
        return courseProgress[previousLessonId]?.completed || false;
      }

      function trackLessonTime() {
        const currentLesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonProgress = courseProgress[currentLesson.id];

        if (lessonProgress?.currentSessionStart) {
          const sessionTime = Math.floor(
            (new Date() - new Date(lessonProgress.currentSessionStart)) /
              1000 /
              60
          );
          lessonProgress.timeSpent =
            (lessonProgress.timeSpent || 0) + sessionTime;
          delete lessonProgress.currentSessionStart;
        }
      }

      // =====================================================
      // LESSON CONTENT RENDERING
      // =====================================================
      function renderLessonContent(lesson) {
        const contentContainer = document.getElementById("lessonContent");
        if (!contentContainer) return;

        let contentHTML = `
        <div class="content-section">
            <h2>Learning Objectives</h2>
            <ul>
                ${lesson.objectives.map((obj) => `<li>${obj}</li>`).join("")}
            </ul>
        </div>
        
        <div class="content-section">
            <h2>Overview</h2>
            <p>${lesson.content.overview}</p>
        </div>
    `;

        // Render content sections
        lesson.content.sections.forEach((section) => {
          contentHTML += `
            <div class="content-section">
                <h2>${section.title}</h2>
                ${section.content}
                ${
                  section.image
                    ? `<img src="${section.image}" alt="${section.title}" class="content-image" loading="lazy">`
                    : ""
                }
            </div>
        `;
        });

        // Render code examples
        if (
          lesson.content.codeExamples &&
          lesson.content.codeExamples.length > 0
        ) {
          contentHTML += `<div class="content-section"><h2>Code Examples</h2></div>`;

          lesson.content.codeExamples.forEach((example, index) => {
            const codeId = `code-${lesson.id}-${index}`;
            contentHTML += `
                <div class="code-section">
                    <div class="code-header">
                        <span class="code-title">${example.title}</span>
                        <button class="copy-btn" onclick="copyCode('${codeId}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <pre class="code-block"><code id="${codeId}" class="language-${
              example.language
            }">${escapeHtml(example.code)}</code></pre>
                </div>
            `;
          });
        }

        // Render quiz
        contentHTML += renderQuiz(lesson.quiz);

        contentContainer.innerHTML = contentHTML;

        // Highlight code syntax if Prism is available
        setTimeout(() => {
          if (window.Prism) {
            Prism.highlightAll();
          }
        }, 100);
      }

      // =====================================================
      // QUIZ SYSTEM
      // =====================================================
      function renderQuiz(quiz) {
        const currentLessonProgress =
          courseProgress[COURSE_DATA.lessons[currentLessonIndex].id];
        const isCompleted = currentLessonProgress?.completed || false;

        let quizHTML = `
        <div class="quiz-section" id="quizSection">
            <div class="quiz-header">
                <h2 class="quiz-title">
                    <i class="fas fa-clipboard-check"></i>
                    Knowledge Check
                </h2>
                <p class="quiz-info">
                    Complete this quiz with ${quiz.passingScore}% or higher to unlock the next lesson.
                </p>
            </div>
    `;

        if (isCompleted) {
          const savedScore = currentLessonProgress.quizScore || 0;
          quizHTML += `
            <div class="quiz-results show">
                <div class="quiz-score pass">${savedScore}%</div>
                <div class="quiz-message">
                    <strong>Lesson Completed!</strong><br>
                    You've successfully passed this lesson's quiz.
                </div>
            </div>
        `;
        } else {
          // Render quiz questions
          quiz.questions.forEach((question, qIndex) => {
            quizHTML += `
                <div class="quiz-question ${
                  qIndex === 0 ? "active" : ""
                }" data-question="${qIndex}">
                    <div class="question-header">
                        <span class="question-number">Question ${
                          qIndex + 1
                        }</span>
                        <span class="question-progress">${qIndex + 1}/${
              quiz.questions.length
            }</span>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="question-options">
                        ${question.options
                          .map(
                            (option, oIndex) => `
                            <div class="option" data-option="${oIndex}" onclick="selectOption(${qIndex}, ${oIndex})">
                                <span class="option-letter">${String.fromCharCode(
                                  65 + oIndex
                                )}</span>
                                <span class="option-text">${option}</span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
            `;
          });

          quizHTML += `
            <div class="quiz-controls">
                <button class="btn btn-secondary" id="prevQuestionBtn" onclick="previousQuestion()" disabled>
                    <i class="fas fa-chevron-left"></i>
                    Previous
                </button>
                <div>
                    <button class="btn btn-secondary" id="nextQuestionBtn" onclick="nextQuestion()" disabled>
                        Next
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn btn-primary" id="submitQuizBtn" onclick="submitQuiz()" style="display: none;">
                        <i class="fas fa-check"></i>
                        Submit Quiz
                    </button>
                </div>
            </div>

            <div class="quiz-results" id="quizResults">
                <div class="quiz-score" id="quizScore">0%</div>
                <div class="quiz-message" id="quizMessage"></div>
                <div class="quiz-actions">
                    <button class="btn btn-primary" id="continueBtn" onclick="completeLesson()" style="display: none;">
                        <i class="fas fa-arrow-right"></i>
                        Continue to Next Lesson
                    </button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">
                        <i class="fas fa-redo"></i>
                        Retake Quiz
                    </button>
                </div>
            </div>
        `;
        }

        quizHTML += "</div>";
        return quizHTML;
      }

      // Quiz interaction functions
      function selectOption(questionIndex, optionIndex) {
        // Clear previous selections
        document
          .querySelectorAll(`[data-question="${questionIndex}"] .option`)
          .forEach((opt) => {
            opt.classList.remove("selected");
          });

        // Select current option
        const selectedOption = document.querySelector(
          `[data-question="${questionIndex}"] [data-option="${optionIndex}"]`
        );
        selectedOption.classList.add("selected");

        // Store answer
        quizState.answers[questionIndex] = optionIndex;

        // Update navigation
        const isLastQuestion =
          questionIndex ===
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length - 1;
        if (isLastQuestion) {
          document.getElementById("submitQuizBtn").style.display =
            "inline-flex";
          document.getElementById("nextQuestionBtn").style.display = "none";
        } else {
          document.getElementById("nextQuestionBtn").disabled = false;
        }
      }

      function nextQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const nextQuestionEl = currentQuestionEl.nextElementSibling;

        if (
          nextQuestionEl &&
          nextQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          nextQuestionEl.classList.add("active");
          quizState.currentQuestion++;
          updateQuizNavigation();
        }
      }

      function previousQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const prevQuestionEl = currentQuestionEl.previousElementSibling;

        if (
          prevQuestionEl &&
          prevQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          prevQuestionEl.classList.add("active");
          quizState.currentQuestion--;
          updateQuizNavigation();
        }
      }

      function updateQuizNavigation() {
        const totalQuestions =
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length;
        const prevBtn = document.getElementById("prevQuestionBtn");
        const nextBtn = document.getElementById("nextQuestionBtn");
        const submitBtn = document.getElementById("submitQuizBtn");

        prevBtn.disabled = quizState.currentQuestion === 0;

        const hasAnswer =
          quizState.answers[quizState.currentQuestion] !== undefined;
        const isLastQuestion = quizState.currentQuestion === totalQuestions - 1;

        if (isLastQuestion) {
          nextBtn.style.display = "none";
          submitBtn.style.display = hasAnswer ? "inline-flex" : "none";
        } else {
          nextBtn.style.display = "inline-flex";
          nextBtn.disabled = !hasAnswer;
          submitBtn.style.display = "none";
        }
      }

      async function submitQuiz() {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const quiz = lesson.quiz;
        let correctAnswers = 0;

        // Hide questions and controls
        document
          .querySelectorAll(".quiz-question")
          .forEach((q) => (q.style.display = "none"));
        document.querySelector(".quiz-controls").style.display = "none";

        // Calculate score and highlight answers
        quiz.questions.forEach((question, index) => {
          const userAnswer = quizState.answers[index];
          const correctAnswer = question.correct;
          const isCorrect = userAnswer === correctAnswer;

          if (isCorrect) correctAnswers++;

          // Highlight answers
          const questionEl = document.querySelector(
            `[data-question="${index}"]`
          );
          const options = questionEl.querySelectorAll(".option");

          options[correctAnswer].classList.add("correct");
          if (userAnswer !== correctAnswer && userAnswer !== undefined) {
            options[userAnswer].classList.add("incorrect");
          }
        });

        const score = Math.round(
          (correctAnswers / quiz.questions.length) * 100
        );
        const passed = score >= quiz.passingScore;

        // Update quiz results UI
        const quizScore = document.getElementById("quizScore");
        const quizMessage = document.getElementById("quizMessage");
        const quizActions = document.querySelector(".quiz-actions");

        quizScore.textContent = `${score}%`;
        quizScore.className = `quiz-score ${passed ? "pass" : "fail"}`;

        if (passed) {
          quizMessage.innerHTML = `
            <strong>Congratulations!</strong><br>
            You passed with ${score}%. You can now proceed to the next lesson.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-primary" onclick="completeLesson()">
                <i class="fas fa-arrow-right"></i>
                Continue to Next Lesson
            </button>
        `;

          // Mark lesson as completed
          await markLessonComplete(score);
        } else {
          quizMessage.innerHTML = `
            <strong>Not quite there yet.</strong><br>
            You scored ${score}%. You need ${quiz.passingScore}% to pass. Review the material and try again.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-secondary" onclick="retakeQuiz()">
                <i class="fas fa-redo"></i>
                Retake Quiz
            </button>
        `;
        }

        document.getElementById("quizResults").classList.add("show");

        // Log quiz completion
        logUserActivity("quiz_completed", {
          lesson_id: lesson.id,
          lesson_title: lesson.title,
          score: score,
          passed: passed,
          attempts: (courseProgress[lesson.id]?.quizAttempts || 0) + 1,
        });

        // Scroll to results
        document
          .getElementById("quizResults")
          .scrollIntoView({ behavior: "smooth" });
      }

      function retakeQuiz() {
        // Reset quiz state
        quizState = {
          currentQuestion: 0,
          answers: [],
          score: 0,
          isComplete: false,
        };

        // Track quiz retry
        const lessonId = COURSE_DATA.lessons[currentLessonIndex].id;
        if (!courseProgress[lessonId]) courseProgress[lessonId] = {};
        courseProgress[lessonId].quizAttempts =
          (courseProgress[lessonId].quizAttempts || 0) + 1;

        // Reload lesson content
        loadLesson(currentLessonIndex);

        // Scroll to quiz
        setTimeout(() => {
          document
            .getElementById("quizSection")
            .scrollIntoView({ behavior: "smooth" });
        }, 500);
      }

      async function markLessonComplete(score) {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonId = lesson.id;

        // Track lesson completion time
        trackLessonTime();

        // Update lesson progress
        courseProgress[lessonId] = {
          ...courseProgress[lessonId],
          completed: true,
          quizScore: score,
          completedAt: new Date().toISOString(),
          finalScore: score,
        };

        // Update session tracking
        courseSession.lessonsCompleted++;

        // Save progress to database
        await saveProgress();

        // Update UI
        renderSidebar();
        updateNavigationButtons();

        // Check various achievements
        await checkLessonCompletionAchievements();
        await checkPerfectScoreAchievements(score);
        await checkStudyTimeAchievements();

        // Log lesson completion
        logUserActivity("lesson_completed", {
          lesson_id: lessonId,
          lesson_title: lesson.title,
          final_score: score,
          time_spent: courseProgress[lessonId].timeSpent || 0,
          lesson_number: currentLessonIndex + 1,
        });

        showToast("Lesson completed successfully!", "success");
      }

      async function completeLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          // Move to next lesson
          currentLessonIndex++;
          loadLesson(currentLessonIndex);
        } else {
          // Course completion
          await completeCourse();
        }
      }

      async function completeCourse() {
        try {
          const completionTime = courseSession.totalStudyTime;

          // Update course progress to 100% completed
          await supabase
            .from("course_progress")
            .update({
              progress: 100,
              completed_at: new Date().toISOString(),
              completion_time_minutes: completionTime,
            })
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Award course completion achievements
          await checkAndUnlockAchievement("course_completion_1");
          await checkSpeedCompletionAchievements(completionTime);
          await checkCourseStreakAchievements();

          // Update user stats
          await updateUserStats();

          // Show completion message
          showToast(
            "Congratulations! Course completed successfully!",
            "certificate"
          );

          // Log course completion
          logUserActivity("course_completed", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            completion_time_minutes: completionTime,
            total_lessons: COURSE_DATA.lessons.length,
            average_quiz_score: calculateAverageQuizScore(),
          });

          // Redirect to dashboard after delay
          setTimeout(() => {
            window.location.href = "/dashboard.html";
          }, 3000);
        } catch (error) {
          console.error("Error completing course:", error);
          showToast("Error marking course as complete", "error");
        }
      }

      // =====================================================
      // ACHIEVEMENT INTEGRATION SYSTEM
      // =====================================================
      async function checkAndUnlockAchievement(
        achievementId,
        skipNotification = false
      ) {
        try {
          // Prevent duplicate checks
          const cacheKey = `achievement_${achievementId}_${currentUser.id}`;
          if (sessionStorage.getItem(cacheKey)) return false;

          // Check if already unlocked
          const { data: existing, error } = await supabase
            .from("user_achievements")
            .select("id")
            .eq("user_id", currentUser.id)
            .eq("achievement_id", achievementId)
            .single();

          if (existing) {
            sessionStorage.setItem(cacheKey, "true");
            return false;
          }

          // Award achievement
          const achievementData = {
            user_id: currentUser.id,
            achievement_id: achievementId,
            unlocked_at: new Date().toISOString(),
            points_awarded: getAchievementPoints(achievementId),
            context: "course_system",
          };

          const { data, error: insertError } = await supabase
            .from("user_achievements")
            .insert([achievementData])
            .select()
            .single();

          if (insertError) {
            if (insertError.code === "23505") return false; // Already exists
            throw insertError;
          }

          // Update user points
          await supabase.rpc('increment_user_stats', {
  user_id_param: currentUser.id,
  points_to_add: achievementData.points_awarded,
  achievements_to_add: 1
});

          // Cache and queue notification
          sessionStorage.setItem(cacheKey, "true");

          if (!skipNotification) {
            queueAchievementNotification({
              id: achievementId,
              name: getAchievementName(achievementId),
              description: getAchievementDescription(achievementId),
              points: achievementData.points_awarded,
              rarity: getAchievementRarity(achievementId),
              icon: getAchievementIcon(achievementId),
            });
          }

          return true;
        } catch (error) {
          console.error("Error unlocking achievement:", error);
          return false;
        }
      }

      // Helper functions for achievement data (replace with your actual achievement definitions)
      function getAchievementPoints(id) {
        const pointsMap = {
          first_course_start: 75,
          first_lesson: 100,
          course_completion_1: 500,
          perfect_score: 250,
          speed_demon: 750,
          marathon_learner: 500,
          night_owl: 200,
          early_bird: 200,
          weekend_warrior: 150,
          // Add more as needed
        };
        return pointsMap[id] || 100;
      }

      function getAchievementName(id) {
        const nameMap = {
          first_course_start: "Learning Initiated",
          first_lesson: "First Steps",
          course_completion_1: "Course Conqueror",
          perfect_score: "Perfectionist",
          speed_demon: "Speed Demon",
          // Add more as needed
        };
        return nameMap[id] || "Achievement Unlocked";
      }

      function getAchievementDescription(id) {
        const descMap = {
          first_course_start: "Start your first cybersecurity course",
          first_lesson: "Complete your first lesson",
          course_completion_1: "Complete your first course",
          perfect_score: "Score 100% on any quiz",
          speed_demon: "Complete a course in under 2 hours",
          // Add more as needed
        };
        return descMap[id] || "Achievement description";
      }

      function getAchievementRarity(id) {
        const rarityMap = {
          first_course_start: "common",
          first_lesson: "bronze",
          course_completion_1: "silver",
          perfect_score: "gold",
          speed_demon: "legendary",
          // Add more as needed
        };
        return rarityMap[id] || "common";
      }

      function getAchievementIcon(id) {
        const iconMap = {
          first_course_start: "fas fa-play",
          first_lesson: "fas fa-baby",
          course_completion_1: "fas fa-trophy",
          perfect_score: "fas fa-star",
          speed_demon: "fas fa-rocket",
          // Add more as needed
        };
        return iconMap[id] || "fas fa-award";
      }

      async function checkLessonAchievements(lessonNumber) {
        if (lessonNumber === 1) {
          await checkAndUnlockAchievement("first_lesson");
        }

        // Check if user has completed multiple lessons in one day
        const today = new Date().toISOString().split("T")[0];
        const todayCompletions = Object.values(courseProgress).filter(
          (p) => p.completed && p.completedAt?.startsWith(today)
        ).length;

        if (todayCompletions >= 3) {
          await checkAndUnlockAchievement("lesson_marathon");
        }
      }

      async function checkLessonCompletionAchievements() {
        const completedCount = getCompletedLessonsCount();

        // Lesson-based achievements
        const lessonMilestones = [1, 5, 10, 25, 50, 100];
        for (const milestone of lessonMilestones) {
          if (completedCount >= milestone) {
            await checkAndUnlockAchievement(`lessons_${milestone}`);
          }
        }

        // Course completion achievements
        if (completedCount === COURSE_DATA.lessons.length) {
          await checkAndUnlockAchievement("course_completion_1");

          // Check for additional course completion achievements
          const { data: allCourses } = await supabase
            .from("course_progress")
            .select("course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100);

          const totalCompleted = allCourses?.length || 0;

          const courseMilestones = [1, 5, 10, 25];
          for (const milestone of courseMilestones) {
            if (totalCompleted >= milestone) {
              await checkAndUnlockAchievement(`course_completion_${milestone}`);
            }
          }
        }
      }

      async function checkPerfectScoreAchievements(score) {
        if (score === 100) {
          await checkAndUnlockAchievement("perfect_score");

          // Check for consecutive perfect scores
          const recentScores = Object.values(courseProgress)
            .filter((p) => p.completed && p.quizScore)
            .slice(-5) // Last 5 completed
            .map((p) => p.quizScore);

          if (
            recentScores.length >= 3 &&
            recentScores.every((s) => s === 100)
          ) {
            await checkAndUnlockAchievement("perfectionist_streak");
          }
        }
      }

      async function checkSpeedCompletionAchievements(completionTime) {
        // Speed demon: Complete course in under 2 hours (120 minutes)
        if (completionTime <= 120) {
          await checkAndUnlockAchievement("speed_demon");
        }

        // Quick learner: Complete course in under 4 hours (240 minutes)
        if (completionTime <= 240) {
          await checkAndUnlockAchievement("quick_learner");
        }
      }

      async function checkStudyTimeAchievements() {
        const totalTime = courseSession.totalStudyTime;

        // Marathon learner: Study for 8+ hours in a course session
        if (totalTime >= 480) {
          // 8 hours
          await checkAndUnlockAchievement("marathon_learner");
        }

        // Dedicated learner: Study for 4+ hours
        if (totalTime >= 240) {
          // 4 hours
          await checkAndUnlockAchievement("dedicated_learner");
        }
      }

      async function checkCourseStreakAchievements() {
        try {
          // Check for consecutive course completions
          const { data: recentCourses, error } = await supabase
            .from("course_progress")
            .select("completed_at, course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100)
            .order("completed_at", { ascending: false })
            .limit(10);

          if (error || !recentCourses) return;

          // Check for courses completed on consecutive days
          let consecutiveDays = 1;
          for (let i = 1; i < recentCourses.length; i++) {
            const prevDate = new Date(
              recentCourses[i - 1].completed_at
            ).toDateString();
            const currentDate = new Date(
              recentCourses[i].completed_at
            ).toDateString();
            const dayDiff =
              Math.abs(new Date(prevDate) - new Date(currentDate)) /
              (1000 * 60 * 60 * 24);

            if (dayDiff <= 1) {
              consecutiveDays++;
            } else {
              break;
            }
          }

          if (consecutiveDays >= 3) {
            await checkAndUnlockAchievement("learning_streak");
          }
        } catch (error) {
          console.error("Error checking course streak achievements:", error);
        }
      }

      // =====================================================
      // TIME-BASED ACHIEVEMENTS
      // =====================================================
      async function checkTimeBasedAchievements(timestamp) {
        const hour = timestamp.getHours();
        const dayOfWeek = timestamp.getDay();

        // Night owl (after midnight, before 6 AM)
        if (hour >= 0 && hour < 6) {
          await incrementTimeBasedCounter("midnight_sessions", "night_owl");
        }

        // Early bird (4 AM to 6 AM)
        if (hour >= 4 && hour < 6) {
          await incrementTimeBasedCounter("early_sessions", "early_bird");
        }

        // Weekend warrior (Saturday = 6, Sunday = 0)
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          await incrementTimeBasedCounter(
            "weekend_sessions",
            "weekend_warrior"
          );
        }
      }

      async function incrementTimeBasedCounter(counterType, achievementId) {
        try {
          const dateStr = new Date().toISOString().split("T")[0];
          const cacheKey = `${counterType}_${currentUser.id}_${dateStr}`;

          // Prevent multiple increments per day
          if (sessionStorage.getItem(cacheKey)) return;

          // Update counter
          await supabase
            .from("profiles")
            .update({
              [counterType]: supabase.sql`${counterType} + 1`,
            })
            .eq("id", currentUser.id);

          // Cache to prevent double counting
          sessionStorage.setItem(cacheKey, "true");

          // Check related achievement
          if (achievementId) {
            await checkAndUnlockAchievement(achievementId, true);
          }
        } catch (error) {
          console.error(`Error incrementing ${counterType}:`, error);
        }
      }

      async function checkDailyStreak() {
        try {
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("last_activity, current_streak, last_streak_date")
            .eq("id", currentUser.id)
            .single();

          if (error) throw error;

          const now = new Date();
          const today = now.toDateString();
          const lastActivity = profile.last_activity
            ? new Date(profile.last_activity)
            : null;
          const lastStreakDate = profile.last_streak_date
            ? new Date(profile.last_streak_date).toDateString()
            : null;

          let newStreak = profile.current_streak || 0;
          let shouldUpdateStreak = false;

          if (!lastActivity) {
            // First time user
            newStreak = 1;
            shouldUpdateStreak = true;
          } else {
            const daysSinceLastActivity = Math.floor(
              (now - lastActivity) / (1000 * 60 * 60 * 24)
            );

            if (lastStreakDate === today) {
              // Already counted today's streak
              return newStreak;
            } else if (
              daysSinceLastActivity === 1 ||
              (daysSinceLastActivity === 0 && lastStreakDate !== today)
            ) {
              // Consecutive day or same day but not counted yet
              newStreak += 1;
              shouldUpdateStreak = true;
            } else if (daysSinceLastActivity > 1) {
              // Streak broken
              newStreak = 1;
              shouldUpdateStreak = true;
            }
          }

          if (shouldUpdateStreak) {
            await supabase
              .from("profiles")
              .update({
                current_streak: newStreak,
                last_activity: now.toISOString(),
                last_streak_date: now.toISOString(),
              })
              .eq("id", currentUser.id);

            userStats.current_streak = newStreak;

            showToast(`Daily streak: ${newStreak} days!`, "success");
            await checkStreakAchievements(newStreak);
          }

          return newStreak;
        } catch (error) {
          console.error("Error checking daily streak:", error);
          return 0;
        }
      }

      async function checkStreakAchievements(currentStreak) {
        const streakMilestones = [3, 7, 14, 30, 100, 365];

        for (const milestone of streakMilestones) {
          if (currentStreak >= milestone) {
            await checkAndUnlockAchievement(`streak_${milestone}`);
          }
        }
      }

      // =====================================================
      // USER ACTIVITY LOGGING
      // =====================================================
      async function logUserActivity(activityType, metadata = {}) {
        try {
          const now = new Date();

          const activityData = {
            user_id: currentUser.id,
            activity_type: activityType,
            timestamp: now.toISOString(),
            course_id: COURSE_DATA.id,
            lesson_index: currentLessonIndex,
            session_duration: courseSession.totalStudyTime,
            metadata: JSON.stringify(metadata),
            created_at: now.toISOString(),
          };

          // Try to log to activities table
          const { error } = await supabase
            .from("user_activities")
            .insert([activityData]);

          if (error && error.code !== "42P01") {
            console.warn("Activity logging failed:", error.message);
          }

          // Always update last activity in profile
          await supabase
            .from("profiles")
            .update({ last_activity: now.toISOString() })
            .eq("id", currentUser.id);
        } catch (error) {
          console.error("Error logging user activity:", error);
        }
      }

      // =====================================================
      // NAVIGATION SYSTEM
      // =====================================================
      function updateNavigationButtons() {
        const prevBtn = document.getElementById("prevLessonBtn");
        const nextBtn = document.getElementById("nextLessonBtn");

        if (!prevBtn || !nextBtn) return;

        // Previous button
        prevBtn.disabled = currentLessonIndex === 0;

        // Next button logic
        const isLastLesson =
          currentLessonIndex === COURSE_DATA.lessons.length - 1;
        const canGoNext =
          currentLessonIndex < COURSE_DATA.lessons.length - 1 &&
          canAccessLesson(currentLessonIndex + 1);

        if (isLastLesson) {
          const isCurrentCompleted =
            courseProgress[COURSE_DATA.lessons[currentLessonIndex].id]
              ?.completed;
          nextBtn.disabled = !isCurrentCompleted;
          nextBtn.innerHTML = '<i class="fas fa-trophy"></i> Complete Course';
        } else {
          nextBtn.disabled = !canGoNext;
          nextBtn.innerHTML = 'Next <i class="fas fa-chevron-right"></i>';
        }
      }

      // Navigation button event handlers
      function goToPreviousLesson() {
        if (currentLessonIndex > 0) {
          trackLessonTime(); // Track time spent on current lesson
          currentLessonIndex--;
          loadLesson(currentLessonIndex);
        }
      }

      function goToNextLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          const canGoNext = canAccessLesson(currentLessonIndex + 1);
          if (canGoNext) {
            trackLessonTime();
            currentLessonIndex++;
            loadLesson(currentLessonIndex);
          } else {
            showToast("Complete the current lesson quiz to proceed", "warning");
          }
        } else {
          // Complete course
          completeCourse();
        }
      }

      // =====================================================
      // SIDEBAR FUNCTIONS
      // =====================================================
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.toggle("open");
        if (overlay) overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.remove("open");
        if (overlay) overlay.classList.remove("active");
      }

      // =====================================================
      // ACHIEVEMENT NOTIFICATION SYSTEM
      // =====================================================
      function queueAchievementNotification(achievement) {
        notificationQueue.push(achievement);
        processNotificationQueue();
      }

      function processNotificationQueue() {
        if (isShowingNotification || notificationQueue.length === 0) return;

        isShowingNotification = true;
        const achievement = notificationQueue.shift();
        showAchievementNotification(achievement);

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          isShowingNotification = false;
          processNotificationQueue();
        }, duration + 500);
      }

      function showAchievementNotification(achievement) {
        const notification = document.getElementById("achievementNotification");
        if (!notification) return;

        const icon = document.getElementById("notificationIcon");
        const title = document.getElementById("notificationTitle");
        const description = document.getElementById("notificationDescription");
        const points = document.getElementById("notificationPoints");

        if (icon) {
          icon.innerHTML = `<i class="${achievement.icon}"></i>`;
          icon.className = `notification-icon ${achievement.rarity}`;
        }
        if (title) title.textContent = achievement.name;
        if (description) description.textContent = achievement.description;
        if (points) points.textContent = `+${achievement.points} Points`;

        notification.className = `achievement-notification ${achievement.rarity}`;
        notification.classList.add("show");

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          notification.classList.remove("show");
        }, duration);
      }

      // =====================================================
      // UTILITY FUNCTIONS
      // =====================================================
      function calculateAverageQuizScore() {
        const scores = Object.values(courseProgress)
          .filter((p) => p.completed && p.quizScore)
          .map((p) => p.quizScore);

        if (scores.length === 0) return 0;
        return Math.round(
          scores.reduce((sum, score) => sum + score, 0) / scores.length
        );
      }

      async function resetProgress() {
        if (
          !confirm(
            "Are you sure you want to reset your progress? This action cannot be undone."
          )
        ) {
          return;
        }

        try {
          // Track lesson time before reset
          trackLessonTime();

          // Reset local state
          courseProgress = {};
          currentLessonIndex = 0;
          courseSession = {
            startTime: new Date(),
            totalStudyTime: 0,
            lessonsStarted: 0,
            lessonsCompleted: 0,
            pageLoadTime: new Date(),
            interactionCount: 0,
            lastActivityTime: new Date(),
          };

          // Delete from database
          await supabase
            .from("course_progress")
            .delete()
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Log reset activity
          logUserActivity("progress_reset", {
            course_id: COURSE_DATA.id,
            reset_reason: "manual",
          });

          // Reinitialize
          await saveProgress();
          renderSidebar();
          loadLesson(0);

          showToast("Progress reset successfully", "success");
        } catch (error) {
          console.error("Error resetting progress:", error);
          showToast("Failed to reset progress", "error");
        }
      }

      function copyCode(codeId) {
        const codeElement = document.getElementById(codeId);
        if (!codeElement) return;

        const text = codeElement.textContent;

        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast("Code copied to clipboard!", "success");

            // Track code copy for achievements
            logUserActivity("code_copied", {
              code_section: codeId,
              lesson_id: COURSE_DATA.lessons[currentLessonIndex].id,
            });
          })
          .catch((err) => {
            console.error("Failed to copy code:", err);
            showToast("Failed to copy code", "error");

            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
              document.execCommand("copy");
              showToast("Code copied to clipboard!", "success");
            } catch (fallbackError) {
              showToast(
                "Copy failed - please select and copy manually",
                "error"
              );
            }
            document.body.removeChild(textArea);
          });
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // =====================================================
      // UI FEEDBACK SYSTEMS
      // =====================================================
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const messageEl = document.getElementById("toastMessage");

        if (!toast || !messageEl) {
          console.log(`Toast: ${message} (${type})`);
          return;
        }

        messageEl.textContent = message;
        toast.className = `toast ${type} show`;

        setTimeout(() => {
          toast.classList.remove("show");
        }, 4000);
      }

      function showLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) loadingScreen.classList.remove("hidden");
      }

      function hideLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) {
          setTimeout(() => {
            loadingScreen.classList.add("hidden");
          }, 1000);
        }
      }

      // =====================================================
      // MUSIC PLAYER INTEGRATION
      // =====================================================
      function initMusicPlayer() {
        const btnText = document.getElementById("music-button-text");
        const icon = document.getElementById("music-icon");
        const dropdown = document.getElementById("music-dropdown-content");

        if (!btnText || !icon || !dropdown) return;

        function setUI(state) {
          btnText.textContent =
            state === "Playing" ? "PAUSE MUSIC" : "STUDY MUSIC";
          icon.className =
            state === "Playing"
              ? "fa-solid fa-circle-pause"
              : "fa-solid fa-music";
        }

        // Load saved music state
        const savedSrc = localStorage.getItem("cybersec_music_src");
        const savedTime = parseFloat(
          localStorage.getItem("cybersec_music_time") || 0
        );

        if (savedSrc) {
          audioPlayer.src = savedSrc;
          audioPlayer.currentTime = savedTime;
          audioPlayer
            .play()
            .then(() => setUI("Playing"))
            .catch(() => setUI("Stopped"));
        }

        // Music button click handler
        document
          .getElementById("music-dropdown")
          .querySelector("button")
          .addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown.style.display =
              dropdown.style.display === "block" ? "none" : "block";

            if (audioPlayer.src && !audioPlayer.paused) {
              audioPlayer.pause();
              setUI("Stopped");
            } else if (audioPlayer.src) {
              audioPlayer.play().then(() => setUI("Playing"));
            }
          });

        // Music selection handlers
        dropdown.querySelectorAll("a[data-src]").forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.src = link.dataset.src;
            audioPlayer.play().then(() => setUI("Playing"));
            localStorage.setItem("cybersec_music_src", link.dataset.src);
            dropdown.style.display = "none";
          });
        });

        // Stop music handler
        const stopLink = document.getElementById("stop-music-link");
        if (stopLink) {
          stopLink.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.removeAttribute("src");
            setUI("Stopped");
            localStorage.removeItem("cybersec_music_src");
            localStorage.removeItem("cybersec_music_time");
            dropdown.style.display = "none";
          });
        }

        // Save music state before page unload
        window.addEventListener("beforeunload", () => {
          if (!audioPlayer.paused && audioPlayer.src) {
            localStorage.setItem("cybersec_music_src", audioPlayer.src);
            localStorage.setItem(
              "cybersec_music_time",
              audioPlayer.currentTime
            );
          }
        });

        // Close dropdown when clicking outside
        window.addEventListener("click", (e) => {
          if (!e.target.closest("#music-dropdown")) {
            dropdown.style.display = "none";
          }
        });
      }

      // Show initial music indicator
      function addMusicIndicator() {
        const musicBtn = document.querySelector("#music-dropdown");
        if (musicBtn) {
          const indicator = document.createElement("div");
          indicator.className = "music-indicator";
          indicator.innerHTML = `<i class="fa-solid fa-music"></i> Try Study Music!`;

          musicBtn.style.position = "relative";
          musicBtn.appendChild(indicator);

          setTimeout(() => indicator.remove(), 3000);
        }
      }

      // Initialize Event Listeners
      function initializeEventListeners() {
        // Navigation buttons
        document
          .getElementById("prevLessonBtn")
          ?.addEventListener("click", goToPreviousLesson);
        document
          .getElementById("nextLessonBtn")
          ?.addEventListener("click", goToNextLesson);

        // Reset progress button
        document
          .getElementById("resetProgressBtn")
          ?.addEventListener("click", resetProgress);

        // Mobile menu toggle
        document
          .getElementById("menuToggle")
          ?.addEventListener("click", toggleSidebar);
        document
          .getElementById("sidebarOverlay")
          ?.addEventListener("click", closeSidebar);

        // Keyboard shortcuts
        document.addEventListener("keydown", handleKeyboardShortcuts);

        // Window resize handler
        window.addEventListener("resize", handleWindowResize);

        // Content interaction tracking
        document.getElementById("contentBody")?.addEventListener(
          "scroll",
          debounce(() => {
            trackUserInteraction();
          }, 1000)
        );
      }

      // Keyboard Shortcuts
      function handleKeyboardShortcuts(e) {
        if (document.querySelector(".quiz-question.active")) return;

        if (e.key === "ArrowLeft" && e.ctrlKey) {
          e.preventDefault();
          goToPreviousLesson();
        } else if (e.key === "ArrowRight" && e.ctrlKey) {
          e.preventDefault();
          goToNextLesson();
        }
      }

      // Window Resize Handler
      function handleWindowResize() {
        if (window.innerWidth > 768) {
          closeSidebar();
        }
      }

      // Debounce Helper
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Initialize responsive behavior
      if (window.innerWidth <= 768) {
        document.getElementById("menuToggle").style.display = "inline-flex";
      }

      // Auto-save progress periodically
      setInterval(async () => {
        if (currentUser && Object.keys(courseProgress).length > 0) {
          await saveProgress();
        }
      }, 60000); // Save every minute

      // System initialization logging
      console.log("CyberSec Academy Course System Initialized");
      console.log("Current Course:", COURSE_DATA.title);
      console.log("Total Lessons:", COURSE_DATA.lessons.length);

      // Google OAuth Integration
      const googleBtn = document.querySelector(".btn-google");
      if (googleBtn) {
        googleBtn.addEventListener("click", async () => {
          const { data, error } = await supabase.auth.signInWithOAuth({
            provider: "google",
            options: {
              redirectTo:
                window.location.origin +
                "/courses/incident-response-fundamentals.html",
            },
          });

          if (error) {
            console.error("Google login error:", error.message);
            showToast("Google login failed: " + error.message, "error");
          }
        });
      }

      // Check for existing session
      supabase.auth.getSession().then(({ data }) => {
        if (data.session) {
          console.log("User already logged in:", data.session.user);
          currentUser = data.session.user;
          startCourseSession();
        }
      });

      // Add missing auth modal functions
      function openAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "flex";
        }
      }

      function closeAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "none";
        }
      }

      // Add auth tab switching functionality
      document.getElementById("tabSignIn")?.addEventListener("click", () => {
        document.getElementById("tabSignIn").classList.add("active");
        document.getElementById("tabSignUp").classList.remove("active");
        document.getElementById("signInForm").style.display = "block";
        document.getElementById("signUpForm").style.display = "none";
      });

      document.getElementById("tabSignUp")?.addEventListener("click", () => {
        document.getElementById("tabSignUp").classList.add("active");
        document.getElementById("tabSignIn").classList.remove("active");
        document.getElementById("signUpForm").style.display = "block";
        document.getElementById("signInForm").style.display = "none";
      });

      document
        .getElementById("closeAuthModal")
        ?.addEventListener("click", closeAuthModal);

      // Improved error handling for auth session
      supabase.auth.onAuthStateChange((event, session) => {
        if (event === "SIGNED_IN") {
          currentUser = session.user;
          closeAuthModal();
          startCourseSession();
        } else if (event === "SIGNED_OUT") {
          currentUser = null;
          openAuthModal();
        }
      });

      // Add form submission handlers
      document
        .getElementById("emailSignInForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signInEmail").value;
          const password = document.getElementById("signInPassword").value;

          try {
            const { data, error } = await supabase.auth.signInWithPassword({
              email,
              password,
            });

            if (error) throw error;

            closeAuthModal();
          } catch (error) {
            showToast(error.message, "error");
          }
        });

      document
        .getElementById("emailSignUpForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signUpEmail").value;
          const password = document.getElementById("signUpPassword").value;
          const name = document.getElementById("signUpName").value;

          try {
            const { data, error } = await supabase.auth.signUp({
              email,
              password,
              options: {
                data: {
                  full_name: name,
                },
              },
            });

            if (error) throw error;

            showToast(
              "Account created successfully! Please check your email.",
              "success"
            );
          } catch (error) {
            showToast(error.message, "error");
          }
        });
    </script>
  </body>
</html>
