



<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>SIEM Operations: From Fundamentals to Expert Course | CipherHall</title>
    <meta name="description" content="Enroll in our free, comprehensive SIEM Operations course. Learn everything from fundamentals to advanced threat hunting, cloud monitoring, and compliance with hands-on labs." />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />
    <link rel="canonical" href="https://www.cipherhall.com/courses/siem-operations-foundations.html" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Course",
      "name": "SIEM Operations: From Fundamentals to Expert",
      "description": "A comprehensive course covering SIEM operations, from basic log management and threat detection to advanced architecture design and threat hunting.",
      "provider": {
        "@type": "Organization",
        "name": "CipherHall",
        "sameAs": "https://www.cipherhall.com"
      },
      "hasCourseInstance": {
        "@type": "CourseInstance",
        "courseMode": "Online",
        "instructor": {
          "@type": "Person",
          "name": "Dr. Evelyn Reed"
        }
      }
    }
    </script>
    <meta name="robots" content="noindex, nofollow">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Exo+2:wght@700;800;900&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" />
    <link rel="stylesheet" href="assets/css/coursepages.css">
</head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loader-icon">
        <i class="fas fa-graduation-cap"></i>
      </div>
      <div class="loader-text">Loading Course Content...</div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Music Player (fixed at top right) -->
    <div class="header-controls">
      <div class="music-dropdown" id="music-dropdown">
        <button class="btn btn-secondary">
          <span id="music-button-text">STUDY MUSIC</span>
          <i id="music-icon" class="fa-solid fa-music"></i>
        </button>
        <div class="music-dropdown-content" id="music-dropdown-content">
          <a
            href="#"
            data-src="https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3"
            >1. Coffee Shop Vibes</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-16.mp3"
            >2. City Lights Lofi</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3"
            >3. Mellow Thoughts</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-13.mp3"
            >4. Rainy Mood</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3"
            >5. Time Alone</a
          >
          <a href="#" id="stop-music-link"
            ><i class="fa-solid fa-stop-circle"></i> Stop Music</a
          >
        </div>
      </div>

      <button class="btn btn-secondary" id="resetProgressBtn">
        <i class="fas fa-redo"></i>
        Reset Progress
      </button>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal" style="display: none">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <span class="close" id="closeAuthModal">&times;</span>
        <div class="auth-tabs">
          <button id="tabSignIn" class="auth-tab active">Sign In</button>
          <button id="tabSignUp" class="auth-tab">Sign Up</button>
        </div>
        <div
          id="authLoader"
          style="display: none; text-align: center; padding: 2rem"
        >
          <i
            class="fas fa-spinner fa-spin fa-2x"
            style="color: var(--color-green)"
          ></i>
          <p style="margin-top: 0.5rem">Authenticating...</p>
        </div>
        <div id="signInForm" class="auth-form">
          <h2>Sign In to CipherHall</h2>
          <button id="googleSignIn" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignInForm">
            <input
              type="email"
              id="signInEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signInPassword"
              placeholder="Password"
              required
            />
            <button type="submit" class="btn btn-primary">Sign In</button>
          </form>
        </div>
        <div id="signUpForm" class="auth-form" style="display: none">
          <h2>Join CipherHall</h2>
          <button id="googleSignUp" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignUpForm">
            <input
              type="text"
              id="signUpName"
              placeholder="Full Name"
              required
            />
            <input
              type="email"
              id="signUpEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signUpPassword"
              placeholder="Password (min. 8 characters)"
              required
            />
            <button type="submit" class="btn btn-secondary">
              Create Account
            </button>
          </form>
        </div>
        <div id="authMessage"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="course-info">
          <h1 class="course-title" id="courseTitle">Loading...</h1>
          <div class="course-progress">
            <div class="progress-header">
              <span class="progress-label">Course Progress</span>
              <span class="progress-percentage" id="courseProgressPercent"
                >0%</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="courseProgressFill"
                style="width: 0%"
              ></div>
            </div>
            <div class="progress-stats">
              <span id="completedLessons">0</span>
              <span id="totalLessons">0</span>
            </div>
          </div>
          <a href="/dashboard.html" class="back-to-dashboard">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
          </a>
        </div>
      </div>

      <nav class="lesson-nav" id="lessonNav">
        <!-- Lessons will be loaded dynamically -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="content-header">
        <div class="lesson-header">
          <div class="lesson-header-left">
            <span class="lesson-number" id="currentLessonNumber">1</span>
            <h1 class="lesson-header-title" id="currentLessonTitle">
              Loading...
            </h1>
          </div>
          <div class="lesson-actions">
            <button class="mbtn btn-primary" id="menuToggle">
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </header>

      <div class="content-body" id="contentBody">
        <div class="lesson-content" id="lessonContent">
          <!-- Lesson content will be loaded dynamically -->
        </div>
      </div>

      <footer class="lesson-navigation">
        <div class="nav-info" id="navInfo">Lesson 1 of 10</div>
        <div class="nav-controls">
          <button class="btn btn-secondary" id="prevLessonBtn" disabled>
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button class="btn btn-primary" id="nextLessonBtn" disabled>
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </footer>
    </main>

    <!-- Achievement Notification -->
    <div id="achievementNotification" class="achievement-notification">
      <div class="notification-header">
        <div class="notification-icon" id="notificationIcon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="notification-content">
          <h3 id="notificationTitle">Achievement Unlocked!</h3>
          <p id="notificationDescription">Description here...</p>
        </div>
      </div>
      <div class="notification-reward" id="notificationReward">
        <i class="fas fa-coins"></i>
        <span id="notificationPoints">+100 Points</span>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage"></span>
    </div>

    <script>
      // =====================================================
      // SYNCHRONIZED COURSE SYSTEM WITH DASHBOARD INTEGRATION
      // =====================================================

      // Supabase Configuration - Replace with your config
      const supabaseUrl = "https://lzcmzulemfubjaksoqor.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6Y216dWxlbWZ1Ympha3NvcW9yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzM5MDgsImV4cCI6MjA3MDkwOTkwOH0.crhPH4YWtRsr1BJTpAQcmPbWSpwIWRbzoI4sRb2_fPI";
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      // =====================================================
      // COURSE DATA STRUCTURE - REPLACE WITH YOUR COURSE JSON
      // =====================================================
      const COURSE_DATA = {
        id: "siem-operations",
        title: "SIEM Operations: From Fundamentals to Expert",
        description:
          "A comprehensive course covering SIEM operations, from basic log management and threat detection to advanced architecture design and threat hunting.",
        category: "cybersecurity",
        difficulty: "Beginner to Expert",
        duration: "60 hours",
        instructor: "Dr. Evelyn Reed",
        lessons: [
          {
            id: "lesson-1-siem-fundamentals",
            title: "Lesson 1: SIEM Fundamentals",
            duration: "120 min",
            objectives: [
              "Define what SIEM is and its critical role in modern cybersecurity",
              "Understand the core architecture and components of a typical SIEM system",
              "Identify common data sources and essential log types for ingestion",
              "Gain an overview of the leading SIEM platforms in the market",
              "Prepare for hands-on labs by understanding installation concepts for Splunk or the ELK Stack",
            ],
            content: {
              overview:
                "Welcome to the world of Security Information and Event Management (SIEM). This foundational lesson introduces you to what a SIEM is, why it's a cornerstone of modern security operations, and how it works to provide visibility and threat detection across an organization.",
              sections: [
                {
                  title: "What is SIEM and Why It Matters",
                  content:
                    "<p>Security Information and Event Management (SIEM) is a solution that helps organizations detect, analyze, and respond to security threats before they harm business operations. It combines two key functions: Security Information Management (SIM) for log collection and reporting, and Security Event Management (SEM) for real-time analysis and threat correlation.</p><h3>Core Functions of a SIEM:</h3><ul><li><strong>Data Aggregation:</strong> Collecting log and event data from a wide range of sources.</li><li><strong>Correlation:</strong> Linking events together to identify suspicious patterns or potential attacks.</li><li><strong>Alerting:</strong> Notifying security staff of correlated events that suggest a security issue.</li><li><strong>Dashboards & Visualization:</strong> Providing real-time insights into the security posture.</li><li><strong>Compliance & Reporting:</strong> Automating the collection and reporting of compliance data (e.g., for PCI DSS, GDPR).</li><li><strong>Forensic Analysis:</strong> Enabling long-term storage of logs for incident investigation.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>The Evolution</strong></div><p>Modern SIEMs often include advanced features like User and Entity Behavior Analytics (UEBA), Security Orchestration, Automation, and Response (SOAR), and threat intelligence integration right out of the box.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1526374965328-7f61d4e18c66?w=800&h=400&fit=crop",
                },
                {
                  title: "SIEM Architecture and Components",
                  content:
                    "<p>A typical SIEM architecture is designed to handle the massive volume of data generated by modern IT environments. It consists of several key components working in concert.</p><h3>Core Components:</h3><ul><li><strong>Data Sources:</strong> The devices, applications, and systems that generate logs.</li><li><strong>Log Collectors / Agents:</strong> Software that gathers and forwards logs.</li><li><strong>Log Aggregator / Storage:</strong> A central repository that receives, parses, normalizes, and stores the data.</li><li><strong>Correlation Engine:</strong> The 'brain' of the SIEM that analyzes data using predefined rules.</li><li><strong>Analyst Console / UI:</strong> The interface where security analysts interact with the SIEM.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Agent vs. Agentless Collection</strong></div><p>Log collection can be agent-based (software on the host) for rich data, or agentless (listening for protocols like Syslog) for easier deployment on network devices.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800&h=400&fit=crop",
                },
                {
                  title: "Data Sources and Log Types",
                  content:
                    "<p>The effectiveness of a SIEM is directly related to the quality and breadth of its data sources. The more context you provide, the better it can detect threats.</p><h3>Critical Data Sources:</h3><ul><li><strong>Network Devices:</strong> Firewalls, Routers, Switches, IDS/IPS.</li><li><strong>Servers:</strong> Windows (Event Logs), Linux (Syslog).</li><li><strong>Endpoints:</strong> Workstations and laptops (via EDR tools).</li><li><strong>Applications:</strong> Databases, web servers, custom applications.</li><li><strong>Cloud Services:</strong> AWS CloudTrail, Azure Monitor Logs.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Garbage In, Garbage Out</strong></div><p>Without proper filtering and normalization, a SIEM can be overwhelmed with low-quality data, leading to missed detections and analyst fatigue.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1544197150-b99a5808e7ee?w=800&h=400&fit=crop",
                },
                {
                  title: "Common SIEM Platforms Overview",
                  content:
                    "<p>The SIEM market offers a wide variety of platforms, ranging from commercial leaders to powerful open-source projects.</p><h3>Leading SIEM Platforms:</h3><ul><li><strong>Splunk Enterprise Security:</strong> A market leader known for its powerful search language (SPL).</li><li><strong>Microsoft Sentinel:</strong> A cloud-native SIEM/SOAR solution that uses Kusto Query Language (KQL).</li><li><strong>IBM QRadar:</strong> A long-standing leader known for its robust analytics.</li><li><strong>Elastic SIEM (ELK Stack):</strong> An open-source solution built on Elasticsearch, Logstash, and Kibana.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Choosing a Platform</strong></div><p>The choice of a SIEM depends on an organization's budget, scale, existing infrastructure, and the expertise of its security team.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1611095965942-5c1a74e5b4ac?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Sample Syslog Firewall Log",
                language: "bash",
                code: "<134>1 2023-10-27T10:30:01Z firewall-1 - - - [action=DROP] src=192.168.1.100 dst=8.8.8.8 sport=54321 dport=53",
              },
              {
                title: "Lab: Basic ELK Stack Installation (Docker)",
                language: "bash",
                code: '# 1. Create a docker network\ndocker network create elastic\n\n# 2. Start Elasticsearch\ndocker run -d --name es01 --net elastic -p 9200:9200 -e "discovery.type=single-node" docker.elastic.co/elasticsearch/elasticsearch:8.4.1\n\n# 3. Start Kibana\ndocker run -d --name kib01 --net elastic -p 5601:5601 -e "ELASTICSEARCH_HOSTS=http://es01:9200" docker.elastic.co/kibana/kibana:8.4.1',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question: "What does SIEM stand for?",
                  options: [
                    "System Information and Event Markup",
                    "Security Information and Event Management",
                    "Secure Internet and Egress Monitoring",
                    "System Integrity and Environment Management",
                  ],
                  correct: 1,
                  explanation:
                    "SIEM stands for Security Information and Event Management.",
                },
                {
                  id: 2,
                  question:
                    "Which component of a SIEM is responsible for analyzing data with predefined rules?",
                  options: [
                    "Log Collector",
                    "Log Storage",
                    "Analyst Console",
                    "Correlation Engine",
                  ],
                  correct: 3,
                  explanation:
                    "The Correlation Engine actively analyzes incoming data to identify security incidents.",
                },
                {
                  id: 3,
                  question:
                    "Which of the following is an essential data source for a SIEM?",
                  options: [
                    "Employee Timesheets",
                    "Marketing Analytics",
                    "Firewall Logs",
                    "Sales CRM Data",
                  ],
                  correct: 2,
                  explanation:
                    "Firewall logs provide critical information about network traffic for security monitoring.",
                },
                {
                  id: 4,
                  question:
                    "The process of converting logs into a common format is called:",
                  options: [
                    "Aggregation",
                    "Normalization",
                    "Collection",
                    "Alerting",
                  ],
                  correct: 1,
                  explanation:
                    "Normalization is the crucial process of parsing and standardizing diverse log formats.",
                },
                {
                  id: 5,
                  question:
                    "Which of these is a popular open-source SIEM platform?",
                  options: [
                    "IBM QRadar",
                    "Microsoft Sentinel",
                    "Splunk",
                    "Elastic SIEM (ELK)",
                  ],
                  correct: 3,
                  explanation:
                    "The Elastic SIEM is built on the open-source ELK Stack.",
                },
              ],
            },
          },
          {
            id: "lesson-2-log-management-basics",
            title: "Lesson 2: Log Management Basics",
            duration: "120 min",
            objectives: [
              "Understand various log collection methods, including agent-based and agentless",
              "Learn the importance of log parsing and normalization for data consistency",
              "Grasp the fundamentals of data retention policies for compliance and forensics",
              "Explore different storage architectures for SIEM data (hot, warm, cold)",
            ],
            content: {
              overview:
                "Effective log management is the bedrock of any successful SIEM implementation. This lesson covers the essential processes of collecting, standardizing, and storing log data to ensure it is available and usable for security analysis.",
              sections: [
                {
                  title: "Log Collection Methods",
                  content:
                    "<p>Getting data into the SIEM is the first critical step. There are two primary methods for log collection, each with its own advantages.</p><h3>Collection Methods:</h3><ul><li><strong>Agent-based:</strong> A lightweight software agent (e.g., Splunk Universal Forwarder, Filebeat) is installed on the source system. It provides reliable, rich, and locally filtered data.</li><li><strong>Agentless:</strong> The SIEM collects data remotely using standard network protocols. This is common for devices where agents cannot be installed.</li></ul><h3>Common Protocols:</h3><ul><li><strong>Syslog:</strong> A standard for message logging used heavily by Linux systems and network devices.</li><li><strong>SNMP Traps:</strong> Notifications sent from devices to a central manager to indicate an event.</li><li><strong>Windows Event Forwarding (WEF):</strong> A native Windows protocol for collecting event logs.</li><li><strong>API Polling:</strong> Programmatically querying data sources (like cloud services) for logs.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Encryption is Key</strong></div><p>Always use encrypted protocols (e.g., Syslog-NG/TLS) when forwarding logs across untrusted networks to protect data integrity and confidentiality.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1580829524623-7a9b05f2b294?w=800&h=400&fit=crop",
                },
                {
                  title: "Log Parsing and Normalization",
                  content:
                    "<p>Logs come in countless different formats. To make sense of them, a SIEM must parse and normalize the data.</p><h3>Key Processes:</h3><ul><li><strong>Parsing:</strong> The process of breaking down a raw log message into its constituent parts (fields). For example, extracting the `src_ip`, `dest_ip`, and `action` from a firewall log. Regular Expressions (Regex) are commonly used for this.</li><li><strong>Normalization:</strong> The process of mapping the extracted fields to a common schema. For example, renaming `Source-IP`, `src_ip`, and `client_ip` all to a standard field name like `source.ip`.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Common Information Model (CIM)</strong></div><p>Many SIEMs use a Common Information Model to standardize field names across all data sources. This makes searching and correlation much easier for analysts.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1517694712202-14261e80e3a5?w=800&h=400&fit=crop",
                },
                {
                  title: "Data Retention Policies",
                  content:
                    "<p>A data retention policy defines how long log data is stored and when it should be archived or deleted. This is critical for both compliance and security investigations.</p><h3>Factors Influencing Retention:</h3><ul><li><strong>Compliance Requirements:</strong> Regulations like PCI DSS (1 year), HIPAA, and SOX dictate minimum retention periods.</li><li><strong>Forensic Investigation Needs:</strong> Investigations into advanced threats may require looking back several months.</li><li><strong>Storage Costs:</strong> Storing vast amounts of data can be expensive, requiring a balance between security needs and budget.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Policy Enforcement</strong></div><p>Your SIEM must be configured to automatically enforce the retention policy, moving data through different storage tiers and eventually deleting it.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1593436034369-9524c8b2a3d9?w=800&h=400&fit=crop",
                },
                {
                  title: "Storage Architecture",
                  content:
                    "<p>To manage costs and search performance, SIEMs use a tiered storage architecture.</p><h3>Storage Tiers:</h3><ul><li><strong>Hot Storage:</strong> The most recent and frequently accessed data, stored on the fastest disks (e.g., SSDs). This data is immediately searchable.</li><li><strong>Warm Storage:</strong> Less recent data that is accessed infrequently, stored on slower, less expensive disks (e.g., HDDs).</li><li><strong>Cold Storage:</strong> Archived data stored on the cheapest media (e.g., cloud object storage like Amazon S3). This data often needs to be 'rehydrated' before it can be searched.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Balancing Act</strong></div><p>A common strategy is to keep 30-90 days of data in hot storage for rapid analysis and the remainder in warm/cold storage for compliance.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1542382156942-0268579cf259?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Filebeat Basic Configuration (filebeat.yml)",
                language: "yaml",
                code: 'filebeat.inputs:\n- type: log\n  enabled: true\n  paths:\n    - /var/log/nginx/access.log\n\noutput.logstash:\n  hosts: ["logstash-server:5044"]\n  ssl.enabled: true\n  ssl.certificate_authorities: ["/etc/pki/tls/certs/logstash.crt"]',
              },
              {
                title: "Logstash Grok Filter for Parsing Nginx Logs",
                language: "ruby",
                code: 'filter {\n  grok {\n    match => { "message" => "%{IPORHOST:client.ip} %{USER:ident} %{USER:auth} \\[%{HTTPDATE:timestamp}\\] \\"%{WORD:http.request.method} %{DATA:url.path} HTTP/%{NUMBER:http.version}\\" %{NUMBER:http.response.status_code} %{NUMBER:http.response.body.bytes}" }\n  }\n}',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question: "What is the primary function of a log parser?",
                  options: [
                    "To forward logs from a source to the SIEM",
                    "To store logs for long-term retention",
                    "To break down a raw log message into fields",
                    "To decide if an event is a security threat",
                  ],
                  correct: 2,
                  explanation:
                    "Parsing is the process of interpreting a raw log string and extracting structured fields from it.",
                },
                {
                  id: 2,
                  question:
                    "A company needs to keep its security logs searchable for 90 days and archived for 1 year. This is defined in the:",
                  options: [
                    "Acceptable Use Policy",
                    "Incident Response Plan",
                    "Data Retention Policy",
                    "Storage Architecture Plan",
                  ],
                  correct: 2,
                  explanation:
                    "A Data Retention Policy dictates how long data is stored in different states to meet compliance and operational needs.",
                },
                {
                  id: 3,
                  question:
                    "Which log collection method involves installing software on a host to send logs?",
                  options: [
                    "Agentless",
                    "API Polling",
                    "Syslog",
                    "Agent-based",
                  ],
                  correct: 3,
                  explanation:
                    "Agent-based collection uses a dedicated forwarder or agent on the source machine for reliable data transfer.",
                },
                {
                  id: 4,
                  question:
                    "In a tiered storage architecture, where is the most recent and frequently accessed data kept?",
                  options: [
                    "Cold Storage",
                    "Warm Storage",
                    "Hot Storage",
                    "Archived Storage",
                  ],
                  correct: 2,
                  explanation:
                    "Hot storage uses the fastest disks to keep the most recent data available for immediate, high-performance searching.",
                },
                {
                  id: 5,
                  question: "What is the purpose of normalization in a SIEM?",
                  options: [
                    "To increase log volume",
                    "To map extracted fields to a common naming schema",
                    "To encrypt log data",
                    "To delete unnecessary logs",
                  ],
                  correct: 1,
                  explanation:
                    "Normalization standardizes field names (e.g., from 'src_ip' and 'Source-IP' to 'source.ip') to enable consistent searching and correlation.",
                },
              ],
            },
          },
          {
            id: "lesson-3-security-event-basics",
            title: "Lesson 3: Security Event Basics",
            duration: "120 min",
            objectives: [
              "Distinguish between a standard log entry and a security event",
              "Understand the fundamental principles of event correlation",
              "Learn to differentiate between false positives and true positives",
              "Gain initial experience with analyzing basic events in a SIEM interface",
            ],
            content: {
              overview:
                "Not all logs are created equal. This lesson focuses on identifying events of security interest from the sea of data, understanding how a SIEM connects them, and beginning the critical process of distinguishing real threats from benign activity.",
              sections: [
                {
                  title: "Understanding Security Events vs. Logs",
                  content:
                    "<p>A log is a record of an activity, while a security event is a log that indicates a potential security issue. A SIEM's first job is to filter the signal from the noise.</p><h3>Definitions:</h3><ul><li><strong>Log:</strong> An immutable, timestamped record of an action that occurred on a system. <em>Example: A user successfully logged in.</em></li><li><strong>Event of Interest:</strong> A log that matches a predefined condition that might be interesting but isn't necessarily malicious. <em>Example: A user logged in outside of normal business hours.</em></li><li><strong>Security Event/Alert:</strong> An event or a set of correlated events that strongly indicates a security policy violation or a threat. <em>Example: A user logged in outside of business hours from a foreign country after 10 failed login attempts.</em></li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Event Enrichment</strong></div><p>SIEMs enrich events with context, such as user information from Active Directory, IP geolocation, or threat intelligence, to help analysts determine their significance.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1510915228340-29c85a43dcfe?w=800&h=400&fit=crop",
                },
                {
                  title: "Event Correlation Fundamentals",
                  content:
                    "<p>Correlation is the core process that turns individual logs into actionable security alerts. It involves linking separate but related events from one or more sources based on a set of rules.</p><h3>Types of Correlation:</h3><ul><li><strong>Session-based (Stateful):</strong> Tracks a sequence of related events over time. <em>Example: Rule triggers if 5 failed logins are followed by 1 successful login from the same IP address.</em></li><li><strong>Stateless:</strong> Triggers on a single event that meets a specific condition. <em>Example: Rule triggers if a known malicious IP address is seen in a firewall log.</em></li><li><strong>Time-based:</strong> Events that occur within a certain time window. <em>Example: Rule triggers if a user logs into two geographically distant locations within an impossible travel time.</em></li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>The Logic</strong></div><p>Correlation rules are typically based on simple logic: IF [condition A] AND/OR [condition B] happens within [timeframe X], THEN [create alert Y].</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=400&fit=crop",
                },
                {
                  title: "False Positives vs. True Positives",
                  content:
                    "<p>A crucial skill for a security analyst is alert triage: determining if an alert represents a real threat or is just noise.</p><h3>Definitions:</h3><ul><li><strong>True Positive (TP):</strong> The alert correctly identified a malicious activity. This is the desired outcome.</li><li><strong>False Positive (FP):</strong> The alert was triggered by benign activity that was incorrectly flagged as malicious. This leads to analyst fatigue.</li><li><strong>True Negative (TN):</strong> The SIEM correctly ignored benign activity.</li><li><strong>False Negative (FN):</strong> The SIEM failed to detect a real malicious activity. This is the most dangerous outcome.</li></ul><h3>Reducing False Positives:</h3><ul><li><strong>Rule Tuning:</strong> Making correlation rules more specific.</li><li><strong>Creating Exceptions:</strong> Whitelisting known benign activity (e.g., a vulnerability scanner).</li><li><strong>Improving Log Quality:</strong> Ensuring logs are parsed correctly and have enough context.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Alert Fatigue</strong></div><p>An excessive number of false positives can overwhelm a security team, causing them to ignore alerts and potentially miss a true positive. Continuous tuning is essential.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1543286386-2e659306cd6c?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Pseudo-code for a Brute Force Detection Rule",
                language: "sql",
                code: "ALERT brute_force_login_success\nIF\n  COUNT(event.id WHERE event.action = 'login_failure') >= 5\n  AND\n  EXISTS(event.id WHERE event.action = 'login_success')\nGROUP BY source.ip, user.name\nWITHIN 5 minutes",
              },
              {
                title: "Basic Splunk Search for Failed Logins",
                language: "sql",
                code: 'index=os sourcetype="windows_security" EventCode=4625\n| stats count by src_ip user',
              },
              {
                title: "Basic Kibana Query for HTTP Errors",
                language: "json",
                code: '{\n  "query": {\n    "bool": {\n      "must": [\n        { "match": { "event.dataset": "nginx.access" } },\n        { "range": { "http.response.status_code": { "gte": 400 } } }\n      ]\n    }\n  }\n}',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "An alert fires for a legitimate vulnerability scan. This is an example of a:",
                  options: [
                    "True Positive",
                    "False Positive",
                    "True Negative",
                    "False Negative",
                  ],
                  correct: 1,
                  explanation:
                    "A False Positive is when an alert is generated for an activity that is actually benign and not a threat.",
                },
                {
                  id: 2,
                  question:
                    "A rule that triggers when 10 failed logins are followed by a successful one from the same user is an example of:",
                  options: [
                    "Data Normalization",
                    "Log Collection",
                    "Event Correlation",
                    "Data Retention",
                  ],
                  correct: 2,
                  explanation:
                    "Event Correlation is the process of linking different events over time to identify a meaningful pattern.",
                },
                {
                  id: 3,
                  question:
                    "What is the most dangerous type of outcome in SIEM alert analysis?",
                  options: [
                    "False Positive",
                    "True Positive",
                    "False Negative",
                    "True Negative",
                  ],
                  correct: 2,
                  explanation:
                    "A False Negative means a real attack was missed, leaving the organization vulnerable without its knowledge.",
                },
                {
                  id: 4,
                  question:
                    "What distinguishes a security event from a simple log?",
                  options: [
                    "It is always longer",
                    "It has a timestamp",
                    "It indicates a potential security issue",
                    "It is always stored in plain text",
                  ],
                  correct: 2,
                  explanation:
                    "A security event is a log entry that has been identified as being relevant to the security of the system.",
                },
                {
                  id: 5,
                  question:
                    "The primary method for reducing a high volume of false positive alerts is called:",
                  options: [
                    "Data Deletion",
                    "Rule Tuning",
                    "Increasing Storage",
                    "Buying a new SIEM",
                  ],
                  correct: 1,
                  explanation:
                    "Rule tuning involves refining the logic of detection rules to make them more specific and less prone to firing on benign traffic.",
                },
              ],
            },
          },
          {
            id: "lesson-4-query-languages-foundation",
            title: "Lesson 4: Query Languages Foundation",
            duration: "150 min",
            objectives: [
              "Understand the structure and basic commands of Splunk's SPL",
              "Learn the fundamentals of Kusto Query Language (KQL) for Microsoft Sentinel",
              "Get an introduction to the JSON-based Elasticsearch Query DSL",
              "Write and execute basic search queries to filter and retrieve data in a lab environment",
            ],
            content: {
              overview:
                "Query languages are the primary way analysts interact with SIEM data. This lesson introduces the foundational syntax and concepts of the most common query languages, empowering you to start searching, filtering, and analyzing log data effectively.",
              sections: [
                {
                  title: "SPL (Splunk Processing Language) Basics",
                  content:
                    "<p>SPL is the query language used in Splunk. It uses a pipe-based syntax, where the output of one command is 'piped' as the input to the next, allowing for powerful, sequential data manipulation.</p><h3>Key Concepts:</h3><ul><li><strong>Search Terms:</strong> Start with keywords, field-value pairs (e.g., `status=404`), or boolean expressions.</li><li><strong>Piping `|`:</strong> The pipe character sends results from one command to the next.</li><li><strong>Commands:</strong> `stats` (for statistics), `table` (to format results), `top` (for top values), `rename` (to rename fields), `eval` (to calculate new fields).</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Structure</strong></div><p>An SPL query typically looks like this: `search_terms | command1 [args] | command2 [args] ...`</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1563986768609-322da13575f3?w=800&h=400&fit=crop",
                },
                {
                  title: "KQL (Kusto Query Language) Fundamentals",
                  content:
                    "<p>KQL is the query language for Microsoft Sentinel, Azure Monitor, and other Azure data platforms. Like SPL, it has a pipe-based structure but a slightly different syntax and set of commands (called operators).</p><h3>Key Concepts:</h3><ul><li><strong>Tables:</strong> Queries start by specifying a table name (e.g., `SigninLogs`).</li><li><strong>Piping `|`:</strong> The pipe character sends tabular data to the next operator.</li><li><strong>Operators:</strong> `where` (to filter rows), `project` (to select columns), `summarize` (for aggregations, like `stats`), `top`, `extend` (to create new columns).</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Readability</strong></div><p>KQL is often considered highly readable due to its SQL-like operators and clear structure. For example: `TableName | where Condition | summarize count() by ColumnName`.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1555949963-aa79dcee981c?w=800&h=400&fit=crop",
                },
                {
                  title: "Elasticsearch Query DSL Introduction",
                  content:
                    "<p>The Elastic SIEM uses the Elasticsearch Query DSL, which is based on JSON. Instead of a command-line syntax, you construct JSON objects to define your query. This is often done via the Kibana user interface.</p><h3>Key Concepts:</h3><ul><li><strong>Clauses:</strong> Queries are built from clauses like `match` (for full-text search), `term` (for exact value search), and `range`.</li><li><strong>Compound Queries:</strong> Use boolean clauses like `must`, `must_not`, and `should` to combine multiple queries.</li><li><strong>Filters:</strong> Filter context is used for yes/no questions and is typically faster than query context.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Learning Curve</strong></div><p>While powerful, the JSON structure of the Query DSL can be intimidating for beginners. Kibana's Query Language (KQL - not to be confused with Kusto) provides a simpler, free-text search experience on top of it.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1522252234503-e356032cafd5?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "SPL: Top 10 Source IPs for Blocked Traffic",
                language: "sql",
                code: "index=firewall action=blocked\n| top limit=10 src_ip",
              },
              {
                title: "KQL: Count of Failed Logons by User over 24 hours",
                language: "sql",
                code: "SecurityEvent\n| where TimeGenerated > ago(24h)\n| where EventID == 4625\n| summarize FailureCount = count() by Account",
              },
              {
                title: "Elasticsearch DSL: Find Nginx Errors",
                language: "json",
                code: '{\n  "query": {\n    "bool": {\n      "must": [\n        { "match": { "service.type": "nginx" } },\n        { "match": { "log.level": "error" } }\n      ]\n    }\n  }\n}',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "In Splunk's SPL, what character is used to send results from one command to the next?",
                  options: [" > ", " -> ", " | ", " & "],
                  correct: 2,
                  explanation:
                    "The pipe character '|' is fundamental to SPL, used to chain commands together.",
                },
                {
                  id: 2,
                  question:
                    "Which KQL operator is used to filter rows based on a condition, similar to SQL's WHERE clause?",
                  options: ["filter", "project", "where", "search"],
                  correct: 2,
                  explanation:
                    "The 'where' operator in KQL is used to filter the result set to rows that satisfy a given predicate.",
                },
                {
                  id: 3,
                  question:
                    "Elasticsearch Query DSL is structured using which format?",
                  options: ["XML", "YAML", "Plain Text", "JSON"],
                  correct: 3,
                  explanation:
                    "The Elasticsearch Query DSL is a flexible, powerful query language expressed entirely in JSON.",
                },
                {
                  id: 4,
                  question:
                    "What is the primary purpose of the `stats` command in SPL?",
                  options: [
                    "To create a table",
                    "To perform statistical calculations and aggregations",
                    "To find the top values of a field",
                    "To filter events",
                  ],
                  correct: 1,
                  explanation:
                    "The 'stats' command is one of the most important in SPL, used for calculating statistics (like count, avg, sum) on your data.",
                },
                {
                  id: 5,
                  question:
                    "In KQL, how do you select specific columns to display in your results?",
                  options: [
                    "using the `select` operator",
                    "using the `columns` operator",
                    "using the `project` operator",
                    "using the `table` operator",
                  ],
                  correct: 2,
                  explanation:
                    "The 'project' operator in KQL is used to specify which columns to include in the output, similar to SQL's SELECT.",
                },
              ],
            },
          },
          {
            id: "lesson-5-use-case-development",
            title: "Lesson 5: Use Case Development",
            duration: "150 min",
            objectives: [
              "Understand the role of the MITRE ATT&CK Framework in threat detection",
              "Learn a structured methodology for designing SIEM use cases",
              "Develop the logic required to build effective detection rules",
              "Translate a threat scenario into a functional detection rule in a lab",
            ],
            content: {
              overview:
                "A SIEM is only as good as the detection rules (use cases) it contains. This lesson transitions from foundational knowledge to practical application, teaching you how to systematically design and build detection rules that are mapped to real-world adversary tactics.",
              sections: [
                {
                  title: "MITRE ATT&CK Framework Integration",
                  content:
                    "<p>The MITRE ATT&CK® framework is a globally-accessible knowledge base of adversary tactics and techniques based on real-world observations. It provides a common language for describing attacker behaviors and is the gold standard for guiding use case development.</p><h3>Why Use ATT&CK?</h3><ul><li><strong>Coverage Analysis:</strong> It helps you identify gaps in your defenses by mapping your detection rules to the framework.</li><li><strong>Threat-Informed Defense:</strong> You can prioritize use cases based on techniques commonly used by threat actors targeting your industry.</li><li><strong>Standardization:</strong> It provides a clear way to label and categorize your alerts (e.g., 'TA0003 - Persistence').</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>From Tactics to Techniques</strong></div><p>ATT&CK is structured into Tactics (the 'why' - e.g., Credential Access) and Techniques (the 'how' - e.g., T1003 OS Credential Dumping). Your use cases should focus on detecting the techniques.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1550645612-82f5d2d77e33?w=800&h=400&fit=crop",
                },
                {
                  title: "Use Case Design Methodology",
                  content:
                    "<p>Building a good detection rule is a systematic process, not just writing a query. A structured approach ensures the rule is effective, maintainable, and adds real value.</p><h3>The Use Case Lifecycle:</h3><ol><li><strong>Identify Threat:</strong> Choose a specific threat to detect, often based on threat intelligence or a specific ATT&CK technique.</li><li><strong>Data Source Identification:</strong> Determine what log sources are needed to observe this threat. (e.g., PowerShell logs, Process Execution logs).</li><li><strong>Detection Logic Development:</strong> Write the pseudo-code for the detection. What specific activities, fields, and thresholds define the malicious behavior?</li><li><strong>Implementation:</strong> Translate the pseudo-code into the SIEM's query language (SPL, KQL, etc.).</li><li><strong>Testing & Tuning:</strong> Test the rule against both malicious and benign data to ensure it works and to minimize false positives.</li><li><strong>Deployment:</strong> Move the rule into production and document its purpose, logic, and response steps.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Start with a Hypothesis</strong></div><p>A good use case starts with a clear hypothesis, such as: 'An attacker will use PowerShell to download a malicious file from the internet. We can detect this by looking for specific command-line parameters in process execution logs.'</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1499750310107-5fef28a66643?w=800&h=400&fit=crop",
                },
                {
                  title: "Detection Logic Development",
                  content:
                    "<p>The core of a use case is its logic. This is where you define the 'if-then' conditions that separate malicious activity from normal system behavior.</p><h3>Key Elements of Logic:</h3><ul><li><strong>Filters:</strong> What events are relevant? (e.g., `EventCode=4688` and `ProcessName='powershell.exe'`)</li><li><strong>Enrichment:</strong> What additional context is needed? (e.g., is the user a privileged account?)</li><li><strong>Thresholds & Aggregation:</strong> Is it a single event or a pattern? (e.g., `count > 5 in 10 minutes`)</li><li><strong>Lookups & Whitelists:</strong> Are there known-good exceptions to exclude? (e.g., exclude processes run by legitimate admin tools).</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Be Specific, but Not Too Specific</strong></div><p>The logic must be specific enough to reduce false positives, but general enough to avoid being easily bypassed by an attacker. For example, instead of looking for an exact file name, look for the *behavior* of downloading and executing a file.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1516116216624-53e6973bea99?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Use Case Idea: PowerShell Download Cradle",
                language: "markdown",
                code: "# ATT&CK Technique: T1059.001 - PowerShell\n# Hypothesis: Attacker uses PowerShell to download and execute a script from the web.\n# Data Source: Windows Process Creation Logs (EventCode 4688) with Command Line auditing.\n# Logic: Look for powershell.exe processes with command-line arguments containing 'System.Net.WebClient', 'DownloadString', 'DownloadFile', or 'IEX'.",
              },
              {
                title: "Splunk Implementation for PowerShell Download Cradle",
                language: "sql",
                code: 'index=os sourcetype="WinEventLog:Security" EventCode=4688 ProcessName="powershell.exe"\n| search (CommandLine="*IEX*" OR CommandLine="*DownloadString*" OR CommandLine="*DownloadFile*")\n| table _time, host, user, ProcessName, CommandLine',
              },
              {
                title: "KQL Implementation for PowerShell Download Cradle",
                language: "sql",
                code: "SecurityEvent \n| where EventID == 4688 and Process == 'powershell.exe' \n| where CommandLine has_any ('IEX', 'DownloadString', 'DownloadFile') \n| project TimeGenerated, Computer, Account, Process, CommandLine",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the primary purpose of the MITRE ATT&CK framework in SIEM use case development?",
                  options: [
                    "To assign ticket priorities",
                    "To provide a knowledge base of adversary tactics and techniques",
                    "To define data retention policies",
                    "To manage SIEM user accounts",
                  ],
                  correct: 1,
                  explanation:
                    "MITRE ATT&CK is a curated knowledge base used to guide the development of threat-informed detection rules.",
                },
                {
                  id: 2,
                  question:
                    "What is the first step in the use case design lifecycle?",
                  options: [
                    "Writing the query",
                    "Testing and tuning",
                    "Identifying the threat to be detected",
                    "Deploying the rule to production",
                  ],
                  correct: 2,
                  explanation:
                    "The lifecycle begins with identifying a specific threat or technique to build a detection rule for.",
                },
                {
                  id: 3,
                  question:
                    "Excluding traffic from a known vulnerability scanner in a detection rule is an example of what?",
                  options: [
                    "Creating a filter",
                    "Creating an exception or whitelist",
                    "Aggregation",
                    "Correlation",
                  ],
                  correct: 1,
                  explanation:
                    "Whitelisting or creating exceptions for known benign activity is a key part of rule tuning to reduce false positives.",
                },
                {
                  id: 4,
                  question:
                    "In the ATT&CK Framework, 'Tactics' represent the ____ and 'Techniques' represent the ____.",
                  options: [
                    "'how' / 'why'",
                    "'why' / 'how'",
                    "'who' / 'what'",
                    "'what' / 'when'",
                  ],
                  correct: 1,
                  explanation:
                    "Tactics are the adversary's technical goals (the 'why'), while Techniques are the specific methods used to achieve those goals (the 'how').",
                },
                {
                  id: 5,
                  question:
                    "What is the final step before a use case is considered complete and operational?",
                  options: [
                    "Logic development",
                    "Deployment and documentation",
                    "Threat identification",
                    "Data source identification",
                  ],
                  correct: 1,
                  explanation:
                    "After successful testing, the rule must be deployed into the production environment and properly documented for other analysts to use.",
                },
              ],
            },
          },
          {
            id: "lesson-6-advanced-correlation",
            title: "Lesson 6: Advanced Correlation Techniques",
            duration: "120 min",
            objectives: [
              "Explore the use of statistical analysis for anomaly detection",
              "Understand core concepts of behavioral analytics",
              "Learn how Machine Learning (ML) is applied within modern SIEMs",
              "Design and implement complex correlation rules that track state over time",
            ],
            content: {
              overview:
                "Beyond simple 'if-then' rules, advanced SIEMs leverage more sophisticated techniques to find the needle in the haystack. This lesson explores how statistical analysis, behavioral modeling, and machine learning are used to detect subtle and previously unknown threats.",
              sections: [
                {
                  title: "Statistical Analysis for Anomaly Detection",
                  content:
                    "<p>Statistical analysis moves from looking for known-bad patterns to identifying deviations from the norm. It's a powerful way to spot outliers that could indicate a security threat.</p><h3>Common Techniques:</h3><ul><li><strong>Baselining:</strong> The SIEM observes 'normal' behavior over a period (e.g., 30 days) to establish a baseline. For example, learning the average amount of data a user egresses daily.</li><li><strong>Standard Deviation:</strong> Alerts are triggered when activity exceeds a certain standard deviation from the baseline. <em>Example: A user egresses 3 standard deviations more data than their daily average.</em></li><li><strong>Frequency Analysis:</strong> Identifying rare events. <em>Example: A process that has never run on a host before is suddenly executed.</em></li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Dynamic Thresholds</strong></div><p>Instead of a static threshold like 'alert if >100MB egressed', statistical analysis creates a dynamic threshold that is unique to each user or entity.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1534073824107-1605b369c435?w=800&h=400&fit=crop",
                },
                {
                  title: "Behavioral Analytics Concepts",
                  content:
                    "<p>Behavioral analytics focuses on tracking sequences of actions. It understands that while a single event might be benign, a specific chain of events is highly indicative of an attack.</p><h3>Key Ideas:</h3><ul><li><strong>Stateful Tracking:</strong> The SIEM remembers previous events. For instance, it tracks that a user first had 5 failed logins, then a successful one, then accessed a critical server.</li><li><strong>TTP Chains:</strong> Connecting individual alerts that map to different ATT&CK Tactics. An attacker's path through the kill chain can be visualized. <em>Example: A phishing email alert, followed by a PowerShell download alert, followed by a lateral movement alert for the same user.</em></li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Focus on Behavior, Not Signatures</strong></div><p>This approach is effective against new or unknown malware because it doesn't rely on known file hashes or IP addresses. It looks for the malicious *behavior* itself.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1559819225-3b36e159b434?w=800&h=400&fit=crop",
                },
                {
                  title: "Machine Learning in SIEM",
                  content:
                    "<p>Machine Learning (ML) automates and enhances statistical and behavioral analysis at scale. Modern SIEMs offer built-in ML capabilities that can surface complex threats without an analyst writing a complex rule.</p><h3>Types of ML in SIEM:</h3><ul><li><strong>Supervised Learning:</strong> The ML model is trained on labeled data (known good and known bad examples) to classify new events. Used for things like DGA detection.</li><li><strong>Unsupervised Learning:</strong> The ML model is given unlabeled data and finds its own patterns and clusters. Excellent for anomaly detection, such as finding a host that is 'behaving' differently from its peers (peer group analysis).</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Not Magic</strong></div><p>ML is a powerful tool, but it's not a replacement for an analyst. The models need to be trained, monitored, and their outputs must be investigated. It's a 'glass box', not a 'black box'.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1620712943543-959bab121695?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Splunk SPL for First Time VPN Login from a New Country",
                language: "sql",
                code: "index=vpn event=login \n| lookup previously_seen_countries user OUTPUT country as seen_country\n| where isnull(seen_country)\n| stats earliest(_time) as first_time by user, country\n| outputlookup previously_seen_countries",
              },
              {
                title: "KQL for DNS Query Volume Anomaly",
                language: "sql",
                code: "DnsEvents\n| summarize dcount(QueryName) by bin(TimeGenerated, 1h), ClientIP\n| series_decompose_anomalies dcount_QueryName\n| where AnomalyScore > 1.5",
              },
              {
                title: "Pseudo-code for Impossible Travel",
                language: "sql",
                code: "ON successful_login for user:\n  GET last_login_location, last_login_time\n  current_location = this_login_location\n  current_time = this_login_time\n\n  distance = geo_distance(current_location, last_login_location)\n  time_diff = current_time - last_login_time\n  speed = distance / time_diff\n\nIF speed > 700 mph THEN ALERT 'Impossible Travel'",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "Establishing a 'normal' level of activity for a user to detect future deviations is called:",
                  options: [
                    "Correlation",
                    "Normalization",
                    "Baselining",
                    "Indexing",
                  ],
                  correct: 2,
                  explanation:
                    "Baselining is the process of observing behavior over time to establish a normal pattern from which anomalies can be detected.",
                },
                {
                  id: 2,
                  question:
                    "An alert that triggers if a user logs in from New York and then 10 minutes later from London is known as what type of detection?",
                  options: [
                    "Brute Force Detection",
                    "Data Exfiltration",
                    "Impossible Travel",
                    "Malware Outbreak",
                  ],
                  correct: 2,
                  explanation:
                    "Impossible Travel analysis uses time and location data to detect logins that are not geographically feasible.",
                },
                {
                  id: 3,
                  question:
                    "Which type of Machine Learning is best suited for finding outliers and anomalies without pre-labeled data?",
                  options: [
                    "Supervised Learning",
                    "Unsupervised Learning",
                    "Reinforcement Learning",
                    "Static Learning",
                  ],
                  correct: 1,
                  explanation:
                    "Unsupervised learning excels at discovering hidden patterns or structures in data that has not been labeled, making it ideal for anomaly detection.",
                },
                {
                  id: 4,
                  question:
                    "Tracking a series of events over time, such as 5 failed logins followed by a success, is an example of:",
                  options: [
                    "Stateless analysis",
                    "Statistical analysis",
                    "Stateful tracking",
                    "Standard deviation",
                  ],
                  correct: 2,
                  explanation:
                    "Stateful tracking means the correlation engine maintains memory ('state') of past events to identify suspicious sequences.",
                },
                {
                  id: 5,
                  question:
                    "What is the primary benefit of using behavioral analytics over signature-based detection?",
                  options: [
                    "It is faster",
                    "It uses less data",
                    "It can detect new or unknown threats",
                    "It produces zero false positives",
                  ],
                  correct: 2,
                  explanation:
                    "Behavioral analytics focuses on detecting malicious actions, not just known indicators, making it effective against zero-day and polymorphic threats.",
                },
              ],
            },
          },
          {
            id: "lesson-7-incident-response-integration",
            title: "Lesson 7: Incident Response Integration",
            duration: "120 min",
            objectives: [
              "Understand how SIEM integrates with SOAR platforms",
              "Learn the basics of playbook development for automated response",
              "Explore case management workflows within a SIEM or integrated platform",
              "Design a basic automated response workflow",
            ],
            content: {
              overview:
                "Detecting a threat is only half the battle. This lesson covers the crucial next step: response. We will explore how modern SIEMs integrate with Security Orchestration, Automation, and Response (SOAR) platforms to automate and streamline incident response, reducing manual effort and response times.",
              sections: [
                {
                  title: "SIEM to SOAR Integration",
                  content:
                    "<p>SOAR platforms are the action-oriented counterpart to the SIEM's detection capabilities. When a SIEM generates a high-fidelity alert, it can trigger a SOAR platform to begin an automated response.</p><h3>How They Work Together:</h3><ul><li><strong>SIEM (Detector):</strong> The SIEM correlates events, identifies a credible threat (e.g., impossible travel detected), and generates an alert.</li><li><strong>Alert Forwarding:</strong> The SIEM forwards the alert, along with all relevant context (user, IP, hostname), to the SOAR platform via an API.</li><li><strong>SOAR (Responder):</strong> The SOAR platform ingests the alert and kicks off a pre-defined automated workflow called a 'playbook'.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Single Pane of Glass</strong></div><p>Many modern SIEMs, like Microsoft Sentinel and Splunk SOAR, have integrated SOAR capabilities, blurring the lines between the two tools and providing a more unified analyst experience.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1599691888286-93e433f064b8?w=800&h=400&fit=crop",
                },
                {
                  title: "Playbook Development",
                  content:
                    "<p>A playbook is a series of automated actions that codify an organization's incident response process. They are typically built using a visual editor, linking different actions and conditional logic together.</p><h3>Example Playbook: Malware Alert</h3><ol><li><strong>Trigger:</strong> SIEM alert for 'High-Confidence Malware Detected'.</li><li><strong>Enrichment:</strong> Automatically query a threat intelligence platform for the malware hash and the source IP.</li><li><strong>Containment:</strong> If the hash is known-malicious, make an API call to the EDR solution to isolate the host and to the firewall to block the source IP.</li><li><strong>Investigation:</strong> Create a ticket in the IT service management system with all collected information.</li><li><strong>Notification:</strong> Post an alert summary to the security team's chat channel.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Start Small</strong></div><p>Begin by automating simple, repetitive tasks like data enrichment. As confidence grows, move towards more active containment actions. Every action should be well-defined and reliable.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=800&h=400&fit=crop",
                },
                {
                  title: "Case Management Workflows",
                  content:
                    "<p>Case Management provides a structured workspace for analysts to investigate and document incidents. It turns a flood of individual alerts into a manageable queue of prioritized cases.</p><h3>Key Features:</h3><ul><li><strong>Incident Creation:</strong> Automatically group related alerts from the SIEM into a single incident or case.</li><li><strong>Ownership & SLA:</strong> Assign cases to specific analysts and track Service Level Agreements (SLAs) for response time.</li><li><strong>Evidence Locker:</strong> Store all artifacts, notes, and evidence related to an investigation in one place.</li><li><strong>Timelines:</strong> Automatically generate a timeline of all events, alerts, and actions related to the case.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Documentation is Crucial</strong></div><p>Thorough and consistent documentation within the case management system is vital for post-incident reviews, knowledge sharing, and legal or compliance purposes.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1556742044-15b56a42a033?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Sentinel Playbook (Logic App) Pseudo-Code",
                language: "json",
                code: '{\n  "trigger": "When a Microsoft Sentinel Alert is created",\n  "actions": [\n    {\n      "name": "Get_IP_Reputation",\n      "type": "API_Call",\n      "parameters": { "ip": "triggerBody().entities.ip[0]" }\n    },\n    {\n      "name": "Conditional_Block",\n      "type": "If",\n      "condition": "outputs(\'Get_IP_Reputation\').is_malicious == true",\n      "true_actions": [\n        { "name": "Create_Firewall_Rule", "..." },\n        { "name": "Post_Message_in_Teams", "..." }\n      ]\n    }\n  ]\n}',
              },
              {
                title: "Basic Python Script to Isolate a Host via EDR API",
                language: "python",
                code: "import requests\nimport os\n\nEDR_API_KEY = os.getenv('EDR_API_KEY')\nEDR_URL = 'https://api.edr.vendor.com/v1/contain_host'\n\ndef isolate_host(hostname):\n    headers = {'Authorization': f'Bearer {EDR_API_KEY}'}\n    payload = {'hostname': hostname}\n    response = requests.post(EDR_URL, headers=headers, json=payload)\n    return response.status_code",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question: "What does SOAR stand for?",
                  options: [
                    "Security Orchestration, Automation, and Response",
                    "Security Observation, Analysis, and Reporting",
                    "System Orchestration and Automated Remediation",
                    "System Oversight, Auditing, and Response",
                  ],
                  correct: 0,
                  explanation:
                    "SOAR stands for Security Orchestration, Automation, and Response, focusing on action and workflow automation.",
                },
                {
                  id: 2,
                  question:
                    "In a SOAR platform, what is the term for an automated series of actions that responds to an alert?",
                  options: [
                    "Workflow",
                    "Use Case",
                    "Correlation Rule",
                    "Playbook",
                  ],
                  correct: 3,
                  explanation:
                    "A playbook is a pre-defined, automated workflow that codifies the steps of an incident response process.",
                },
                {
                  id: 3,
                  question:
                    "What is the primary benefit of integrating a SIEM with a SOAR?",
                  options: [
                    "To increase log storage capacity",
                    "To reduce the time between detection and response",
                    "To improve log normalization",
                    "To replace the need for security analysts",
                  ],
                  correct: 1,
                  explanation:
                    "Automation through SOAR dramatically reduces the Mean Time to Respond (MTTR) by eliminating manual steps.",
                },
                {
                  id: 4,
                  question:
                    "The first step in a typical enrichment playbook is to:",
                  options: [
                    "Block the IP address",
                    "Isolate the host",
                    "Gather more context about the indicators in the alert",
                    "Close the ticket",
                  ],
                  correct: 2,
                  explanation:
                    "Enrichment playbooks start by automatically gathering additional data (e.g., IP reputation, file hash lookups) to help an analyst make a faster decision.",
                },
                {
                  id: 5,
                  question:
                    "A system for grouping related alerts, assigning them to analysts, and documenting the investigation is called a:",
                  options: [
                    "Log Aggregator",
                    "Case Management System",
                    "Parser",
                    "Hot Storage Tier",
                  ],
                  correct: 1,
                  explanation:
                    "A Case Management System provides the workflow and documentation hub for incident response activities.",
                },
              ],
            },
          },
          {
            id: "lesson-8-threat-intel-integration",
            title: "Lesson 8: Threat Intelligence Integration",
            duration: "120 min",
            objectives: [
              "Understand different methods for integrating Indicators of Compromise (IOCs)",
              "Learn about threat feed management and prioritization",
              "Explore how threat intelligence provides crucial context enrichment",
              "Gain insight into integrating platforms like MISP or ThreatConnect",
            ],
            content: {
              overview:
                "Threat intelligence provides critical external context to your internal security data. This lesson covers how to effectively integrate threat intelligence into your SIEM to enhance detection capabilities, prioritize alerts, and accelerate investigations by identifying known-malicious activity.",
              sections: [
                {
                  title: "IOC Integration Methods",
                  content:
                    "<p>Indicators of Compromise (IOCs) are pieces of data that identify malicious activity, like file hashes, IP addresses, or domain names. Integrating them into your SIEM allows for rapid detection of known threats.</p><h3>Common Integration Patterns:</h3><ul><li><strong>IOC Matching (Lookups):</strong> The SIEM compares fields from incoming logs (e.g., `destination.ip`) against a large list of known-bad IOCs. This is a common and effective use case.</li><li><strong>Threat Feed Dashboards:</strong> Visualizing threat intelligence data to identify trends, such as the most reported malicious IPs or malware families.</li><li><strong>Retrospective Hunting:</strong> Searching past logs for newly acquired IOCs to find previously undetected compromises.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Types of Indicators</strong></div><p>IOCs range from simple (IPs, hashes, domains) to complex (TTPs - Tactics, Techniques, and Procedures). Mature programs focus more on detecting TTPs, which are harder for attackers to change.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1599373922312-5b9340d8a5a5?w=800&h=400&fit=crop",
                },
                {
                  title: "Threat Feed Management",
                  content:
                    "<p>Not all threat intelligence feeds are created equal. Effective management is key to avoiding an influx of low-quality data and false positives.</p><h3>Considerations for Feeds:</h3><ul><li><strong>Source:</strong> Is the feed from a reputable provider? (e.g., open source like Abuse.ch, or commercial like CrowdStrike).</li><li><strong>Relevance:</strong> Is the intelligence relevant to your industry, geography, and technology stack?</li><li><strong>Timeliness:</strong> How quickly are indicators published after being discovered? Old IOCs have little value.</li><li><strong>Confidence Score:</strong> Does the feed provide a confidence score to indicate the likelihood an IOC is truly malicious? This can be used to tune alert severity.</li><li><strong>Data Format:</strong> Can the SIEM easily ingest the feed? (Common formats are STIX/TAXII).</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Threat Intelligence Platform (TIP)</strong></div><p>Organizations often use a TIP like MISP or ThreatConnect to aggregate, deduplicate, and manage multiple feeds before sending a curated, high-confidence list of IOCs to the SIEM.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1563905788977-62b714f520b2?w=800&h=400&fit=crop",
                },
                {
                  title: "Contextual Enrichment Techniques",
                  content:
                    "<p>Beyond simple matching, threat intelligence provides valuable context that helps analysts understand the 'who, what, and why' behind an alert.</p><h3>Examples of Enrichment:</h3><ul><li><strong>IP Address Context:</strong> Instead of just 'malicious IP', the enrichment could show 'C2 server for Cobalt Strike, associated with FIN7 actor, located in Russia'.</li><li><strong>File Hash Context:</strong> Enrichment can provide the malware family name (e.g., 'Emotet'), common behaviors, and links to detailed analysis reports.</li><li><strong>Domain Context:</strong> Identifying newly registered domains (NRDs) or domains associated with known phishing campaigns.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Automate Enrichment</strong></div><p>This enrichment should be automated. When an alert is created, the SIEM or SOAR should automatically query threat intelligence sources and append the findings directly to the alert or case, saving the analyst valuable time.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title:
                  "Splunk SPL to Join Firewall Logs with a Threat Intel IP List",
                language: "sql",
                code: 'index=firewall\n| `comment("The inputlookup command searches a local CSV or KV store of IOCs")`\n| lookup threat_intel_ips.csv source_ip AS src_ip OUTPUT threat_actor, confidence\n| search threat_actor=* \n| table _time, src_ip, dest_ip, threat_actor, confidence',
              },
              {
                title:
                  "KQL to Join DNS Logs with a Threat Intel Feed (ThreatIntelligenceIndicator table)",
                language: "sql",
                code: "DnsEvents\n| join kind=inner (ThreatIntelligenceIndicator\n  | where Active == true and isnotempty(DomainName)\n) on $left.QueryName == $right.DomainName\n| project TimeGenerated, ClientIP, QueryName, Description, ConfidenceScore",
              },
              {
                title: "MISP API Call to Check a Hash (Python)",
                language: "python",
                code: "from pymisp import PyMISP\n\nMISP_URL = 'https://misp.example.com/'\nMISP_KEY = 'YOUR_API_KEY'\n\ndef check_hash(file_hash):\n    misp = PyMISP(MISP_URL, MISP_KEY, ssl=True)\n    result = misp.search(controller='attributes', value=file_hash)\n    return result",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "A file hash, a malicious IP address, and a suspicious domain name are all examples of what?",
                  options: [
                    "Tactics, Techniques, and Procedures (TTPs)",
                    "Indicators of Compromise (IOCs)",
                    "Service Level Agreements (SLAs)",
                    "Correlation Rules",
                  ],
                  correct: 1,
                  explanation:
                    "IOCs are artifacts observed on a network or in an operating system that indicate a computer intrusion.",
                },
                {
                  id: 2,
                  question:
                    "What is the primary function of a Threat Intelligence Platform (TIP)?",
                  options: [
                    "To collect and store all company logs",
                    "To aggregate, deduplicate, and manage multiple threat intelligence feeds",
                    "To act as a firewall for the network",
                    "To create backups of the SIEM",
                  ],
                  correct: 1,
                  explanation:
                    "A TIP serves as a central hub for managing threat intelligence, enabling teams to curate feeds before they are sent to tools like the SIEM.",
                },
                {
                  id: 3,
                  question:
                    "When your SIEM matches an IP address from your firewall logs against a list of known command-and-control servers, it is performing:",
                  options: [
                    "Data Normalization",
                    "IOC Matching",
                    "Log Parsing",
                    "Data Retention",
                  ],
                  correct: 1,
                  explanation:
                    "This is a classic example of IOC matching, where live data is compared against a static or dynamic list of known-bad indicators.",
                },
                {
                  id: 4,
                  question:
                    "What is the most significant disadvantage of relying on old or outdated threat intelligence?",
                  options: [
                    "It uses too much storage",
                    "It is no longer relevant as attackers have moved to new infrastructure",
                    "It is too expensive",
                    "It can crash the SIEM",
                  ],
                  correct: 1,
                  explanation:
                    "Threat intelligence has a short shelf life; IPs, domains, and hashes are changed constantly by attackers, making old intelligence useless.",
                },
                {
                  id: 5,
                  question: "STIX/TAXII are standards related to what?",
                  options: [
                    "Log parsing formats",
                    "Automated sharing of threat intelligence",
                    "SIEM query languages",
                    "Compliance reporting",
                  ],
                  correct: 1,
                  explanation:
                    "STIX is a language for expressing threat intelligence, and TAXII is a protocol for securely sharing it, enabling interoperability between tools and organizations.",
                },
              ],
            },
          },
          {
            id: "lesson-9-advanced-querying",
            title: "Lesson 9: Advanced Query Techniques",
            duration: "150 min",
            objectives: [
              "Master complex SPL operations including transactions and streamstats",
              "Learn advanced KQL functions like joins, unions, and window functions",
              "Understand key principles for query performance optimization",
              "Write advanced, multi-stage queries to answer complex security questions",
            ],
            content: {
              overview:
                "Move beyond simple searches and learn the advanced querying techniques that unlock the full power of your SIEM. This lesson delves into complex commands and functions that allow you to group events, enrich data on the fly, and perform sophisticated statistical analysis directly within the search bar.",
              sections: [
                {
                  title: "Complex SPL Operations",
                  content:
                    "<p>SPL offers powerful commands that go far beyond simple filtering and counting. These commands allow you to group related events and analyze data streams in real-time.</p><h3>Advanced Commands:</h3><ul><li><strong>`transaction`</strong>: Groups events that are related, even if they aren't sequential, based on field values and constraints like time spans or start/end conditions. Useful for tracking a user session across multiple log sources.</li><li><strong>`streamstats`</strong>: Calculates statistics on-the-fly for each event as it is seen in the data stream. Unlike `stats` which works on the whole result set, `streamstats` provides a running total. Useful for tracking cumulative data transfer.</li><li><strong>`eventstats`</strong>: Similar to `stats` but it adds the aggregated statistics to every event, rather than producing a summary table. This allows you to compare an event's value to the average or max for that group.</li><li><strong>`appendpipe`</strong>: Allows you to run a sub-search and append its results to the current result set. Useful for adding a total or average row to a report.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Transaction vs. Stats</strong></div><p>Use `stats` when you need to aggregate data based on a specific field. Use `transaction` when you need to group disparate events that together form a single, logical 'transaction'.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1573495627361-ab2b8664a78c?w=800&h=400&fit=crop",
                },
                {
                  title: "Advanced KQL Functions",
                  content:
                    "<p>KQL is a rich language with extensive capabilities for combining, manipulating, and analyzing data from different tables, much like a traditional database language.</p><h3>Advanced Operators:</h3><ul><li><strong>`join`</strong>: Combines rows of two tables to form a new table by matching the values of specified columns. Kinds of joins include `inner`, `leftouter`, `rightouter`, etc.</li><li><strong>`union`</strong>: Returns all the rows from two or more tables. Useful for querying similar data from different sources (e.g., firewall logs from two different vendors).</li><li><strong>`lookup`</strong>: A performant way to enrich data by 'looking up' values from one table and adding them to another.</li><li><strong>Window Functions</strong>: Functions like `row_window()`, `prev()`, and `next()` allow you to perform calculations across a set of rows related to the current row, enabling analysis of time-series data.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Let and Materialize</strong></div><p>Use `let` statements to define variables or complex expressions for reuse within a query. Use `materialize()` to cache the results of a subquery if it's used multiple times, improving performance.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1521790797524-114217385973?w=800&h=400&fit=crop",
                },
                {
                  title: "Performance Optimization",
                  content:
                    "<p>Writing a query that works is one thing; writing a query that runs efficiently on terabytes of data is another. Optimization is a critical skill for any SIEM analyst.</p><h3>Key Principles:</h3><ol><li><strong>Filter Early and Often:</strong> The most important rule. Reduce the dataset as much as possible at the beginning of your query by specifying indexes, time ranges, and filtering terms.</li><li><strong>Use Fields, Not Full-Text Search:</strong> Searching `status=404` is much faster than searching `\"404\"` because it targets an indexed field.</li><li><strong>Avoid Wildcards at the Beginning:</strong> A search like `*error` is much slower than `error*` because the latter can use the index more effectively.</li><li><strong>Use Performant Commands:</strong> Some commands are more intensive than others. For example, `stats` is generally faster than `transaction`. `lookup` is often faster than `join`. Understand the cost of your commands.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>The Search Job Inspector</strong></div><p>Tools like the Splunk Search Job Inspector provide detailed performance diagnostics, showing you how much time each part of your query took. Use it to identify and fix bottlenecks.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "SPL Transaction: Grouping User Activity into a Session",
                language: "sql",
                code: 'index=auth sourcetype=sshd user="*"\n| transaction user maxspan=30m startswith="session opened" endswith="session closed"\n| table _time, duration, user, src_ip, eventcount',
              },
              {
                title:
                  "SPL Eventstats: Calculating Percent of Total Traffic per IP",
                language: "sql",
                code: "index=firewall\n| stats sum(bytes) as ip_bytes by src_ip\n| eventstats sum(ip_bytes) as total_bytes\n| eval percent = round((ip_bytes / total_bytes) * 100, 2)\n| table src_ip, ip_bytes, total_bytes, percent",
              },
              {
                title:
                  "KQL Join: Correlating Sign-in Logs with Employee Department Info",
                language: "sql",
                code: "SigninLogs\n| where ResultType == 0\n| join kind=leftouter (\n    OfficeActivity\n    | distinct UserPrincipalName, Department\n) on UserPrincipalName\n| summarize count() by Department",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "Which SPL command is best for grouping related events into a single session, even if they are not consecutive?",
                  options: ["stats", "top", "transaction", "chart"],
                  correct: 2,
                  explanation:
                    "`transaction` is specifically designed to group events into a logical 'transaction' based on common fields and time constraints.",
                },
                {
                  id: 2,
                  question:
                    "What is the single most important rule for query performance optimization?",
                  options: [
                    "Use as many wildcards as possible",
                    "Filter the data as early as possible",
                    "Always use the `transaction` command",
                    "Avoid specifying a time range",
                  ],
                  correct: 1,
                  explanation:
                    "Reducing the amount of data the later parts of the query have to process is the key to making searches fast and efficient.",
                },
                {
                  id: 3,
                  question:
                    "Which KQL operator is used to combine tables by matching values in common columns?",
                  options: ["union", "lookup", "join", "extend"],
                  correct: 2,
                  explanation:
                    "The `join` operator in KQL is used to combine rows from two tables based on a join key, similar to SQL.",
                },
                {
                  id: 4,
                  question:
                    "You want to add the total event count to every single raw event in your Splunk search results. Which command should you use?",
                  options: ["stats", "eventstats", "streamstats", "table"],
                  correct: 1,
                  explanation:
                    "`eventstats` calculates a summary statistic (like total count) but adds it as a new field to every event, rather than creating a summary table.",
                },
                {
                  id: 5,
                  question:
                    'A search for `"Failed password for *"` is more performant than a search for `"* for root"`. Why?',
                  options: [
                    "The second search is shorter",
                    "The first search uses fewer wildcards",
                    "The first search does not start with a wildcard",
                    "The second search uses a common word",
                  ],
                  correct: 2,
                  explanation:
                    "Leading wildcards prevent the search engine from using its index effectively, forcing it to scan much more data and slowing down the search.",
                },
              ],
            },
          },
          {
            id: "lesson-10-data-models",
            title: "Lesson 10: Data Models and CIM",
            duration: "120 min",
            objectives: [
              "Understand the purpose of a Common Information Model (CIM)",
              "Learn how data models accelerate queries and simplify analysis",
              "Grasp the basics of field extractions and data transformation",
              "Practice mapping raw data to a CIM-compliant data model",
            ],
            content: {
              overview:
                "Data models are the ultimate form of normalization. This lesson explains how a Common Information Model (CIM) provides a universal language for your data, allowing you to write vendor-agnostic correlation rules and massively accelerate common queries. We will cover the theory and practical steps of making your data 'CIM-compliant'.",
              sections: [
                {
                  title: "Common Information Model (CIM)",
                  content:
                    "<p>A Common Information Model (CIM) is a standardized schema for different types of security data. It's an abstraction layer that allows you to analyze data based on *what it is* (e.g., authentication data) rather than *where it came from* (e.g., Windows Event Logs, Palo Alto Firewall logs).</p><h3>Core Benefits:</h3><ul><li><strong>Vendor Agnostic Queries:</strong> You can write one rule to detect a brute force attack (e.g., `datamodel=Authentication failed | stats count by user`) and it will work across logs from Windows, Linux, VPNs, etc., as long as they are all mapped to the model.</li><li><strong>Simplified Searching:</strong> Analysts don't need to remember hundreds of different field names. They only need to know the standardized CIM field names (e.g., `src`, `dest`, `user`, `action`).</li><li><strong>Interoperability:</strong> Pre-built apps and content from security vendors (like Splunk's Enterprise Security) are built on top of the CIM. Making your data CIM-compliant allows you to use this content out-of-the-box.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Data Models</strong></div><p>A CIM typically consists of multiple 'data models', each representing a specific type of event data, such as `Authentication`, `Network_Traffic`, `Endpoint_Changes`, and `Malware`.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1518432031352-d6fc5c10da5a?w=800&h=400&fit=crop",
                },
                {
                  title: "Data Model Acceleration",
                  content:
                    "<p>Data models can be 'accelerated'. This is a process where the SIEM pre-calculates and summarizes the data described by the model and stores it in a high-performance analytics store.</p><h3>How Acceleration Works:</h3><ol><li>You define a data model (e.g., Network Traffic, containing all firewall and proxy logs).</li><li>You enable acceleration for this data model over a specific time range (e.g., the last 30 days).</li><li>The SIEM runs background searches to build a summary of this data.</li><li>When you run a search against the *accelerated* data model, the SIEM queries the small, pre-calculated summary instead of the massive raw data index.</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Massive Speed Increase</strong></div><p>Queries against accelerated data models can be orders of magnitude faster than searching raw logs. This is essential for powering real-time dashboards and high-frequency correlation searches.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1542491147-1901b8a5b29c?w=800&h=400&fit=crop",
                },
                {
                  title: "Field Extractions and Transforms",
                  content:
                    "<p>The process of making data CIM-compliant involves mapping your raw, vendor-specific field names to the standard CIM field names. This is done through field extractions and transformations.</p><h3>Key Steps (The 'Onboarding' Process):</h3><ul><li><strong>Parsing:</strong> First, the raw log must be parsed to extract fields (as we learned in Lesson 2).</li><li><strong>Field Aliasing:</strong> The simplest method. You create an alias that maps your existing field name to a CIM field name (e.g., `src_ip` becomes an alias for `src`).</li><li><strong>Eval Expressions:</strong> For more complex transformations, you can use expressions to reformat or calculate field values. For example, `eval action = if(status_code >= 400, \\\"failure\\\", \\\"success\\\")` maps a status code to the required `action` field in the Authentication model.</li><li><strong>Tagging:</strong> You apply tags to your data (e.g., `authentication`, `network`, `traffic`) to tell the data model which datasets it should include.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Get It Right at Ingest</strong></div><p>This mapping work should be done at ingest time, before the data is indexed. This ensures that the data is ready for analysis and that all subsequent searches and correlations can rely on the standardized model.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1571171637578-41bc2dd41cd2?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title:
                  "Splunk SPL Query using the `tstats` command for Accelerated Data",
                language: "sql",
                code: '# This search runs against the accelerated summary, not raw data, making it very fast.\n| tstats summariesonly=true count from datamodel=Network_Traffic where nodename=All_Traffic\nby _time, src\n| `drop_dm_object_name("All_Traffic")`',
              },
              {
                title: "Splunk CIM Field Alias Configuration (`props.conf`)",
                language: "ini",
                code: '[my_firewall_sourcetype]\nFIELDALIAS-src = source_address AS src\nFIELDALIAS-dest = destination_address AS dest\nFIELDALIAS-dpt = dest_port AS dpt\nEVAL-action = if(disposition=="allow", "allowed", "blocked")',
              },
              {
                title: "Splunk CIM Tagging Configuration (`tags.conf`)",
                language: "ini",
                code: "[sourcetype=my_firewall_sourcetype]\nnetwork = enabled\ntraffic = enabled",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the primary benefit of using a Common Information Model (CIM)?",
                  options: [
                    "It increases the amount of logs you can store",
                    "It provides a standardized schema for vendor-agnostic queries",
                    "It automatically blocks malicious IP addresses",
                    "It encrypts all log data",
                  ],
                  correct: 1,
                  explanation:
                    "The CIM provides an abstraction layer so you can write queries and rules based on the type of data (e.g., authentication) regardless of the source vendor.",
                },
                {
                  id: 2,
                  question:
                    "The process of pre-calculating and summarizing data from a data model to speed up searches is called:",
                  options: [
                    "Normalization",
                    "Retention",
                    "Acceleration",
                    "Ingestion",
                  ],
                  correct: 2,
                  explanation:
                    "Data model acceleration creates a separate, highly performant summary of the data, which makes queries against it significantly faster.",
                },
                {
                  id: 3,
                  question:
                    "To tell a data model that your firewall logs should be included in the `Network_Traffic` model, you would use:",
                  options: [
                    "A field alias",
                    "An eval expression",
                    "A tag",
                    "A transaction",
                  ],
                  correct: 2,
                  explanation:
                    "Tags are used to classify your data and tell data models which event types to include.",
                },
                {
                  id: 4,
                  question:
                    "Which Splunk search command is specifically designed to query accelerated data models?",
                  options: ["search", "stats", "table", "tstats"],
                  correct: 3,
                  explanation:
                    "`tstats` (terse stats) is the high-performance command used to search the accelerated data summaries.",
                },
                {
                  id: 5,
                  question:
                    "You have a log with a field `source_ip`, but the CIM `Network_Traffic` model requires a field named `src`. The simplest way to map this is with a:",
                  options: [
                    "Field Alias",
                    "Lookup Table",
                    "Regular Expression",
                    "New Sourcetype",
                  ],
                  correct: 0,
                  explanation:
                    "A field alias is the most direct and efficient way to map an existing extracted field to a CIM-compliant field name.",
                },
              ],
            },
          },
          {
            id: "lesson-11-ueba",
            title: "Lesson 11: User and Entity Behavior Analytics",
            duration: "120 min",
            objectives: [
              "Define User and Entity Behavior Analytics (UEBA) and its core concepts",
              "Understand how UEBA establishes baselines of normal behavior",
              "Learn about risk scoring models and how they prioritize threats",
              "Explore common UEBA use cases like insider threat and compromised accounts",
            ],
            content: {
              overview:
                "This lesson dives into User and Entity Behavior Analytics (UEBA), a specialized category of security tools that focuses on detecting threats by analyzing user and device behavior. UEBA goes beyond individual rules to build a holistic understanding of 'normal' and flags risky deviations.",
              sections: [
                {
                  title: "UEBA Concepts and Implementation",
                  content:
                    "<p>UEBA solutions focus on the activity of users and entities (like hosts, applications, and network devices) to detect malicious activity that might otherwise go unnoticed. They are data science-driven, leveraging statistical analysis and machine learning.</p><h3>Key Differences from Traditional SIEM:</h3><ul><li><strong>Entity-focused:</strong> Instead of focusing on discrete events, UEBA systems pivot all data around entities (e.g., creating a complete timeline for `user: jdoe`).</li><li><strong>Stateful by Nature:</strong> UEBA systems maintain a long-term memory of an entity's behavior to establish detailed baselines.</li><li><strong>Automated Anomaly Detection:</strong> The core function is to automatically detect anomalies without requiring analysts to write specific rules for every scenario.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Inside the SIEM</strong></div><p>UEBA was once a standalone technology, but today its capabilities are often integrated directly into modern SIEM platforms like Splunk, Exabeam, and Microsoft Sentinel.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1554224154-260325c27596?w=800&h=400&fit=crop",
                },
                {
                  title: "Baseline Establishment",
                  content:
                    "<p>The foundation of any UEBA system is its ability to learn what is 'normal' for every user and entity in the environment. This baseline is multi-faceted and continuously updated.</p><h3>What UEBA Learns:</h3><ul><li><strong>Common Activities:</strong> What applications does the user typically run? What servers do they connect to?</li><li><strong>Working Hours:</strong> When does the user normally log in and out?</li><li><strong>Geographic Location:</strong> Where does the user usually work from?</li><li><strong>Peer Group Analysis:</strong> How does this user's behavior compare to others in their department (e.g., 'Finance')? A finance user suddenly using engineering tools is an anomaly.</li><li><strong>Data Access Patterns:</strong> What type and volume of data does this user normally access?</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>The Learning Period</strong></div><p>When a UEBA system is first deployed, it undergoes a 'learning period' (typically 30-90 days) where it quietly observes activity to build these initial baselines before it starts generating alerts.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1534951009808-766178b47a4f?w=800&h=400&fit=crop",
                },
                {
                  title: "Risk Scoring Models",
                  content:
                    "<p>UEBA systems don't just generate a flood of binary 'malicious/benign' alerts. Instead, they assign a risk score to anomalous events. Multiple low-risk events can accumulate over time to elevate an entity's overall risk score.</p><h3>How it Works:</h3><ol><li>A user performs a slightly unusual activity (e.g., logs in at 10 PM). This adds a small number of points (e.g., +10) to their risk score.</li><li>Later, the same user accesses a server they've never touched before (+25 points).</li><li>Then, they begin exfiltrating an unusual amount of data (+50 points).</li><li>When the user's cumulative risk score crosses a predefined threshold (e.g., 75), the system generates a high-priority alert for an analyst to investigate.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Contextual Prioritization</strong></div><p>This model is highly effective at reducing alert fatigue. Instead of 100 minor alerts, the analyst gets one high-priority case that says 'User John Doe has a high risk score because of these 5 anomalous behaviors'.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1559523161-0947758378b8?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "UEBA Use Case: First Time Access to Critical Server",
                language: "markdown",
                code: "# Entity: User, Host\n# Anomaly: User account authenticates to a server classified as 'critical' for the first time.\n# Baseline: The UEBA system has learned which users normally access which servers.\n# Risk Score: Add +25 to the user's risk score.\n# Rationale: Could be legitimate access, but it's a deviation from normal behavior and warrants monitoring.",
              },
              {
                title: "UEBA Use Case: Abnormal Data Egress",
                language: "markdown",
                code: "# Entity: User, Host\n# Anomaly: User egresses 3 standard deviations more data than their 30-day average.\n# Baseline: UEBA maintains a rolling average of daily data transfer for each user.\n# Risk Score: Add +40 to the user's risk score.\n# Rationale: Potential data theft. Correlate with other anomalies.",
              },
              {
                title: "UEBA Use Case: Login after Impossible Travel",
                language: "markdown",
                code: "# Entity: User\n# Anomaly: A successful user login occurs after a recent login from a geographically impossible location.\n# Baseline: The system tracks session and location data for each user.\n# Risk Score: Add +70 to the user's risk score.\n# Rationale: High likelihood of a compromised credential.",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question: "What does UEBA primarily focus on analyzing?",
                  options: [
                    "Firewall rule configurations",
                    "The behavior of users and entities",
                    "Antivirus signature files",
                    "Network packet captures",
                  ],
                  correct: 1,
                  explanation:
                    "UEBA is centered on analyzing the behaviors of users and entities (like hosts) to find deviations from their established baselines.",
                },
                {
                  id: 2,
                  question:
                    "How does a UEBA system determine what is 'normal' activity?",
                  options: [
                    "By using a hard-coded list of rules",
                    "By establishing a baseline over a learning period",
                    "By only monitoring administrator accounts",
                    "By asking users to define their own normal activity",
                  ],
                  correct: 1,
                  explanation:
                    "The core of UEBA is its ability to learn normal patterns of behavior for each entity by observing activity over an initial period (e.g., 30 days).",
                },
                {
                  id: 3,
                  question:
                    "Instead of many individual alerts, UEBA systems typically use what mechanism to prioritize threats?",
                  options: [
                    "Email notifications",
                    "A risk scoring model",
                    "Support tickets",
                    "Dashboard-only views",
                  ],
                  correct: 1,
                  explanation:
                    "UEBA assigns risk points to anomalous events, and only creates a high-priority notification when an entity's cumulative risk score crosses a threshold.",
                },
                {
                  id: 4,
                  question:
                    "Analyzing a user's behavior in comparison to others in their department is known as:",
                  options: [
                    "Peer group analysis",
                    "Standard deviation",
                    "Geographic profiling",
                    "Frequency analysis",
                  ],
                  correct: 0,
                  explanation:
                    "Peer group analysis is a powerful UEBA technique that identifies anomalies where a user's activity is normal for the company but highly abnormal for their specific role.",
                },
                {
                  id: 5,
                  question:
                    "UEBA is particularly effective at detecting which type of threat?",
                  options: [
                    "Network port scans",
                    "Known malware signatures",
                    "Insider threats and compromised accounts",
                    "Website defacement",
                  ],
                  correct: 2,
                  explanation:
                    "Because insider threats and compromised accounts often use legitimate credentials, their malicious activity is best detected as a deviation from normal behavior, which is UEBA's strength.",
                },
              ],
            },
          },
          {
            id: "lesson-12-cloud-siem",
            title: "Lesson 12: Cloud SIEM Operations",
            duration: "150 min",
            objectives: [
              "Understand the challenges and opportunities of cloud security monitoring",
              "Learn to analyze key cloud data sources like AWS CloudTrail and Azure Activity Logs",
              "Explore the capabilities of cloud-native SIEMs like Microsoft Sentinel",
              "Design and implement a basic multi-cloud monitoring strategy",
            ],
            content: {
              overview:
                "As organizations move to the cloud, security operations must follow. This lesson covers the unique aspects of cloud SIEM operations, focusing on the key data sources from major cloud providers (AWS, Azure, GCP) and the capabilities of cloud-native SIEMs designed to handle the scale and ephemerality of cloud environments.",
              sections: [
                {
                  title: "AWS CloudTrail Analysis",
                  content:
                    "<p>AWS CloudTrail is the definitive record of all API activity within your AWS account. It logs every action, whether it's taken through the console, SDK, or command line. It is the single most important data source for AWS security monitoring.</p><h3>Key Events to Monitor:</h3><ul><li><strong>IAM Changes:</strong> Any creation, deletion, or modification of users, roles, policies, and access keys (e.g., `CreateUser`, `AttachUserPolicy`, `DeleteAccessKey`).</li><li><strong>Security Group Changes:</strong> Rules being added or removed from network security groups (e.g., `AuthorizeSecurityGroupIngress`, `RevokeSecurityGroupIngress`). Look for ports like RDP (3389) or SSH (22) being opened to the world (0.0.0.0/0).</li><li><strong>S3 Bucket Policy Changes:</strong> Modifications that could make a private bucket public (e.g., `PutBucketPolicy`).</li><li><strong>CloudTrail Disablement:</strong> Alerts for events that attempt to stop or tamper with CloudTrail logging itself (e.g., `StopLogging`, `DeleteTrail`).</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Other AWS Sources</strong></div><p>While CloudTrail is primary, a complete strategy also includes AWS VPC Flow Logs (for network traffic), AWS GuardDuty (for threat detection), and AWS CloudWatch (for application/OS logs).</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1607513746974-2c6444f49e75?w=800&h=400&fit=crop",
                },
                {
                  title: "Azure Sentinel Implementation",
                  content:
                    "<p>Microsoft Sentinel is a leading example of a cloud-native SIEM. It lives within Azure and is designed from the ground up to integrate tightly with cloud and on-premises data sources. It combines SIEM functionality with built-in SOAR capabilities.</p><h3>Key Features:</h3><ul><li><strong>Data Connectors:</strong> Sentinel has hundreds of built-in connectors that make it easy to ingest data from Microsoft sources (like Azure AD, Office 365, Defender) and third-party sources (like Palo Alto, Check Point).</li><li><strong>Analytics Rules:</strong> This is Sentinel's term for correlation rules. It includes many pre-built templates mapped to the MITRE ATT&CK framework.</li><li><strong>Kusto Query Language (KQL):</strong> Sentinel uses the powerful KQL for all searching, analytics, and threat hunting.</li><li><strong>Azure Logic Apps for SOAR:</strong> Sentinel's automation capabilities are powered by Azure Logic Apps, which provide a visual designer for building automated response playbooks.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>The Data Lake Approach</strong></div><p>Sentinel is built on top of Azure Monitor Log Analytics, which acts as a massive, scalable data lake for all your security data. This allows it to handle the huge volumes of data generated by cloud services.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=800&h=400&fit=crop",
                },
                {
                  title: "GCP Security Command Center",
                  content:
                    "<p>Google Cloud Platform (GCP) provides Security Command Center (SCC) as its centralized security and risk management platform. While it has some SIEM-like features, it's primarily a Cloud Security Posture Management (CSPM) and threat detection tool. It often forwards its findings to a dedicated SIEM like Splunk or Sentinel.</p><h3>Core Components:</h3><ul><li><strong>Cloud Audit Logs:</strong> Similar to CloudTrail, this is the record of all administrative and data access events in GCP. It's the essential log source.</li><li><strong>Security Health Analytics:</strong> Scans your GCP resources for common misconfigurations and vulnerabilities.</li><li><strong>Event Threat Detection:</strong> Uses intelligence and behavioral analysis to detect threats like malware, cryptomining, and credential abuse within your GCP environment.</li><li><strong>Chronicle SIEM:</strong> Google's standalone SIEM platform, which is part of Google Cloud, offers petabyte-scale analysis and is tightly integrated with SCC.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Aggregation is Key</strong></div><p>In a multi-cloud environment, a central SIEM is critical. The goal is to forward the key findings and logs from tools like AWS GuardDuty and GCP SCC into a single platform where they can be correlated with each other and with on-premises data.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title:
                  "KQL Query in Sentinel for Security Group Changes Allowing RDP",
                language: "sql",
                code: 'AzureActivity\n| where OperationNameValue == "MICROSOFT.NETWORK/NETWORKSECURITYGROUPS/SECURITYRULES/WRITE"\n| where Properties_d has "destinationPortRange" and Properties_d has "3389"\n| where Properties_d has "sourceAddressPrefix" and Properties_d has "0.0.0.0/0"\n| project TimeGenerated, Caller, ResourceGroup, ActivityStatusValue',
              },
              {
                title: "Splunk SPL Query for AWS Root Account Usage",
                language: "sql",
                code: 'index=aws sourcetype="aws:cloudtrail"\n| search userIdentity.type="Root"\n| stats count by eventName, sourceIPAddress, awsRegion',
              },
              {
                title: "AWS CLI Command to Check for Public S3 Buckets",
                language: "bash",
                code: "# This command doesn't query the SIEM, but demonstrates a check for a condition you'd want to alert on.\naws s3api list-buckets --query 'Buckets[].Name' --output text | xargs -I {} aws s3api get-bucket-acl --bucket {} --query 'Grants[?Grantee.URI==`http://acs.amazonaws.com/groups/global/AllUsers`]' --output text",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the most important data source for monitoring security-related API activity in AWS?",
                  options: [
                    "VPC Flow Logs",
                    "CloudWatch Metrics",
                    "GuardDuty Findings",
                    "CloudTrail Logs",
                  ],
                  correct: 3,
                  explanation:
                    "AWS CloudTrail provides the authoritative audit trail of every API call made in your AWS account, making it the cornerstone of security analysis.",
                },
                {
                  id: 2,
                  question:
                    "Microsoft Sentinel, a cloud-native SIEM, is built on top of which Azure service for data storage and querying?",
                  options: [
                    "Azure Storage Blobs",
                    "Azure SQL Database",
                    "Azure Log Analytics Workspace",
                    "Azure Active Directory",
                  ],
                  correct: 2,
                  explanation:
                    "An Azure Log Analytics Workspace is the underlying data platform that provides the scalability and query engine (KQL) for Microsoft Sentinel.",
                },
                {
                  id: 3,
                  question:
                    "An alert for an attempt to execute the `StopLogging` command in AWS CloudTrail is an example of detecting what?",
                  options: [
                    "Lateral Movement",
                    "Defense Evasion",
                    "Initial Access",
                    "Data Exfiltration",
                  ],
                  correct: 1,
                  explanation:
                    "Tampering with logging and security tools is a classic Defense Evasion technique (MITRE ATT&CK Tactic TA0005).",
                },
                {
                  id: 4,
                  question:
                    "Which of the following is a primary benefit of a cloud-native SIEM?",
                  options: [
                    "It is always cheaper",
                    "It can only be used with one cloud provider",
                    "It is built to handle the scale and elasticity of cloud environments",
                    "It does not require any configuration",
                  ],
                  correct: 2,
                  explanation:
                    "Cloud-native SIEMs are designed to elastically scale to handle the massive, bursty data volumes common in cloud environments and have native connectors for cloud services.",
                },
                {
                  id: 5,
                  question:
                    "In Google Cloud Platform, the service analogous to AWS CloudTrail is:",
                  options: [
                    "Security Command Center",
                    "Event Threat Detection",
                    "Cloud Audit Logs",
                    "Chronicle",
                  ],
                  correct: 2,
                  explanation:
                    "GCP's Cloud Audit Logs provide the detailed audit trail of administrative actions and data access, which is the GCP equivalent of CloudTrail.",
                },
              ],
            },
          },
          {
            id: "lesson-13-compliance-reporting",
            title: "Lesson 13: Compliance and Reporting",
            duration: "120 min",
            objectives: [
              "Understand how a SIEM supports compliance frameworks like PCI DSS, SOX, and GDPR",
              "Learn to create and manage compliance-specific dashboards and reports",
              "Explore techniques for monitoring file integrity and user access for compliance",
              "Design and build a compliance dashboard in a lab environment",
            ],
            content: {
              overview:
                "A SIEM is a critical tool for achieving and demonstrating compliance with various regulatory frameworks. This lesson covers how to leverage your SIEM to automate evidence collection, monitor for compliance violations, and generate the reports needed to satisfy auditors.",
              sections: [
                {
                  title: "PCI DSS Requirements",
                  content:
                    "<p>The Payment Card Industry Data Security Standard (PCI DSS) is a strict set of requirements for any organization that handles credit card data. SIEM is essential for meeting several of these requirements.</p><h3>Key PCI DSS SIEM Use Cases:</h3><ul><li><strong>Requirement 10:</strong> Track and monitor all access to network resources and cardholder data. SIEM provides the centralized logging and audit trails to prove this.</li><li><strong>Req 10.6:</strong> Review logs and security events daily. SIEM dashboards and alerts facilitate this process.</li><li><strong>Requirement 11:</strong> Regularly test security systems and processes. A SIEM can monitor File Integrity Monitoring (FIM) systems and track changes to critical files.</li><li><strong>Req 1.2 & 1.3:</strong> Monitor all firewall and router configurations and traffic to and from the Cardholder Data Environment (CDE).</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Automated Reporting</strong></div><p>Many SIEMs have pre-built PCI DSS compliance packs that include dashboards and reports mapped directly to each requirement, saving hundreds of hours of manual effort during an audit.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1579873436214-a4b5683938a4?w=800&h=400&fit=crop",
                },
                {
                  title: "SOX Compliance Monitoring",
                  content:
                    "<p>The Sarbanes-Oxley Act (SOX) is a U.S. federal law enacted to protect investors by improving the accuracy and reliability of corporate disclosures. From an IT perspective, SOX is concerned with access controls and the integrity of financial data.</p><h3>Key SOX SIEM Use Cases:</h3><ul><li><strong>Access Control Monitoring:</strong> Auditing who is accessing financial systems, databases, and applications. SIEM can provide detailed reports of all logins, failed logins, and privilege escalations.</li><li><strong>Change Management:</strong> Tracking all changes to critical systems, applications, and financial databases. This includes who made the change, what was changed, and when.</li><li><strong>Privileged User Monitoring:</strong> Keeping a close eye on the activities of administrators and other privileged users to ensure separation of duties and prevent fraud.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Proving Controls</strong></div><p>During a SOX audit, an organization must prove its internal controls are effective. SIEM logs and reports serve as the primary evidence to demonstrate that these IT controls are working as designed.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1612089421535-63853dec6247?w=800&h=400&fit=crop",
                },
                {
                  title: "GDPR Data Protection Monitoring",
                  content:
                    "<p>The General Data Protection Regulation (GDPR) is a comprehensive data privacy law in the European Union. It requires organizations to protect the personal data and privacy of EU citizens.</p><h3>Key GDPR SIEM Use Cases:</h3><ul><li><strong>Detecting Data Breaches:</strong> Identifying potential data breaches involving personal data is a core function. A SIEM can correlate events to detect data exfiltration or unauthorized access. GDPR mandates a 72-hour notification window for breaches, so rapid detection is critical.</li><li><strong>Monitoring Access to Personal Data:</strong> A SIEM can be configured to audit and alert on any access to databases, files, or applications known to contain personal data.</li><li><strong>Data Subject Access Requests (DSAR):</strong> When a user requests their data, a SIEM can help locate all the systems and logs that contain information about that individual.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Focus on Personal Data</strong></div><p>To use a SIEM for GDPR, you must first identify what constitutes 'personal data' in your organization and which systems store it. Data classification is a prerequisite for effective monitoring.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1555949963-ff980877a232?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title:
                  "Splunk SPL for PCI DSS Req 10.2.2: All Actions by Privileged Users",
                language: "sql",
                code: "# Assuming privileged users are in a 'privileged_users.csv' lookup\nindex=*\n| lookup privileged_users.csv user OUTPUT is_privileged\n| where is_privileged = \"true\"\n| table _time, user, action, object, status",
              },
              {
                title: "KQL for SOX: Tracking Changes to a Financial Database",
                language: "sql",
                code: '# Assumes a custom log table for database activity\nFinancialDB_CL\n| where ActionType_s == "SchemaChange" or ActionType_s == "PermissionChange"\n| project TimeGenerated, UserPrincipalName_s, ClientIP_s, ActionDetails_s',
              },
              {
                title: "Query to Detect Potential Data Exfiltration for GDPR",
                language: "sql",
                code: 'index=firewall OR index=proxy\n| stats sum(bytes_out) as total_bytes_out by user\n| eventstats avg(total_bytes_out) as avg_bytes, stdev(total_bytes_out) as stdev_bytes\n| where total_bytes_out > (avg_bytes + (3 * stdev_bytes))\n| `comment("Find users sending out 3 standard deviations more data than the average")`',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "Which PCI DSS requirement is primarily concerned with tracking and monitoring all access to network resources and cardholder data?",
                  options: [
                    "Requirement 1",
                    "Requirement 5",
                    "Requirement 10",
                    "Requirement 12",
                  ],
                  correct: 2,
                  explanation:
                    "Requirement 10 of PCI DSS is entirely focused on logging and monitoring, making the SIEM a central tool for compliance.",
                },
                {
                  id: 2,
                  question:
                    "From an IT perspective, the Sarbanes-Oxley Act (SOX) is most concerned with:",
                  options: [
                    "Protecting credit card numbers",
                    "Data privacy for EU citizens",
                    "Internal controls related to financial data integrity and access",
                    "The security of industrial control systems",
                  ],
                  correct: 2,
                  explanation:
                    "SOX compliance in IT revolves around proving that controls are in place to prevent tampering with or unauthorized access to systems that handle financial reporting.",
                },
                {
                  id: 3,
                  question:
                    "A key requirement of GDPR is to notify authorities of a data breach within what timeframe?",
                  options: ["30 days", "90 days", "24 hours", "72 hours"],
                  correct: 3,
                  explanation:
                    "The 72-hour breach notification window under GDPR makes rapid detection via a SIEM critically important.",
                },
                {
                  id: 4,
                  question:
                    "Many SIEM platforms provide pre-configured dashboards and reports mapped to specific regulations. These are often called:",
                  options: [
                    "Query Packs",
                    "Compliance Packs or Add-ons",
                    "Log Parsers",
                    "SOAR Playbooks",
                  ],
                  correct: 1,
                  explanation:
                    "Compliance Packs are pre-built content designed to help organizations meet specific regulatory requirements with their SIEM.",
                },
                {
                  id: 5,
                  question:
                    "Using a SIEM to monitor for unauthorized changes to critical system files is known as:",
                  options: [
                    "User Behavior Analytics (UBA)",
                    "File Integrity Monitoring (FIM)",
                    "Network Access Control (NAC)",
                    "Threat Intelligence",
                  ],
                  correct: 1,
                  explanation:
                    "File Integrity Monitoring (FIM) systems generate logs when critical files are changed, which are then sent to the SIEM for monitoring, alerting, and reporting as required by regulations like PCI DSS.",
                },
              ],
            },
          },
          {
            id: "lesson-14-performance-tuning",
            title: "Lesson 14: Performance Tuning",
            duration: "120 min",
            objectives: [
              "Understand the key factors affecting SIEM performance",
              "Learn best practices for index management and data tiering",
              "Explore search optimization strategies beyond basic query writing",
              "Grasp the importance of resource allocation for SIEM components",
            ],
            content: {
              overview:
                "A slow SIEM is an ineffective SIEM. As data volumes grow, maintaining the performance of your platform is critical for real-time alerting and analyst productivity. This lesson covers the advanced techniques for tuning your SIEM, from the storage layer to the search head.",
              sections: [
                {
                  title: "Index Management",
                  content:
                    "<p>How you structure your data at rest has a profound impact on search performance. Proper index management is the first step in building a scalable SIEM.</p><h3>Best Practices:</h3><ul><li><strong>Index Strategy:</strong> Don't put all your data in one massive index. Segment data into logical indexes based on source, type, and retention requirements (e.g., `pci_data`, `web_logs`, `os_logs`). This allows for more targeted searches.</li><li><strong>Time-based Buckets:</strong> SIEMs store data in time-based 'buckets' or 'shards'. When you search with a time range, the SIEM can completely ignore buckets outside that range, drastically reducing the data it has to scan. This is why time is the most important filter.</li><li><strong>Cardinality:</strong> Be mindful of fields with extremely high cardinality (a huge number of unique values), as they can be resource-intensive to index and search on.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Index Per Source Type</strong></div><p>A common best practice is to create a new index for each major new data source. This provides easy separation for access control, retention, and performance management.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1518932945647-7a1c969f8be2?w=800&h=400&fit=crop",
                },
                {
                  title: "Search Optimization",
                  content:
                    "<p>We've already covered efficient query writing. Search optimization at the platform level involves scheduling, resource management, and understanding how the SIEM processes queries.</p><h3>Advanced Techniques:</h3><ul><li><strong>Search Scheduling:</strong> Not all searches need to run in real-time. Schedule resource-intensive reports and correlation searches to run during off-peak hours. Use different schedules for high-priority (every 5 mins) vs. low-priority (every 4 hours) alerts.</li><li><strong>Summary Indexing:</strong> For very large, slow-running searches that you need to report on frequently, you can use summary indexing. This involves running the search on a schedule (e.g., once an hour) and saving the small statistical result into a special summary index. Your reports then query the tiny summary index instead of the raw data.</li><li><strong>Concurrent Search Limits:</strong> SIEMs limit the number of searches a single user or the entire system can run concurrently. Understand these limits and work with your admins to adjust them if necessary, but avoid overwhelming the system.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Acceleration vs. Summary Indexing</strong></div><p>Data model acceleration is a more modern, efficient, and transparent method for speeding up queries. Summary indexing is an older, more manual method but can still be useful for very specific, complex statistical reports.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1542438408-abb2021e1837?w=800&h=400&fit=crop",
                },
                {
                  title: "Resource Allocation",
                  content:
                    "<p>A SIEM is a distributed system with multiple components (ingesters, indexers, search heads) that must be properly resourced with CPU, RAM, and fast I/O.</p><h3>Key Areas of Concern:</h3><ul><li><strong>Indexer I/O:</strong> Indexers are constantly writing data to disk and reading it back for searches. They require very fast storage (SSDs are standard) to avoid I/O bottlenecks that would slow down both ingestion and searching.</li><li><strong>Search Head CPU & RAM:</strong> Search heads do the heavy lifting of processing and correlating data. They are CPU and RAM intensive. A slow search UI is often a sign that the search heads are under-resourced.</li><li><strong>Ingestion Pipeline:</strong> The components responsible for receiving, parsing, and queueing data need enough resources to handle data bursts without dropping logs. Monitor the ingestion queue depth for signs of bottlenecks.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Monitor the Monitor</strong></div><p>You must actively monitor the health and performance of your SIEM itself. Use the platform's built-in monitoring tools to track CPU, memory, disk I/O, search latency, and data ingestion rates. Proactively identify and fix issues before they impact security operations.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1591799264318-7e6e74e3cce2?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title:
                  "Splunk: Configuring an Index with Hot, Warm, Cold Tiers",
                language: "ini",
                code: "# From indexes.conf\n\n[web_logs]\nhomePath = /opt/splunk/var/lib/splunk/web_logs/db\ncoldPath = /opt/splunk/var/lib/splunk/web_logs/colddb\nthawedPath = /opt/splunk/var/lib/splunk/web_logs/thaweddb\n\n# Keep data in hot/warm (on SSDs) for 30 days\nmaxTotalDataSizeMB = 512000\nfrozenTimePeriodInSecs = 2592000 # 30 days",
              },
              {
                title: "Splunk: Populating a Summary Index",
                language: "sql",
                code: '# Original slow search\nindex=firewall action=blocked | stats count by src_ip, dest_port\n\n# Saved search that runs hourly to populate the summary\n| savedsearch "Firewall Block Summary" | collect index=summary addinfo=true',
              },
              {
                title:
                  "KQL: Performance Tip - Use `has` instead of `contains` for substrings",
                language: "sql",
                code: '# Less performant: Case-insensitive, scans for full substring\nSecurityEvent | where CommandLine contains "powershell"\n\n# More performant: Case-sensitive, uses index for tokenized terms. Better for keywords.\nSecurityEvent | where CommandLine has "powershell"',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "Why is it a best practice to separate data into multiple indexes instead of using one large index?",
                  options: [
                    "It costs less in licensing",
                    "It allows for more targeted searches and granular retention policies",
                    "It is required by law",
                    "It automatically normalizes the data",
                  ],
                  correct: 1,
                  explanation:
                    "Separating data by source or type (e.g., index=web, index=pci) allows you to apply different retention/archiving policies and makes searches faster by limiting the scope.",
                },
                {
                  id: 2,
                  question:
                    "Which SIEM component has the most demanding requirement for fast disk I/O?",
                  options: [
                    "Forwarder / Agent",
                    "Search Head",
                    "Indexer / Data Node",
                    "License Manager",
                  ],
                  correct: 2,
                  explanation:
                    "Indexers are constantly writing new data and servicing read requests for searches, making fast disk I/O their most critical resource.",
                },
                {
                  id: 3,
                  question:
                    "The process of running a pre-scheduled search and saving the smaller statistical results to a separate index is called:",
                  options: [
                    "Data Modeling",
                    "Summary Indexing",
                    "Real-time Alerting",
                    "Log Parsing",
                  ],
                  correct: 1,
                  explanation:
                    "Summary indexing is a performance optimization technique where you pre-calculate the results of a slow search and store them for fast reporting.",
                },
                {
                  id: 4,
                  question:
                    "What is the primary reason that specifying a time range is the most effective search filter?",
                  options: [
                    "It reduces CPU usage on the search head",
                    "It allows the SIEM to completely ignore data buckets outside the time range",
                    "It is easier for analysts to write",
                    "It makes dashboards look better",
                  ],
                  correct: 1,
                  explanation:
                    "Because data is stored in time-ordered buckets, providing a time range allows the search to skip scanning massive amounts of irrelevant data.",
                },
                {
                  id: 5,
                  question:
                    "If your SIEM dashboards and interactive searches are consistently slow and laggy, which component is most likely under-resourced?",
                  options: [
                    "The Log Collectors",
                    "The network switch",
                    "The Indexers",
                    "The Search Head",
                  ],
                  correct: 3,
                  explanation:
                    "The Search Head is responsible for rendering the UI and processing the search language. Slowness in the user interface is a classic symptom of an over-taxed Search Head (insufficient CPU or RAM).",
                },
              ],
            },
          },
          {
            id: "lesson-15-threat-hunting",
            title: "Lesson 15: Advanced Threat Hunting",
            duration: "150 min",
            objectives: [
              "Differentiate between security monitoring and active threat hunting",
              "Understand how to develop a hypothesis for a threat hunt",
              "Utilize advanced analytics and visualization to uncover hidden threats",
              "Translate findings from a threat hunt into new, automated detections",
            ],
            content: {
              overview:
                "Threat hunting is the proactive, iterative search through your data to detect and isolate advanced threats that have evaded existing security controls. This lesson moves you from a reactive (alert-driven) mindset to a proactive (hunt-driven) one, teaching you the methodologies and techniques used by elite security teams.",
              sections: [
                {
                  title: "Hypothesis-Driven Hunting",
                  content:
                    "<p>Threat hunting is not aimless searching. It starts with a hypothesis—an educated guess about a potential threat or technique that might be active in your environment. The hypothesis guides your investigation.</p><h3>Developing a Hypothesis:</h3><ul><li><strong>Based on Threat Intelligence:</strong> 'A threat actor called FIN7 is targeting our industry with new PowerShell-based malware. Let's hunt for evidence of their specific techniques.'</li><li><strong>Based on ATT&CK Techniques:</strong> 'Attackers often use Scheduled Tasks for persistence (T1053.005). Let's hunt for unusual or newly created scheduled tasks across our server fleet.'</li><li><strong>Based on Anomalies ('Crown Jewels'):</strong> 'Our critical intellectual property is on the 'Thor' fileserver. Let's hunt for any unusual data access patterns, file movements, or connections originating from that server.'</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Be Creative and Curious</strong></div><p>Threat hunting requires an analyst's creativity and intuition. It's about asking 'what if...' and having the skills to look for the answer in the data. Assume a breach has already occurred and look for the evidence.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1542831371-d531d209121f?w=800&h=400&fit=crop",
                },
                {
                  title: "Advanced Analytics for Hunting",
                  content:
                    "<p>Threat hunters use advanced analytics to find subtle deviations and patterns that automated rules might miss. This often involves looking at data in aggregate and visualizing it to spot outliers.</p><h3>Hunting Techniques:</h3><ul><li><strong>Stacking:</strong> Grouping data by a specific value and counting the occurrences. The goal is to find outliers. For example, 'stacking' by user-agent strings can reveal a strange, non-browser user-agent that indicates a C2 beacon.</li><li><strong>Clustering:</strong> An unsupervised machine learning technique to group similar behaviors. For example, clustering processes by their command-line arguments can help identify a malicious variant among thousands of legitimate processes.</li><li><strong>Visualization:</strong> Using charts and graphs to spot anomalies. A spike in DNS queries for a specific domain or an unusual parent-child process relationship might be instantly visible in a graph but hard to find in raw logs.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>The Hunting Loop</strong></div><p>Threat hunting is an iterative process: Form Hypothesis -> Investigate with a Query -> Analyze Results (refine query if needed) -> Find Evil (or prove hypothesis wrong) -> Automate Detection.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=400&fit=crop",
                },
                {
                  title: "Custom Detection Development",
                  content:
                    "<p>The ultimate goal of a successful threat hunt is to close a detection gap. Once you have identified a malicious pattern, you must use that knowledge to build a new, automated detection rule (use case) in your SIEM.</p><h3>From Hunt to Detection:</h3><ol><li><strong>Isolate the Malicious Pattern:</strong> During the hunt, you identified the specific combination of events, command-line arguments, or network traffic that defines the threat.</li><li><strong>Generalize the Logic:</strong> Abstract the pattern so it's not too specific. Instead of looking for `malware.exe`, look for an unsigned executable running from the `Downloads` folder.</li><li><strong>Build the Correlation Rule:</strong> Implement this logic as a new detection rule in your SIEM.</li><li><strong>Test and Deploy:</strong> Test the rule for false positives and then deploy it.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Never Hunt the Same Thing Twice</strong></div><p>This is the motto of threat hunting. The knowledge gained from every hunt should be codified into an automated detection, allowing your team to move on to hunting for the next unknown threat.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title:
                  "Hunt Hypothesis 1: Living off the Land with `rundll32.exe`",
                language: "sql",
                code: "# Hypothesis: Attackers use rundll32.exe to execute malicious code directly from the command line, often without a parent process or from an unusual location.\n# KQL Query to find suspicious rundll32.exe executions:\nDeviceProcessEvents \n| where FileName == 'rundll32.exe'\n| where isempty(InitiatingProcessParentFileName) or InitiatingProcessFolderPath !contains 'C:\\Windows\\System32\\'",
              },
              {
                title: "Hunt Hypothesis 2: DNS Tunneling",
                language: "sql",
                code: "# Hypothesis: Attackers are exfiltrating data via DNS, which would manifest as abnormally long DNS queries.\n# SPL Query to find the longest DNS queries:\nindex=dns sourcetype=stream:dns\n| eval query_len=len(query)\n| sort 100 - query_len\n| table query, query_len, src_ip, dest_ip",
              },
              {
                title:
                  "Hunt Hypothesis 3: Stacking by User Agent to Find Beacons",
                language: "sql",
                code: "# Hypothesis: C2 beacons often use non-standard or rare User-Agent strings.\n# SPL Query:\nindex=proxy\n| stats count by http_user_agent\n| sort count asc",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the key difference between security monitoring and threat hunting?",
                  options: [
                    "Monitoring uses the SIEM, hunting does not",
                    "Monitoring is reactive (alert-driven), while hunting is proactive and iterative",
                    "Monitoring is done by junior analysts, hunting by senior analysts",
                    "Monitoring focuses on network data, hunting on endpoint data",
                  ],
                  correct: 1,
                  explanation:
                    "Monitoring is the process of responding to alerts from automated systems, while threat hunting is a proactive, human-driven search for threats that those systems missed.",
                },
                {
                  id: 2,
                  question: "A threat hunt should always begin with what?",
                  options: [
                    "Running a full vulnerability scan",
                    "A clear, testable hypothesis",
                    "Restarting the SIEM servers",
                    "Blocking all traffic from unknown countries",
                  ],
                  correct: 1,
                  explanation:
                    "A hypothesis provides the necessary structure and direction for a threat hunt, turning it from random searching into a focused investigation.",
                },
                {
                  id: 3,
                  question:
                    "The technique of grouping data by a value (like user-agent or process name) and looking for the least common occurrences is known as:",
                  options: [
                    "Baselining",
                    "Stacking",
                    "Correlation",
                    "Indexing",
                  ],
                  correct: 1,
                  explanation:
                    "Stacking (or frequency analysis) is a core hunting technique used to find outliers and anomalies by looking for rare values in a dataset.",
                },
                {
                  id: 4,
                  question:
                    "What is the ultimate goal of a successful threat hunt?",
                  options: [
                    "To produce a report for management",
                    "To test the performance of the SIEM",
                    "To create a new, automated detection rule based on the findings",
                    "To prove that the network is secure",
                  ],
                  correct: 2,
                  explanation:
                    "The primary goal is to close the detection gap found during the hunt. This is done by operationalizing the discovery into an automated alert so you don't have to hunt for the same thing again.",
                },
                {
                  id: 5,
                  question:
                    "A threat hunter looking for evidence of a specific adversary group's known methods is using which source to form their hypothesis?",
                  options: [
                    "The 'Crown Jewels' asset inventory",
                    "Internal penetration test results",
                    "Threat Intelligence",
                    "A random number generator",
                  ],
                  correct: 2,
                  explanation:
                    "Threat intelligence reports on actor TTPs are a rich source for generating hunt hypotheses, such as 'Let's hunt for the techniques used by APT29.'",
                },
              ],
            },
          },
          {
            id: "lesson-16-siem-architecture",
            title: "Lesson 16: SIEM Architecture Design",
            duration: "120 min",
            objectives: [
              "Understand designs for distributed and tiered SIEM deployments",
              "Learn concepts of High Availability (HA) for SIEM components",
              "Explore Disaster Recovery (DR) planning for a SIEM",
              "Design a basic enterprise SIEM architecture",
            ],
            content: {
              overview:
                "For large enterprises, a single SIEM instance is not enough. This lesson moves into SIEM engineering and architecture, covering how to design a scalable, resilient, and distributed SIEM deployment that can handle massive data volumes and ensure business continuity.",
              sections: [
                {
                  title: "Distributed SIEM Deployment",
                  content:
                    "<p>A distributed architecture separates SIEM functions onto different servers or clusters to handle large scale. This is the standard for any significant enterprise deployment.</p><h3>Common Components:</h3><ul><li><strong>Search Head(s):</strong> One or more servers dedicated to handling the user interface and search processing. For larger teams, a search head cluster can be deployed for scalability and redundancy.</li><li><strong>Indexers:</strong> A cluster of servers responsible for receiving, indexing, and storing data. Data is often distributed across the cluster, and replication can be configured for data redundancy.</li><li><strong>Forwarders:</strong> Thousands of lightweight agents deployed on endpoints and servers to collect and forward data to the indexers.</li><li><strong>Deployment Server / Manager:</strong> A central server used to manage the configurations of all the forwarders.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Separation of Concerns</strong></div><p>This separation allows each component to be scaled independently. If search is slow, add more search heads. If ingestion is lagging, add more indexers.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1461749280684-dccba630e2f6?w=800&h=400&fit=crop",
                },
                {
                  title: "High Availability (HA) Configuration",
                  content:
                    "<p>High Availability ensures that the SIEM service remains operational even if a component fails. This is critical for a 24/7 Security Operations Center (SOC).</p><h3>HA Techniques:</h3><ul><li><strong>Indexer Clustering:</strong> An indexer cluster automatically replicates data across multiple nodes. If one indexer fails, the data is still available on other nodes and searches can continue without interruption.</li><li><strong>Search Head Clustering:</strong> A search head cluster provides a pool of search heads behind a load balancer. If one search head fails, user sessions are automatically redirected to a healthy one.</li><li><strong>Load Balancing:</strong> Using load balancers in front of ingestion components (like syslog collectors or HTTP event collectors) to distribute the load and route around failures.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>No Single Point of Failure</strong></div><p>The goal of an HA architecture is to eliminate any single point of failure whose crash would cause an outage of the entire SIEM service.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1549419409-17083a21a8a9?w=800&h=400&fit=crop",
                },
                {
                  title: "Disaster Recovery (DR) Planning",
                  content:
                    "<p>Disaster Recovery goes beyond HA. It addresses a total site failure (e.g., a datacenter is lost). A DR plan ensures you can restore SIEM functionality at a secondary site.</p><h3>DR Strategies:</h3><ul><li><strong>Backup and Restore:</strong> The simplest method. Regularly back up the SIEM configurations and indexed data. In a disaster, you would build new servers at the DR site and restore from backup. This has a high Recovery Time Objective (RTO).</li><li><strong>Cold/Warm Standby:</strong> A duplicate environment exists at the DR site but is turned off or minimally provisioned. In a disaster, it is powered on and configured to take over.</li><li><strong>Hot Standby (Active/Passive):</strong> A fully operational duplicate environment exists at the DR site. Data is continuously replicated from the primary site to the standby site. In a disaster, a failover process is initiated to make the DR site the new primary. This offers the lowest RTO.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Test Your DR Plan!</strong></div><p>A DR plan that has never been tested is not a plan; it's a prayer. Regular DR testing is essential to ensure that the process works and that the team is prepared to execute it.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1517048676732-d65bc937f952?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Diagram: Splunk Distributed Architecture",
                language: "markdown",
                code: "Forwarders --> Load Balancer --> Indexer Cluster (3+ Nodes)\n  ^\n  |\nUsers --> Search Head Cluster (3+ Nodes) --searches--> Indexer Cluster\n  |\n  +---- Deployment Server manages Forwarders",
              },
              {
                title: "Diagram: SIEM Multi-Site DR (Active/Passive)",
                language: "markdown",
                code: "PRIMARY SITE (Active)\nForwarders --> Indexer Cluster [A]\n                  |\n                  +---(Replication)---> Indexer Cluster [B]\nUsers --> Search Head Cluster [A]\n\n\nDISASTER RECOVERY SITE (Passive)\n(Forwarders are configured to fail over to Site B)\n\nIndexer Cluster [B] (Receiving replicated data)\nSearch Head Cluster [B] (Standby)",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "In a large distributed Splunk environment, which component is primarily responsible for storing and indexing data?",
                  options: [
                    "Search Head",
                    "Forwarder",
                    "Deployment Server",
                    "Indexer",
                  ],
                  correct: 3,
                  explanation:
                    "The indexer is the workhorse of the Splunk architecture, handling the tasks of receiving, writing, indexing, and storing data.",
                },
                {
                  id: 2,
                  question:
                    "The primary goal of a High Availability (HA) architecture is to:",
                  options: [
                    "Make searches run faster",
                    "Reduce licensing costs",
                    "Eliminate single points of failure to prevent service outages",
                    "Store data for a longer period of time",
                  ],
                  correct: 2,
                  explanation:
                    "High Availability is all about redundancy and resilience, ensuring the service remains available despite the failure of an individual component.",
                },
                {
                  id: 3,
                  question:
                    "A plan to fail over your entire SIEM to a secondary datacenter in the event of a catastrophic site failure is called a:",
                  options: [
                    "High Availability Plan",
                    "Disaster Recovery Plan",
                    "Indexing Strategy",
                    "Use Case Development Plan",
                  ],
                  correct: 1,
                  explanation:
                    "Disaster Recovery (DR) deals with large-scale disasters, whereas High Availability (HA) deals with localized component failures within a single site.",
                },
                {
                  id: 4,
                  question:
                    "What is the function of a Search Head Cluster in a Splunk architecture?",
                  options: [
                    "To provide a redundant and scalable search tier for users",
                    "To store all the log data",
                    "To manage the configurations of forwarders",
                    "To collect logs from endpoints",
                  ],
                  correct: 0,
                  explanation:
                    "A Search Head Cluster provides a highly available and scalable interface for users to run searches, create dashboards, and manage alerts.",
                },
                {
                  id: 5,
                  question:
                    "Replicating indexed data across multiple nodes in an indexer cluster primarily provides:",
                  options: [
                    "Faster search performance",
                    "Better parsing",
                    "Data redundancy to protect against data loss if an indexer fails",
                    "Reduced storage costs",
                  ],
                  correct: 2,
                  explanation:
                    "Replication is a key HA feature that ensures a copy of the data exists on multiple nodes, so if one fails, the data is not lost and remains searchable.",
                },
              ],
            },
          },
          {
            id: "lesson-17-custom-content",
            title: "Lesson 17: Custom Content Development",
            duration: "120 min",
            objectives: [
              "Learn to build custom apps and add-ons to package SIEM content",
              "Understand how to use SIEM APIs for data ingress and egress",
              "Develop custom visualizations and dashboards",
              "Package a set of related SIEM objects for easy deployment",
            ],
            content: {
              overview:
                "Go beyond the built-in features and learn how to extend and customize your SIEM. This lesson covers the development of custom content, from creating new data inputs and visualizations to packaging your work into apps and add-ons for clean, manageable deployments.",
              sections: [
                {
                  title: "Custom Apps and Add-ons",
                  content:
                    "<p>In platforms like Splunk, the best way to organize and deploy custom content is by packaging it into an app or an add-on. This provides a clean, version-controlled, and easily distributable unit.</p><h3>App vs. Add-on:</h3><ul><li><strong>Technology Add-on (TA):</strong> Primarily focused on getting data *in* and making it CIM-compliant. A TA typically contains configurations for data inputs, parsing (props/transforms), and field aliases. It has no user interface.</li><li><strong>App:</strong> Focused on the user experience. An app provides dashboards, reports, visualizations, and workflows for a specific use case. It often depends on a TA to provide the underlying data.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Modularity</strong></div><p>This separation is a best practice. The TA handles the data 'plumbing', and the App handles the analytics and presentation. You could have one TA for Palo Alto data, and multiple Apps (a security app, a network operations app) that use its data.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1531403009284-440993d21634?w=800&h=400&fit=crop",
                },
                {
                  title: "API Integration Development",
                  content:
                    "<p>Modern SIEMs have rich REST APIs that allow for programmatic interaction with the platform. This is key for automation and integration with other tools in your security ecosystem.</p><h3>Common API Use Cases:</h3><ul><li><strong>Data Ingress:</strong> Pushing data *into* the SIEM from custom scripts or applications. The HTTP Event Collector (HEC) is a common, high-performance way to do this.</li><li><strong>Data Egress:</strong> Running a search via the API and pulling the results *out* of the SIEM for use in another system (e.g., a custom dashboard or a data science platform).</li><li><strong>Configuration Management:</strong> Automating the creation of users, indexes, saved searches, and other SIEM configuration objects, which is useful for DevOps/IaC (Infrastructure as Code) practices.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>SDKs Simplify Development</strong></div><p>Most SIEMs provide official Software Development Kits (SDKs) for popular languages like Python, Java, and JavaScript. These SDKs are wrappers around the REST API that make it much easier to write integration scripts.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1504639725590-34d0984388bd?w=800&h=400&fit=crop",
                },
                {
                  title: "Custom Visualizations",
                  content:
                    "<p>While SIEMs come with a standard library of charts (bar, line, pie), they also offer ways to build completely custom visualizations to better tell your data's story.</p><h3>Methods for Custom Views:</h3><ul><li><strong>Dashboard Editors:</strong> Most platforms have advanced UI editors that allow you to customize HTML, CSS, and JavaScript directly within the dashboard. This allows for custom layouts, interactive elements, and dynamic behavior.</li><li><strong>Custom Visualization Libraries:</strong> Platforms like Splunk have a defined process for developing and packaging entirely new chart types (e.g., a sunburst chart, a Sankey diagram) using web libraries like D3.js. These can then be shared and reused by other users.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Focus on the Question</strong></div><p>A flashy visualization is useless if it doesn't help an analyst answer a security question faster. Always start with the question you're trying to answer and choose the visualization that best serves that purpose. Clarity is more important than complexity.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1534430480872-3498386e7856?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Splunk App Directory Structure (Simplified)",
                language: "bash",
                code: "my_security_app/\n├── default/\n│   ├── app.conf       # App metadata\n│   ├── data/\n│   │   └── ui/\n│   │       ├── nav/     # Navigation menu\n│   │       └── views/   # Dashboards (XML)\n│   └── savedsearches.conf # Reports and alerts\n└── lookups/             # Lookup files (CSVs)\n",
              },
              {
                title: "Python Script to Send Data to Splunk HEC",
                language: "python",
                code: "import requests\nimport json\n\nSPLUNK_HEC_URL = 'https://splunk.example.com:8088/services/collector'\nSPLUNK_HEC_TOKEN = 'YOUR-HEC-TOKEN'\n\nheaders = {'Authorization': f'Splunk {SPLUNK_HEC_TOKEN}'}\n\npayload = {\n    'event': {'message': 'User alice logged out successfully'},\n    'sourcetype': 'custom:app:logout'\n}\n\nresponse = requests.post(SPLUNK_HEC_URL, headers=headers, data=json.dumps(payload), verify=False)\nprint(response.text)",
              },
              {
                title: "Dashboard XML for a Simple Panel (Splunk)",
                language: "xml",
                code: '<dashboard>\n  <label>My Custom Dashboard</label>\n  <row>\n    <panel>\n      <title>Failed Logins by User</title>\n      <chart>\n        <search>\n          <query>index=auth action=failure | top user</query>\n          <earliest>-24h@h</earliest>\n          <latest>now</latest>\n        </search>\n        <option name="charting.chart">bar</option>\n      </chart>\n    </panel>\n  </row>\n</dashboard>',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "In Splunk, what is the primary purpose of a Technology Add-on (TA)?",
                  options: [
                    "To provide dashboards and visualizations",
                    "To handle data ingestion, parsing, and normalization",
                    "To manage user accounts",
                    "To control licensing",
                  ],
                  correct: 1,
                  explanation:
                    "A Technology Add-on's main job is the 'plumbing'—getting data from a specific source into Splunk and making it CIM-compliant.",
                },
                {
                  id: 2,
                  question:
                    "What is the most common and performant method for sending event data into a SIEM via a custom script?",
                  options: [
                    "Writing directly to the index files",
                    "Using the REST API with an HTTP Event Collector (HEC) endpoint",
                    "Sending an email to the SIEM administrator",
                    "Configuring an FTP transfer",
                  ],
                  correct: 1,
                  explanation:
                    "The HTTP Event Collector is a high-performance, token-based endpoint specifically designed for receiving data from custom sources.",
                },
                {
                  id: 3,
                  question:
                    "The main benefit of packaging your custom content (dashboards, alerts, lookups) into an App is:",
                  options: [
                    "It makes your searches run faster",
                    "It provides a clean, version-controlled, and deployable unit",
                    "It reduces the amount of data stored",
                    "It is the only way to create new alerts",
                  ],
                  correct: 1,
                  explanation:
                    "Packaging content into an app makes it easy to manage, deploy to other servers (like search head cluster members), and share with the community.",
                },
                {
                  id: 4,
                  question:
                    "Splunk SDKs (Software Development Kits) for languages like Python are designed to:",
                  options: [
                    "Replace the need for writing SPL queries",
                    "Simplify programmatic interaction with the SIEM's REST API",
                    "Create custom visualizations automatically",
                    "Increase the SIEM's indexing speed",
                  ],
                  correct: 1,
                  explanation:
                    "SDKs are helpful wrappers that handle authentication and API call syntax, making it much easier to automate and integrate with the SIEM from external scripts.",
                },
                {
                  id: 5,
                  question:
                    "What is the most important principle of designing a good custom visualization?",
                  options: [
                    "Using as many bright colors as possible",
                    "Ensuring it helps an analyst answer a specific question quickly",
                    "Making it as complex as possible",
                    "Only using 3D pie charts",
                  ],
                  correct: 1,
                  explanation:
                    "A visualization's value is measured by its ability to convey information and insight clearly. The driving force behind its design should always be the analytical question it needs to answer.",
                },
              ],
            },
          },
          {
            id: "lesson-18-advanced-threat-detection",
            title: "Lesson 18: Advanced Threat Detection",
            duration: "120 min",
            objectives: [
              "Explore techniques for detecting Advanced Persistent Threats (APTs)",
              "Understand how to approach insider threat monitoring",
              "Learn about the challenges and strategies for detecting zero-day attacks",
              "Simulate and detect a multi-stage attack in a lab environment",
            ],
            content: {
              overview:
                "This lesson focuses on detecting the most sophisticated and evasive threats. We will cover the tactics, techniques, and procedures (TTPs) used by Advanced Persistent Threats (APTs) and insiders, and discuss the data sources and analytical strategies required to bring their activities to light.",
              sections: [
                {
                  title: "Advanced Persistent Threat (APT) Detection",
                  content:
                    "<p>An APT is a sophisticated, long-term threat actor, often state-sponsored, that gains unauthorized access to a network and remains undetected for an extended period. Detecting them requires a focus on subtle TTPs, not just simple IOCs.</p><h3>Detection Strategy:</h3><ul><li><strong>Long-term Baselining:</strong> APTs move slowly. Detections must be based on baselines of user and host behavior that span months, not hours or days.</li><li><strong>Credential Access Focus:</strong> Monitor for credential dumping (e.g., Mimikatz), abuse of Kerberos (Golden Ticket attacks), and other advanced credential theft techniques.</li><li><strong>Lateral Movement Tracking:</strong> APTs expand their foothold by moving from system to system. Meticulously track all host-to-host connections (e.g., via WinRM, PsExec, RDP) and alert on unusual patterns.</li><li><strong>C2 Beaconing Detection:</strong> APT malware often uses stealthy command-and-control channels. Hunt for periodic, low-volume network traffic to unusual destinations, DNS queries for long, random-looking domains (DGA), and non-standard protocols on standard ports.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>It's a Campaign</strong></div><p>Don't look for a single 'APT event'. Look for a chain of low-and-slow events that, when correlated, reveal the broader campaign. A SIEM with good behavioral analytics is key.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1614064548237-02f8f17374b2?w=800&h=400&fit=crop",
                },
                {
                  title: "Insider Threat Monitoring",
                  content:
                    "<p>An insider threat comes from a current or former employee, contractor, or partner who has authorized access and misuses it, either maliciously or unintentionally. Detections must focus on abuse of legitimate access.</p><h3>Key Indicators:</h3><ul><li><strong>Anomalous Data Access:</strong> A user accessing sensitive data they've never accessed before, or accessing it outside of normal working hours.</li><li><strong>Mass Data Aggregation/Exfiltration:</strong> A user downloading or transferring unusually large volumes of data to USB drives, cloud storage, or personal email.</li><li><strong>Suspicious Job-Seeking Behavior:</strong> Correlating HR data with activity like printing sensitive documents or searching for confidential project files.</li><li><strong>Sabotage Attempts:</strong> Looking for privileged users deleting backups, disabling security controls, or wiping critical systems.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>UEBA is Essential</strong></div><p>Insider threat is the classic use case for UEBA. Since the insider is using legitimate credentials, traditional rules are often ineffective. Only by baselining their normal behavior can you spot the malicious deviations.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1556742054-e0e6d6a2f778?w=800&h=400&fit=crop",
                },
                {
                  title: "Zero-Day Attack Detection",
                  content:
                    "<p>A zero-day attack exploits a software vulnerability that is unknown to the vendor. Since there are no signatures or patches, detection cannot rely on known IOCs.</p><h3>Detection Strategies:</h3><ul><li><strong>Focus on Post-Exploitation Behavior:</strong> You might not see the exploit itself, but you can see what the attacker does *immediately after*. Look for anomalous process creation from a vulnerable service (e.g., an web server suddenly spawning PowerShell or cmd.exe).</li><li><strong>Memory Analysis:</strong> Advanced EDR tools integrated with your SIEM can detect memory-based attacks (fileless malware), which are common in zero-day exploits.</li><li><strong>Application Log Auditing:</strong> Monitor application logs for unusual error messages or inputs that could indicate an exploitation attempt.</li><li><strong>Honeypots and Canaries:</strong> A 'canary' is a fake file or credential. A SIEM can alert instantly if this canary token is ever accessed, as no legitimate process should ever touch it. This can be a high-fidelity signal of a breach.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Detection in Depth</strong></div><p>You cannot 'detect a zero-day'. You detect the *consequences* of the exploit. This requires multiple layers of visibility, especially from an EDR solution providing rich process and command-line data to the SIEM.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1547756536-cde55c3f2c65?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Query for Lateral Movement via PsExec",
                language: "sql",
                code: "# PsExec creates a service on the remote host called 'PSEXESVC'\n# KQL Query to detect this behavior\nDeviceProcessEvents \n| where FileName == 'services.exe'\n| where ProcessCommandLine contains 'PSEXESVC.exe'",
              },
              {
                title: "Query for Potential Kerberos Golden Ticket Usage",
                language: "sql",
                code: '# A golden ticket will often have a long lifetime and a generic account name.\n# SPL Query using Windows Security logs (EventCode 4624)\nindex=os EventCode=4624 LogonType=9\n| `comment("LogonType 9 = NewCredentials")`\n| search TicketOptions="*0x40810000*"\n| search TicketEncryptionType="*0x17*" OR TicketEncryptionType="*0x18*"\n| where AccountName != "*$"  `comment("Exclude machine accounts")`',
              },
              {
                title: "Query for Web Server Spawning Command Shell",
                language: "sql",
                code: '# This is a classic indicator of web shell exploitation (post-exploit behavior)\n# SPL Query\nindex=endpoint sourcetype="sysmon" EventCode=1\n| search ParentImage IN ("C:\\windows\\system32\\inetsrv\\w3wp.exe", "/usr/sbin/httpd", "/usr/sbin/nginx")\n| search Image IN ("C:\\windows\\system32\\cmd.exe", "C:\\windows\\system32\\windowspowershell\\v1.0\\powershell.exe", "/bin/bash")\n| table _time, host, ParentImage, Image, CommandLine',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the defining characteristic of an Advanced Persistent Threat (APT)?",
                  options: [
                    "They are primarily interested in short-term financial gain",
                    "They use very noisy and easy-to-detect malware",
                    "They are sophisticated actors who maintain long-term, stealthy access to a network",
                    "They only target small businesses",
                  ],
                  correct: 2,
                  explanation:
                    "APTs are characterized by their 'low-and-slow' methodology, aiming to remain undetected for long periods to achieve strategic goals.",
                },
                {
                  id: 2,
                  question:
                    "UEBA is most effective for detecting which of the following threats?",
                  options: [
                    "Network port scanning",
                    "Insider threats",
                    "Known virus signatures",
                    "Spam emails",
                  ],
                  correct: 1,
                  explanation:
                    "Since insiders use legitimate credentials, their malicious actions are best found by identifying deviations from their normal, baselined behavior, which is the core strength of UEBA.",
                },
                {
                  id: 3,
                  question:
                    "What is the best strategy for detecting a zero-day attack?",
                  options: [
                    "Relying solely on antivirus signature updates",
                    "Blocking all network traffic",
                    "Focusing on detecting the attacker's post-exploitation behavior",
                    "Waiting for the vendor to release a patch",
                  ],
                  correct: 2,
                  explanation:
                    "Since the initial exploit is unknown, the most effective strategy is to detect the subsequent actions the attacker takes, such as creating new processes or moving laterally.",
                },
                {
                  id: 4,
                  question:
                    "Monitoring for the use of tools like Mimikatz and tracking host-to-host PsExec connections are primarily aimed at detecting which ATT&CK Tactic?",
                  options: [
                    "Initial Access and Lateral Movement",
                    "Data Exfiltration",
                    "Impact",
                    "Reconnaissance",
                  ],
                  correct: 0,
                  explanation:
                    "Mimikatz is for credential access, and PsExec is a classic tool for lateral movement. These are key stages in an attacker's campaign after gaining an initial foothold.",
                },
                {
                  id: 5,
                  question:
                    "An alert that triggers when a web server process like `w3wp.exe` spawns `cmd.exe` is a high-fidelity indicator of what?",
                  options: [
                    "A normal server reboot",
                    "A successful web application exploit",
                    "A user clearing their browser cache",
                    "A database backup",
                  ],
                  correct: 1,
                  explanation:
                    "Legitimate web server processes should never spawn a command shell. This behavior is a strong signal that an attacker has exploited a vulnerability and is now executing commands on the server.",
                },
              ],
            },
          },
          {
            id: "lesson-19-security-orchestration",
            title: "Lesson 19: Security Orchestration",
            duration: "120 min",
            objectives: [
              "Define security orchestration and differentiate it from automation",
              "Understand how to integrate multiple security tools into a cohesive workflow",
              "Design and implement complex, multi-tool response playbooks",
              "Explore the role of human-in-the-loop decision points in orchestration",
            ],
            content: {
              overview:
                "This lesson advances from simple automation to true orchestration. Security orchestration is about connecting disparate security tools and automating complex workflows that span the entire security stack, from detection in the SIEM to response on the endpoint and firewall, all seamlessly integrated.",
              sections: [
                {
                  title: "Orchestration vs. Automation",
                  content:
                    "<p>While often used interchangeably, orchestration and automation have distinct meanings in a SOAR context.</p><h3>Definitions:</h3><ul><li><strong>Automation:</strong> The process of making a single, specific task run without human intervention. <em>Example: An automated script that blocks an IP address on a firewall.</em></li><li><strong>Orchestration:</strong> The process of coordinating and managing multiple automated tasks across different tools to execute a complete, complex workflow. Orchestration connects the different automated pieces together.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Orchestration is the Conductor</strong></div><p>Think of an orchestra. Each musician can 'automate' playing their instrument. The conductor 'orchestrates' them all to play together to create a symphony. In a SOC, the SOAR platform is the conductor, and the security tools (firewall, EDR, SIEM) are the musicians.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1593064390382-2c63824f5a83?w=800&h=400&fit=crop",
                },
                {
                  title: "Workflow Automation",
                  content:
                    "<p>A fully orchestrated workflow integrates multiple tools to perform a series of dependent actions, streamlining the incident response process from end to end.</p><h3>Example Phishing Response Orchestration:</h3><ol><li><strong>Start (Ingestion):</strong> A user reports a phishing email to a special inbox.</li><li><strong>Step 1 (Email Security):</strong> The SOAR platform pulls the email, automatically extracts URLs, attachments, and headers.</li><li><strong>Step 2 (Sandboxing - Automation):</strong> It submits the attachment to a sandbox for detonation and analysis.</li><li><strong>Step 3 (Threat Intel - Automation):</strong> It queries threat intelligence sources for the reputation of the sender IP and any URLs.</li><li><strong>Step 4 (SIEM - Automation):</strong> It searches the SIEM to see if any other users received an email from this sender or clicked on the malicious URL.</li><li><strong>Step 5 (Containment - Orchestration):</strong> Based on the combined findings, if malicious, the SOAR platform executes coordinated actions: deletes the email from all other user inboxes (via Mail Server API), blocks the sender IP (via Firewall API), and isolates any hosts where the user clicked the link (via EDR API).</li></ol><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>API-Driven</strong></div><p>Orchestration is only possible if your security tools have APIs that allow them to be controlled programmatically. This is a critical consideration when purchasing new security products.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1542708944-9721d234a413?w=800&h=400&fit=crop",
                },
                {
                  title: "Custom Playbook Development",
                  content:
                    "<p>Advanced playbooks go beyond simple alert responses and can codify entire security processes, including human decision points.</p><h3>Human-in-the-Loop:</h3><p>Not all actions should be fully automated. For high-impact actions like shutting down a production server, orchestration can pause and ask for human approval.</p><h3>Example Workflow with Approval:</h3><ol><li>SOAR detects a critical vulnerability on a production web server.</li><li>It automatically creates a change request ticket in the service desk system.</li><li>It then sends a message to the SOC manager's chat client with two buttons: 'Approve Patch' and 'Deny'.</li><li>The playbook pauses and waits for the manager's response.</li><li>If 'Approve' is clicked, the SOAR platform makes an API call to the patch management system to deploy the patch. If 'Deny', it closes the ticket with a note.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Document Everything</strong></div><p>Every playbook must be thoroughly documented. What does it do? What triggers it? What APIs does it touch? What are the fail-safes? This is crucial for maintaining and troubleshooting complex workflows.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1521791136064-7986c2920216?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Orchestration Playbook Flow (Pseudocode)",
                language: "markdown",
                code: "TRIGGER: New Phishing Email Alert\n\n1.  **Enrichment:**\n    -   Detonate attachment in Sandbox_A.\n    -   Check URL reputation in ThreatIntel_B.\n    -   Search SIEM_C for other victims.\n\n2.  **Decision Point (Human-in-the-loop):**\n    -   IF Sandbox_A.verdict == 'malicious' OR ThreatIntel_B.score > 80:\n        -   PROCEED to containment\n    -   ELSE:\n        -   NOTIFY analyst for manual review.\n\n3.  **Containment:**\n    -   Block sender_ip on Firewall_D.\n    -   Isolate host via EDR_E.\n    -   Delete email from MailServer_F.",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the best definition of security orchestration?",
                  options: [
                    "Automating a single, repetitive task",
                    "Coordinating automated tasks across multiple, disparate tools to execute a workflow",
                    "Installing security software on a server",
                    "Writing a custom log parser",
                  ],
                  correct: 1,
                  explanation:
                    "Orchestration is the coordination and sequencing of multiple automated tasks across different systems to achieve a broader outcome.",
                },
                {
                  id: 2,
                  question:
                    "Submitting a file to a sandbox, querying a threat intelligence platform, and blocking an IP on a firewall within a single workflow is an example of:",
                  options: [
                    "Log normalization",
                    "Security Orchestration",
                    "Data modeling",
                    "Index management",
                  ],
                  correct: 1,
                  explanation:
                    "This is a classic orchestration example, as it involves coordinating actions across at least three different tools (sandbox, TIP, firewall) to complete a process.",
                },
                {
                  id: 3,
                  question:
                    "What is a 'human-in-the-loop' decision point in a playbook?",
                  options: [
                    "A step where the playbook fails and requires manual fixing",
                    "A point where the automated workflow pauses and requires human approval before proceeding",
                    "A process that can only be done manually by an analyst",
                    "A report that is sent to a person at the end of the workflow",
                  ],
                  correct: 1,
                  explanation:
                    "A human-in-the-loop step is a deliberate pause in an automated workflow to allow for human judgment or approval for high-impact actions.",
                },
                {
                  id: 4,
                  question:
                    "What is the primary technological enabler for security orchestration?",
                  options: [
                    "Fast CPUs in the SIEM",
                    "A large amount of log storage",
                    "Security tools that have well-documented APIs",
                    "A reliable email server",
                  ],
                  correct: 2,
                  explanation:
                    "Orchestration relies entirely on the ability of the SOAR platform to programmatically control other security tools. This is only possible if those tools provide functional Application Programming Interfaces (APIs).",
                },
                {
                  id: 5,
                  question:
                    "In the orchestra analogy, the SOAR platform is the ____, and the individual security tools are the ____.",
                  options: [
                    "'composer' / 'music'",
                    "'conductor' / 'musicians'",
                    "'audience' / 'performers'",
                    "'stage' / 'instruments'",
                  ],
                  correct: 1,
                  explanation:
                    "This analogy perfectly captures the relationship: the SOAR platform (conductor) directs and coordinates the actions of the individual tools (musicians) to create a cohesive response (the symphony).",
                },
              ],
            },
          },
          {
            id: "lesson-20-siem-admin",
            title: "Lesson 20: SIEM Administration",
            duration: "120 min",
            objectives: [
              "Understand best practices for user access management (RBAC)",
              "Learn methods for SIEM backup and recovery",
              "Grasp the importance of SIEM platform patch management",
              "Perform common SIEM administrative and health-check tasks",
            ],
            content: {
              overview:
                "Keeping the SIEM platform healthy, secure, and available is a critical job in itself. This lesson covers the essential administrative tasks required to manage a SIEM, including user access, backups, patching, and routine health checks to ensure the platform remains a reliable foundation for the SOC.",
              sections: [
                {
                  title: "User Access Management",
                  content:
                    "<p>Proper user access control is fundamental to securing the SIEM itself. The principle of least privilege should be strictly enforced using Role-Based Access Control (RBAC).</p><h3>RBAC Best Practices:</h3><ul><li><strong>Roles:</strong> Define roles based on job function, not individuals. Common roles include: `SOC Analyst` (can search data and manage alerts), `SIEM Engineer` (can manage data inputs and configurations), `Auditor` (read-only access to specific compliance data), `Administrator` (full control).</li><li><strong>Index-level Access:</strong> Control which roles can search which indexes. For example, general SOC analysts may not have access to the index containing sensitive HR data, which is reserved for insider threat specialists.</li><li><strong>Capabilities:</strong> Define fine-grained permissions or 'capabilities' for each role. For example, an analyst role might be granted the ability to run searches but not the ability to install new applications.</li><li><strong>Single Sign-On (SSO):</strong> Integrate the SIEM with an enterprise identity provider (like Azure AD or Okta) using SAML or OpenID Connect for centralized and multi-factor authentication.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Audit the Auditors</strong></div><p>The SIEM's own internal audit logs are a critical data source. They record every search run, every configuration change, and every login attempt. Monitor these logs to ensure the SIEM is being used appropriately.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1554224155-83e8b835d07a?w=800&h=400&fit=crop",
                },
                {
                  title: "Backup and Recovery",
                  content:
                    "<p>A comprehensive backup strategy is essential to recover from hardware failure, data corruption, or even a ransomware attack on the SIEM itself.</p><h3>What to Back Up:</h3><ul><li><strong>Configuration Files:</strong> The most important piece. This includes all app configurations, saved searches, dashboards, user roles, parsing logic, etc. These should be backed up frequently. Many organizations store these in a Git repository for version control.</li><li><strong>Indexed Data:</strong> The raw and indexed log data. Given the volume, these are often backed up to cheaper storage tiers or via storage-level snapshots. A full data restore is a lengthy process, which is why HA replication is preferred for operational continuity.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>HA is Not a Backup</strong></div><p>High Availability and replication protect against hardware failure. They do *not* protect against an administrator accidentally deleting a critical configuration, as that deletion would be dutifully replicated to all the other nodes. You still need traditional backups.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1579548122216-3841a12d1b5a?w=800&h=400&fit=crop",
                },
                {
                  title: "Patch Management",
                  content:
                    "<p>Like any other enterprise software, the SIEM platform and its underlying operating system have vulnerabilities that must be patched. Keeping the SIEM itself secure is paramount.</p><h3>Patching Strategy:</h3><ol><li><strong>Stay Informed:</strong> Subscribe to security advisories from your SIEM vendor.</li><li><strong>Test in a Lab:</strong> Before applying any patch to production, deploy it in a non-production (lab/dev) environment to test for any regressions or performance issues.</li><li><strong>Follow a Rolling Process:</strong> In a clustered environment, apply patches in a rolling fashion. For example, take one indexer out of the cluster, patch it, restart it, validate it, and then move to the next. This ensures the service remains available during the upgrade.</li><li><strong>Document:</strong> Record all patching activities in a change management system.</li></ol><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Don't Forget the OS and Apps</strong></div><p>The patch management plan must cover the SIEM software, any apps and add-ons installed on it, the underlying server operating system, and any supporting components like the Java runtime.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1605152334438-6b3a69a4891e?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Splunk: Role Definition in authorize.conf (Simplified)",
                language: "ini",
                code: "[role_soc_analyst]\n# Grant read access to OS and Network logs\nsearchIndexes = os_logs;network_logs\n\n# Deny access to HR data\nsearchIndexesAllowed = \nsearchIndexesDefault = \n\n# Grant the ability to run scripts and view dashboards\n-run_script = enabled\n-edit_view = enabled\n\n# Deny the ability to install apps\n-install_apps = disabled",
              },
              {
                title: "Linux: Script to Back Up Splunk Configurations",
                language: "bash",
                code: "#!/bin/bash\n\nSPLUNK_ETC=/opt/splunk/etc\nBACKUP_DIR=/opt/splunk/backups\n\n# Create a timestamped tarball of the configuration directories\ntar -czf $BACKUP_DIR/splunk_etc_$(date +%F).tar.gz $SPLUNK_ETC/apps $SPLUNK_ETC/users $SPLUNK_ETC/system/local\n\n# Optional: Push backup to cloud storage\n# aws s3 cp $BACKUP_DIR/splunk_etc_$(date +%F).tar.gz s3://my-splunk-backups/",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "The security principle that states a user should only have the minimum permissions necessary to perform their job is called:",
                  options: [
                    "High Availability",
                    "Defense in Depth",
                    "The Principle of Least Privilege",
                    "Disaster Recovery",
                  ],
                  correct: 2,
                  explanation:
                    "The Principle of Least Privilege is a foundational concept in access control, and it should be enforced in the SIEM via Role-Based Access Control (RBAC).",
                },
                {
                  id: 2,
                  question:
                    "High Availability (HA) protects against data loss from _____, while backups protect against data loss from _____.",
                  options: [
                    "accidental deletion / hardware failure",
                    "hardware failure / accidental deletion",
                    "slow searches / power outages",
                    "power outages / slow searches",
                  ],
                  correct: 1,
                  explanation:
                    "HA protects against component failure by replicating data. If you accidentally delete a configuration, HA will replicate that deletion. Only a backup can restore the accidentally deleted item.",
                },
                {
                  id: 3,
                  question:
                    "Before applying a major patch to your production SIEM cluster, what is the most important step?",
                  options: [
                    "Notify all users of the impending downtime",
                    "Test the patch thoroughly in a non-production lab environment",
                    "Increase the SIEM's license capacity",
                    "Immediately apply it to all servers at once",
                  ],
                  correct: 1,
                  explanation:
                    "Testing patches in a lab environment is critical to ensure they don't cause unexpected issues or performance degradation in the production system.",
                },
                {
                  id: 4,
                  question:
                    "Using a central identity provider like Azure AD to manage logins to the SIEM is an example of:",
                  options: [
                    "Role-Based Access Control (RBAC)",
                    "Single Sign-On (SSO) integration",
                    "Patch Management",
                    "Summary Indexing",
                  ],
                  correct: 1,
                  explanation:
                    "SSO integration centralizes user authentication, making it easier to enforce policies like Multi-Factor Authentication (MFA) and to deprovision user access when they leave the organization.",
                },
                {
                  id: 5,
                  question:
                    "To monitor for misuse of the SIEM itself, an administrator should analyze what data source?",
                  options: [
                    "The SIEM's internal audit logs",
                    "Firewall logs",
                    "Windows Event Logs",
                    "The corporate HR database",
                  ],
                  correct: 0,
                  explanation:
                    "The SIEM's own logs (often called `_internal` in Splunk or the equivalent) provide a complete audit trail of every action performed within the platform and are essential for security and troubleshooting.",
                },
              ],
            },
          },
          {
            id: "lesson-21-network-monitoring",
            title: "Lesson 21: Network Security Monitoring",
            duration: "120 min",
            objectives: [
              "Integrate network traffic data (NetFlow, Zeek) into the SIEM",
              "Correlate firewall and IDS/IPS logs with other data sources",
              "Develop use cases for DNS monitoring and analysis",
              "Build detection rules for common network-based attacks",
            ],
            content: {
              overview:
                "This specialization lesson focuses on the network layer. We will cover how to leverage rich network data sources to gain deep visibility into traffic patterns, detect command-and-control channels, identify lateral movement, and hunt for anomalous network behaviors.",
              sections: [
                {
                  title: "Network Traffic Analysis",
                  content:
                    "<p>While firewall logs tell you what was allowed or blocked, network flow data and transaction logs provide much richer context about the actual conversations happening on your network.</p><h3>Key Data Sources:</h3><ul><li><strong>NetFlow/IPFIX:</strong> Flow data provides a summary of network connections (who talked to whom, when, for how long, and how much data was sent). It's great for baselining traffic patterns and detecting anomalies like data exfiltration.</li><li><strong>Zeek (formerly Bro):</strong> Zeek is a powerful network security monitor that goes beyond flow data. It parses application-layer protocols, providing detailed transaction logs for DNS, HTTP, SSL, and more. For example, it can log all HTTP headers or all certificates used in SSL sessions.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>PCAP is for Forensics</strong></div><p>Full packet capture (PCAP) contains too much data to be practical for long-term SIEM storage. Instead, forward high-value, summarized data from tools like NetFlow and Zeek to the SIEM, and pivot to PCAP for deep-dive forensics when an incident is detected.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1594917951231-98745c43d779?w=800&h=400&fit=crop",
                },
                {
                  title: "IDS/IPS Integration",
                  content:
                    "<p>Intrusion Detection/Prevention Systems (IDS/IPS) are designed to detect known attack patterns using signatures. Their alerts are a critical data source for the SIEM, but they must be put into context.</p><h3>Correlation is Key:</h3><p>An IDS alert on its own can be noisy. The real value comes from correlating it with other data points in the SIEM.</p><ul><li><strong>Example 1:</strong> An IDS alert fires for a 'SQL Injection Attempt'. Correlate the source IP from the IDS alert with your firewall logs. Is it an external IP? Correlate it with your web server access logs. Did the request result in a `500 Internal Server Error`? Now you have a high-confidence incident.</li><li><strong>Example 2:</strong> An IPS alert 'blocks' a malware download. Correlate that event with endpoint (EDR) logs. Did the file still get written to disk on the endpoint? The IPS may have been bypassed, and you need to investigate.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Enrich, Don't Just Alert</strong></div><p>Use IDS/IPS alerts to enrich other events. For example, if an IP triggers an IDS alert, automatically add that IP to a 'suspicious hosts' list in the SIEM for a period of 24 hours. Any further activity from that host can then be given a higher risk score.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1544890225-2fde1e46f71b?w=800&h=400&fit=crop",
                },
                {
                  title: "DNS Monitoring",
                  content:
                    "<p>DNS is the 'phonebook of the internet' and is used in nearly every stage of a cyber attack. Monitoring DNS traffic is one of the most effective ways to detect threats.</p><h3>Key DNS Use Cases:</h3><ul><li><strong>Known C2 Domains:</strong> Matching DNS queries against a threat intelligence feed of known malicious domains.</li><li><strong>Domain Generation Algorithms (DGA):</strong> Detecting queries for the long, random-looking domains generated by malware for C2 communication. This is often done with machine learning.</li><li><strong>DNS Tunneling:</strong> Looking for non-standard DNS query types and unusually long query names, which can indicate data being exfiltrated over the DNS protocol.</li><li><strong>New Domains:</strong> Identifying connections to domains that were registered within the last 24-48 hours, which is a common tactic for phishing and malware campaigns.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Encrypt Your DNS Traffic</strong></div><p>Enable DNS over HTTPS (DoH) or DNS over TLS (DoT) on your clients and forward all internal DNS queries to a centralized, monitored DNS resolver. This prevents attackers from easily snooping on or hijacking DNS requests.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1585149420381-f13a0429a1b4?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Query to Find Potential Data Exfiltration via NetFlow",
                language: "sql",
                code: '# Looks for internal hosts making large outbound connections to non-standard ports\nindex=netflow src_ip="10.0.0.0/8" dest_ip!="10.0.0.0/8"\n| search dest_port<1024 AND dest_port!=80 AND dest_port!=443\n| stats sum(bytes_out) as total_bytes by src_ip, dest_ip, dest_port\n| where total_bytes > 100000000 `comment("Over 100 MB")`',
              },
              {
                title: "Query to Detect DGA using Query Name Length (SPL)",
                language: "sql",
                code: 'index=dns sourcetype=stream:dns\n| eval query_length = len(query)\n| where query_length > 30 `comment("Legitimate domains are rarely this long")`\n| stats count, dc(query) as distinct_queries by src_ip\n| where distinct_queries > 10',
              },
              {
                title: "Query to Correlate IDS Alert with Web Logs",
                language: "sql",
                code: 'index=ids alert_signature="SQL Injection*" \n| join src_ip [ search index=web status=5* \n| fields src_ip, url, status ] \n| table _time, src_ip, dest_ip, alert_signature, url, status',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "Which network data source provides detailed, application-layer transaction logs for protocols like HTTP, DNS, and SSL?",
                  options: ["NetFlow", "PCAP", "Zeek (Bro)", "SNMP"],
                  correct: 2,
                  explanation:
                    "Zeek is a network analysis framework that parses application-layer protocols, providing far more detail than traditional NetFlow.",
                },
                {
                  id: 2,
                  question:
                    "Monitoring DNS logs for unusually long and random-looking hostnames is a method for detecting what?",
                  options: [
                    "Port Scanning",
                    "Domain Generation Algorithms (DGA)",
                    "SQL Injection",
                    "Brute force attacks",
                  ],
                  correct: 1,
                  explanation:
                    "Malware often uses DGAs to generate a large number of potential C2 domains, which have a characteristically random and long appearance.",
                },
                {
                  id: 3,
                  question:
                    "What is the most effective way to use IDS/IPS alerts in a SIEM?",
                  options: [
                    "To immediately block every IP that triggers any alert",
                    "To use them as the only source of truth for security events",
                    "To correlate them with other data sources (like endpoint and firewall logs) to add context",
                    "To ignore them because they are always false positives",
                  ],
                  correct: 2,
                  explanation:
                    "The true power of a SIEM is its ability to correlate data. An IDS alert becomes much more valuable when combined with context from other logs.",
                },
                {
                  id: 4,
                  question: "NetFlow data is primarily used for:",
                  options: [
                    "Capturing the full content of every packet",
                    "Providing a summary of network conversations (IPs, ports, bytes, duration)",
                    "Deep analysis of HTTP headers",
                    "Detecting malware signatures inside files",
                  ],
                  correct: 1,
                  explanation:
                    "NetFlow creates a 'summary record' for each network flow, making it excellent for high-level traffic analysis, baselining, and anomaly detection.",
                },
                {
                  id: 5,
                  question:
                    "Using the SIEM to look for an internal host connecting to 100 other internal hosts on port 445 within 5 minutes is an example of hunting for:",
                  options: [
                    "Data Exfiltration",
                    "A phishing attack",
                    "Lateral Movement",
                    "A zero-day exploit",
                  ],
                  correct: 2,
                  explanation:
                    "This behavior is characteristic of an attacker or worm scanning the network on the SMB port (445) to find other hosts to spread to, which is a classic lateral movement technique.",
                },
              ],
            },
          },
          {
            id: "lesson-22-endpoint-integration",
            title: "Lesson 22: Endpoint Detection Integration",
            duration: "120 min",
            objectives: [
              "Understand the importance of Endpoint Detection and Response (EDR) data",
              "Integrate EDR platform alerts and telemetry into the SIEM",
              "Leverage host-based data for threat hunting and incident response",
              "Design detection rules based on detailed endpoint telemetry",
            ],
            content: {
              overview:
                "The endpoint is where attacks execute. This lesson focuses on integrating rich telemetry from Endpoint Detection and Response (EDR) platforms into your SIEM. This provides unparalleled visibility into process execution, file modifications, registry changes, and network connections at the host level, enabling high-fidelity detection and rapid response.",
              sections: [
                {
                  title: "EDR Platform Integration",
                  content:
                    "<p>EDR platforms (like CrowdStrike, SentinelOne, or Microsoft Defender for Endpoint) are a cybersecurity solution that continuously monitors endpoints to detect and respond to advanced threats. Sending this data to the SIEM unlocks powerful correlation capabilities.</p><h3>Data Types from EDR:</h3><ul><li><strong>Alerts:</strong> High-fidelity detections from the EDR tool itself (e.g., 'Mimikatz detected in memory'). These should be treated as high-priority events in the SIEM.</li><li><strong>Telemetry:</strong> The raw, detailed event stream of everything happening on the host. This includes process creation, command-line arguments, file writes, registry modifications, and network connections for every single process. This data is invaluable for threat hunting.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>SIEM + EDR = Security Power Couple</strong></div><p>The SIEM sees the big picture (network, cloud, applications), and the EDR provides the ground truth of what happened on the host. Correlating these two sources (e.g., matching a suspicious network connection in the SIEM to the exact process that generated it in the EDR logs) is the foundation of modern threat detection.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1593106579243-d3b145b597c5?w=800&h=400&fit=crop",
                },
                {
                  title: "Host-Based Monitoring",
                  content:
                    "<p>EDR telemetry allows you to create extremely specific and powerful detection rules that are impossible with network logs alone.</p><h3>Key Use Cases:</h3><ul><li><strong>Living off the Land (LOLBAS):</strong> Detecting attackers using legitimate Windows binaries (like `PowerShell.exe`, `wmic.exe`, `certutil.exe`) for malicious purposes by analyzing their command-line arguments and parent processes.</li><li><strong>Fileless Malware Detection:</strong> EDR can see malicious code being executed directly in memory without ever being written to disk. The SIEM can alert on anomalous process behaviors associated with this.</li><li><strong>Ransomware Detection:</strong> Identifying the characteristic behaviors of ransomware, such as the rapid modification and encryption of thousands of files or the deletion of volume shadow copies (`vssadmin.exe delete shadows`).</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>The Power of the Parent-Child Relationship</strong></div><p>One of the most powerful hunting techniques is to analyze parent-child process relationships. For example, Microsoft Word (`winword.exe`) should never spawn PowerShell (`powershell.exe`). This is a huge red flag that a malicious macro is running.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1563206767-5b18f218e8de?w=800&h=400&fit=crop",
                },
                {
                  title: "Memory Analysis Integration",
                  content:
                    "<p>Some advanced threats are memory-resident and try to avoid leaving traces on the disk. While deep memory forensics is a specialized field, EDR and other tools can provide memory-based indicators to the SIEM.</p><h3>Indicators from Memory:</h3><ul><li><strong>Process Injection:</strong> A common technique where an attacker injects malicious code into a legitimate process to hide it. EDR can detect this and alert the SIEM.</li><li><strong>Credential Dumping:</strong> Tools like Mimikatz work by reading credentials directly from the memory of processes like LSASS. EDR has specific detections for this behavior.</li><li><strong>In-memory Shellcode:</strong> Detecting the execution of shellcode directly in memory, which is characteristic of many exploits.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>SOAR for Response</strong></div><p>EDR integration is a prime use case for SOAR. When the SIEM detects a threat on an endpoint, it can trigger a playbook that uses the EDR's API to automatically isolate the host from the network, preventing the threat from spreading while the investigation begins.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1550751827-4138d04d47ee?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Query for PowerShell Downloading a File",
                language: "sql",
                code: '# Living off the land detection\nindex=edr EventType=ProcessCreation ProcessName=powershell.exe\n| search CommandLine IN ("*DownloadFile*", "*DownloadString*", "*WebClient*")',
              },
              {
                title:
                  "Query for Deletion of Volume Shadow Copies (Ransomware Tactic)",
                language: "sql",
                code: '# Tactic to prevent system restore\nindex=edr EventType=ProcessCreation ProcessName=vssadmin.exe\n| search CommandLine IN ("*delete*", "*shadows*")',
              },
              {
                title:
                  "Query for Office Product Spawning a Shell (Malicious Macro)",
                language: "sql",
                code: '# Detects malicious macro execution\nindex=edr EventType=ProcessCreation\n| search ParentProcessName IN ("winword.exe", "excel.exe", "powerpnt.exe")\n| search ProcessName IN ("cmd.exe", "powershell.exe", "wscript.exe", "cscript.exe")',
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the primary value of integrating EDR telemetry into a SIEM?",
                  options: [
                    "It reduces the number of logs the SIEM has to store",
                    "It provides detailed host-level visibility into processes, files, and network connections",
                    "It automatically patches vulnerable software on endpoints",
                    "It replaces the need for firewall logs",
                  ],
                  correct: 1,
                  explanation:
                    "EDR provides the 'ground truth' of what is happening on an endpoint, which is essential for detecting advanced threats and investigating alerts seen at the network level.",
                },
                {
                  id: 2,
                  question:
                    "Detecting an attacker using `certutil.exe` to download malware is an example of what kind of detection?",
                  options: [
                    "Monitoring for 'Living off the Land' techniques",
                    "Network intrusion detection",
                    "Brute force detection",
                    "Cloud misconfiguration detection",
                  ],
                  correct: 0,
                  explanation:
                    "'Living off the Land' (LOLBAS) is the tactic of using legitimate, pre-installed system tools for malicious purposes to evade detection.",
                },
                {
                  id: 3,
                  question:
                    "Looking for instances of `winword.exe` (Microsoft Word) launching `powershell.exe` is a high-fidelity way to detect what?",
                  options: [
                    "A user updating their resume",
                    "A software bug in Microsoft Word",
                    "Execution of a malicious macro in a Word document",
                    "A system administrator running a script",
                  ],
                  correct: 2,
                  explanation:
                    "This parent-child process relationship is highly anomalous and a classic indicator that a malicious document has been opened and is executing code.",
                },
                {
                  id: 4,
                  question:
                    "What is the most effective automated response action following a high-confidence EDR alert in the SIEM?",
                  options: [
                    "Sending the user an email asking them to restart their computer",
                    "Using a SOAR playbook to call the EDR's API and isolate the host from the network",
                    "Running a vulnerability scan on the entire network",
                    "Increasing the log retention period",
                  ],
                  correct: 1,
                  explanation:
                    "Isolating the host via the EDR API is a swift and effective containment action that prevents the threat from spreading while allowing for forensic investigation.",
                },
                {
                  id: 5,
                  question:
                    "The detailed stream of process creation, registry modification, and network connection events from an EDR tool is known as:",
                  options: ["Alerts", "Signatures", "Telemetry", "Incidents"],
                  correct: 2,
                  explanation:
                    "Telemetry refers to the raw, granular data collected by the EDR agent, which is invaluable for threat hunting, while 'alerts' are the specific detections generated by the EDR platform itself.",
                },
              ],
            },
          },
          {
            id: "lesson-23-app-security-monitoring",
            title: "Lesson 23: Application Security Monitoring",
            duration: "120 min",
            objectives: [
              "Understand how to integrate Web Application Firewall (WAF) logs",
              "Develop use cases for analyzing application-specific logs",
              "Learn techniques for API security monitoring",
              "Detect common web application attacks like SQLi and XSS",
            ],
            content: {
              overview:
                "Applications are a primary target for attackers. This lesson focuses on monitoring the application layer, covering the ingestion and analysis of logs from Web Application Firewalls (WAFs), web servers, and custom applications to detect attacks against your software and APIs.",
              sections: [
                {
                  title: "Web Application Firewall (WAF) Integration",
                  content:
                    "<p>A WAF sits in front of web applications and inspects HTTP traffic to detect and block common web application attacks. Its logs are a critical data source for understanding threats targeting your applications.</p><h3>Key WAF Log Events:</h3><ul><li><strong>Blocked Attacks:</strong> Alerts for attacks the WAF successfully blocked, such as SQL Injection (SQLi), Cross-Site Scripting (XSS), and Remote Code Execution (RCE). Analyzing these shows who is targeting you and what techniques they are using.</li><li><strong>Traffic in 'Monitor' Mode:</strong> Even if a rule is not in blocking mode, the WAF will log when it is triggered. This is useful for tuning rules and detecting attacks without impacting legitimate traffic.</li><li><strong>Bot Detection:</strong> Logs related to malicious bots, credential stuffing attacks, and denial-of-service attempts.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Correlate with Web Server Logs</strong></div><p>Correlate WAF logs with your backend web server logs. Did the WAF block an SQLi attempt? Check the web and database logs to see if the malicious request still reached the server. This can help identify WAF bypass techniques.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1605379399642-870262d3d051?w=800&h=400&fit=crop",
                },
                {
                  title: "Application Log Analysis",
                  content:
                    '<p>Your own applications can be a rich source of security telemetry if they are built with logging in mind. Developers and security teams must work together to ensure applications log relevant security events.</p><h3>What to Log:</h3><ul><li><strong>Authentication Events:</strong> Log every successful and failed login attempt, password change, and MFA event. Include the source IP and user agent.</li><li><strong>Authorization Failures:</strong> Log any instance where a user attempts to access a function or data they are not authorized to view.</li><li><strong>Key Business Transactions:</strong> Log high-risk actions, such as a large financial transfer or a change in user permissions.</li><li><strong>Input Validation Failures:</strong> Log any user-supplied data that fails validation, as this could indicate an attack attempt.</li><li><strong>Unhandled Exceptions:</strong> A spike in server-side errors (HTTP 500) can indicate that an attacker is probing for vulnerabilities.</li></ul><div class=\'info-box note\'><div class=\'info-box-header\'><i class=\'fas fa-info-circle\'></i><strong>Structured Logging</strong></div><p>Encourage developers to use structured logging formats like JSON. A log that says `{"timestamp": "...", "event": "login_failure", "user": "admin", "ip": "1.2.3.4"}` is infinitely easier to parse and analyze in a SIEM than a plain text string.</p></div>',
                  image:
                    "https://images.unsplash.com/photo-1555099962-4199c345e541?w=800&h=400&fit=crop",
                },
                {
                  title: "API Security Monitoring",
                  content:
                    "<p>As applications increasingly rely on APIs, securing them becomes critical. API traffic can be monitored via logs from API gateways, web servers, or the application itself.</p><h3>Key API Threats to Monitor:</h3><ul><li><strong>Broken Object Level Authorization (BOLA):</strong> Detecting when a user tries to access a specific object they shouldn't (e.g., user `123` making an API call to `/api/v1/orders/456`). This requires logging both the authenticated user ID and the ID of the object being requested.</li><li><strong>Anomalous API Usage:</strong> Baselining normal API usage for each user or API key and alerting on deviations. For example, a key that normally makes 10 requests per hour suddenly makes 10,000 requests.</li><li><strong>Data Scraping:</strong> Identifying users or bots that are systematically iterating through API endpoints to download large amounts of data.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Shadow APIs</strong></div><p>A 'shadow API' is an API that is undocumented and unknown to the security team, often created by developers for a specific purpose. It's critical to have a discovery process to find all APIs and ensure their logs are being sent to the SIEM.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1596003906915-013661138ae2?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title:
                  "Query for a Single IP Triggering Multiple WAF Rule Types",
                language: "sql",
                code: "# Indicates an attacker probing for different vulnerabilities\nindex=waf\n| stats dc(rule_name) as unique_attack_types, values(rule_name) as attacks by src_ip\n| where unique_attack_types > 3",
              },
              {
                title: "Query for High Rate of Server-Side Errors (HTTP 500)",
                language: "sql",
                code: "# Can indicate probing or a failing application\nindex=web status=5*\n| stats count by url, src_ip\n| where count > 20",
              },
              {
                title: "Query for Potential BOLA Attack on an API",
                language: "sql",
                code: "# Requires application logs with authenticated_user_id and requested_object_owner_id\nindex=app_api sourcetype=api_access\n| where authenticated_user_id != requested_object_owner_id\n| stats count by authenticated_user_id, src_ip",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question:
                    "What is the primary function of a Web Application Firewall (WAF)?",
                  options: [
                    "To scan endpoint devices for malware",
                    "To inspect HTTP traffic to detect and block common web application attacks",
                    "To manage user passwords for web applications",
                    "To provide DNS services",
                  ],
                  correct: 1,
                  explanation:
                    "A WAF is a specialized firewall that operates at Layer 7 to protect against attacks like SQL Injection and Cross-Site Scripting.",
                },
                {
                  id: 2,
                  question:
                    "Encouraging developers to write logs in a format like JSON is an example of what?",
                  options: [
                    "Penetration Testing",
                    "Vulnerability Scanning",
                    "Structured Logging",
                    "Input Validation",
                  ],
                  correct: 2,
                  explanation:
                    "Structured logging uses a consistent, machine-readable format which makes parsing logs in a SIEM much easier and more reliable than parsing plain text strings.",
                },
                {
                  id: 3,
                  question:
                    "An alert that triggers when `user_A` successfully makes an API call to view the data of `user_B` is designed to detect which vulnerability?",
                  options: [
                    "Cross-Site Scripting (XSS)",
                    "Denial of Service (DoS)",
                    "Broken Object Level Authorization (BOLA)",
                    "SQL Injection",
                  ],
                  correct: 2,
                  explanation:
                    "BOLA is an access control vulnerability where an attacker can access data belonging to another user simply by changing an ID in the API request. Detecting it requires logging and comparing the authenticated user's ID with the owner ID of the requested resource.",
                },
                {
                  id: 4,
                  question:
                    "A sudden, massive spike in HTTP 500 'Internal Server Error' responses from a specific IP address could indicate what?",
                  options: [
                    "A successful login",
                    "Normal browsing activity",
                    "An attacker probing for vulnerabilities by sending malformed requests",
                    "The web server is being restarted",
                  ],
                  correct: 2,
                  explanation:
                    "Attackers often try to trigger unhandled exceptions to find vulnerabilities or learn more about the application's technology stack. A spike in 5xx errors is a strong indicator of such probing.",
                },
                {
                  id: 5,
                  question:
                    "Correlating WAF logs with backend web server and database logs helps to:",
                  options: [
                    "Increase the performance of the web application",
                    "Identify if a WAF rule was bypassed and the malicious traffic still reached its target",
                    "Manage SSL certificates",
                    "Control user access to the SIEM",
                  ],
                  correct: 1,
                  explanation:
                    "Correlation is key to verifying the effectiveness of your controls. The WAF might block an attack, but confirming in the server logs that the request was never processed provides a higher level of assurance and can help detect WAF bypasses.",
                },
              ],
            },
          },
          {
            id: "lesson-24-ics-monitoring",
            title: "Lesson 24: Industrial Control Systems (ICS) Monitoring",
            duration: "120 min",
            objectives: [
              "Understand the convergence of OT and IT environments and its security implications",
              "Learn about common ICS/SCADA data sources and protocols",
              "Develop use cases for monitoring industrial environments",
              "Explore challenges unique to ICS security monitoring",
            ],
            content: {
              overview:
                "This specialized lesson ventures into the world of Operational Technology (OT) and Industrial Control Systems (ICS). We will explore the unique challenges and strategies for monitoring the critical systems that control physical processes in sectors like manufacturing, energy, and utilities. ",
              sections: [
                {
                  title: "OT/IT Convergence Monitoring",
                  content:
                    "<p>Historically, OT networks (which run factories, power grids, etc.) were isolated ('air-gapped') from IT networks. Today, due to business needs, these networks are increasingly connected. This IT/OT convergence creates new risks, as threats from the IT side can now potentially impact physical systems.</p><h3>Key Monitoring Chokepoint:</h3><p>The primary focus of monitoring is the boundary between the IT and OT networks. All traffic passing through the firewall or demilitarized zone (DMZ) between these environments must be heavily scrutinized.</p><ul><li>Monitor for any unauthorized protocols attempting to cross the boundary.</li><li>Alert on any connections originating from the IT network to critical OT assets that are not on an approved whitelist.</li><li>Track any large data transfers from the OT network back to the IT network.</li></ul><div class='info-box tip'><div class='info-box-header'><i class='fas fa-lightbulb'></i><strong>Safety First</strong></div><p>In OT environments, the primary concerns are safety and availability. Security controls must be implemented in a way that does not risk disrupting critical physical processes. 'Do no harm' is the first rule.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1614113168853-39f1577f152d?w=800&h=400&fit=crop",
                },
                {
                  title: "SCADA System Integration",
                  content:
                    "<p>Supervisory Control and Data Acquisition (SCADA) systems are used to control and monitor industrial processes. Integrating logs from SCADA components into the SIEM provides visibility into the state of the OT environment.</p><h3>Key Data Sources:</h3><ul><li><strong>Human-Machine Interface (HMI):</strong> The graphical interface operators use to interact with the system. Logs can show commands issued, setpoint changes, and alarm acknowledgements.</li><li><strong>Engineering Workstations:</strong> The computers used to program and maintain the control systems. Monitor for any program downloads to Programmable Logic Controllers (PLCs).</li><li><strong>Historian:</strong> A database that logs all process data and sensor readings. Baselines of normal operational values can be established, and the SIEM can alert on deviations.</li></ul><div class='info-box note'><div class='info-box-header'><i class='fas fa-info-circle'></i><strong>Passive Monitoring is Key</strong></div><p>You cannot simply place a standard vulnerability scanner on an OT network; it could crash sensitive legacy equipment. Monitoring is often done passively, using sensors that listen to network traffic without actively polling devices.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1581092446346-b333a466a93b?w=800&h=400&fit=crop",
                },
                {
                  title: "Industrial Protocol Analysis",
                  content:
                    "<p>OT networks use specialized industrial protocols that are different from standard IT protocols like HTTP or SMB. To monitor them, you need tools that understand this traffic.</p><h3>Common Industrial Protocols:</h3><ul><li><strong>Modbus</strong></li><li><strong>DNP3</strong></li><li><strong>PROFINET</strong></li><li><strong>EtherNet/IP</strong></li></ul><h3>Monitoring Use Cases:</h3><ul><li><strong>Unauthorized Commands:</strong> Detecting specific dangerous commands, like a 'stop' command being sent to a PLC from an unauthorized source.</li><li><strong>Setpoint Changes:</strong> Alerting on any changes to critical process setpoints (e.g., pressure, temperature, speed) that originate from outside the approved engineering workstations.</li><li><strong>Firmware Changes:</strong> Identifying attempts to download new logic or firmware to a PLC, a common tactic for attackers seeking to manipulate a physical process.</li></ul><div class='info-box warning'><div class='info-box-header'><i class='fas fa-exclamation-triangle'></i><strong>Requires Specialized Tools</strong></div><p>Your standard IT network security tools do not understand industrial protocols. Monitoring OT networks requires specialized passive network sensors (from vendors like Dragos, Nozomi, or Claroty) that can parse these protocols and forward meaningful alerts to the enterprise SIEM.</p></div>",
                  image:
                    "https://images.unsplash.com/photo-1518457607833-85f02f37181c?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Use Case: Detecting Remote Desktop Login to an HMI",
                language: "markdown",
                code: "# Hypothesis: An attacker from the IT network uses RDP to gain access to a critical HMI in the OT network.\n# Data Sources: Firewall logs, Windows logs from the HMI.\n# Logic: ALERT IF (event.logon_type == 10 AND destination.asset_type == 'HMI' AND source.network == 'IT_Network') AND source.ip NOT IN approved_admin_list.",
              },
              {
                title: "Use Case: Unauthorized PLC Program Download",
                language: "markdown",
                code: "# Hypothesis: Malware on an engineering workstation is used to push a malicious program to a PLC.\n# Data Source: OT Network Security Monitoring Platform logs.\n# Logic: ALERT IF (protocol == 'Modbus' AND function_code == 6) OR (protocol == 'PROFINET' AND command == 'Program_Download') AND source.ip != engineering_workstation_IP.",
              },
            ],
            quiz: {
              passingScore: 75,
              questions: [
                {
                  id: 1,
                  question: "What does 'OT/IT Convergence' refer to?",
                  options: [
                    "The merging of two technology companies",
                    "The increasing connectivity between corporate (IT) and industrial (OT) networks",
                    "A new type of programming language",
                    "A compliance regulation for technology firms",
                  ],
                  correct: 1,
                  explanation:
                    "OT/IT convergence describes the trend of connecting previously isolated industrial control system networks to the corporate IT network, which introduces new security risks.",
                },
                {
                  id: 2,
                  question:
                    "In an OT environment, what are the highest priority concerns, often even above confidentiality?",
                  options: [
                    "System performance and user experience",
                    "Safety and availability of physical processes",
                    "Reducing software licensing costs",
                    "Data privacy",
                  ],
                  correct: 1,
                  explanation:
                    "The primary mission of an OT environment is to maintain safe and continuous physical operations. Security measures must not jeopardize this mission.",
                },
                {
                  id: 3,
                  question:
                    "Why is active vulnerability scanning generally forbidden in OT networks?",
                  options: [
                    "The protocols are all encrypted",
                    "It could crash sensitive, legacy equipment that controls physical processes",
                    "There are no vulnerabilities in OT systems",
                    "It consumes too much network bandwidth",
                  ],
                  correct: 1,
                  explanation:
                    "Many OT devices are not designed to handle unexpected network traffic and can fail in unpredictable ways if actively scanned, leading to potential safety issues. Therefore, passive monitoring is preferred.",
                },
                {
                  id: 4,
                  question:
                    "What kind of tool is required to understand and parse industrial protocols like Modbus and DNP3?",
                  options: [
                    "A standard firewall",
                    "A typical antivirus software",
                    "A specialized passive OT network security monitoring platform",
                    "A web application firewall",
                  ],
                  correct: 2,
                  explanation:
                    "Standard IT security tools do not have the capability to decode industrial protocols. This requires specialized OT visibility solutions.",
                },
                {
                  id: 5,
                  question:
                    "The computer an engineer uses to program a Programmable Logic Controller (PLC) is called a(n):",
                  options: [
                    "Historian",
                    "Human-Machine Interface (HMI)",
                    "Engineering Workstation",
                    "Demilitarized Zone (DMZ)",
                  ],
                  correct: 2,
                  explanation:
                    "The Engineering Workstation is a highly privileged and critical asset in an OT environment, as it can directly change the logic controlling physical machinery.",
                },
              ],
            },
          },
          {
            id: "lesson-25-capstone-project",
            title: "Lesson 25: Capstone Project",
            duration: "240 min",
            objectives: [
              "Apply learned skills to design and implement a SIEM solution for a fictional company",
              "Analyze a real-world breach scenario and use the SIEM to investigate",
              "Develop custom detection rules, dashboards, and reports based on the scenario",
              "Present findings and recommendations in a formal report",
            ],
            content: {
              overview:
                "This final lesson is a capstone project that brings everything you have learned together. You will be given a scenario for a fictional company and a dataset representing a multi-stage cyber attack. Your mission is to act as the lead SIEM engineer and analyst to onboard the data, investigate the breach, build detections, and report on the incident.",
              sections: [
                {
                  title: "Scenario: ACME Innovations Inc.",
                  content:
                    "<p><strong>Company Profile:</strong> ACME Innovations is a mid-sized tech company with a standard corporate network, a public-facing web application, and a small cloud presence in AWS. You have been hired to set up their new SIEM and investigate a suspected breach.</p><h3>Provided Resources:</h3><ul><li><strong>Log Data:</strong> You will be given a large set of log files, including: firewall logs, Windows endpoint logs (Sysmon), web server logs, AWS CloudTrail logs, and custom application logs.</li><li><strong>Network Diagram:</strong> A high-level diagram of the ACME network architecture.</li><li><strong>Asset Inventory:</strong> A list of critical servers and their functions.</li></ul>",
                  image:
                    "https://images.unsplash.com/photo-1519389950473-47ba0277781c?w=800&h=400&fit=crop",
                },
                {
                  title: "Phase 1: SIEM Implementation & Data Onboarding",
                  content:
                    "<p>In this phase, you will configure your lab SIEM (Splunk or ELK) to ingest and process the provided data.</p><h3>Tasks:</h3><ol><li><strong>Data Ingestion:</strong> Set up the necessary inputs to ingest all the provided log files.</li><li><strong>Parsing & Normalization:</strong> Ensure the logs are parsed correctly, extracting key fields.</li><li><strong>CIM Compliance:</strong> Create the necessary field aliases and tags to make the Windows, firewall, and web data compliant with the relevant Common Information Models (Authentication, Network_Traffic, etc.).</li><li><strong>Build Foundational Dashboards:</strong> Create a basic security overview dashboard showing login activity, firewall traffic, and web server errors.</li></ol>",
                  image:
                    "https://images.unsplash.com/photo-1498050108023-c5249f4df085?w=800&h=400&fit=crop",
                },
                {
                  title: "Phase 2: Incident Investigation & Threat Hunting",
                  content:
                    "<p>A high-level alert has indicated suspicious activity. Using the data you've onboarded, your task is to investigate the full scope of the attack, from initial access to final impact.</p><h3>Guiding Questions:</h3><ul><li>How did the attacker gain initial access? (Look at web logs, firewall logs)</li><li>What actions did they perform on the first compromised host? (Look at endpoint logs)</li><li>How did they move laterally to other systems? (Look for suspicious host-to-host connections)</li><li>Did they escalate their privileges?</li><li>Did they exfiltrate any data? If so, how?</li><li>You are expected to use threat hunting techniques to find activity not triggered by existing alerts. Create a timeline of the incident.</li></ul>",
                  image:
                    "https://images.unsplash.com/photo-1614064548237-02f8f17374b2?w=800&h=400&fit=crop",
                },
                {
                  title: "Phase 3: Content Development & Reporting",
                  content:
                    "<p>Based on your investigation, you must improve ACME's defenses by building new detections and presenting your findings.</p><h3>Tasks:</h3><ol><li><strong>Create New Detection Rules:</strong> For each of the attacker's TTPs you identified, create a new, high-fidelity correlation rule in the SIEM to detect it automatically in the future.</li><li><strong>Build an Incident Response Dashboard:</strong> Create a new dashboard specifically designed to display the key indicators and timeline related to this incident.</li><li><strong>Write a Final Report:</strong> Prepare a formal incident report that includes an executive summary, a detailed timeline of the attack, your findings, the detection gaps you identified, and recommendations for security improvements.</li></ol>",
                  image:
                    "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=800&h=400&fit=crop",
                },
              ],
            },
            codeExamples: [
              {
                title: "Project Deliverable 1: Sample CIM Compliance Check",
                language: "sql",
                code: '| tstats summariesonly=true count from datamodel=Network_Traffic by sourcetype\n| `comment("This query should show counts for your newly onboarded firewall data after making it CIM compliant.")`',
              },
              {
                title: "Project Deliverable 2: Sample Incident Timeline Entry",
                language: "markdown",
                code: "| Timestamp           | Tactic              | Technique                           | Finding                                     |\n|---------------------|---------------------|-------------------------------------|---------------------------------------------|\n| 2023-10-27T10:30:01 | Initial Access      | T1190: Exploit Public-Facing App  | Attacker exploited vulnerability in web app |\n| 2023-10-27T10:35:15 | Execution           | T1059: Command-Line Interface     | Web server spawned a command shell          |",
              },
              {
                title:
                  "Project Deliverable 3: Sample New Detection Rule (Pseudocode)",
                language: "sql",
                code: "# Detection for Web Shell Behavior\n# ATT&CK ID: T1505.003\nALERT web_server_spawns_shell on (index=endpoint)\nIF ParentProcessName is in ('w3wp.exe', 'httpd', 'nginx')\nAND ProcessName is in ('cmd.exe', 'powershell.exe', '/bin/bash')\nTHEN create 'High Priority Alert'",
              },
            ],
            quiz: {
              passingScore: 100,
              questions: [
                {
                  id: 1,
                  question: "The primary goal of the capstone project is to:",
                  options: [
                    "Memorize SIEM vendor documentation",
                    "Apply the comprehensive skills learned throughout the course to a realistic scenario",
                    "Learn a new programming language",
                    "Develop a new type of firewall",
                  ],
                  correct: 1,
                  explanation:
                    "The capstone project is designed to be a practical application of all the skills learned, from data onboarding and analysis to incident response and reporting.",
                },
              ],
            },
          },
        ],
      };
      // =====================================================
      // GLOBAL VARIABLES
      // =====================================================
      let currentUser = null;
      let currentLessonIndex = 0;
      let courseProgress = {};
      let userStats = {};
      let quizState = {
        currentQuestion: 0,
        answers: [],
        score: 0,
        isComplete: false,
      };

      // Enhanced session tracking
      let courseSession = {
        startTime: null,
        totalStudyTime: 0,
        lessonsStarted: 0,
        lessonsCompleted: 0,
        pageLoadTime: new Date(),
        interactionCount: 0,
        lastActivityTime: new Date(),
      };

      // Music Player Variables
      let audioPlayer = new Audio();

      // Achievement notification system
      let notificationQueue = [];
      let isShowingNotification = false;

      // =====================================================
      // INITIALIZATION
      // =====================================================
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          showLoadingScreen();
          await checkAuth();

          if (currentUser) {
            // Initialize session tracking
            startCourseSession();

            // Load course data and progress
            await loadCourseData();
            await loadUserProfile();
            await loadProgress();

            // Initialize UI
            initializeEventListeners();
            renderSidebar();
            loadLesson(currentLessonIndex);

            // Initialize additional features
            initMusicPlayer();
            addMusicIndicator();
            initializeActivityTracking();

            hideLoadingScreen();
          } else {
            openAuthModal();
          }
        } catch (error) {
          console.error("Error initializing course:", error);
          hideLoadingScreen();
          showToast("Failed to initialize course system", "error");
        }
      });

      // =====================================================
      // AUTHENTICATION SYSTEM
      // =====================================================
      async function checkAuth() {
        try {
          const {
            data: { session },
            error,
          } = await supabase.auth.getSession();

          if (error) {
            console.error("Auth error:", error);
            currentUser = null;
            openAuthModal();
            return;
          }

          if (!session) {
            currentUser = null;
            openAuthModal();
            return;
          }

          currentUser = session.user;
          updateUIWithUser();
        } catch (error) {
          console.error("Error checking auth:", error);
          currentUser = null;
          openAuthModal();
        }
      }

      function updateUIWithUser() {
        if (!currentUser) return;

        const name =
          currentUser.user_metadata?.full_name ||
          currentUser.email.split("@")[0];
        const userElements = document.querySelectorAll("[data-user-name]");
        userElements.forEach((el) => (el.textContent = name));
      }

      // =====================================================
      // USER PROFILE & STATS MANAGEMENT
      // =====================================================
      async function loadUserProfile() {
        try {
          // 🔍 Step 1: Try to fetch existing profile
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", currentUser.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (!profile) {
            // 🆕 Step 2: Create new profile if missing
            await createUserProfile();
          } else {
            // ✅ Step 3: Use existing profile
            userStats = profile;
            await updateLastActivity();
          }
        } catch (error) {
          console.error("❌ Error loading user profile:", error);
          showToast("Failed to load user profile", "error");
        }
      }
      async function createUserProfile() {
        try {
          const newProfile = {
            id: currentUser.id,
            full_name: currentUser.user_metadata?.full_name || "",
            email: currentUser.email,
            level: "Script Kiddie",
            total_points: 0,
            completed_courses: 0,
            current_streak: 0,
            total_certificates: 0,
            total_achievements: 0,
            sections_visited: 0,
            bonus_points: 0,
            in_progress_courses: 0,
            settings_changed: 0,
            midnight_sessions: 0,
            early_sessions: 0,
            weekend_sessions: 0,
            last_activity: new Date().toISOString(),
            created_at: new Date().toISOString(),
          };

          const { error } = await supabase
            .from("profiles")
            .insert([newProfile]);

          if (!error) {
            userStats = newProfile;
            // Award first login achievement
            setTimeout(() => checkAndUnlockAchievement("first_login"), 1000);
          }
        } catch (error) {
          console.error("Error creating user profile:", error);
        }
      }

      async function updateLastActivity() {
        try {
          const now = new Date();

          // Update activity tracking
          courseSession.lastActivityTime = now;

          // Update database
          await supabase
            .from("profiles")
            .update({
              last_activity: now.toISOString(),
            })
            .eq("id", currentUser.id);

          // Check time-based achievements
          await checkTimeBasedAchievements(now);
        } catch (error) {
          console.error("Error updating last activity:", error);
        }
      }

      // =====================================================
      // COURSE SESSION MANAGEMENT
      // =====================================================
      function startCourseSession() {
        courseSession.startTime = new Date();
        courseSession.pageLoadTime = new Date();

        logUserActivity("course_session_start", {
          course_id: COURSE_DATA.id,
          course_title: COURSE_DATA.title,
          user_agent: navigator.userAgent,
          screen_resolution: `${screen.width}x${screen.height}`,
        });

        // Check daily streak
        checkDailyStreak();
      }

      function initializeActivityTracking() {
        // Track page focus/blur for accurate study time
        document.addEventListener("visibilitychange", handleVisibilityChange);

        // Track user interactions
        ["click", "keydown", "scroll", "mousemove"].forEach((event) => {
          document.addEventListener(event, trackUserInteraction, {
            passive: true,
          });
        });

        // Periodic activity updates
        setInterval(updateStudyTime, 60000); // Every minute

        // Save session data before page unload
        window.addEventListener("beforeunload", saveSessionData);
      }

      function handleVisibilityChange() {
        if (document.hidden) {
          courseSession.lastActivityTime = new Date();
        } else {
          // Page became visible again - update activity
          updateLastActivity();
        }
      }

      function trackUserInteraction() {
        courseSession.interactionCount++;
        courseSession.lastActivityTime = new Date();

        // Throttle activity updates
        if (courseSession.interactionCount % 50 === 0) {
          updateLastActivity();
        }
      }

      function updateStudyTime() {
        if (!courseSession.startTime || document.hidden) return;

        const now = new Date();
        const sessionDuration = now - courseSession.startTime;
        courseSession.totalStudyTime = Math.floor(sessionDuration / 1000 / 60); // in minutes

        // Update progress with study time
        saveProgress();
      }

      function saveSessionData() {
        if (!currentUser || !courseSession.startTime) return;

        const sessionData = {
          user_id: currentUser.id,
          course_id: COURSE_DATA.id,
          session_duration: courseSession.totalStudyTime,
          lessons_viewed: courseSession.lessonsStarted,
          lessons_completed: courseSession.lessonsCompleted,
          interactions: courseSession.interactionCount,
          session_date: courseSession.startTime.toISOString().split("T")[0],
        };

        // Store in localStorage as backup
        localStorage.setItem(
          "course_session_backup",
          JSON.stringify(sessionData)
        );

        // Try to save to database
        logUserActivity("course_session_end", sessionData);
      }

      // =====================================================
      // COURSE DATA & PROGRESS MANAGEMENT
      // =====================================================
      async function loadCourseData() {
        try {
          // Update course info in UI
          document.getElementById("courseTitle").textContent =
            COURSE_DATA.title;
          document.getElementById("totalLessons").textContent =
            COURSE_DATA.lessons.length;

          // Log course access
          logUserActivity("course_access", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
          });
        } catch (error) {
          console.error("Error loading course data:", error);
        }
      }

      async function loadProgress() {
        try {
          // Get existing progress from database
          const { data, error } = await supabase
            .from("course_progress")
            .select("*")
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (data) {
            courseProgress = JSON.parse(data.lesson_progress || "{}");
            currentLessonIndex = data.current_lesson || 0;

            // Update session tracking
            courseSession.lessonsStarted = Object.keys(courseProgress).length;
            courseSession.lessonsCompleted = Object.values(
              courseProgress
            ).filter((p) => p.completed).length;
          } else {
            // Initialize new progress
            courseProgress = {};
            currentLessonIndex = 0;
            await saveProgress();

            // Award first course start achievement
            await checkAndUnlockAchievement("first_course_start");
          }

          updateProgressDisplay();
        } catch (error) {
          console.error("Error loading progress:", error);
          showToast("Failed to load progress", "error");
        }
      }

      async function saveProgress() {
        try {
          if (!currentUser) return;

          const now = new Date();
          const progressData = {
            user_id: currentUser.id,
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            current_lesson: currentLessonIndex,
            lesson_progress: JSON.stringify(courseProgress),
            progress: calculateOverallProgress(),
            lessons_completed: getCompletedLessonsCount(),
            lessons_started: Object.keys(courseProgress).length,
            study_time_minutes: courseSession.totalStudyTime,
            last_accessed: now.toISOString(),
            updated_at: now.toISOString(),
          };

          // Upsert progress
          const { error } = await supabase
            .from("course_progress")
            .upsert([progressData]);

          if (error) throw error;

          // Update user stats
          await updateUserStats();

          updateProgressDisplay();
        } catch (error) {
          console.error("Error saving progress:", error);
          showToast("Failed to save progress", "error");
        }
      }

      async function updateUserStats() {
        try {
          // Get all course progress for this user
          const { data: allProgress, error } = await supabase
            .from("course_progress")
            .select("progress, course_id, study_time_minutes")
            .eq("user_id", currentUser.id);

          if (error) throw error;

          // Calculate stats
          const completedCourses =
            allProgress?.filter((p) => p.progress >= 100).length || 0;
          const inProgressCourses =
            allProgress?.filter((p) => p.progress > 0 && p.progress < 100)
              .length || 0;
          const totalStudyTime =
            allProgress?.reduce(
              (sum, p) => sum + (p.study_time_minutes || 0),
              0
            ) || 0;

          // Calculate points (500 per completed course + achievement points)
          const coursePoints = completedCourses * 500;
          const bonusPoints = userStats.bonus_points || 0;
          const totalPoints = coursePoints + bonusPoints;

          // Update profile
          const updateData = {
            completed_courses: completedCourses,
            in_progress_courses: inProgressCourses,
            total_points: totalPoints,
            total_study_time: totalStudyTime,
            last_activity: new Date().toISOString(),
          };

          const { error: updateError } = await supabase
            .from("profiles")
            .update(updateData)
            .eq("id", currentUser.id);

          if (updateError) throw updateError;

          // Update local stats
          Object.assign(userStats, updateData);
        } catch (error) {
          console.error("Error updating user stats:", error);
        }
      }

      function calculateOverallProgress() {
        const completedLessons = getCompletedLessonsCount();
        return Math.round(
          (completedLessons / COURSE_DATA.lessons.length) * 100
        );
      }

      function getCompletedLessonsCount() {
        return Object.values(courseProgress).filter(
          (lesson) => lesson.completed
        ).length;
      }

      function updateProgressDisplay() {
        const completedCount = getCompletedLessonsCount();
        const progressPercent = calculateOverallProgress();

        // Update UI elements
        const elements = {
          completedLessons: completedCount,
          courseProgressPercent: `${progressPercent}%`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });

        // Update progress bar
        const progressBar = document.getElementById("courseProgressFill");
        if (progressBar) progressBar.style.width = `${progressPercent}%`;
      }

      // =====================================================
      // LESSON MANAGEMENT
      // =====================================================
      function loadLesson(index) {
        if (index < 0 || index >= COURSE_DATA.lessons.length) return;

        const lesson = COURSE_DATA.lessons[index];
        currentLessonIndex = index;

        // Mark lesson as started and track activity
        if (!courseProgress[lesson.id]) {
          courseProgress[lesson.id] = {
            started: true,
            completed: false,
            startedAt: new Date().toISOString(),
            timeSpent: 0,
          };

          courseSession.lessonsStarted++;
          saveProgress();

          // Log lesson start
          logUserActivity("lesson_start", {
            lesson_id: lesson.id,
            lesson_title: lesson.title,
            lesson_index: index,
          });
        }

        // Update lesson start time for time tracking
        courseProgress[lesson.id].currentSessionStart = new Date();

        // Update sidebar and navigation
        renderSidebar();
        updateNavigationButtons();

        // Update header info
        updateLessonHeader(lesson, index);

        // Render lesson content
        renderLessonContent(lesson);

        // Smooth scroll and animations
        window.scrollTo({ top: 0, behavior: "smooth" });
        document.getElementById("contentBody").scrollTop = 0;

        const contentBody = document.getElementById("contentBody");
        contentBody.classList.add("fade-in");
        setTimeout(() => contentBody.classList.remove("fade-in"), 500);

        // Check lesson-based achievements
        checkLessonAchievements(index + 1);
      }

      function updateLessonHeader(lesson, index) {
        const elements = {
          currentLessonNumber: index + 1,
          currentLessonTitle: lesson.title,
          navInfo: `Lesson ${index + 1} of ${COURSE_DATA.lessons.length}`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });
      }

      function renderSidebar() {
        const lessonNav = document.getElementById("lessonNav");
        if (!lessonNav) return;

        lessonNav.innerHTML = "";

        COURSE_DATA.lessons.forEach((lesson, index) => {
          const lessonItem = document.createElement("div");
          lessonItem.className = "lesson-item";

          // Determine lesson status
          const lessonProgress = courseProgress[lesson.id];
          const isCompleted = lessonProgress?.completed || false;
          const isInProgress = lessonProgress?.started || false;
          const isLocked = !isCompleted && !canAccessLesson(index);
          const isActive = index === currentLessonIndex;

          // Apply status classes
          if (isCompleted) lessonItem.classList.add("completed");
          if (isLocked) lessonItem.classList.add("locked");
          if (isActive) lessonItem.classList.add("active");

          // Determine status display
          let statusClass = "not-started";
          let statusIcon = index + 1;

          if (isCompleted) {
            statusClass = "completed";
            statusIcon = "✓";
          } else if (isInProgress) {
            statusClass = "in-progress";
            statusIcon = "◐";
          }

          // Create lesson item HTML
          lessonItem.innerHTML = `
            <div class="lesson-status ${statusClass}">${statusIcon}</div>
            <div class="lesson-info">
                <div class="lesson-title">${lesson.title}</div>
                <div class="lesson-meta">
                    ${
                      isCompleted
                        ? "Completed"
                        : isInProgress
                        ? "In Progress"
                        : isLocked
                        ? "Locked"
                        : "Not Started"
                    }
                </div>
            </div>
            <div class="lesson-duration">${lesson.duration}</div>
        `;

          // Add click handler if not locked
          if (!isLocked) {
            lessonItem.addEventListener("click", () => {
              if (index !== currentLessonIndex) {
                // Track lesson time before switching
                trackLessonTime();

                currentLessonIndex = index;
                loadLesson(index);
                closeSidebar();
              }
            });
          }

          lessonNav.appendChild(lessonItem);
        });
      }

      function canAccessLesson(index) {
        if (index === 0) return true; // First lesson always accessible

        // Can access if previous lesson is completed
        const previousLessonId = COURSE_DATA.lessons[index - 1].id;
        return courseProgress[previousLessonId]?.completed || false;
      }

      function trackLessonTime() {
        const currentLesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonProgress = courseProgress[currentLesson.id];

        if (lessonProgress?.currentSessionStart) {
          const sessionTime = Math.floor(
            (new Date() - new Date(lessonProgress.currentSessionStart)) /
              1000 /
              60
          );
          lessonProgress.timeSpent =
            (lessonProgress.timeSpent || 0) + sessionTime;
          delete lessonProgress.currentSessionStart;
        }
      }

      // =====================================================
      // LESSON CONTENT RENDERING
      // =====================================================
      function renderLessonContent(lesson) {
        const contentContainer = document.getElementById("lessonContent");
        if (!contentContainer) return;

        let contentHTML = `
        <div class="content-section">
            <h2>Learning Objectives</h2>
            <ul>
                ${lesson.objectives.map((obj) => `<li>${obj}</li>`).join("")}
            </ul>
        </div>
        
        <div class="content-section">
            <h2>Overview</h2>
            <p>${lesson.content.overview}</p>
        </div>
    `;

        // Render content sections
        lesson.content.sections.forEach((section) => {
          contentHTML += `
            <div class="content-section">
                <h2>${section.title}</h2>
                ${section.content}
                ${
                  section.image
                    ? `<img src="${section.image}" alt="${section.title}" class="content-image" loading="lazy">`
                    : ""
                }
            </div>
        `;
        });

        // Render code examples
        if (
          lesson.content.codeExamples &&
          lesson.content.codeExamples.length > 0
        ) {
          contentHTML += `<div class="content-section"><h2>Code Examples</h2></div>`;

          lesson.content.codeExamples.forEach((example, index) => {
            const codeId = `code-${lesson.id}-${index}`;
            contentHTML += `
                <div class="code-section">
                    <div class="code-header">
                        <span class="code-title">${example.title}</span>
                        <button class="copy-btn" onclick="copyCode('${codeId}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <pre class="code-block"><code id="${codeId}" class="language-${
              example.language
            }">${escapeHtml(example.code)}</code></pre>
                </div>
            `;
          });
        }

        // Render quiz
        contentHTML += renderQuiz(lesson.quiz);

        contentContainer.innerHTML = contentHTML;

        // Highlight code syntax if Prism is available
        setTimeout(() => {
          if (window.Prism) {
            Prism.highlightAll();
          }
        }, 100);
      }

      // =====================================================
      // QUIZ SYSTEM
      // =====================================================
      function renderQuiz(quiz) {
        const currentLessonProgress =
          courseProgress[COURSE_DATA.lessons[currentLessonIndex].id];
        const isCompleted = currentLessonProgress?.completed || false;

        let quizHTML = `
        <div class="quiz-section" id="quizSection">
            <div class="quiz-header">
                <h2 class="quiz-title">
                    <i class="fas fa-clipboard-check"></i>
                    Knowledge Check
                </h2>
                <p class="quiz-info">
                    Complete this quiz with ${quiz.passingScore}% or higher to unlock the next lesson.
                </p>
            </div>
    `;

        if (isCompleted) {
          const savedScore = currentLessonProgress.quizScore || 0;
          quizHTML += `
            <div class="quiz-results show">
                <div class="quiz-score pass">${savedScore}%</div>
                <div class="quiz-message">
                    <strong>Lesson Completed!</strong><br>
                    You've successfully passed this lesson's quiz.
                </div>
            </div>
        `;
        } else {
          // Render quiz questions
          quiz.questions.forEach((question, qIndex) => {
            quizHTML += `
                <div class="quiz-question ${
                  qIndex === 0 ? "active" : ""
                }" data-question="${qIndex}">
                    <div class="question-header">
                        <span class="question-number">Question ${
                          qIndex + 1
                        }</span>
                        <span class="question-progress">${qIndex + 1}/${
              quiz.questions.length
            }</span>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="question-options">
                        ${question.options
                          .map(
                            (option, oIndex) => `
                            <div class="option" data-option="${oIndex}" onclick="selectOption(${qIndex}, ${oIndex})">
                                <span class="option-letter">${String.fromCharCode(
                                  65 + oIndex
                                )}</span>
                                <span class="option-text">${option}</span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
            `;
          });

          quizHTML += `
            <div class="quiz-controls">
                <button class="btn btn-secondary" id="prevQuestionBtn" onclick="previousQuestion()" disabled>
                    <i class="fas fa-chevron-left"></i>
                    Previous
                </button>
                <div>
                    <button class="btn btn-secondary" id="nextQuestionBtn" onclick="nextQuestion()" disabled>
                        Next
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn btn-primary" id="submitQuizBtn" onclick="submitQuiz()" style="display: none;">
                        <i class="fas fa-check"></i>
                        Submit Quiz
                    </button>
                </div>
            </div>

            <div class="quiz-results" id="quizResults">
                <div class="quiz-score" id="quizScore">0%</div>
                <div class="quiz-message" id="quizMessage"></div>
                <div class="quiz-actions">
                    <button class="btn btn-primary" id="continueBtn" onclick="completeLesson()" style="display: none;">
                        <i class="fas fa-arrow-right"></i>
                        Continue to Next Lesson
                    </button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">
                        <i class="fas fa-redo"></i>
                        Retake Quiz
                    </button>
                </div>
            </div>
        `;
        }

        quizHTML += "</div>";
        return quizHTML;
      }

      // Quiz interaction functions
      function selectOption(questionIndex, optionIndex) {
        // Clear previous selections
        document
          .querySelectorAll(`[data-question="${questionIndex}"] .option`)
          .forEach((opt) => {
            opt.classList.remove("selected");
          });

        // Select current option
        const selectedOption = document.querySelector(
          `[data-question="${questionIndex}"] [data-option="${optionIndex}"]`
        );
        selectedOption.classList.add("selected");

        // Store answer
        quizState.answers[questionIndex] = optionIndex;

        // Update navigation
        const isLastQuestion =
          questionIndex ===
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length - 1;
        if (isLastQuestion) {
          document.getElementById("submitQuizBtn").style.display =
            "inline-flex";
          document.getElementById("nextQuestionBtn").style.display = "none";
        } else {
          document.getElementById("nextQuestionBtn").disabled = false;
        }
      }

      function nextQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const nextQuestionEl = currentQuestionEl.nextElementSibling;

        if (
          nextQuestionEl &&
          nextQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          nextQuestionEl.classList.add("active");
          quizState.currentQuestion++;
          updateQuizNavigation();
        }
      }

      function previousQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const prevQuestionEl = currentQuestionEl.previousElementSibling;

        if (
          prevQuestionEl &&
          prevQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          prevQuestionEl.classList.add("active");
          quizState.currentQuestion--;
          updateQuizNavigation();
        }
      }

      function updateQuizNavigation() {
        const totalQuestions =
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length;
        const prevBtn = document.getElementById("prevQuestionBtn");
        const nextBtn = document.getElementById("nextQuestionBtn");
        const submitBtn = document.getElementById("submitQuizBtn");

        prevBtn.disabled = quizState.currentQuestion === 0;

        const hasAnswer =
          quizState.answers[quizState.currentQuestion] !== undefined;
        const isLastQuestion = quizState.currentQuestion === totalQuestions - 1;

        if (isLastQuestion) {
          nextBtn.style.display = "none";
          submitBtn.style.display = hasAnswer ? "inline-flex" : "none";
        } else {
          nextBtn.style.display = "inline-flex";
          nextBtn.disabled = !hasAnswer;
          submitBtn.style.display = "none";
        }
      }

      async function submitQuiz() {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const quiz = lesson.quiz;
        let correctAnswers = 0;

        // Hide questions and controls
        document
          .querySelectorAll(".quiz-question")
          .forEach((q) => (q.style.display = "none"));
        document.querySelector(".quiz-controls").style.display = "none";

        // Calculate score and highlight answers
        quiz.questions.forEach((question, index) => {
          const userAnswer = quizState.answers[index];
          const correctAnswer = question.correct;
          const isCorrect = userAnswer === correctAnswer;

          if (isCorrect) correctAnswers++;

          // Highlight answers
          const questionEl = document.querySelector(
            `[data-question="${index}"]`
          );
          const options = questionEl.querySelectorAll(".option");

          options[correctAnswer].classList.add("correct");
          if (userAnswer !== correctAnswer && userAnswer !== undefined) {
            options[userAnswer].classList.add("incorrect");
          }
        });

        const score = Math.round(
          (correctAnswers / quiz.questions.length) * 100
        );
        const passed = score >= quiz.passingScore;

        // Update quiz results UI
        const quizScore = document.getElementById("quizScore");
        const quizMessage = document.getElementById("quizMessage");
        const quizActions = document.querySelector(".quiz-actions");

        quizScore.textContent = `${score}%`;
        quizScore.className = `quiz-score ${passed ? "pass" : "fail"}`;

        if (passed) {
          quizMessage.innerHTML = `
            <strong>Congratulations!</strong><br>
            You passed with ${score}%. You can now proceed to the next lesson.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-primary" onclick="completeLesson()">
                <i class="fas fa-arrow-right"></i>
                Continue to Next Lesson
            </button>
        `;

          // Mark lesson as completed
          await markLessonComplete(score);
        } else {
          quizMessage.innerHTML = `
            <strong>Not quite there yet.</strong><br>
            You scored ${score}%. You need ${quiz.passingScore}% to pass. Review the material and try again.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-secondary" onclick="retakeQuiz()">
                <i class="fas fa-redo"></i>
                Retake Quiz
            </button>
        `;
        }

        document.getElementById("quizResults").classList.add("show");

        // Log quiz completion
        logUserActivity("quiz_completed", {
          lesson_id: lesson.id,
          lesson_title: lesson.title,
          score: score,
          passed: passed,
          attempts: (courseProgress[lesson.id]?.quizAttempts || 0) + 1,
        });

        // Scroll to results
        document
          .getElementById("quizResults")
          .scrollIntoView({ behavior: "smooth" });
      }

      function retakeQuiz() {
        // Reset quiz state
        quizState = {
          currentQuestion: 0,
          answers: [],
          score: 0,
          isComplete: false,
        };

        // Track quiz retry
        const lessonId = COURSE_DATA.lessons[currentLessonIndex].id;
        if (!courseProgress[lessonId]) courseProgress[lessonId] = {};
        courseProgress[lessonId].quizAttempts =
          (courseProgress[lessonId].quizAttempts || 0) + 1;

        // Reload lesson content
        loadLesson(currentLessonIndex);

        // Scroll to quiz
        setTimeout(() => {
          document
            .getElementById("quizSection")
            .scrollIntoView({ behavior: "smooth" });
        }, 500);
      }

      async function markLessonComplete(score) {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonId = lesson.id;

        // Track lesson completion time
        trackLessonTime();

        // Update lesson progress
        courseProgress[lessonId] = {
          ...courseProgress[lessonId],
          completed: true,
          quizScore: score,
          completedAt: new Date().toISOString(),
          finalScore: score,
        };

        // Update session tracking
        courseSession.lessonsCompleted++;

        // Save progress to database
        await saveProgress();

        // Update UI
        renderSidebar();
        updateNavigationButtons();

        // Check various achievements
        await checkLessonCompletionAchievements();
        await checkPerfectScoreAchievements(score);
        await checkStudyTimeAchievements();

        // Log lesson completion
        logUserActivity("lesson_completed", {
          lesson_id: lessonId,
          lesson_title: lesson.title,
          final_score: score,
          time_spent: courseProgress[lessonId].timeSpent || 0,
          lesson_number: currentLessonIndex + 1,
        });

        showToast("Lesson completed successfully!", "success");
      }

      async function completeLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          // Move to next lesson
          currentLessonIndex++;
          loadLesson(currentLessonIndex);
        } else {
          // Course completion
          await completeCourse();
        }
      }

      async function completeCourse() {
        try {
          const completionTime = courseSession.totalStudyTime;

          // Update course progress to 100% completed
          await supabase
            .from("course_progress")
            .update({
              progress: 100,
              completed_at: new Date().toISOString(),
              completion_time_minutes: completionTime,
            })
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Award course completion achievements
          await checkAndUnlockAchievement("course_completion_1");
          await checkSpeedCompletionAchievements(completionTime);
          await checkCourseStreakAchievements();

          // Update user stats
          await updateUserStats();

          // Show completion message
          showToast(
            "Congratulations! Course completed successfully!",
            "certificate"
          );

          // Log course completion
          logUserActivity("course_completed", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            completion_time_minutes: completionTime,
            total_lessons: COURSE_DATA.lessons.length,
            average_quiz_score: calculateAverageQuizScore(),
          });

          // Redirect to dashboard after delay
          setTimeout(() => {
            window.location.href = "/dashboard.html";
          }, 3000);
        } catch (error) {
          console.error("Error completing course:", error);
          showToast("Error marking course as complete", "error");
        }
      }

      // =====================================================
      // ACHIEVEMENT INTEGRATION SYSTEM
      // =====================================================
      async function checkAndUnlockAchievement(
        achievementId,
        skipNotification = false
      ) {
        try {
          // Prevent duplicate checks
          const cacheKey = `achievement_${achievementId}_${currentUser.id}`;
          if (sessionStorage.getItem(cacheKey)) return false;

          // Check if already unlocked
          const { data: existing, error } = await supabase
            .from("user_achievements")
            .select("id")
            .eq("user_id", currentUser.id)
            .eq("achievement_id", achievementId)
            .single();

          if (existing) {
            sessionStorage.setItem(cacheKey, "true");
            return false;
          }

          // Award achievement
          const achievementData = {
            user_id: currentUser.id,
            achievement_id: achievementId,
            unlocked_at: new Date().toISOString(),
            points_awarded: getAchievementPoints(achievementId),
            context: "course_system",
          };

          const { data, error: insertError } = await supabase
            .from("user_achievements")
            .insert([achievementData])
            .select()
            .single();

          if (insertError) {
            if (insertError.code === "23505") return false; // Already exists
            throw insertError;
          }

          // Update user points
         await supabase.rpc('increment_user_stats', {
  user_id_param: currentUser.id,
  points_to_add: achievementData.points_awarded,
  achievements_to_add: 1
});

          // Cache and queue notification
          sessionStorage.setItem(cacheKey, "true");

          if (!skipNotification) {
            queueAchievementNotification({
              id: achievementId,
              name: getAchievementName(achievementId),
              description: getAchievementDescription(achievementId),
              points: achievementData.points_awarded,
              rarity: getAchievementRarity(achievementId),
              icon: getAchievementIcon(achievementId),
            });
          }

          return true;
        } catch (error) {
          console.error("Error unlocking achievement:", error);
          return false;
        }
      }

      // Helper functions for achievement data (replace with your actual achievement definitions)
      function getAchievementPoints(id) {
        const pointsMap = {
          first_course_start: 75,
          first_lesson: 100,
          course_completion_1: 500,
          perfect_score: 250,
          speed_demon: 750,
          marathon_learner: 500,
          night_owl: 200,
          early_bird: 200,
          weekend_warrior: 150,
          // Add more as needed
        };
        return pointsMap[id] || 100;
      }

      function getAchievementName(id) {
        const nameMap = {
          first_course_start: "Learning Initiated",
          first_lesson: "First Steps",
          course_completion_1: "Course Conqueror",
          perfect_score: "Perfectionist",
          speed_demon: "Speed Demon",
          // Add more as needed
        };
        return nameMap[id] || "Achievement Unlocked";
      }

      function getAchievementDescription(id) {
        const descMap = {
          first_course_start: "Start your first cybersecurity course",
          first_lesson: "Complete your first lesson",
          course_completion_1: "Complete your first course",
          perfect_score: "Score 100% on any quiz",
          speed_demon: "Complete a course in under 2 hours",
          // Add more as needed
        };
        return descMap[id] || "Achievement description";
      }

      function getAchievementRarity(id) {
        const rarityMap = {
          first_course_start: "common",
          first_lesson: "bronze",
          course_completion_1: "silver",
          perfect_score: "gold",
          speed_demon: "legendary",
          // Add more as needed
        };
        return rarityMap[id] || "common";
      }

      function getAchievementIcon(id) {
        const iconMap = {
          first_course_start: "fas fa-play",
          first_lesson: "fas fa-baby",
          course_completion_1: "fas fa-trophy",
          perfect_score: "fas fa-star",
          speed_demon: "fas fa-rocket",
          // Add more as needed
        };
        return iconMap[id] || "fas fa-award";
      }

      async function checkLessonAchievements(lessonNumber) {
        if (lessonNumber === 1) {
          await checkAndUnlockAchievement("first_lesson");
        }

        // Check if user has completed multiple lessons in one day
        const today = new Date().toISOString().split("T")[0];
        const todayCompletions = Object.values(courseProgress).filter(
          (p) => p.completed && p.completedAt?.startsWith(today)
        ).length;

        if (todayCompletions >= 3) {
          await checkAndUnlockAchievement("lesson_marathon");
        }
      }

      async function checkLessonCompletionAchievements() {
        const completedCount = getCompletedLessonsCount();

        // Lesson-based achievements
        const lessonMilestones = [1, 5, 10, 25, 50, 100];
        for (const milestone of lessonMilestones) {
          if (completedCount >= milestone) {
            await checkAndUnlockAchievement(`lessons_${milestone}`);
          }
        }

        // Course completion achievements
        if (completedCount === COURSE_DATA.lessons.length) {
          await checkAndUnlockAchievement("course_completion_1");

          // Check for additional course completion achievements
          const { data: allCourses } = await supabase
            .from("course_progress")
            .select("course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100);

          const totalCompleted = allCourses?.length || 0;

          const courseMilestones = [1, 5, 10, 25];
          for (const milestone of courseMilestones) {
            if (totalCompleted >= milestone) {
              await checkAndUnlockAchievement(`course_completion_${milestone}`);
            }
          }
        }
      }

      async function checkPerfectScoreAchievements(score) {
        if (score === 100) {
          await checkAndUnlockAchievement("perfect_score");

          // Check for consecutive perfect scores
          const recentScores = Object.values(courseProgress)
            .filter((p) => p.completed && p.quizScore)
            .slice(-5) // Last 5 completed
            .map((p) => p.quizScore);

          if (
            recentScores.length >= 3 &&
            recentScores.every((s) => s === 100)
          ) {
            await checkAndUnlockAchievement("perfectionist_streak");
          }
        }
      }

      async function checkSpeedCompletionAchievements(completionTime) {
        // Speed demon: Complete course in under 2 hours (120 minutes)
        if (completionTime <= 120) {
          await checkAndUnlockAchievement("speed_demon");
        }

        // Quick learner: Complete course in under 4 hours (240 minutes)
        if (completionTime <= 240) {
          await checkAndUnlockAchievement("quick_learner");
        }
      }

      async function checkStudyTimeAchievements() {
        const totalTime = courseSession.totalStudyTime;

        // Marathon learner: Study for 8+ hours in a course session
        if (totalTime >= 480) {
          // 8 hours
          await checkAndUnlockAchievement("marathon_learner");
        }

        // Dedicated learner: Study for 4+ hours
        if (totalTime >= 240) {
          // 4 hours
          await checkAndUnlockAchievement("dedicated_learner");
        }
      }

      async function checkCourseStreakAchievements() {
        try {
          // Check for consecutive course completions
          const { data: recentCourses, error } = await supabase
            .from("course_progress")
            .select("completed_at, course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100)
            .order("completed_at", { ascending: false })
            .limit(10);

          if (error || !recentCourses) return;

          // Check for courses completed on consecutive days
          let consecutiveDays = 1;
          for (let i = 1; i < recentCourses.length; i++) {
            const prevDate = new Date(
              recentCourses[i - 1].completed_at
            ).toDateString();
            const currentDate = new Date(
              recentCourses[i].completed_at
            ).toDateString();
            const dayDiff =
              Math.abs(new Date(prevDate) - new Date(currentDate)) /
              (1000 * 60 * 60 * 24);

            if (dayDiff <= 1) {
              consecutiveDays++;
            } else {
              break;
            }
          }

          if (consecutiveDays >= 3) {
            await checkAndUnlockAchievement("learning_streak");
          }
        } catch (error) {
          console.error("Error checking course streak achievements:", error);
        }
      }

      // =====================================================
      // TIME-BASED ACHIEVEMENTS
      // =====================================================
      async function checkTimeBasedAchievements(timestamp) {
        const hour = timestamp.getHours();
        const dayOfWeek = timestamp.getDay();

        // Night owl (after midnight, before 6 AM)
        if (hour >= 0 && hour < 6) {
          await incrementTimeBasedCounter("midnight_sessions", "night_owl");
        }

        // Early bird (4 AM to 6 AM)
        if (hour >= 4 && hour < 6) {
          await incrementTimeBasedCounter("early_sessions", "early_bird");
        }

        // Weekend warrior (Saturday = 6, Sunday = 0)
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          await incrementTimeBasedCounter(
            "weekend_sessions",
            "weekend_warrior"
          );
        }
      }

      async function incrementTimeBasedCounter(counterType, achievementId) {
        try {
          const dateStr = new Date().toISOString().split("T")[0];
          const cacheKey = `${counterType}_${currentUser.id}_${dateStr}`;

          // Prevent multiple increments per day
          if (sessionStorage.getItem(cacheKey)) return;

          // Update counter
          await supabase
            .from("profiles")
            .update({
              [counterType]: supabase.sql`${counterType} + 1`,
            })
            .eq("id", currentUser.id);

          // Cache to prevent double counting
          sessionStorage.setItem(cacheKey, "true");

          // Check related achievement
          if (achievementId) {
            await checkAndUnlockAchievement(achievementId, true);
          }
        } catch (error) {
          console.error(`Error incrementing ${counterType}:`, error);
        }
      }

      async function checkDailyStreak() {
        try {
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("last_activity, current_streak, last_streak_date")
            .eq("id", currentUser.id)
            .single();

          if (error) throw error;

          const now = new Date();
          const today = now.toDateString();
          const lastActivity = profile.last_activity
            ? new Date(profile.last_activity)
            : null;
          const lastStreakDate = profile.last_streak_date
            ? new Date(profile.last_streak_date).toDateString()
            : null;

          let newStreak = profile.current_streak || 0;
          let shouldUpdateStreak = false;

          if (!lastActivity) {
            // First time user
            newStreak = 1;
            shouldUpdateStreak = true;
          } else {
            const daysSinceLastActivity = Math.floor(
              (now - lastActivity) / (1000 * 60 * 60 * 24)
            );

            if (lastStreakDate === today) {
              // Already counted today's streak
              return newStreak;
            } else if (
              daysSinceLastActivity === 1 ||
              (daysSinceLastActivity === 0 && lastStreakDate !== today)
            ) {
              // Consecutive day or same day but not counted yet
              newStreak += 1;
              shouldUpdateStreak = true;
            } else if (daysSinceLastActivity > 1) {
              // Streak broken
              newStreak = 1;
              shouldUpdateStreak = true;
            }
          }

          if (shouldUpdateStreak) {
            await supabase
              .from("profiles")
              .update({
                current_streak: newStreak,
                last_activity: now.toISOString(),
                last_streak_date: now.toISOString(),
              })
              .eq("id", currentUser.id);

            userStats.current_streak = newStreak;

            showToast(`Daily streak: ${newStreak} days!`, "success");
            await checkStreakAchievements(newStreak);
          }

          return newStreak;
        } catch (error) {
          console.error("Error checking daily streak:", error);
          return 0;
        }
      }

      async function checkStreakAchievements(currentStreak) {
        const streakMilestones = [3, 7, 14, 30, 100, 365];

        for (const milestone of streakMilestones) {
          if (currentStreak >= milestone) {
            await checkAndUnlockAchievement(`streak_${milestone}`);
          }
        }
      }

      // =====================================================
      // USER ACTIVITY LOGGING
      // =====================================================
      async function logUserActivity(activityType, metadata = {}) {
        try {
          const now = new Date();

          const activityData = {
            user_id: currentUser.id,
            activity_type: activityType,
            timestamp: now.toISOString(),
            course_id: COURSE_DATA.id,
            lesson_index: currentLessonIndex,
            session_duration: courseSession.totalStudyTime,
            metadata: JSON.stringify(metadata),
            created_at: now.toISOString(),
          };

          // Try to log to activities table
          const { error } = await supabase
            .from("user_activities")
            .insert([activityData]);

          if (error && error.code !== "42P01") {
            console.warn("Activity logging failed:", error.message);
          }

          // Always update last activity in profile
          await supabase
            .from("profiles")
            .update({ last_activity: now.toISOString() })
            .eq("id", currentUser.id);
        } catch (error) {
          console.error("Error logging user activity:", error);
        }
      }

      // =====================================================
      // NAVIGATION SYSTEM
      // =====================================================
      function updateNavigationButtons() {
        const prevBtn = document.getElementById("prevLessonBtn");
        const nextBtn = document.getElementById("nextLessonBtn");

        if (!prevBtn || !nextBtn) return;

        // Previous button
        prevBtn.disabled = currentLessonIndex === 0;

        // Next button logic
        const isLastLesson =
          currentLessonIndex === COURSE_DATA.lessons.length - 1;
        const canGoNext =
          currentLessonIndex < COURSE_DATA.lessons.length - 1 &&
          canAccessLesson(currentLessonIndex + 1);

        if (isLastLesson) {
          const isCurrentCompleted =
            courseProgress[COURSE_DATA.lessons[currentLessonIndex].id]
              ?.completed;
          nextBtn.disabled = !isCurrentCompleted;
          nextBtn.innerHTML = '<i class="fas fa-trophy"></i> Complete Course';
        } else {
          nextBtn.disabled = !canGoNext;
          nextBtn.innerHTML = 'Next <i class="fas fa-chevron-right"></i>';
        }
      }

      // Navigation button event handlers
      function goToPreviousLesson() {
        if (currentLessonIndex > 0) {
          trackLessonTime(); // Track time spent on current lesson
          currentLessonIndex--;
          loadLesson(currentLessonIndex);
        }
      }

      function goToNextLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          const canGoNext = canAccessLesson(currentLessonIndex + 1);
          if (canGoNext) {
            trackLessonTime();
            currentLessonIndex++;
            loadLesson(currentLessonIndex);
          } else {
            showToast("Complete the current lesson quiz to proceed", "warning");
          }
        } else {
          // Complete course
          completeCourse();
        }
      }

      // =====================================================
      // SIDEBAR FUNCTIONS
      // =====================================================
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.toggle("open");
        if (overlay) overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.remove("open");
        if (overlay) overlay.classList.remove("active");
      }

      // =====================================================
      // ACHIEVEMENT NOTIFICATION SYSTEM
      // =====================================================
      function queueAchievementNotification(achievement) {
        notificationQueue.push(achievement);
        processNotificationQueue();
      }

      function processNotificationQueue() {
        if (isShowingNotification || notificationQueue.length === 0) return;

        isShowingNotification = true;
        const achievement = notificationQueue.shift();
        showAchievementNotification(achievement);

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          isShowingNotification = false;
          processNotificationQueue();
        }, duration + 500);
      }

      function showAchievementNotification(achievement) {
        const notification = document.getElementById("achievementNotification");
        if (!notification) return;

        const icon = document.getElementById("notificationIcon");
        const title = document.getElementById("notificationTitle");
        const description = document.getElementById("notificationDescription");
        const points = document.getElementById("notificationPoints");

        if (icon) {
          icon.innerHTML = `<i class="${achievement.icon}"></i>`;
          icon.className = `notification-icon ${achievement.rarity}`;
        }
        if (title) title.textContent = achievement.name;
        if (description) description.textContent = achievement.description;
        if (points) points.textContent = `+${achievement.points} Points`;

        notification.className = `achievement-notification ${achievement.rarity}`;
        notification.classList.add("show");

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          notification.classList.remove("show");
        }, duration);
      }

      // =====================================================
      // UTILITY FUNCTIONS
      // =====================================================
      function calculateAverageQuizScore() {
        const scores = Object.values(courseProgress)
          .filter((p) => p.completed && p.quizScore)
          .map((p) => p.quizScore);

        if (scores.length === 0) return 0;
        return Math.round(
          scores.reduce((sum, score) => sum + score, 0) / scores.length
        );
      }

      async function resetProgress() {
        if (
          !confirm(
            "Are you sure you want to reset your progress? This action cannot be undone."
          )
        ) {
          return;
        }

        try {
          // Track lesson time before reset
          trackLessonTime();

          // Reset local state
          courseProgress = {};
          currentLessonIndex = 0;
          courseSession = {
            startTime: new Date(),
            totalStudyTime: 0,
            lessonsStarted: 0,
            lessonsCompleted: 0,
            pageLoadTime: new Date(),
            interactionCount: 0,
            lastActivityTime: new Date(),
          };

          // Delete from database
          await supabase
            .from("course_progress")
            .delete()
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Log reset activity
          logUserActivity("progress_reset", {
            course_id: COURSE_DATA.id,
            reset_reason: "manual",
          });

          // Reinitialize
          await saveProgress();
          renderSidebar();
          loadLesson(0);

          showToast("Progress reset successfully", "success");
        } catch (error) {
          console.error("Error resetting progress:", error);
          showToast("Failed to reset progress", "error");
        }
      }

      function copyCode(codeId) {
        const codeElement = document.getElementById(codeId);
        if (!codeElement) return;

        const text = codeElement.textContent;

        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast("Code copied to clipboard!", "success");

            // Track code copy for achievements
            logUserActivity("code_copied", {
              code_section: codeId,
              lesson_id: COURSE_DATA.lessons[currentLessonIndex].id,
            });
          })
          .catch((err) => {
            console.error("Failed to copy code:", err);
            showToast("Failed to copy code", "error");

            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
              document.execCommand("copy");
              showToast("Code copied to clipboard!", "success");
            } catch (fallbackError) {
              showToast(
                "Copy failed - please select and copy manually",
                "error"
              );
            }
            document.body.removeChild(textArea);
          });
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // =====================================================
      // UI FEEDBACK SYSTEMS
      // =====================================================
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const messageEl = document.getElementById("toastMessage");

        if (!toast || !messageEl) {
          console.log(`Toast: ${message} (${type})`);
          return;
        }

        messageEl.textContent = message;
        toast.className = `toast ${type} show`;

        setTimeout(() => {
          toast.classList.remove("show");
        }, 4000);
      }

      function showLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) loadingScreen.classList.remove("hidden");
      }

      function hideLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) {
          setTimeout(() => {
            loadingScreen.classList.add("hidden");
          }, 1000);
        }
      }

      // =====================================================
      // MUSIC PLAYER INTEGRATION
      // =====================================================
      function initMusicPlayer() {
        const btnText = document.getElementById("music-button-text");
        const icon = document.getElementById("music-icon");
        const dropdown = document.getElementById("music-dropdown-content");

        if (!btnText || !icon || !dropdown) return;

        function setUI(state) {
          btnText.textContent =
            state === "Playing" ? "PAUSE MUSIC" : "STUDY MUSIC";
          icon.className =
            state === "Playing"
              ? "fa-solid fa-circle-pause"
              : "fa-solid fa-music";
        }

        // Load saved music state
        const savedSrc = localStorage.getItem("cybersec_music_src");
        const savedTime = parseFloat(
          localStorage.getItem("cybersec_music_time") || 0
        );

        if (savedSrc) {
          audioPlayer.src = savedSrc;
          audioPlayer.currentTime = savedTime;
          audioPlayer
            .play()
            .then(() => setUI("Playing"))
            .catch(() => setUI("Stopped"));
        }

        // Music button click handler
        document
          .getElementById("music-dropdown")
          .querySelector("button")
          .addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown.style.display =
              dropdown.style.display === "block" ? "none" : "block";

            if (audioPlayer.src && !audioPlayer.paused) {
              audioPlayer.pause();
              setUI("Stopped");
            } else if (audioPlayer.src) {
              audioPlayer.play().then(() => setUI("Playing"));
            }
          });

        // Music selection handlers
        dropdown.querySelectorAll("a[data-src]").forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.src = link.dataset.src;
            audioPlayer.play().then(() => setUI("Playing"));
            localStorage.setItem("cybersec_music_src", link.dataset.src);
            dropdown.style.display = "none";
          });
        });

        // Stop music handler
        const stopLink = document.getElementById("stop-music-link");
        if (stopLink) {
          stopLink.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.removeAttribute("src");
            setUI("Stopped");
            localStorage.removeItem("cybersec_music_src");
            localStorage.removeItem("cybersec_music_time");
            dropdown.style.display = "none";
          });
        }

        // Save music state before page unload
        window.addEventListener("beforeunload", () => {
          if (!audioPlayer.paused && audioPlayer.src) {
            localStorage.setItem("cybersec_music_src", audioPlayer.src);
            localStorage.setItem(
              "cybersec_music_time",
              audioPlayer.currentTime
            );
          }
        });

        // Close dropdown when clicking outside
        window.addEventListener("click", (e) => {
          if (!e.target.closest("#music-dropdown")) {
            dropdown.style.display = "none";
          }
        });
      }

      // Show initial music indicator
      function addMusicIndicator() {
        const musicBtn = document.querySelector("#music-dropdown");
        if (musicBtn) {
          const indicator = document.createElement("div");
          indicator.className = "music-indicator";
          indicator.innerHTML = `<i class="fa-solid fa-music"></i> Try Study Music!`;

          musicBtn.style.position = "relative";
          musicBtn.appendChild(indicator);

          setTimeout(() => indicator.remove(), 3000);
        }
      }

      // Initialize Event Listeners
      function initializeEventListeners() {
        // Navigation buttons
        document
          .getElementById("prevLessonBtn")
          ?.addEventListener("click", goToPreviousLesson);
        document
          .getElementById("nextLessonBtn")
          ?.addEventListener("click", goToNextLesson);

        // Reset progress button
        document
          .getElementById("resetProgressBtn")
          ?.addEventListener("click", resetProgress);

        // Mobile menu toggle
        document
          .getElementById("menuToggle")
          ?.addEventListener("click", toggleSidebar);
        document
          .getElementById("sidebarOverlay")
          ?.addEventListener("click", closeSidebar);

        // Keyboard shortcuts
        document.addEventListener("keydown", handleKeyboardShortcuts);

        // Window resize handler
        window.addEventListener("resize", handleWindowResize);

        // Content interaction tracking
        document.getElementById("contentBody")?.addEventListener(
          "scroll",
          debounce(() => {
            trackUserInteraction();
          }, 1000)
        );
      }

      // Keyboard Shortcuts
      function handleKeyboardShortcuts(e) {
        if (document.querySelector(".quiz-question.active")) return;

        if (e.key === "ArrowLeft" && e.ctrlKey) {
          e.preventDefault();
          goToPreviousLesson();
        } else if (e.key === "ArrowRight" && e.ctrlKey) {
          e.preventDefault();
          goToNextLesson();
        }
      }

      // Window Resize Handler
      function handleWindowResize() {
        if (window.innerWidth > 768) {
          closeSidebar();
        }
      }

      // Debounce Helper
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Initialize responsive behavior
      if (window.innerWidth <= 768) {
        document.getElementById("menuToggle").style.display = "inline-flex";
      }

      // Auto-save progress periodically
      setInterval(async () => {
        if (currentUser && Object.keys(courseProgress).length > 0) {
          await saveProgress();
        }
      }, 60000); // Save every minute

      // System initialization logging
      console.log("CyberSec Academy Course System Initialized");
      console.log("Current Course:", COURSE_DATA.title);
      console.log("Total Lessons:", COURSE_DATA.lessons.length);

      // Google OAuth Integration
      const googleBtn = document.querySelector(".btn-google");
      if (googleBtn) {
        googleBtn.addEventListener("click", async () => {
          const { data, error } = await supabase.auth.signInWithOAuth({
            provider: "google",
            options: {
              redirectTo:
                window.location.origin +
                "/courses/siem-operations-foundations.html",
            },
          });

          if (error) {
            console.error("Google login error:", error.message);
            showToast("Google login failed: " + error.message, "error");
          }
        });
      }

      // Check for existing session
      supabase.auth.getSession().then(({ data }) => {
        if (data.session) {
          console.log("User already logged in:", data.session.user);
          currentUser = data.session.user;
          startCourseSession();
        }
      });

      // Add missing auth modal functions
      function openAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "flex";
        }
      }

      function closeAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "none";
        }
      }

      // Add auth tab switching functionality
      document.getElementById("tabSignIn")?.addEventListener("click", () => {
        document.getElementById("tabSignIn").classList.add("active");
        document.getElementById("tabSignUp").classList.remove("active");
        document.getElementById("signInForm").style.display = "block";
        document.getElementById("signUpForm").style.display = "none";
      });

      document.getElementById("tabSignUp")?.addEventListener("click", () => {
        document.getElementById("tabSignUp").classList.add("active");
        document.getElementById("tabSignIn").classList.remove("active");
        document.getElementById("signUpForm").style.display = "block";
        document.getElementById("signInForm").style.display = "none";
      });

      document
        .getElementById("closeAuthModal")
        ?.addEventListener("click", closeAuthModal);

      // Improved error handling for auth session
      supabase.auth.onAuthStateChange((event, session) => {
        if (event === "SIGNED_IN") {
          currentUser = session.user;
          closeAuthModal();
          startCourseSession();
        } else if (event === "SIGNED_OUT") {
          currentUser = null;
          openAuthModal();
        }
      });

      // Add form submission handlers
      document
        .getElementById("emailSignInForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signInEmail").value;
          const password = document.getElementById("signInPassword").value;

          try {
            const { data, error } = await supabase.auth.signInWithPassword({
              email,
              password,
            });

            if (error) throw error;

            closeAuthModal();
          } catch (error) {
            showToast(error.message, "error");
          }
        });

      document
        .getElementById("emailSignUpForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signUpEmail").value;
          const password = document.getElementById("signUpPassword").value;
          const name = document.getElementById("signUpName").value;

          try {
            const { data, error } = await supabase.auth.signUp({
              email,
              password,
              options: {
                data: {
                  full_name: name,
                },
              },
            });

            if (error) throw error;

            showToast(
              "Account created successfully! Please check your email.",
              "success"
            );
          } catch (error) {
            showToast(error.message, "error");
          }
        });
    </script>
  </body>
</html>
