


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- ========== Start: SEO & Schema Enhancement ========== -->
    <title>Complete Incident Response Planning Course | CipherHall</title>
    <meta name="description" content="Enroll in our expert-led Incident Response Planning course. Master the NIST framework, threat hunting, digital forensics, and crisis management." />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />
    <link rel="canonical" href="https://www.cipherhall.com/courses/incident-response-planning-detail.html" />

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Course",
      "name": "Complete Incident Response Planning Course",
      "description": "A comprehensive, in-depth course covering every facet of incident response, from initial planning and team building to advanced threat hunting, crisis management, and program leadership.",
      "provider": {
        "@type": "Organization",
        "name": "CipherHall",
        "sameAs": "https://www.cipherhall.com"
      },
      "hasCourseInstance": {
        "@type": "CourseInstance",
        "courseMode": "Online",
        "instructor": {
          "@type": "Person",
          "name": "Dr. Evelyn Reed"
        }
      }
    }
    </script>
    <!-- ========== End: SEO & Schema Enhancement ========== -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Exo+2:wght@700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css"
    />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />

    <link rel="stylesheet" href="assets/css/coursepages.css" />
</head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loader-icon">
        <i class="fas fa-graduation-cap"></i>
      </div>
      <div class="loader-text">Loading Course Content...</div>
    </div>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Music Player (fixed at top right) -->
    <div class="header-controls">
      <div class="music-dropdown" id="music-dropdown">
        <button class="btn btn-secondary">
          <span id="music-button-text">STUDY MUSIC</span>
          <i id="music-icon" class="fa-solid fa-music"></i>
        </button>
        <div class="music-dropdown-content" id="music-dropdown-content">
          <a
            href="#"
            data-src="https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3"
            >1. Coffee Shop Vibes</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-16.mp3"
            >2. City Lights Lofi</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3"
            >3. Mellow Thoughts</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-13.mp3"
            >4. Rainy Mood</a
          >
          <a
            href="#"
            data-src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-10.mp3"
            >5. Time Alone</a
          >
          <a href="#" id="stop-music-link"
            ><i class="fa-solid fa-stop-circle"></i> Stop Music</a
          >
        </div>
      </div>

      <button class="btn btn-secondary" id="resetProgressBtn">
        <i class="fas fa-redo"></i>
        Reset Progress
      </button>
    </div>

    <!-- Auth Modal -->
    <div id="authModal" class="modal" style="display: none">
      <div class="modal-overlay"></div>
      <div class="modal-content">
        <span class="close" id="closeAuthModal">&times;</span>
        <div class="auth-tabs">
          <button id="tabSignIn" class="auth-tab active">Sign In</button>
          <button id="tabSignUp" class="auth-tab">Sign Up</button>
        </div>
        <div
          id="authLoader"
          style="display: none; text-align: center; padding: 2rem"
        >
          <i
            class="fas fa-spinner fa-spin fa-2x"
            style="color: var(--color-green)"
          ></i>
          <p style="margin-top: 0.5rem">Authenticating...</p>
        </div>
        <div id="signInForm" class="auth-form">
          <h2>Sign In to CipherHall</h2>
          <button id="googleSignIn" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignInForm">
            <input
              type="email"
              id="signInEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signInPassword"
              placeholder="Password"
              required
            />
            <button type="submit" class="btn btn-primary">Sign In</button>
          </form>
        </div>
        <div id="signUpForm" class="auth-form" style="display: none">
          <h2>Join CipherHall</h2>
          <button id="googleSignUp" class="btn btn-google">
            <i class="fab fa-google"></i> Continue with Google
          </button>
          <div class="divider"><span>or</span></div>
          <form id="emailSignUpForm">
            <input
              type="text"
              id="signUpName"
              placeholder="Full Name"
              required
            />
            <input
              type="email"
              id="signUpEmail"
              placeholder="Email Address"
              required
            />
            <input
              type="password"
              id="signUpPassword"
              placeholder="Password (min. 8 characters)"
              required
            />
            <button type="submit" class="btn btn-secondary">
              Create Account
            </button>
          </form>
        </div>
        <div id="authMessage"></div>
      </div>
    </div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="course-info">
          <h1 class="course-title" id="courseTitle">Loading...</h1>
          <div class="course-progress">
            <div class="progress-header">
              <span class="progress-label">Course Progress</span>
              <span class="progress-percentage" id="courseProgressPercent"
                >0%</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="courseProgressFill"
                style="width: 0%"
              ></div>
            </div>
            <div class="progress-stats">
              <span id="completedLessons">0</span>
              <span id="totalLessons">0</span>
            </div>
          </div>
          <a href="/dashboard.html" class="back-to-dashboard">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
          </a>
        </div>
      </div>

      <nav class="lesson-nav" id="lessonNav">
        <!-- Lessons will be loaded dynamically -->
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="content-header">
        <div class="lesson-header">
          <div class="lesson-header-left">
            <span class="lesson-number" id="currentLessonNumber">1</span>
            <h1 class="lesson-header-title" id="currentLessonTitle">
              Loading...
            </h1>
          </div>
          <div class="lesson-actions">
            <button class="mbtn btn-primary" id="menuToggle">
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </header>

      <div class="content-body" id="contentBody">
        <div class="lesson-content" id="lessonContent">
          <!-- Lesson content will be loaded dynamically -->
        </div>
      </div>

      <footer class="lesson-navigation">
        <div class="nav-info" id="navInfo">Lesson 1 of 10</div>
        <div class="nav-controls">
          <button class="btn btn-secondary" id="prevLessonBtn" disabled>
            <i class="fas fa-chevron-left"></i>
            Previous
          </button>
          <button class="btn btn-primary" id="nextLessonBtn" disabled>
            Next
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </footer>
    </main>

    <!-- Achievement Notification -->
    <div id="achievementNotification" class="achievement-notification">
      <div class="notification-header">
        <div class="notification-icon" id="notificationIcon">
          <i class="fas fa-trophy"></i>
        </div>
        <div class="notification-content">
          <h3 id="notificationTitle">Achievement Unlocked!</h3>
          <p id="notificationDescription">Description here...</p>
        </div>
      </div>
      <div class="notification-reward" id="notificationReward">
        <i class="fas fa-coins"></i>
        <span id="notificationPoints">+100 Points</span>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
      <span id="toastMessage"></span>
    </div>

    <script>
      // =====================================================
      // SYNCHRONIZED COURSE SYSTEM WITH DASHBOARD INTEGRATION
      // =====================================================

      // Supabase Configuration - Replace with your config
      const supabaseUrl = "https://lzcmzulemfubjaksoqor.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx6Y216dWxlbWZ1Ympha3NvcW9yIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzM5MDgsImV4cCI6MjA3MDkwOTkwOH0.crhPH4YWtRsr1BJTpAQcmPbWSpwIWRbzoI4sRb2_fPI";
      const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

      // =====================================================
      // COURSE DATA STRUCTURE - REPLACE WITH YOUR COURSE JSON
      // =====================================================
      const COURSE_DATA = {
        "id": "incident-response-planning",
        "title": "Complete Incident Response Planning Course",
        "description": "A comprehensive, in-depth course covering every facet of incident response, from initial planning and team building to advanced threat hunting, crisis management, and program leadership.",
        "category": "cybersecurity-operations",
        "difficulty": "Intermediate to Advanced",
        "duration": "150 hours",
        "instructor": "Dr. Evelyn Reed",
        "lessons": [
            {
                "id": "lesson-1",
                "title": "Introduction to Incident Response",
                "duration": "120 min",
                "objectives": [
                    "Define incident response and its core principles.",
                    "Classify different types of security incidents.",
                    "Differentiate between Incident Response, Business Continuity, and Disaster Recovery.",
                    "Identify key legal and regulatory requirements for incident response.",
                    "Understand major industry frameworks like NIST, ISO 27035, and SANS.",
                    "Analyze the business impact and cost of security incidents.",
                    "Evaluate organizational readiness using incident response maturity models."
                ],
                "content": {
                    "overview": "This foundational lesson introduces the critical discipline of Incident Response (IR). We will define what constitutes a security incident, explore its lifecycle, and understand why a structured approach is essential for protecting an organization's assets, reputation, and bottom line.",
                    "sections": [
                        {
                            "title": "What is Incident Response?",
                            "content": "<p>Incident Response (IR) is an organized approach to addressing and managing the aftermath of a security breach or cyberattack. The goal is to handle the situation in a way that limits damage and reduces recovery time and costs.</p><h3>Key Goals of Incident Response:</h3><ul><li><strong>Confirm or dispel</strong> whether an incident occurred.</li><li><strong>Promote</strong> information sharing to help protect the entire enterprise.</li><li><strong>Contain</strong> the incident to limit its operational, financial, and reputational impact.</li><li><strong>Eradicate</strong> the root cause of the incident to prevent recurrence.</li><li><strong>Recover</strong> affected systems and restore normal business operations swiftly.</li><li><strong>Learn</strong> from the incident to improve future defense and response efforts.</li></ul><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>Beyond the Technical</strong></div><p>Effective incident response is not just a technical activity. It involves legal, communications, HR, and executive stakeholders to manage the crisis holistically.</p></div>"
                        },
                        {
                            "title": "Classifying Security Incidents",
                            "content": "<p>Incidents are not created equal. Proper classification is key to prioritizing response efforts. Incidents are often categorized by their attack vector or their impact.</p><h3>Common Incident Categories:</h3><ul><li><strong>Unauthorized Access:</strong> An individual gains logical or physical access to a network, system, application, data, or other resource without permission.</li><li><strong>Denial of Service (DoS):</strong> An attack that prevents or impairs the normal use of networks, systems, or applications by exhausting resources.</li><li><strong>Malicious Code:</strong> Installation of software (e.g., ransomware, virus, worm, trojan) that infects a system.</li><li><strong>Improper Usage:</strong> A violation of an organization’s acceptable use policies by an authorized user.</li><li><strong>Scams / Phishing:</strong> Deceiving an individual into revealing sensitive information through social engineering.</li><li><strong>Data Exfiltration:</strong> The unauthorized transfer of data from a computer or network.</li></ul>"
                        },
                        {
                            "title": "IR vs. Business Continuity (BC) vs. Disaster Recovery (DR)",
                            "content": "<p>These terms are often confused but have distinct purposes.</p><ul><li><strong>Incident Response (IR):</strong> Focuses on addressing the immediate threat of a security incident to contain and remediate it. It's the 'first responder' activity.</li><li><strong>Disaster Recovery (DR):</strong> A subset of BC, it focuses on restoring IT infrastructure and operations after a disaster (e.g., natural disaster, major power failure).</li><li><strong>Business Continuity (BC):</strong> The most comprehensive term. It's about maintaining critical business functions or quickly resuming them in the event of a major disruption, which could be a security incident, natural disaster, or pandemic.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Simple Analogy</strong></div><p>IR is the 'paramedics' stopping the bleeding. DR is the 'hospital' restoring the patient's IT functions. BC is the 'life plan' ensuring the patient can continue their daily life and work.</p></div>"
                        },
                        {
                            "title": "Key Frameworks and Standards",
                            "content": "<p>Leveraging established frameworks provides a structured, repeatable, and defensible approach to incident response.</p><h3>Major Industry Frameworks:</h3><ol><li><strong>NIST SP 800-61:</strong> The Computer Security Incident Handling Guide provides a widely adopted framework covering the entire incident response lifecycle: Preparation, Detection & Analysis, Containment, Eradication & Recovery, and Post-Incident Activity.</li><li><strong>ISO/IEC 27035:</strong> An international standard for Information Security Incident Management, it provides a structured and planned approach to managing incidents.</li><li><strong>SANS Institute:</strong> Offers a popular six-step incident response process (Preparation, Identification, Containment, Eradication, Recovery, Lessons Learned) that aligns closely with NIST.</li></ol>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Incident Response Maturity Assessment Checklist (YAML)",
                            "language": "yaml",
                            "code": "# Simple IR Maturity Assessment based on CMMI levels\n# Score each item 1-5 (1=Non-existent, 5=Fully Optimized)\n\ncategory: Preparation\n  - item: Formal Incident Response Plan exists and is documented.\n    score: 3\n  - item: IR team is formally designated with defined roles.\n    score: 4\n  - item: Regular IR training and exercises are conducted.\n    score: 2\n  - item: Necessary tools (SIEM, EDR, Forensics) are deployed.\n    score: 4\n\ncategory: Identification & Analysis\n  - item: 24/7 monitoring and alerting capabilities are in place.\n    score: 3\n  - item: A formal process for incident triage and prioritization exists.\n    score: 3\n  - item: Threat intelligence is actively used for detection.\n    score: 2\n\ncategory: Containment, Eradication & Recovery\n  - item: Pre-defined containment strategies for major incident types exist.\n    score: 2\n  - item: Forensic data preservation procedures are documented.\n    score: 3\n  - item: System recovery and validation processes are standardized.\n    score: 3\n\ncategory: Post-Incident Activity\n  - item: A formal lessons learned process is followed after every major incident.\n    score: 2\n  - item: Metrics (MTTD, MTTR) are tracked and reported to management.\n    score: 1"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary goal of the 'Containment' phase in incident response?",
                            "options": [
                                "To learn from the incident to prevent future occurrences.",
                                "To restore all systems to normal operation.",
                                "To limit the damage and prevent the incident from spreading.",
                                "To determine if an incident has actually occurred."
                            ],
                            "correct": 2,
                            "explanation": "Containment focuses on isolating the affected systems to limit the scope and impact of the incident, preventing it from spreading to other parts of the network."
                        },
                        {
                            "id": 2,
                            "question": "Which framework is known for its six-step process: Preparation, Identification, Containment, Eradication, Recovery, and Lessons Learned?",
                            "options": [
                                "ISO/IEC 27035",
                                "COBIT",
                                "ITIL",
                                "SANS Institute"
                            ],
                            "correct": 3,
                            "explanation": "The SANS Institute popularizes this specific six-step incident response methodology, which is widely adopted in the industry."
                        },
                        {
                            "id": 3,
                            "question": "An employee losing a company laptop is an example of what kind of security incident?",
                            "options": [
                                "Denial of Service",
                                "Malicious Code",
                                "Unauthorized Access (potential)",
                                "Improper Usage"
                            ],
                            "correct": 2,
                            "explanation": "While it could be just a lost device, it represents a potential unauthorized access incident, as the data on the laptop is at risk of being compromised."
                        },
                        {
                            "id": 4,
                            "question": "What is the primary focus of Disaster Recovery (DR)?",
                            "options": [
                                "Maintaining critical business functions during any disruption.",
                                "Restoring IT infrastructure and operations after a major event.",
                                "Containing a cyberattack in real-time.",
                                "Communicating with stakeholders during a crisis."
                            ],
                            "correct": 1,
                            "explanation": "Disaster Recovery specifically focuses on the technology aspect—restoring IT systems, networks, and data after a disaster has occurred."
                        }
                    ]
                }
            },
            {
                "id": "lesson-2",
                "title": "Incident Response Lifecycle and Methodology",
                "duration": "90 min",
                "objectives": [
                    "Deeply understand the phases of the NIST Computer Security Incident Handling Guide.",
                    "Compare and contrast the NIST, SANS, and ISO 27035 methodologies.",
                    "Design a high-level incident response process flow.",
                    "Develop decision trees and escalation matrices for effective response.",
                    "Learn how to integrate the IR process with other business operations.",
                    "Apply continuous improvement methodologies to the IR lifecycle."
                ],
                "content": {
                    "overview": "A successful incident response program relies on a well-defined and repeatable methodology. This lesson provides a deep dive into the industry-standard lifecycles, focusing on the phases that guide a response from initial alert to final resolution and organizational learning.",
                    "sections": [
                        {
                            "title": "The NIST Incident Response Lifecycle",
                            "content": "<p>The National Institute of Standards and Technology (NIST) Special Publication 800-61 provides a comprehensive and widely adopted lifecycle. It's a cyclical process, emphasizing continuous improvement.</p><h3>The Four Phases:</h3><ul><li><strong>1. Preparation:</strong> This is the proactive phase. It involves establishing the right tools, processes, and people before an incident occurs. This includes creating the IR plan, forming the team, and deploying security tools.</li><li><strong>2. Detection & Analysis:</strong> An incident is detected through monitoring and alerts. This phase involves analyzing all available data to confirm the incident, determine its scope, and assess its impact.</li><li><strong>3. Containment, Eradication & Recovery:</strong> This phase is about taking action. <strong>Containment</strong> stops the bleeding. <strong>Eradication</strong> removes the root cause. <strong>Recovery</strong> restores systems to a secure, operational state.</li><li><strong>4. Post-Incident Activity:</strong> Often called 'Lessons Learned', this critical phase involves analyzing the incident and the response to identify areas for improvement in technology, processes, and people.</li></ul><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>Preparation is Key</strong></div><p>The success of all other phases is directly dependent on the quality of the Preparation phase. A lack of preparation leads to a chaotic and ineffective response.</p></div>"
                        },
                        {
                            "title": "Designing the Process Flow",
                            "content": "<p>Visualizing the IR process is crucial for ensuring everyone understands their role. This is often done with flowcharts that map out the steps from initial detection to closure.</p><h3>Key Elements of a Process Flow:</h3><ul><li><strong>Trigger:</strong> What initiates the process (e.g., SIEM alert, user report)?</li><li><strong>Decision Points:</strong> Questions that guide the path (e.g., 'Is this a true positive?', 'Is the incident critical?').</li><li><strong>Actions:</strong> Specific tasks to be performed (e.g., 'Isolate host', 'Reset passwords').</li><li><strong>Escalation Paths:</strong> Clearly defined triggers for involving management, legal, or other teams.</li><li><strong>Communication Loops:</strong> Points where status updates are provided to stakeholders.</li></ul>"
                        },
                        {
                            "title": "Escalation Matrices",
                            "content": "<p>An escalation matrix is a simple table that defines when and who to notify as an incident's severity or impact increases over time. It removes ambiguity in a crisis.</p><h3>Example Escalation Matrix:</h3><table class=\"table\"><thead><tr><th>Severity</th><th>Initial Responder</th><th>After 1 Hour</th><th>After 4 Hours</th></tr></thead><tbody><tr><td><strong>Low</strong></td><td>Tier 1 Analyst</td><td>Tier 2 Analyst</td><td>IR Team Lead</td></tr><tr><td><strong>Medium</strong></td><td>IR Team Analyst</td><td>IR Team Lead</td><td>IR Manager</td></tr><tr><td><strong>High</strong></td><td>Senior IR Analyst</td><td>IR Manager</td><td>CISO / Legal</td></tr><tr><td><strong>Critical</strong></td><td>IR Manager</td><td>CISO / CIO</td><td>CEO / Executive Team</td></tr></tbody></table><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Keep it Simple</strong></div><p>During a real incident, complex escalation paths are often ignored. The best matrices are simple, clear, and easily accessible to the entire team.</p></div>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Simple Incident Response Workflow in JSON",
                            "language": "json",
                            "code": "{\n  \"workflowName\": \"Phishing Incident Response\",\n  \"trigger\": {\n    \"source\": \"PhishingMailbox\",\n    \"condition\": \"NewEmailReceived\"\n  },\n  \"steps\": [\n    {\n      \"step\": 1,\n      \"name\": \"Initial Analysis\",\n      \"action\": \"ExtractObservables\",\n      \"parameters\": [\"email_headers\", \"urls\", \"attachments\"],\n      \"next_step_on_success\": 2\n    },\n    {\n      \"step\": 2,\n      \"name\": \"Threat Intelligence Lookup\",\n      \"action\": \"EnrichObservables\",\n      \"parameters\": [\"VirusTotal\", \"ThreatConnect\"],\n      \"next_step_on_success\": 3\n    },\n    {\n      \"step\": 3,\n      \"name\": \"Check for Clicks\",\n      \"action\": \"QueryProxyLogs\",\n      \"parameters\": [\"url_observables\"],\n      \"next_step_on_success\": 4\n    },\n    {\n      \"step\": 4,\n      \"name\": \"Decision: Is Malicious?\",\n      \"type\": \"condition\",\n      \"check\": \"observables.malicious_score > 75\",\n      \"path_if_true\": 5,\n      \"path_if_false\": 99\n    },\n    {\n      \"step\": 5,\n      \"name\": \"Containment\",\n      \"action\": \"Block observables (URL, Hash, IP)\",\n      \"next_step_on_success\": 6\n    },\n    {\n      \"step\": 99,\n      \"name\": \"Close as False Positive\",\n      \"action\": \"CloseTicket\"\n    }\n  ]\n}"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "In the NIST lifecycle, in which phase would an organization conduct a tabletop exercise?",
                            "options": [
                                "Detection & Analysis",
                                "Containment, Eradication & Recovery",
                                "Post-Incident Activity",
                                "Preparation"
                            ],
                            "correct": 3,
                            "explanation": "Tabletop exercises, training, and tool deployment are all part of the proactive 'Preparation' phase, designed to ensure readiness before an incident occurs."
                        },
                        {
                            "id": 2,
                            "question": "What is the main purpose of an escalation matrix?",
                            "options": [
                                "To document the technical details of an incident.",
                                "To provide a clear, predefined path for notifying stakeholders as severity increases.",
                                "To analyze the root cause of an incident.",
                                "To choose the correct containment strategy."
                            ],
                            "correct": 1,
                            "explanation": "An escalation matrix is designed to eliminate guesswork by clearly defining who needs to be informed and when, based on the incident's characteristics like severity or duration."
                        },
                        {
                            "id": 3,
                            "question": "The 'Lessons Learned' process is a key part of which NIST phase?",
                            "options": [
                                "Preparation",
                                "Detection & Analysis",
                                "Post-Incident Activity",
                                "Recovery"
                            ],
                            "correct": 2,
                            "explanation": "Post-Incident Activity is the formal phase dedicated to reviewing the entire incident and response, capturing lessons learned to feedback into the 'Preparation' phase for continuous improvement."
                        }
                    ]
                }
            },
            {
                "id": "lesson-3",
                "title": "Incident Response Team Structure and Roles",
                "duration": "100 min",
                "objectives": [
                    "Analyze different organizational models for an Incident Response Team (IRT).",
                    "Define the core roles and responsibilities within an IRT.",
                    "Understand how to integrate the core IRT with extended teams like Legal, HR, and PR.",
                    "Identify the essential skills and competencies for IR professionals.",
                    "Develop strategies for 24/7 coverage and team training."
                ],
                "content": {
                    "overview": "People are the most critical component of any incident response capability. This lesson explores how to structure an effective IR team, define clear roles and responsibilities, and ensure the team has the necessary skills and support to succeed during a crisis.",
                    "sections": [
                        {
                            "title": "Incident Response Team Models",
                            "content": "<p>The right team model depends on the organization's size, budget, and risk profile.</p><h3>Common Models:</h3><ul><li><strong>Centralized Team:</strong> A single, full-time team responsible for IR across the entire organization. This model provides consistency and deep expertise. Best for large organizations.</li><li><strong>Distributed Team:</strong> Team members are spread across different departments or locations, each with IR responsibilities for their area. Requires strong coordination.</li><li><strong>Coordinating Team:</strong> A central team (like a CSIRT) provides guidance, expertise, and coordination, but the actual response work is done by local IT and security staff.</li><li><strong>Outsourced/Managed Team:</strong> A third-party Managed Security Service Provider (MSSP) handles all or part of the incident response function. This is common for SMBs.</li></ul>"
                        },
                        {
                            "title": "Core Team Roles and Responsibilities",
                            "content": "<p>Clearly defined roles are essential to avoid confusion during a high-stress incident.</p><h3>Key Roles:</h3><ul><li><strong>Incident Response Manager/Commander:</strong> The overall leader. Manages the team, coordinates with stakeholders, makes critical decisions, and is ultimately responsible for the response.</li><li><strong>Lead Investigator / Analyst:</strong> The primary technical resource. Performs deep-dive forensics, malware analysis, and log correlation to understand the 'what, where, when, and how' of the incident.</li><li><strong>Triage Analyst:</strong> The first line of defense. Monitors alerts, performs initial analysis to validate and prioritize incidents, and escalates as needed.</li><li><strong>Communications Lead:</strong> Manages all internal and external communications. Ensures stakeholders receive timely and accurate updates. Acts as the liaison to PR and Legal.</li><li><strong>Scribe / Documentation Lead:</strong> Responsible for meticulously documenting every action, decision, and finding throughout the incident lifecycle. This is crucial for post-incident review and legal purposes.</li></ul>"
                        },
                        {
                            "title": "Integrating with the Extended Team",
                            "content": "<p>A major incident is a business crisis, not just an IT problem. Integration with other departments is non-negotiable.</p><h3>Critical Stakeholders:</h3><ul><li><strong>Legal:</strong> Provides guidance on regulatory requirements, data breach notifications, evidence handling (attorney-client privilege), and law enforcement engagement.</li><li><strong>Human Resources (HR):</strong> Essential for insider threat incidents, disciplinary actions, and employee communications.</li><li><strong>Public Relations (PR):</strong> Manages the external narrative, press releases, and customer communications to protect the company's reputation.</li><li><strong>Executive Management (C-Suite):</strong> Must be kept informed to make strategic business decisions, approve resources, and manage investor relations.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Build Bridges Before a Fire</strong></div><p>The worst time to exchange business cards with your legal counsel is during a live ransomware incident. Build these relationships and establish protocols during the 'Preparation' phase.</p></div>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Python Script for Team Skills Gap Analysis",
                            "language": "python",
                            "code": "import csv\n\n# Define required skills for an IR role\nrequired_skills = {\n    'Lead Investigator': ['Digital Forensics', 'Malware Analysis', 'Network Analysis', 'Python Scripting'],\n    'Triage Analyst': ['SIEM Operations', 'Log Analysis', 'Phishing Analysis']\n}\n\n# Load team skills from a CSV\nteam_members = {\n    'Alice': ['SIEM Operations', 'Log Analysis', 'Python Scripting'],\n    'Bob': ['Digital Forensics', 'Network Analysis']\n}\n\ndef analyze_gaps(role, members):\n    print(f\"--- Skills Gap Analysis for {role} ---\")\n    needed_skills = set(required_skills[role])\n    \n    for member, skills in members.items():\n        member_skills = set(skills)\n        missing_skills = needed_skills - member_skills\n        if not missing_skills:\n            print(f\"{member} meets all skill requirements for this role.\")\n        elif len(missing_skills) < len(needed_skills):\n            print(f\"{member} could fit this role but needs training in: {', '.join(missing_skills)}\")\n        else:\n            print(f\"{member} is not a primary fit for this role.\")\n\nanalyze_gaps('Lead Investigator', team_members)\nanalyze_gaps('Triage Analyst', team_members)"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "In a centralized IR team model, where does the primary responsibility for incident response lie?",
                            "options": [
                                "With a third-party MSSP.",
                                "Spread out among various IT departments.",
                                "With a single, full-time team that handles IR for the whole organization.",
                                "With a coordinating body that advises local teams."
                            ],
                            "correct": 2,
                            "explanation": "A centralized model concentrates IR expertise and responsibility into one dedicated, full-time team."
                        },
                        {
                            "id": 2,
                            "question": "Which role is primarily responsible for documenting all actions and decisions during an incident?",
                            "options": [
                                "Incident Manager",
                                "Lead Investigator",
                                "Communications Lead",
                                "Scribe / Documentation Lead"
                            ],
                            "correct": 3,
                            "explanation": "The Scribe is tasked with the critical function of keeping a detailed log of the incident response, which is vital for review, legal defense, and auditing."
                        },
                        {
                            "id": 3,
                            "question": "When an incident involves a malicious employee, which extended team member is most critical to involve early?",
                            "options": [
                                "Public Relations",
                                "Human Resources",
                                "Investor Relations",
                                "Finance Department"
                            ],
                            "correct": 1,
                            "explanation": "Human Resources is essential for managing the legal and procedural aspects of an investigation involving an employee, including potential disciplinary action."
                        }
                    ]
                }
            },
            {
                "id": "lesson-4",
                "title": "Incident Response Planning Framework",
                "duration": "120 min",
                "objectives": [
                    "Understand the methodology for developing a formal Incident Response Plan (IRP).",
                    "Identify the essential components and structure of a comprehensive IRP.",
                    "Apply a risk-based approach to prioritize planning efforts.",
                    "Integrate threat landscape analysis into the planning process.",
                    "Learn how to manage plan versions and changes effectively."
                ],
                "content": {
                    "overview": "The Incident Response Plan (IRP) is the cornerstone of a mature response capability. It is the formal, documented guide for how the organization will respond to an incident. This lesson covers how to build a practical and effective IRP from the ground up.",
                    "sections": [
                        {
                            "title": "What is an Incident Response Plan?",
                            "content": "<p>An Incident Response Plan (IRP) is a formal document that provides a structured set of instructions to the IR team for detecting, responding to, and recovering from security incidents. It is the playbook that ensures a coordinated and effective response.</p><h3>Key Characteristics of a Good Plan:</h3><ul><li><strong>Actionable:</strong> It should be a practical guide, not a theoretical document. Use checklists and clear instructions.</li><li><strong>Accessible:</strong> Team members must be able to access it immediately during a crisis (e.g., not just on a server that might be encrypted by ransomware).</li><li><strong>Adaptable:</strong> The plan should be a living document, updated regularly to reflect new threats, technologies, and business processes.</li><li><strong>Authoritative:</strong> It must be formally approved by management, giving the IR team the authority to act.</li></ul>"
                        },
                        {
                            "title": "Essential Components of an IRP",
                            "content": "<p>A comprehensive IRP should be well-structured and contain several key sections.</p><h3>Core Structure:</h3><ol><li><strong>Mission, Strategy, and Goals:</strong> A high-level overview of the plan's purpose and objectives.</li><li><strong>Roles, Responsibilities, and Contact Info:</strong> Detailed information on the IR team and key stakeholders. Should include a 24/7 contact list.</li><li><strong>Incident Classification and Severity:</strong> A clear definition of what constitutes an incident and how to categorize its severity.</li><li><strong>Response Phases (The Playbook):</strong> Detailed procedures and checklists for each phase of the response lifecycle (e.g., Identification, Containment). This is the largest part of the plan.</li><li><strong>Communication Plan:</strong> Guidelines on who to notify, when, and how. Includes templates for different audiences.</li><li><strong>Reporting Requirements:</strong> Defines what reports are needed for legal, regulatory, and management purposes.</li><li><strong>Lessons Learned Process:</strong> A formal procedure for post-incident review.</li></ol><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Don't Forget the Appendices</strong></div><p>Appendices are crucial for storing practical information like network diagrams, asset inventories, third-party contact lists, and incident reporting forms.</p></div>"
                        },
                        {
                            "title": "A Risk-Based Approach",
                            "content": "<p>You cannot plan for every possible threat. A risk-based approach focuses your planning efforts on the most likely and most impactful scenarios.</p><h3>Steps for Risk-Based Planning:</h3><ol><li><strong>Identify Critical Assets:</strong> What data, systems, and processes are most important to the business? (This often comes from a Business Impact Analysis).</li><li><strong>Identify Threats:</strong> What are the most likely threats to those critical assets (e.g., ransomware, business email compromise, insider data theft)?</li><li><strong>Analyze Scenarios:</strong> For each high-risk scenario, develop a specific playbook. A ransomware playbook will have very different containment and recovery steps than an insider threat playbook.</li><li><strong>Prioritize:</strong> Develop the most detailed playbooks for the highest risk scenarios first.</li></ol>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Python Script to Generate an IR Plan Template (Markdown)",
                            "language": "python",
                            "code": "import datetime\n\ncompany_name = \"Global Tech Inc.\"\nplan_version = \"1.0\"\n\ndef generate_plan():\n    plan_content = f\"\"\"\n# Incident Response Plan for {company_name}\n\n**Version:** {plan_version}\n**Last Updated:** {datetime.date.today()}\n\n---\n\n## 1. Mission and Goals\n\n*This section defines the purpose of the IR plan.*\n\n## 2. Roles and Responsibilities\n\n| Role | Primary Contact | Backup Contact |\n|---|---|---|\n| IR Manager | [Name] | [Name] |\n| Lead Investigator | [Name] | [Name] |\n| Comms Lead | [Name] | [Name] |\n\n## 3. Incident Classification\n\n*Define severity levels (e.g., Critical, High, Medium, Low) here.*\n\n## 4. Response Phase: Identification\n\n- [ ] Action 1: Triage the alert.\n- [ ] Action 2: Document initial findings in the case management system.\n\n## 5. Response Phase: Containment\n\n- [ ] Action 1: Consult the relevant scenario playbook (e.g., Ransomware, Phishing).\n- [ ] Action 2: Isolate the affected host(s).\n\n## 6. Communication Plan\n\n*Define communication matrix and templates here.*\n\n---\n\n**Document Approval:**\n\n**CISO:** ________________________\n\n\"\"\"\n    with open(\"IR_Plan_Template.md\", \"w\") as f:\n        f.write(plan_content)\n    print(\"Incident Response Plan template generated successfully!\")\n\ngenerate_plan()"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary purpose of an Incident Response Plan (IRP)?",
                            "options": [
                                "To satisfy auditor requirements.",
                                "To provide a structured, actionable guide for responding to incidents.",
                                "To document historical security incidents.",
                                "To allocate budget for security tools."
                            ],
                            "correct": 1,
                            "explanation": "The IRP's main goal is to be an actionable playbook that ensures a consistent, coordinated, and effective response during a crisis."
                        },
                        {
                            "id": 2,
                            "question": "Why should an IRP be accessible offline?",
                            "options": [
                                "To save on network bandwidth.",
                                "For easy printing.",
                                "Because the network or key servers may be unavailable during an incident like a ransomware attack.",
                                "To prevent unauthorized users from reading it."
                            ],
                            "correct": 2,
                            "explanation": "If the plan is only stored on a server that gets encrypted by ransomware or taken offline, the plan becomes useless when it's needed most."
                        },
                        {
                            "id": 3,
                            "question": "A risk-based approach to IR planning involves focusing on scenarios that have the:",
                            "options": [
                                "Highest technical complexity.",
                                "Most media attention.",
                                "Highest likelihood and highest potential impact.",
                                "Lowest cost to remediate."
                            ],
                            "correct": 2,
                            "explanation": "Risk is a function of likelihood and impact. A risk-based approach prioritizes planning for the threats that are most likely to occur and would cause the most damage to the organization."
                        }
                    ]
                }
            },
            {
                "id": "lesson-5",
                "title": "Incident Detection and Analysis",
                "duration": "120 min",
                "objectives": [
                    "Identify various sources and mechanisms for incident detection.",
                    "Understand the role of a SIEM in log analysis and correlation.",
                    "Define Indicators of Compromise (IoCs) and how they are used.",
                    "Develop strategies for managing and reducing false positives.",
                    "Learn to integrate external threat intelligence into the detection process."
                ],
                "content": {
                    "overview": "You can't respond to what you can't see. This lesson focuses on the 'Detection and Analysis' phase, exploring the technologies and techniques used to identify malicious activity amidst the noise of a busy network, and the initial analysis required to validate and understand a potential threat.",
                    "sections": [
                        {
                            "title": "Sources of Detection",
                            "content": "<p>Incidents are detected through a variety of technical and human sources. A mature program leverages multiple sources for a defense-in-depth approach.</p><h3>Common Detection Sources:</h3><ul><li><strong>Technical Alerts:</strong><ul><li><strong>SIEM/SOAR:</strong> Alerts from correlated log events.</li><li><strong>Endpoint Detection & Response (EDR):</strong> Alerts on suspicious process behavior on workstations and servers.</li><li><strong>Intrusion Detection/Prevention Systems (IDS/IPS):</strong> Alerts on malicious network traffic patterns.</li><li><strong>Antivirus/Anti-malware:</strong> Alerts on known malicious files.</li></ul></li><li><strong>Human Reports:</strong><ul><li><strong>User-Reported Phishing:</strong> Employees forwarding suspicious emails.</li><li><strong>Help Desk Tickets:</strong> Users reporting unusual system behavior.</li><li><strong>External Notification:</strong> A third party (e.g., law enforcement, a customer) reports a breach.</li></ul></li></ul>"
                        },
                        {
                            "title": "The Role of a SIEM",
                            "content": "<p>A Security Information and Event Management (SIEM) system is a central hub for detection. It aggregates log data from hundreds or thousands of sources, correlates it to find patterns, and generates alerts.</p><h3>Core SIEM Functions:</h3><ul><li><strong>Log Aggregation:</strong> Collecting logs from firewalls, servers, applications, etc.</li><li><strong>Normalization:</strong> Converting logs from different formats into a common format.</li><li><strong>Correlation:</strong> Applying rules to link related events. For example, 'If a user logs in from two different countries within 10 minutes, create an alert.'</li><li><strong>Alerting:</strong> Notifying analysts when a correlation rule is triggered.</li><li><strong>Dashboards & Reporting:</strong> Providing visualization and analysis capabilities.</li></ul>"
                        },
                        {
                            "title": "Indicators of Compromise (IoCs)",
                            "content": "<p>IoCs are the digital breadcrumbs that an attacker leaves behind. They are pieces of forensic data that indicate a potential intrusion.</p><h3>Types of IoCs:</h3><ul><li><strong>IP Addresses:</strong> Malicious C2 (Command and Control) servers.</li><li><strong>Domain Names:</strong> Phishing sites or C2 domains.</li><li><strong>File Hashes (MD5, SHA256):</strong> Unique fingerprints of malware files.</li><li><strong>File Paths/Names:</strong> Specific files dropped by an attacker (e.g., `C:\\temp\\mimikatz.exe`).</li><li><strong>Registry Keys:</strong> Keys created by malware for persistence.</li><li><strong>User Agent Strings:</strong> Unique browser or tool identifiers used by attackers.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>From IoCs to IoAs</strong></div><p>While IoCs are useful, advanced attackers can change them easily. The industry is moving towards Indicators of *Attack* (IoAs), which focus on the attacker's *behavior* (e.g., 'A PowerShell process spawning from a Word document'), which is harder to change.</p></div>"
                        },
                        {
                            "title": "Initial Triage and False Positive Management",
                            "content": "<p>Not every alert is a real incident. Triage is the process of quickly investigating an alert to determine if it's a <strong>True Positive</strong> (a real incident) or a <strong>False Positive</strong> (legitimate activity that accidentally triggered a rule).</p><h3>Steps in Triage:</h3><ol><li><strong>Enrich the Data:</strong> Gather more context. Who is the user? What is the hostname? What is its function?</li><li><strong>Check Baselines:</strong> Is this normal behavior for this user or system?</li><li><strong>Consult Threat Intelligence:</strong> Is the IP address or domain known to be malicious?</li><li><strong>Make a Decision:</strong> Escalate as a potential incident or close as a false positive.</li></ol><p>Managing false positives is critical. If analysts are overwhelmed by noisy alerts, they will miss the real ones. This involves tuning correlation rules and creating allow-lists for known good behavior.</p>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Simple Log Parser in Python to Find IoCs",
                            "language": "python",
                            "code": "import re\n\n# A list of known malicious IP addresses (IoCs)\nmalicious_ips = ['198.51.100.55', '203.0.113.12']\n\ndef parse_firewall_log(log_file):\n    print(f\"Scanning {log_file} for known malicious IPs...\")\n    found_iocs = []\n    ip_regex = r\"\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b\"\n\n    with open(log_file, 'r') as f:\n        for line_num, line in enumerate(f, 1):\n            # Find all IPs in the line\n            ips_in_line = re.findall(ip_regex, line)\n            for ip in ips_in_line:\n                if ip in malicious_ips:\n                    print(f\"  [!] Found malicious IP {ip} on line {line_num}\")\n                    found_iocs.append(ip)\n    \n    if not found_iocs:\n        print(\"No known malicious IPs found.\")\n    return set(found_iocs)\n\n# Create a dummy log file for the example\nwith open('firewall.log', 'w') as f:\n    f.write(\"Sep 1 10:00:01 fw1 ALLOW src=192.168.1.10 dst=203.0.113.12 port=443\\n\")\n    f.write(\"Sep 1 10:00:02 fw1 DENY src=198.51.100.55 dst=10.0.0.5 port=80\\n\")\n    f.write(\"Sep 1 10:00:03 fw1 ALLOW src=192.168.1.12 dst=8.8.8.8 port=53\\n\")\n\nparse_firewall_log('firewall.log')"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary function of a SIEM system?",
                            "options": [
                                "To block malicious files on an endpoint.",
                                "To automatically patch system vulnerabilities.",
                                "To aggregate and correlate log data from multiple sources to detect threats.",
                                "To conduct deep forensic analysis of a hard drive."
                            ],
                            "correct": 2,
                            "explanation": "A SIEM's core purpose is to provide a centralized view of security data by collecting, normalizing, and correlating logs to identify potential incidents."
                        },
                        {
                            "id": 2,
                            "question": "Which of the following is a classic example of an Indicator of Compromise (IoC)?",
                            "options": [
                                "A strong password policy.",
                                "A SHA256 hash of a known malware file.",
                                "A company's acceptable use policy.",
                                "A daily data backup."
                            ],
                            "correct": 1,
                            "explanation": "A file hash is a specific, measurable artifact that can be used to identify a malicious file, making it a perfect example of an IoC."
                        },
                        {
                            "id": 3,
                            "question": "An alert is triggered for a developer running a network scan, which is part of their normal job. This is an example of a:",
                            "options": [
                                "True Positive",
                                "True Negative",
                                "False Negative",
                                "False Positive"
                            ],
                            "correct": 3,
                            "explanation": "It's a False Positive because the activity was legitimate and benign, but it triggered a security rule that was likely too broad."
                        }
                    ]
                }
            },
            {
                "id": "lesson-6",
                "title": "Incident Classification and Prioritization",
                "duration": "90 min",
                "objectives": [
                    "Develop and apply incident classification schemes.",
                    "Define criteria for assessing incident severity and priority.",
                    "Utilize a business impact evaluation to inform prioritization.",
                    "Create a risk-based prioritization matrix.",
                    "Establish clear escalation triggers and thresholds."
                ],
                "content": {
                    "overview": "Not all incidents are emergencies. Effective response requires a system to quickly classify an incident's severity and prioritize it based on its potential impact to the business. This lesson covers the methodologies for building a consistent and defensible prioritization framework.",
                    "sections": [
                        {
                            "title": "Classification vs. Prioritization",
                            "content": "<p>These two concepts are related but distinct.</p><ul><li><strong>Classification:</strong> Is about 'what' the incident is. It involves categorizing the incident based on its type (e.g., Malware, Phishing, DoS) and its technical scope.</li><li><strong>Prioritization:</strong> Is about 'how important' the incident is. It involves evaluating the incident's business impact to determine how urgently it needs to be addressed.</li></ul><p>For example, a malware infection (classification) on a low-importance test server is a low priority. The same malware infection on a critical production database server is a critical priority.</p>"
                        },
                        {
                            "title": "Defining Severity and Priority Levels",
                            "content": "<p>A clear, simple set of levels is essential. Most organizations use a 3 to 5 level scale.</p><h3>Example 5-Level Priority Scheme (P1-P5):</h3><ul><li><strong>P1 - Critical:</strong> Widespread business impact, critical data breach, risk to life, significant financial or reputational loss. Requires immediate, 24/7 response.</li><li><strong>P2 - High:</strong> Significant business impact, disruption of a critical service, potential for data loss. Requires immediate response during business hours.</li><li><strong>P3 - Medium:</strong> Moderate business impact, single system or small group of users affected. Response is required within a set number of hours.</li><li><strong>P4 - Low:</strong> Minor impact, no disruption to business functions. Addressed during normal business operations.</li><li><strong>P5 - Informational:</strong> No immediate threat, but activity is logged for review and trending.</li></ul>"
                        },
                        {
                            "title": "The Prioritization Matrix",
                            "content": "<p>A prioritization matrix helps analysts make consistent decisions by plotting the incident's impact against the types of resources affected.</p><h3>Example Matrix:</h3><table class=\"table\"><thead><tr><th>Impact</th><th>Workstation / Single User</th><th>Standard Server</th><th>Critical Server / Data</th></tr></thead><tbody><tr><td><strong>Low (e.g., single malware detection, blocked)</strong></td><td>P4</td><td>P3</td><td>P3</td></tr><tr><td><strong>Medium (e.g., successful phishing click, no data loss)</strong></td><td>P3</td><td>P2</td><td>P2</td></tr><tr><td><strong>High (e.g., active ransomware, data exfiltration)</strong></td><td>P2</td><td>P1</td><td>P1</td></tr></tbody></table><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>Key Factors</strong></div><p>When assessing impact, consider: Data Sensitivity (e.g., PII, PHI, financial), Criticality of the System, Number of Users Affected, and potential for Lateral Movement.</p></div>"
                        },
                        {
                            "title": "Escalation Triggers",
                            "content": "<p>Triggers are pre-defined conditions that automatically raise an incident's priority level or require notification to management.</p><h3>Common Triggers:</h3><ul><li><strong>Time-based:</strong> If a P3 incident is not contained within 4 hours, it automatically becomes a P2.</li><li><strong>Discovery-based:</strong> An incident initially classified as P3 (malware on one PC) is reclassified to P1 when analysis reveals that sensitive customer data was exfiltrated.</li><li><strong>Scope-based:</strong> An incident affecting 5 users is a P3. When it is found to affect 500 users, it becomes a P1.</li><li><strong>Regulatory:</strong> The discovery that an incident involves protected data (like GDPR or HIPAA) immediately raises its priority.</li></ul>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Python Function for Intelligent Prioritization",
                            "language": "python",
                            "code": "def calculate_priority(data_sensitivity, system_criticality, user_scope):\n    \"\"\"Calculates a priority score based on inputs (1-10 scale).\"\"\"\n    score = 0\n    \n    # Weight data sensitivity highest\n    score += data_sensitivity * 5\n    \n    # Weight system criticality second\n    score += system_criticality * 3\n    \n    # Weight user scope third\n    score += user_scope * 2\n    \n    if score >= 80:\n        return \"P1 - Critical\"\n    elif score >= 60:\n        return \"P2 - High\"\n    elif score >= 40:\n        return \"P3 - Medium\"\n    else:\n        return \"P4 - Low\"\n\n# Example: An incident involving highly sensitive data (10/10) on a critical server (9/10) affecting a small group (3/10).\ndata_sensitivity = 10\nsystem_criticality = 9\nuser_scope = 3\n\nincident_priority = calculate_priority(data_sensitivity, system_criticality, user_scope)\nprint(f\"Calculated Incident Priority: {incident_priority}\") # Should be P1"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary difference between incident classification and prioritization?",
                            "options": [
                                "There is no difference.",
                                "Classification defines 'what' it is; prioritization defines 'how important' it is.",
                                "Classification is done by senior analysts; prioritization is done by junior analysts.",
                                "Classification is for technical incidents; prioritization is for physical incidents."
                            ],
                            "correct": 1,
                            "explanation": "Classification categorizes the type of incident, while prioritization evaluates its business impact to determine the urgency of the response."
                        },
                        {
                            "id": 2,
                            "question": "A widespread ransomware attack that has halted all business operations should be classified with what priority level?",
                            "options": [
                                "P4 - Low",
                                "P3 - Medium",
                                "P5 - Informational",
                                "P1 - Critical"
                            ],
                            "correct": 3,
                            "explanation": "This scenario represents the highest level of business impact and requires an immediate, all-hands response, making it a P1-Critical incident."
                        },
                        {
                            "id": 3,
                            "question": "An incident is initially triaged as low priority. Later, the team discovers that personal customer data (PII) was exposed. This discovery is an example of what?",
                            "options": [
                                "A false positive.",
                                "An escalation trigger.",
                                "A lessons learned activity.",
                                "A containment strategy."
                            ],
                            "correct": 1,
                            "explanation": "The discovery of exposed PII is a pre-defined condition (a discovery-based trigger) that should automatically escalate the incident's priority level due to regulatory and reputational risk."
                        }
                    ]
                }
            },
            {
                "id": "lesson-7",
                "title": "Incident Containment Strategies",
                "duration": "100 min",
                "objectives": [
                    "Evaluate different criteria for selecting a containment strategy.",
                    "Understand techniques for network and system isolation.",
                    "Learn how to preserve critical forensic evidence during containment.",
                    "Compare short-term versus long-term containment approaches.",
                    "Explore the role of automation in containment."
                ],
                "content": {
                    "overview": "Containment is the critical point in the response where you stop the bleeding. The primary goal is to prevent the incident from spreading and causing further damage. This lesson covers the strategies and techniques for effectively isolating threats while balancing business impact and evidence preservation.",
                    "sections": [
                        {
                            "title": "The Goal of Containment",
                            "content": "<p>The primary goal of containment is to limit the immediate impact of an incident. It's a balancing act; the strategy must be effective enough to stop the attacker but not so disruptive that it causes more damage to the business than the incident itself.</p><h3>Key Decision Criteria:</h3><ul><li><strong>Speed of the attack:</strong> A fast-spreading threat like ransomware may require immediate, drastic action.</li><li><strong>Potential for damage:</strong> Incidents involving data exfiltration from critical servers require a more robust containment strategy.</li><li><strong>Evidence preservation:</strong> Containment actions can destroy forensic evidence. The need for evidence must be weighed against the need to stop the attack.</li><li><strong>Impact on business operations:</strong> Disconnecting a critical e-commerce server will have a significant financial impact.</li></ul>"
                        },
                        {
                            "title": "Containment Techniques",
                            "content": "<p>Containment can happen at the network, host, or application level.</p><h3>Common Techniques:</h3><ul><li><strong>Network Segmentation/Isolation:</strong> The most common technique. Disconnect the affected host from the network. This can be done by unplugging the network cable, disabling the switch port, or applying a restrictive firewall rule or VLAN.</li><li><strong>System Quarantine:</strong> Using an EDR agent to place a host in a 'quarantined' state, where it can only communicate with the security team's analysis servers. This allows for investigation without risk of spreading.</li><li><strong>User Account Disablement:</strong> If a user's account is compromised, immediately disable or reset the password to revoke the attacker's access.</li><li><strong>Service/Application Shutdown:</strong> If a specific application is being exploited, temporarily shut down that service to prevent further compromise.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Don't Just Power Off!</strong></div><p>Pulling the plug on a compromised machine is a tempting but often poor choice. It destroys all volatile memory (RAM), which may contain crucial forensic evidence about the attacker's activities.</p></div>"
                        },
                        {
                            "title": "Short-Term vs. Long-Term Containment",
                            "content": "<p>Containment is often a phased approach.</p><ul><li><strong>Short-Term Containment:</strong> This is the immediate, emergency action. For example, isolating a host from the internet but leaving it on the internal network for analysis. The goal is to give the IR team time to investigate without the attacker continuing their actions.</li><li><strong>Long-Term Containment:</strong> This is a more robust solution put in place after initial analysis. For example, rebuilding the infected host from a clean backup and applying security patches. The original system is kept offline for deep forensic analysis.</li></ul>"
                        },
                        {
                            "title": "Automated Containment",
                            "content": "<p>Modern Security Orchestration, Automation, and Response (SOAR) platforms can perform containment actions automatically, dramatically reducing response time.</p><h3>Example Automated Workflow:</h3><ol><li>EDR tool detects a known ransomware process on a laptop.</li><li>EDR sends an alert to the SOAR platform.</li><li>The SOAR platform executes a playbook:</li><ol type=\"a\"><li>It enriches the alert with user and asset data.</li><li>It automatically triggers the EDR tool to quarantine the host.</li><li>It disables the user's VPN access.</li><li>It creates a critical priority ticket in the case management system.</li></ol><li>An analyst is notified that the automated containment has been performed.</li></ol><p>This entire process can happen in seconds, whereas manual response could take minutes or hours.</p>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Bash Script to Isolate a Host via Firewall",
                            "language": "bash",
                            "code": "#!/bin/bash\n\n# WARNING: This script is for educational purposes only.\n# Do not run on production systems without thorough testing.\n\nif [ -z \"$1\" ]; then\n  echo \"Usage: $0 <ip_to_isolate>\"\n  exit 1\nfi\n\nIP_TO_ISOLATE=$1\nLOG_FILE=\"/var/log/containment.log\"\n\necho \"$(date): Starting containment for IP: $IP_TO_ISOLATE\" >> $LOG_FILE\n\n# Check if iptables is installed\nif ! command -v iptables &> /dev/null\nthen\n    echo \"iptables command could not be found. Cannot perform containment.\" >> $LOG_FILE\n    exit 1\nfi\n\n# Create a new chain for isolating IPs\niptables -N ISOLATED_HOSTS\n\n# Block all traffic from the isolated IP\niptables -I ISOLATED_HOSTS 1 -s $IP_TO_ISOLATE -j DROP\n\n# Block all traffic to the isolated IP\niptables -I ISOLATED_HOSTS 2 -d $IP_TO_ISOLATE -j DROP\n\n# Jump to this chain from the main INPUT and OUTPUT chains\niptables -I INPUT 1 -j ISOLATED_HOSTS\niptables -I OUTPUT 1 -j ISOLATED_HOSTS\n\necho \"$(date): Successfully created iptables rules to isolate $IP_TO_ISOLATE\" >> $LOG_FILE\n\n# Display the current rules\niptables -L ISOLATED_HOSTS -v -n"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary reason to avoid immediately shutting down a compromised system?",
                            "options": [
                                "It could corrupt the hard drive.",
                                "It destroys volatile data in RAM, which is critical for forensic analysis.",
                                "It might anger the attacker.",
                                "The system may not boot back up."
                            ],
                            "correct": 1,
                            "explanation": "Volatile memory (RAM) contains active processes, network connections, and other crucial evidence of the attacker's live activity. Powering off the machine erases this valuable data."
                        },
                        {
                            "id": 2,
                            "question": "Using an EDR tool to block a compromised host from communicating with any system except for a forensics server is an example of what?",
                            "options": [
                                "Eradication",
                                "Recovery",
                                "Quarantine",
                                "Lessons Learned"
                            ],
                            "correct": 2,
                            "explanation": "Quarantine is a specific containment technique that isolates a host while still allowing limited access for investigation by the security team."
                        },
                        {
                            "id": 3,
                            "question": "A fast-spreading ransomware worm is actively encrypting files across the network. Which is the MOST appropriate initial containment strategy?",
                            "options": [
                                "Send an email asking users to turn off their computers.",
                                "Begin a deep forensic analysis of the first infected host.",
                                "Immediately segment the network to stop the spread, even if it causes some operational disruption.",
                                "Wait for the next patch Tuesday to apply updates."
                            ],
                            "correct": 2,
                            "explanation": "In a fast-moving, high-damage attack, the priority shifts to stopping the spread immediately. Network segmentation is the most effective way to do this, and the resulting business disruption is likely less severe than the damage from the ransomware."
                        }
                    ]
                }
            },
            {
                "id": "lesson-8",
                "title": "Digital Forensics Integration",
                "duration": "120 min",
                "objectives": [
                    "Understand the fundamental principles of digital forensics for IR.",
                    "Learn the process of evidence collection and maintaining the chain of custody.",
                    "Explore techniques for forensic imaging and data preservation.",
                    "Differentiate between network, memory, and disk forensics.",
                    "Recognize legal requirements for evidence admissibility."
                ],
                "content": {
                    "overview": "Digital Forensics is the science of identifying, collecting, preserving, and analyzing digital evidence. For an incident responder, forensic skills are essential to understand the root cause of an incident and ensure that any evidence collected can be used in legal or disciplinary proceedings.",
                    "sections": [
                        {
                            "title": "Forensics Fundamentals",
                            "content": "<p>The goal of forensics in IR is to reconstruct the events of an incident to answer key questions: Who, What, Where, When, and How?</p><h3>Core Principles:</h3><ul><li><strong>Preserve the original evidence:</strong> Analysis should always be performed on a copy (a forensic image), never on the original evidence.</li><li><strong>Document everything:</strong> Every step taken, tool used, and observation made must be meticulously documented.</li><li><strong>Maintain a Chain of Custody:</strong> A formal record showing who has handled the evidence, when, and for what purpose. This is critical for legal admissibility.</li><li><strong>Follow a repeatable process:</strong> Use scientifically sound and validated tools and techniques.</li></ul>"
                        },
                        {
                            "title": "Evidence Collection and Chain of Custody",
                            "content": "<p>The first step is to collect the data in a forensically sound manner. This often follows the 'Order of Volatility'.</p><h3>Order of Volatility (Most to Least Volatile):</h3><ol><li><strong>CPU registers, cache:</strong> Extremely volatile, rarely collected.</li><li><strong>Memory (RAM):</strong> Highly volatile. Contains running processes, network connections, encryption keys. Must be collected from a live system.</li><li><strong>Network state:</strong> Active connections, routing tables.</li><li><strong>Running processes:</strong> What is currently executing on the system.</li><li><strong>Disk data:</strong> Files on hard drives, SSDs.</li><li><strong>Backups, logs:</strong> The least volatile data.</li></ol><p>A <strong>Chain of Custody</strong> form is a physical or digital document that tracks the evidence from collection to court. It includes details like case number, item description, serial number, who collected it, and a signature log for every time it changes hands.</p>"
                        },
                        {
                            "title": "Types of Digital Forensics",
                            "content": "<p>Different types of data require different tools and techniques.</p><h3>Major Disciplines:</h3><ul><li><strong>Disk Forensics:</strong> The analysis of data on storage media like hard drives and SSDs. This involves recovering deleted files, searching for keywords, and analyzing file system timelines.</li><li><strong>Memory Forensics:</strong> The analysis of a 'memory dump' (a copy of RAM) from a live system. This is one of the most powerful techniques for finding active malware that may not write anything to the disk.</li><li><strong>Network Forensics:</strong> The analysis of network traffic captures (PCAP files). It's used to trace network connections, identify data exfiltration, and analyze attacker commands.</li><li><strong>Mobile/Cloud Forensics:</strong> Specialized disciplines for collecting and analyzing data from smartphones, tablets, and cloud environments (like AWS, Azure, GCP).</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Forensic Imaging</strong></div><p>A forensic image is a bit-for-bit copy of a storage device, including all deleted files and unallocated space. It's not the same as a backup. The image is verified with a cryptographic hash (e.g., SHA256) to prove it hasn't been altered.</p></div>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Bash Script for Forensic Evidence Collection (Imaging)",
                            "language": "bash",
                            "code": "#!/bin/bash\n\n# WARNING: This script demonstrates forensic principles for educational use.\n# Real-world forensics requires specialized, write-blocked hardware.\n\nSOURCE_DEVICE=\"/dev/sdb\"  # The evidence drive\nDESTINATION_DIR=\"/mnt/forensic_storage\"\nCASE_NUMBER=\"CASE-2025-001\"\n\n# Check for root privileges\nif [[ $EUID -ne 0 ]]; then\n   echo \"This script must be run as root\" \n   exit 1\nfi\n\n# Check if destination exists\nif [ ! -d \"$DESTINATION_DIR\" ]; then\n    echo \"Destination directory $DESTINATION_DIR does not exist.\"\n    exit 1\nfi\n\nIMAGE_FILE=\"$DESTINATION_DIR/$CASE_NUMBER-image.dd\"\nHASH_FILE=\"$DESTINATION_DIR/$CASE_NUMBER-hashes.txt\"\n\necho \"--- Starting Forensic Imaging Process ---\"\n\n# 1. Calculate pre-acquisition hash of the source device\necho \"Calculating pre-acquisition hash for $SOURCE_DEVICE...\"\nPRE_HASH=$(sha256sum $SOURCE_DEVICE | awk '{print $1}')\necho \"Source ($SOURCE_DEVICE) Pre-Hash (SHA256): $PRE_HASH\" | tee $HASH_FILE\n\n# 2. Create the bit-for-bit image using `dcfldd` (a forensic version of `dd`)\n# If dcfldd is not available, `dd` can be used.\necho \"Creating forensic image of $SOURCE_DEVICE...\"\ndcfldd if=$SOURCE_DEVICE of=$IMAGE_FILE hash=sha256 hashlog=$DESTINATION_DIR/$CASE_NUMBER-dcfldd-hash.txt\n\n# 3. Calculate post-acquisition hash of the created image file\necho \"Calculating post-acquisition hash for the image file...\"\nPOST_HASH=$(sha256sum $IMAGE_FILE | awk '{print $1}')\necho \"Image File ($IMAGE_FILE) Post-Hash (SHA256): $POST_HASH\" | tee -a $HASH_FILE\n\n# 4. Verify that the hashes match\necho \"--- Verification ---\"\nif [ \"$PRE_HASH\" == \"$POST_HASH\" ]; then\n    echo \"[SUCCESS] Hashes match! The image is a verified copy.\"\nelse\n    echo \"[FAILURE] HASH MISMATCH! The image is not a valid copy.\"\nfi"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "When performing digital forensics, analysis should always be conducted on:",
                            "options": [
                                "The original evidence.",
                                "A printed copy of the data.",
                                "A forensically sound copy (image) of the evidence.",
                                "A standard file backup of the evidence."
                            ],
                            "correct": 2,
                            "explanation": "A core principle of digital forensics is to preserve the original evidence. Analysis is always done on a bit-for-bit copy, or image, to prevent any alteration of the original."
                        },
                        {
                            "id": 2,
                            "question": "What is the primary purpose of a 'Chain of Custody' document?",
                            "options": [
                                "To list the tools used during the investigation.",
                                "To provide a technical summary of the findings.",
                                "To legally prove who has handled the evidence and when, ensuring its integrity.",
                                "To get budget approval for the investigation."
                            ],
                            "correct": 2,
                            "explanation": "The Chain of Custody is a legal document that provides an audit trail of evidence handling, which is crucial for the evidence to be admissible in court."
                        },
                        {
                            "id": 3,
                            "question": "According to the Order of Volatility, which of the following should be collected first?",
                            "options": [
                                "Files on the hard drive.",
                                "Data from system backups.",
                                "The contents of system memory (RAM).",
                                "Logs from a SIEM."
                            ],
                            "correct": 2,
                            "explanation": "Memory (RAM) is highly volatile and will be lost when the system is powered off. Therefore, it should be collected from a live system before less volatile data like hard drive contents."
                        }
                    ]
                }
            },
            {
                "id": "lesson-9",
                "title": "Malware Analysis and Threat Hunting",
                "duration": "120 min",
                "objectives": [
                    "Understand basic techniques for malware analysis in an IR context.",
                    "Differentiate between static and dynamic analysis.",
                    "Recognize the importance of using safe sandbox environments.",
                    "Learn how to integrate proactive threat hunting with reactive IR.",
                    "Utilize behavioral analysis to detect unknown threats."
                ],
                "content": {
                    "overview": "Understanding the adversary's tools is key to defeating them. This lesson introduces the basics of malware analysis and the proactive discipline of threat hunting, moving the security team from a purely reactive posture to actively searching for hidden threats within the network.",
                    "sections": [
                        {
                            "title": "Malware Analysis for Incident Responders",
                            "content": "<p>The goal of malware analysis in IR is not necessarily to fully reverse-engineer the malware, but to quickly extract actionable intelligence, such as Indicators of Compromise (IoCs), to aid in containment and eradication.</p><h3>Two Main Types of Analysis:</h3><ul><li><strong>Static Analysis:</strong> Examining the malware file without executing it. This is the safer first step. Techniques include:<ul><li>Running the `strings` command to look for readable text like IP addresses or URLs.</li><li>Analyzing the file header to determine the file type.</li><li>Scanning the file with multiple antivirus engines (like on VirusTotal).</li><li>Looking at the list of imported functions to guess its capabilities.</li></ul></li><li><strong>Dynamic Analysis:</strong> Executing the malware in a safe, isolated environment (a 'sandbox') to observe its behavior. This is more risky but provides much richer information. The sandbox monitors:<ul><li>Network connections the malware tries to make.</li><li>Files it creates, modifies, or deletes.</li><li>Registry keys it changes.</li><li>Processes it launches.</li></ul></li></ul>"
                        },
                        {
                            "title": "The Importance of Sandboxing",
                            "content": "<p>A sandbox is an isolated virtual machine designed specifically for analyzing malicious code. It prevents the malware from infecting the analyst's machine or the corporate network.</p><h3>Key Features of a Sandbox:</h3><ul><li><strong>Isolation:</strong> The virtual machine is completely firewalled off from the production network.</li><li><strong>Instrumentation:</strong> The sandbox has tools that monitor and log every action the malware takes.</li><li><strong>Revertible:</strong> After the analysis is complete, the virtual machine can be reverted to a clean 'snapshot' in seconds, ready for the next sample.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Anti-Analysis Techniques</strong></div><p>Modern malware is often 'sandbox-aware'. It may check if it's running in a virtual machine (e.g., by looking for VMWare tools) and will not execute its malicious payload if it detects it's being analyzed. This creates a cat-and-mouse game between analysts and malware authors.</p></div>"
                        },
                        {
                            "title": "Introduction to Threat Hunting",
                            "content": "<p>Threat hunting is the proactive search for cyber threats that are lurking undetected in a network. Unlike reactive incident response, which starts with an alert, threat hunting starts with a hypothesis.</p><h3>The Threat Hunting Loop:</h3><ol><li><strong>Create a Hypothesis:</strong> Start with a 'what if' question based on threat intelligence or experience. For example: 'I hypothesize an attacker is using PowerShell for lateral movement, evading our EDR.'</li><li><strong>Investigate:</strong> Use tools like SIEM, EDR, and log analysis to search for evidence supporting the hypothesis. For the example, you might search for PowerShell commands that contain suspicious keywords like `Invoke-Mimikatz`.</li><li><strong>Uncover New Patterns:</strong> During the investigation, you might find new attacker techniques or IoCs.</li><li><strong>Inform and Enrich Analytics:</strong> If the hunt is successful, you use your findings to create new, automated detection rules in your SIEM or EDR. This turns a successful hunt into a future automated alert, maturing your security posture.</li></ol>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Python Script to Submit File Hash to VirusTotal API",
                            "language": "python",
                            "code": "import requests\nimport hashlib\n\n# NOTE: You need a free VirusTotal API key for this to work.\nAPI_KEY = 'YOUR_VIRUSTOTAL_API_KEY'\nFILE_TO_CHECK = 'malware_sample.exe' # A sample file to check\n\ndef get_file_hash(filename):\n    \"\"\"Calculates the SHA256 hash of a file.\"\"\"\n    sha256_hash = hashlib.sha256()\n    with open(filename, \"rb\") as f:\n        for byte_block in iter(lambda: f.read(4096), b\"\"):\n            sha256_hash.update(byte_block)\n    return sha256_hash.hexdigest()\n\ndef check_hash_on_virustotal(file_hash):\n    \"\"\"Checks a file hash against the VirusTotal API.\"\"\"\n    if API_KEY == 'YOUR_VIRUSTOTAL_API_KEY':\n        print(\"Error: Please replace 'YOUR_VIRUSTOTAL_API_KEY' with your actual key.\")\n        return\n\n    url = f'https://www.virustotal.com/api/v3/files/{file_hash}'\n    headers = {\n        'x-apikey': API_KEY\n    }\n    \n    response = requests.get(url, headers=headers)\n    \n    if response.status_code == 200:\n        result = response.json()\n        stats = result['data']['attributes']['last_analysis_stats']\n        detections = stats['malicious']\n        total = sum(stats.values())\n        print(f\"--- VirusTotal Report for {file_hash} ---\")\n        print(f\"Detections: {detections} / {total}\")\n        if detections > 0:\n            print(\"Result: MALICIOUS\")\n        else:\n            print(\"Result: Clean\")\n    elif response.status_code == 404:\n        print(f\"Hash {file_hash} not found on VirusTotal.\")\n    else:\n        print(f\"Error: {response.status_code} - {response.text}\")\n\n# Create a dummy file for the example\nwith open(FILE_TO_CHECK, 'w') as f:\n    f.write('This is a test file.')\n\nfile_hash_to_check = get_file_hash(FILE_TO_CHECK)\ncheck_hash_on_virustotal(file_hash_to_check)"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "Running a malware executable in an isolated virtual machine to see what it does is an example of what?",
                            "options": [
                                "Static Analysis",
                                "Dynamic Analysis",
                                "Threat Hunting",
                                "Log Correlation"
                            ],
                            "correct": 1,
                            "explanation": "Dynamic analysis involves executing the code to observe its behavior, such as network connections and file system changes, in a controlled environment."
                        },
                        {
                            "id": 2,
                            "question": "What is the primary goal of threat hunting?",
                            "options": [
                                "To respond to active SIEM alerts.",
                                "To patch vulnerabilities on servers.",
                                "To proactively search for threats that have evaded existing security controls.",
                                "To write the incident response plan."
                            ],
                            "correct": 2,
                            "explanation": "Threat hunting is a proactive discipline that assumes a breach has occurred and involves actively searching for evidence of compromise, rather than waiting for an automated alert."
                        },
                        {
                            "id": 3,
                            "question": "Using the `strings` command on a binary file to find readable text like an IP address is a form of:",
                            "options": [
                                "Static Analysis",
                                "Dynamic Analysis",
                                "Memory Forensics",
                                "Network Forensics"
                            ],
                            "correct": 0,
                            "explanation": "This is static analysis because the file is being examined without being executed."
                        }
                    ]
                }
            },
            {
                "id": "lesson-10",
                "title": "Communication and Stakeholder Management",
                "duration": "100 min",
                "objectives": [
                    "Develop a strategic incident communication plan.",
                    "Differentiate between internal and external communication procedures.",
                    "Create effective executive briefings and reports.",
                    "Understand how to manage media relations during a crisis.",
                    "Apply best practices for crisis communication."
                ],
                "content": {
                    "overview": "During a security incident, communication is just as critical as the technical response. A failure to communicate effectively can lead to panic, reputational damage, and poor decision-making. This lesson covers how to develop a communication strategy to keep all stakeholders informed and confident in the response effort.",
                    "sections": [
                        {
                            "title": "The Communication Plan",
                            "content": "<p>A communication plan should be a key component of your overall IRP. It defines the who, what, when, and how of communication during an incident.</p><h3>Key Elements:</h3><ul><li><strong>Stakeholder Matrix:</strong> A list of all potential stakeholders (internal and external) and their information needs.</li><li><strong>Communication Channels:</strong> The approved methods for communication (e.g., email distribution lists, Slack channels, conference bridges, status pages).</li><li><strong>Templates and Drafts:</strong> Pre-written templates for different types of updates (e.g., initial notification, status update, resolution notice) and different audiences.</li><li><strong>Frequency Guidelines:</strong> A defined cadence for updates (e.g., 'Executive updates will be provided every 4 hours for a critical incident').</li></ul>"
                        },
                        {
                            "title": "Internal vs. External Communication",
                            "content": "<p>Communication needs to be tailored to the audience.</p><h3>Internal Stakeholders:</h3><ul><li><strong>IR Team:</strong> Needs constant, real-time technical communication.</li><li><strong>IT Operations:</strong> Needs to be informed of containment actions that may impact their systems.</li><li><strong>Help Desk:</strong> Needs clear, simple scripts to handle user inquiries.</li><li><strong>Employees:</strong> May need to be informed of an issue or asked to take an action (e.g., 'Do not click on suspicious emails').</li><li><strong>Executive Leadership:</strong> Needs high-level, business-impact-focused summaries, not deep technical details.</li></ul><h3>External Stakeholders:</h3><ul><li><strong>Customers:</strong> May need to be notified of a data breach or service outage. This is often legally mandated.</li><li><strong>Regulators:</strong> Government and industry bodies that require formal notification.</li><li><strong>Law Enforcement:</strong> If you choose to involve them.</li><li><strong>The Public/Media:</strong> Handled through a formal PR process to control the narrative.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>The 3 C's of Crisis Communication</strong></div><p>All communications, especially external ones, should be: <strong>Clear</strong> (easy to understand), <strong>Credible</strong> (honest and transparent), and <strong>Consistent</strong> (the same message across all channels).</p></div>"
                        },
                        {
                            "title": "Executive Briefings",
                            "content": "<p>Communicating with executives requires a different approach. They need information to make strategic decisions, not to fix the technical problem.</p><h3>The BLUF Principle: Bottom Line Up Front</h3><p>Start with the most important information.</p><ul><li><strong>What happened:</strong> A one-sentence summary (e.g., 'We are responding to a ransomware incident that is impacting our manufacturing systems.').</li><li><strong>What is the impact:</strong> The business impact (e.g., 'Production is currently halted. There is no evidence of data theft at this time.').</li><li><strong>What are we doing:</strong> The high-level response strategy (e.g., 'We have engaged our cybersecurity partner and are working to restore systems from backup.').</li><li><strong>What do we need:</strong> Any decisions or resources required from leadership.</li></ul>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Python Script to Generate an Executive Status Report",
                            "language": "python",
                            "code": "def generate_exec_briefing(case_id, incident_type, impact, actions, next_steps):\n    \"\"\"Generates a structured executive briefing email body.\"\"\"\n    \n    subject = f\"URGENT: Security Incident Update - {incident_type} ({case_id})\"\n    \n    body = f\"\"\"\n    **Executive Summary (BLUF - Bottom Line Up Front):**\n    We are currently managing a {incident_type} incident. The primary business impact is {impact}. Our response team is actively engaged in containment and recovery.\n\n    --- DETAILS ---\n\n    **1. What Happened:**\n    - {incident_type}\n\n    **2. Business Impact:**\n    - {impact}\n\n    **3. Actions Taken:**\n    - {actions}\n\n    **4. Next Steps & ETA:**\n    - {next_steps}\n\n    The next update will be provided in approximately 2 hours or sooner if there is a significant development.\n    \"\"\"\n    \n    print(f\"--- Generating Briefing ---\\\nSubject: {subject}\\\n{body}\")\n\n# Example Usage\ngenerate_exec_briefing(\n    case_id=\"CASE-2025-002\",\n    incident_type=\"Ransomware Attack\",\n    impact=\"the encryption of 5 servers in the research department, halting project X\",\n    actions=\"Affected servers have been isolated from the network. Forensics team is analyzing a sample.\",\n    next_steps=\"Begin restoring servers from clean backups. ETA for initial restoration is 6 hours.\"\n)"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the 'BLUF' principle in executive communication?",
                            "options": [
                                "Be Loud, Unique, and Forthright.",
                                "Bottom Line Up Front.",
                                "Bring Legal Under Fire.",
                                "Brief Leaders Under Five minutes."
                            ],
                            "correct": 1,
                            "explanation": "BLUF (Bottom Line Up Front) means starting your communication with the most critical information and conclusion first, so executives can grasp the situation quickly."
                        },
                        {
                            "id": 2,
                            "question": "Which of the following is an example of an INTERNAL stakeholder?",
                            "options": [
                                "A customer whose data was breached.",
                                "A government regulator.",
                                "The company's Help Desk.",
                                "A journalist from a major newspaper."
                            ],
                            "correct": 2,
                            "explanation": "The Help Desk is an internal department within the organization, whereas customers, regulators, and the media are external stakeholders."
                        },
                        {
                            "id": 3,
                            "question": "Why is it important to have pre-written communication templates?",
                            "options": [
                                "To increase the word count of the IR plan.",
                                "To save time and reduce the chance of errors during a high-stress incident.",
                                "Templates are not important for communication.",
                                "To ensure all communications are highly technical."
                            ],
                            "correct": 1,
                            "explanation": "During a crisis, it's difficult to craft clear, accurate messages from scratch. Templates that have been pre-approved by Legal and PR save critical time and ensure consistency."
                        }
                    ]
                }
            },
            {
                "id": "lesson-11",
                "title": "Legal and Regulatory Considerations",
                "duration": "100 min",
                "objectives": [
                    "Identify key legal requirements that govern incident response.",
                    "Understand data breach notification laws and their timelines.",
                    "Recognize the reporting obligations of major regulations (GDPR, HIPAA, PCI DSS).",
                    "Learn best practices for coordinating with law enforcement.",
                    "Understand the concept and importance of attorney-client privilege."
                ],
                "content": {
                    "overview": "Incident response does not happen in a vacuum. It is governed by a complex web of laws and regulations that dictate how organizations must protect data and what they must do in the event of a breach. Ignoring these obligations can result in severe financial penalties and legal action.",
                    "sections": [
                        {
                            "title": "The Legal Duty to Respond",
                            "content": "<p>For many organizations, having an incident response plan is not just a good idea—it's the law. Numerous regulations require organizations to have the ability to detect and respond to security incidents.</p>"
                        },
                        {
                            "title": "Major Regulations and their Requirements",
                            "content": "<p>While laws vary by jurisdiction and industry, several key regulations have a global impact.</p><h3>Key Regulations:</h3><ul><li><strong>GDPR (General Data Protection Regulation):</strong> Applies to the personal data of EU residents. Requires notification to a supervisory authority 'without undue delay' and generally no later than <strong>72 hours</strong> after becoming aware of a breach.</li><li><strong>HIPAA (Health Insurance Portability and Accountability Act):</strong> Applies to protected health information (PHI) in the United States. Requires notification to affected individuals within 60 days of discovering a breach.</li><li><strong>PCI DSS (Payment Card Industry Data Security Standard):</strong> A contractual standard for handling credit card data. Requires a formal incident response plan and specific actions following a compromise of cardholder data.</li><li><strong>SOX (Sarbanes-Oxley Act):</strong> Affects publicly traded companies in the US. While not a direct cybersecurity law, its requirements for financial data integrity and internal controls make incident response a critical component of compliance.</li></ul>"
                        },
                        {
                            "title": "Data Breach Notification Laws",
                            "content": "<p>Most jurisdictions now have laws requiring organizations to notify affected individuals if their personal information is compromised. These laws are complex and vary significantly.</p><h3>Common Notification Triggers:</h3><ul><li>The unauthorized acquisition of...</li><li>Unencrypted personal information...</li><li>That creates a risk of harm to the individual.</li></ul><p>The definition of 'personal information' varies but often includes a name combined with a Social Security number, driver's license number, or financial account number.</p><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>The Clock is Ticking</strong></div><p>The notification clock (e.g., GDPR's 72 hours) often starts from the moment the organization becomes 'aware' of the breach, not when the investigation is complete. This creates immense pressure on the IR team to quickly determine the scope and nature of the incident.</p></div>"
                        },
                        {
                            "title": "Attorney-Client Privilege",
                            "content": "<p>In the aftermath of a breach, reports, and communications created by the IR team could potentially be used against the company in a lawsuit. To protect these sensitive analyses, organizations often engage external legal counsel to direct the investigation.</p><p>When forensics or IR work is done at the direction of a lawyer for the purpose of providing legal advice, the resulting work product may be protected by <strong>attorney-client privilege</strong>. This can prevent it from being discoverable in court. This is a critical legal strategy that must be planned *before* a major incident.</p>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Python Script: Breach Notification Decision Helper",
                            "language": "python",
                            "code": "def check_gdpr_notification(is_personal_data, is_high_risk_to_rights):\n    \"\"\"Simple decision tree for GDPR notification.\"\"\"\n    if not is_personal_data:\n        return \"No GDPR personal data involved. Notification not required under GDPR.\"\n    \n    print(\"Personal data under GDPR is involved.\")\n    \n    # Always notify supervisory authority unless there's no risk\n    notification = [\"Notify Supervisory Authority (e.g., ICO, CNIL) within 72 hours.\"]\n    \n    if is_high_risk_to_rights:\n        notification.append(\"Notify affected data subjects directly without undue delay.\")\n    else:\n        notification.append(\"Direct notification to data subjects may not be required if risk is not high.\")\n        \n    return \"\\n\".join(notification)\n\n# Scenario 1: Encrypted laptop is lost, key is safe. Low risk.\nprint(\"--- Scenario 1 ---\")\nprint(check_gdpr_notification(is_personal_data=True, is_high_risk_to_rights=False))\n\n# Scenario 2: Unencrypted customer database leaked online. High risk.\nprint(\"\\n--- Scenario 2 ---\")\nprint(check_gdpr_notification(is_personal_data=True, is_high_risk_to_rights=True))"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "Under GDPR, what is the general timeframe for notifying the supervisory authority of a data breach?",
                            "options": [
                                "Within 30 days.",
                                "Within 1 year.",
                                "Within 72 hours of becoming aware of it.",
                                "There is no specific timeframe."
                            ],
                            "correct": 2,
                            "explanation": "GDPR is known for its strict 72-hour notification deadline for informing the relevant data protection authority."
                        },
                        {
                            "id": 2,
                            "question": "What is the primary purpose of involving legal counsel to direct an incident response investigation?",
                            "options": [
                                "To have them perform the technical forensics.",
                                "To potentially protect the investigation's findings under attorney-client privilege.",
                                "To slow down the investigation.",
                                "To get a bigger budget for the response."
                            ],
                            "correct": 1,
                            "explanation": "When legal counsel directs the investigation, the work product is created for the purpose of providing legal advice, which is the foundation for asserting attorney-client privilege."
                        },
                        {
                            "id": 3,
                            "question": "Which regulation is primarily concerned with protecting health information in the United States?",
                            "options": [
                                "GDPR",
                                "PCI DSS",
                                "HIPAA",
                                "SOX"
                            ],
                            "correct": 2,
                            "explanation": "HIPAA (Health Insurance Portability and Accountability Act) sets the standard for protecting sensitive patient health information (PHI)."
                        }
                    ]
                }
            },
            {
                "id": "lesson-12",
                "title": "Eradication and Recovery Planning",
                "duration": "100 min",
                "objectives": [
                    "Apply root cause analysis methodologies to identify the ultimate source of an incident.",
                    "Develop procedures for thoroughly cleaning systems and removing malware.",
                    "Plan for system restoration, including rebuilding and data recovery.",
                    "Implement security hardening and vulnerability remediation to prevent recurrence.",
                    "Create a process for verifying and testing the success of the recovery."
                ],
                "content": {
                    "overview": "After an incident is contained, the next steps are to eliminate the threat and restore operations. Eradication involves removing the attacker and their tools from the environment, while Recovery focuses on safely returning affected systems to a production-ready state. This lesson covers the strategies for both.",
                    "sections": [
                        {
                            "title": "Eradication: Removing the Threat",
                            "content": "<p>Eradication is the step where you remove the root cause of the incident. Simply deleting a malware file is often not enough; you must eliminate the vulnerability that allowed it to get there in the first place.</p><h3>Key Eradication Activities:</h3><ul><li><strong>Root Cause Analysis (RCA):</strong> Before you can eradicate, you must understand the true root cause. Was it an unpatched vulnerability? A successful phish? A weak password? The '5 Whys' is a simple but effective RCA technique.</li><li><strong>Malware Removal:</strong> Eliminating all components of the attacker's presence, including malware, persistence mechanisms (e.g., scheduled tasks, registry keys), and any backdoors they may have installed.</li><li><strong>Vulnerability Remediation:</strong> Patching the software, updating the configuration, or implementing a new control to close the security gap that the attacker exploited.</li><li><strong>Credential Reset:</strong> If passwords or access keys were compromised, they must all be reset.</li></ul>"
                        },
                        {
                            "title": "The 'Rebuild vs. Clean' Decision",
                            "content": "<p>When a system is compromised, especially by a rootkit or advanced malware, you face a critical decision: try to clean the existing system or rebuild it from scratch?</p><ul><li><strong>Cleaning:</strong> Attempting to remove the malware from the live system. This is often faster but carries a high risk that some component of the malware will be missed, allowing the attacker to regain access.</li><li><strong>Rebuilding:</strong> Wiping the system and reinstalling the operating system, applications, and data from a known-good, trusted source (like a clean backup and verified application installers). This is the safest and most recommended approach for critical systems. It ensures the attacker's tools are completely eliminated.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Nuke it from Orbit</strong></div><p>The industry best practice for a confirmed system compromise is clear: 'Nuke it from orbit. It's the only way to be sure.' Always favor rebuilding over cleaning for anything other than the most trivial incidents.</p></div>"
                        },
                        {
                            "title": "Recovery Planning and Execution",
                            "content": "<p>Recovery is the process of bringing the rebuilt or cleaned systems back online and returning to normal business operations.</p><h3>Recovery Steps:</h3><ol><li><strong>Restore from Backup:</strong> Restore data from the most recent, known-clean backup. Be careful not to restore the malware along with the data.</li><li><strong>Apply Hardening and Patches:</strong> Ensure the rebuilt system is fully patched and configured according to security best practices *before* it is connected back to the network.</li><li><strong>Phased Restoration:</strong> Bring systems back online in a controlled manner, starting with the most critical ones.</li><li><strong>Monitoring and Verification:</strong> Once a system is back online, it must be intensively monitored for any signs of suspicious activity to ensure the recovery was successful and the attacker is not still present.</li></ol>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Ansible Playbook for Automated System Hardening",
                            "language": "yaml",
                            "code": "---\n- name: Harden Ubuntu Server Post-Recovery\n  hosts: recovered_servers\n  become: yes\n\n  tasks:\n    - name: Ensure latest security patches are installed\n      apt:\n        update_cache: yes\n        upgrade: dist\n\n    - name: Ensure UFW firewall is enabled\n      ufw:\n        state: enabled\n        policy: deny\n\n    - name: Allow essential ports (e.g., SSH, HTTP, HTTPS)\n      ufw:\n        rule: allow\n        name: \"{{ item }}\"\n      with_items:\n        - OpenSSH\n        - Nginx Full\n\n    - name: Disable root login over SSH\n      lineinfile:\n        path: /etc/ssh/sshd_config\n        regexp: '^PermitRootLogin'\n        line: 'PermitRootLogin no'\n      notify: restart sshd\n\n    - name: Ensure auditd is installed for logging\n      apt:\n        name: auditd\n        state: present\n\n  handlers:\n    - name: restart sshd\n      service:\n        name: sshd\n        state: restarted"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary goal of the eradication phase?",
                            "options": [
                                "To restore data from backups.",
                                "To remove the root cause of the incident and the attacker's tools.",
                                "To notify customers of a data breach.",
                                "To contain the incident to a single host."
                            ],
                            "correct": 1,
                            "explanation": "Eradication focuses on completely removing the threat and fixing the underlying vulnerability to prevent the incident from immediately recurring."
                        },
                        {
                            "id": 2,
                            "question": "For a critically compromised server, what is the generally recommended best practice?",
                            "options": [
                                "Run an antivirus scan and hope it finds everything.",
                                "Wipe the server and rebuild it from a known-good source.",
                                "Unplug it from the network and leave it off.",
                                "Try to clean the malware off the live system to save time."
                            ],
                            "correct": 1,
                            "explanation": "Rebuilding from a trusted state is the only way to be confident that all attacker persistence mechanisms and backdoors have been removed."
                        },
                        {
                            "id": 3,
                            "question": "During the recovery phase, what is a crucial final step after bringing a system back online?",
                            "options": [
                                "Immediately move on to the next incident.",
                                "Take a long vacation.",
                                "Intensively monitor the system for any signs of anomalous activity.",
                                "Delete all logs from the incident."
                            ],
                            "correct": 2,
                            "explanation": "Post-recovery monitoring is critical to verify that the eradication was successful and that the attacker does not still have a foothold in the environment."
                        }
                    ]
                }
            },
            {
                "id": "lesson-13",
                "title": "Business Continuity Integration",
                "duration": "90 min",
                "objectives": [
                    "Align incident response activities with the organization's Business Continuity (BC) plan.",
                    "Understand the concepts of Recovery Time Objective (RTO) and Recovery Point Objective (RPO).",
                    "Identify critical business processes and their dependencies.",
                    "Develop strategies to minimize customer impact during an extended outage.",
                    "Integrate vendor and supplier coordination into recovery planning."
                ],
                "content": {
                    "overview": "A severe security incident is not just a technical problem; it's a business disruption. This lesson explores the crucial link between Incident Response and Business Continuity, ensuring that technical recovery efforts are aligned with the overarching goal of keeping the business running.",
                    "sections": [
                        {
                            "title": "Aligning IR and BC",
                            "content": "<p>Incident Response (IR) and Business Continuity (BC) must work together. IR focuses on remediating the security threat, while BC focuses on maintaining or restoring critical business functions in the face of that disruption.</p><h3>Points of Integration:</h3><ul><li>The Business Impact Analysis (BIA), a core BC document, provides the IR team with a prioritized list of critical systems.</li><li>The IR team's assessment of the incident's scope informs the BC team whether they need to activate their plans.</li><li>Recovery time estimates from the IR team are used by the BC team to manage business expectations.</li></ul>"
                        },
                        {
                            "title": "RTO and RPO: The Guiding Metrics",
                            "content": "<p>These two metrics are defined by the business (not IT) and are fundamental to recovery planning.</p><ul><li><strong>Recovery Time Objective (RTO):</strong> The maximum acceptable amount of time a system or business process can be offline after a disaster or disruption. The RTO dictates the required speed of the recovery effort. An RTO of 4 hours means the business requires the system to be back online within 4 hours.</li><li><strong>Recovery Point Objective (RPO):</strong> The maximum acceptable amount of data loss, measured in time. The RPO dictates the required frequency of backups. An RPO of 1 hour means the business can tolerate losing, at most, 1 hour's worth of data, requiring backups at least every hour.</li></ul><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>IR's Role with RTO/RPO</strong></div><p>During an incident, the IR team must understand the RTO and RPO of affected systems. If a server has an RTO of 2 hours, the team knows they have a very aggressive timeline for eradication and recovery. This helps prioritize their efforts.</p></div>"
                        },
                        {
                            "title": "Beyond Technology: Process and People",
                            "content": "<p>Business continuity is not just about restoring servers. It's about enabling business processes to continue, which may involve manual workarounds.</p><h3>Example Scenario:</h3><p>A ransomware attack takes down the automated invoicing system (the technical problem).</p><ul><li><strong>Incident Response</strong> focuses on isolating the affected servers, analyzing the malware, and rebuilding the system.</li><li><strong>Business Continuity</strong> focuses on the 'how do we send invoices *now*?' problem. Their plan might involve:<ul><li>Pulling customer data from a separate CRM system.</li><li>Using a spreadsheet template to create invoices manually.</li><li>Having staff email the invoices directly to clients.</li></ul></li></ul><p>This ensures that the critical business process of getting paid can continue, even while the primary IT system is being recovered.</p>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Python Script for Business Impact Assessment",
                            "language": "python",
                            "code": "# A simple tool to quantify business impact\n\ndef calculate_impact(revenue_per_hour, downtime_hours, brand_damage_factor, recovery_cost):\n    \"\"\"Calculates the financial impact of an outage.\"\"\"\n    \n    lost_revenue = revenue_per_hour * downtime_hours\n    \n    # Brand damage is subjective, represented as a multiplier on lost revenue\n    brand_impact = lost_revenue * brand_damage_factor\n    \n    total_impact = lost_revenue + brand_impact + recovery_cost\n    \n    print(\"--- Business Impact Analysis ---\")\n    print(f\"Lost Revenue: ${lost_revenue:,.2f}\")\n    print(f\"Estimated Brand/Reputation Impact: ${brand_impact:,.2f}\")\n    print(f\"Direct Recovery Costs: ${recovery_cost:,.2f}\")\n    print(\"-------------------------------------\")\n    print(f\"Total Estimated Financial Impact: ${total_impact:,.2f}\")\n    \n    return total_impact\n\n# Example: A critical e-commerce platform that generates $50,000/hour is down for 8 hours.\n# The incident is public, causing significant brand damage (factor 1.5x revenue loss).\n# Recovery costs are $100,000.\n\ncalculate_impact(\n    revenue_per_hour=50000,\n    downtime_hours=8,\n    brand_damage_factor=1.5, \n    recovery_cost=100000\n)"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "Your company's policy states that the customer database can't afford to lose more than 15 minutes of data. This is an example of what?",
                            "options": [
                                "Recovery Time Objective (RTO)",
                                "Recovery Point Objective (RPO)",
                                "Service Level Agreement (SLA)",
                                "Acceptable Use Policy (AUP)"
                            ],
                            "correct": 1,
                            "explanation": "RPO defines the maximum acceptable amount of data loss. An RPO of 15 minutes dictates that backups must be taken at least every 15 minutes."
                        },
                        {
                            "id": 2,
                            "question": "A critical server has an RTO of 2 hours. What does this mean for the incident response team?",
                            "options": [
                                "They must recover 2 hours worth of data.",
                                "They should take a 2-hour break before starting.",
                                "They are under pressure to complete eradication and recovery for that server within 2 hours.",
                                "The server must be backed up every 2 hours."
                            ],
                            "correct": 2,
                            "explanation": "RTO is the deadline for recovery. It sets the pace for the IR team and helps them prioritize which systems to work on first."
                        },
                        {
                            "id": 3,
                            "question": "While the IR team is rebuilding a compromised payroll system, the BC team implements a plan to pay employees using manual paper checks. This is an example of:",
                            "options": [
                                "A technical recovery procedure.",
                                "A business process workaround.",
                                "A forensic investigation.",
                                "A containment strategy."
                            ],
                            "correct": 1,
                            "explanation": "This is a classic business continuity activity: finding an alternative, often manual, way to perform a critical business function while the primary technology is unavailable."
                        }
                    ]
                }
            },
            {
                "id": "lesson-14",
                "title": "Technology and Tool Selection",
                "duration": "100 min",
                "objectives": [
                    "Design a modern incident response technology stack.",
                    "Understand the roles of SIEM, SOAR, EDR, and other key tools.",
                    "Evaluate and select appropriate forensic and analysis tools.",
                    "Integrate communication and case management platforms.",
                    "Compare the benefits of cloud-based versus on-premises tools."
                ],
                "content": {
                    "overview": "Having the right tools is essential for an efficient and effective incident response. This lesson provides an overview of the modern IR technology stack, explaining the purpose of each component and how they work together to provide visibility, context, and automation to the response team.",
                    "sections": [
                        {
                            "title": "The Modern IR Tech Stack",
                            "content": "<p>A well-equipped IR team uses a variety of tools that fall into several key categories, often referred to as the 'security triad' of visibility: Endpoint, Network, and Logs.</p><h3>Core Components:</h3><ul><li><strong>SIEM (Security Information and Event Management):</strong> The foundation for log collection and correlation. (e.g., Splunk, QRadar, Azure Sentinel).</li><li><strong>EDR (Endpoint Detection and Response):</strong> Provides deep visibility into workstation and server activity, and allows for remote response actions like host quarantine. (e.g., CrowdStrike Falcon, SentinelOne, Carbon Black).</li><li><strong>NDR (Network Detection and Response):</strong> Monitors network traffic for anomalies and malicious patterns. (e.g., Darktrace, ExtraHop).</li><li><strong>SOAR (Security Orchestration, Automation, and Response):</strong> Acts as the 'brain' of the operation, integrating all other tools and automating response playbooks. (e.g., Splunk SOAR, Palo Alto XSOAR).</li><li><strong>Forensic Tools:</strong> Used for deep-dive analysis of disk and memory images. (e.g., EnCase, FTK, Volatility).</li><li><strong>Case Management:</strong> A system for tracking incidents, documenting evidence, and managing the response workflow. (e.g., TheHive, ServiceNow, Jira).</li></ul>"
                        },
                        {
                            "title": "The Role of SOAR",
                            "content": "<p>SOAR platforms are a game-changer for modern security operations. They act as a force multiplier by automating the repetitive, manual tasks that consume most of an analyst's time.</p><h3>How SOAR Works:</h3><ol><li><strong>Ingestion:</strong> An alert comes in from a SIEM or EDR.</li><li><strong>Enrichment:</strong> The SOAR platform automatically queries other tools for context. It might look up an IP address in a threat intelligence platform, get user details from Active Directory, and check the asset's vulnerability status from a scanner.</li><li><strong>Orchestration:</strong> Based on a pre-defined playbook, the SOAR platform executes response actions by calling the APIs of other tools. It can quarantine a host via the EDR, block an IP on the firewall, and disable a user account.</li><li><strong>Case Management:</strong> It creates a case, populates it with all the enriched data, and assigns it to an analyst for final review and remediation.</li></ol><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Human in the Loop</strong></div><p>While SOAR is powerful, most organizations design their playbooks with a 'human in the loop' decision point for destructive actions. The SOAR platform does all the data gathering and then presents a summary to an analyst, asking for approval before, for example, blocking a critical IP address.</p></div>"
                        },
                        {
                            "title": "Cloud vs. On-Premises Tools",
                            "content": "<p>Organizations must decide whether to deploy their IR tools in their own data center or use cloud-based SaaS solutions.</p><h3>Considerations:</h3><ul><li><strong>Cloud-Based (SaaS):</strong><ul><li><strong>Pros:</strong> Faster deployment, lower maintenance overhead, scalability, accessibility from anywhere.</li><li><strong>Cons:</strong> Data residency/privacy concerns, potential for vendor lock-in, recurring subscription costs.</li></ul></li><li><strong>On-Premises:</strong><ul><li><strong>Pros:</strong> Full control over data, potentially lower TCO over the long term, no reliance on internet connectivity for internal monitoring.</li><li><strong>Cons:</strong> High initial capital expense, requires dedicated staff for maintenance and upgrades, slower to deploy.</li></ul></li></ul><p>Many organizations now use a hybrid approach, using SaaS solutions like EDR and cloud-native SIEMs while keeping some specialized forensic tools on-premises.</p>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "JSON Config for a SOAR Playbook Integration",
                            "language": "json",
                            "code": "{\n  \"playbookName\": \"Phishing Triage and Response\",\n  \"integrations\": [\n    {\n      \"name\": \"Proofpoint\",\n      \"type\": \"Email Gateway\",\n      \"actions\": [\"GetEmailHeaders\", \"DecodeURL\"]\n    },\n    {\n      \"name\": \"VirusTotal\",\n      \"type\": \"Threat Intelligence\",\n      \"actions\": [\"GetURLReport\", \"GetFileHashReport\"]\n    },\n    {\n      \"name\": \"CrowdStrike Falcon\",\n      \"type\": \"EDR\",\n      \"actions\": [\"SearchForProcess\", \"QuarantineHost\"]\n    },\n    {\n      \"name\": \"Palo Alto Firewall\",\n      \"type\": \"Firewall\",\n      \"actions\": [\"BlockURL\", \"BlockIP\"]\n    },\n    {\n      \"name\": \"TheHive\",\n      \"type\": \"Case Management\",\n      \"actions\": [\"CreateCase\", \"AddObservable\", \"CloseCase\"]\n    }\n  ]\n}"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "Which tool's primary purpose is to provide deep visibility into activity on workstations and servers and allow for remote containment?",
                            "options": [
                                "SIEM",
                                "SOAR",
                                "EDR",
                                "NDR"
                            ],
                            "correct": 2,
                            "explanation": "EDR (Endpoint Detection and Response) agents are installed on endpoints (workstations/servers) to monitor their behavior and enable response actions like quarantine."
                        },
                        {
                            "id": 2,
                            "question": "What is the key function of a SOAR platform?",
                            "options": [
                                "To collect logs from firewalls.",
                                "To analyze memory dumps for malware.",
                                "To automate and orchestrate response actions by integrating other security tools.",
                                "To capture and analyze network traffic."
                            ],
                            "correct": 2,
                            "explanation": "SOAR's main value is in automation and orchestration, tying together disparate tools into automated workflows or playbooks to speed up response."
                        },
                        {
                            "id": 3,
                            "question": "Splunk, Azure Sentinel, and QRadar are all examples of what type of security tool?",
                            "options": [
                                "EDR",
                                "Forensic Tools",
                                "SOAR",
                                "SIEM"
                            ],
                            "correct": 3,
                            "explanation": "These are all leading platforms in the SIEM (Security Information and Event Management) market, focused on log aggregation and correlation."
                        }
                    ]
                }
            },
            {
                "id": "lesson-15",
                "title": "Automation and Orchestration",
                "duration": "100 min",
                "objectives": [
                    "Identify key opportunities for automation in the IR lifecycle.",
                    "Understand the process of developing an automated playbook.",
                    "Implement a security orchestration strategy.",
                    "Explore the role of AI and machine learning in modern incident response.",
                    "Recognize the importance of human oversight in an automated system."
                ],
                "content": {
                    "overview": "As the volume and speed of attacks increase, manual response is no longer sufficient. This lesson delves into the practical application of automation and orchestration, transforming incident response from a series of manual tasks into a streamlined, machine-speed process.",
                    "sections": [
                        {
                            "title": "Why Automate?",
                            "content": "<p>Automation in incident response is not about replacing human analysts, but about augmenting them. It aims to handle the repetitive, low-level tasks, freeing up analysts to focus on complex investigation and decision-making.</p><h3>Key Benefits:</h3><ul><li><strong>Speed:</strong> Automated actions can be executed in seconds, compared to the minutes or hours it might take a human. This is critical for containing fast-moving threats.</li><li><strong>Consistency:</strong> A playbook ensures that the same process is followed every single time, reducing the chance of human error.</li><li><strong>Efficiency:</strong> It allows a smaller team to handle a much larger volume of alerts, addressing the cybersecurity skills gap.</li><li><strong>Enrichment:</strong> Automation can gather and present all relevant context to an analyst in one place, dramatically speeding up their investigation time.</li></ul>"
                        },
                        {
                            "title": "Developing an Automation Playbook",
                            "content": "<p>A playbook is a formal, step-by-step workflow for responding to a specific type of incident. It's like a flowchart that a SOAR platform can execute.</p><h3>Steps to Create a Playbook:</h3><ol><li><strong>Choose a Use Case:</strong> Start with a high-volume, low-complexity incident type, like 'User-Reported Phishing' or 'Impossible Travel Alert'.</li><li><strong>Document the Manual Process:</strong> Map out every single step an analyst currently takes to handle that incident. Where do they get the data? What commands do they run? Who do they notify?</li><li><strong>Identify Automation Points:</strong> Look for steps in the manual process that can be replaced by an API call from the SOAR tool (e.g., 'look up URL reputation', 'detonate file in sandbox', 'block hash in EDR').</li><li><strong>Build the Workflow:</strong> Use the SOAR platform's interface to drag and drop these actions into a logical flow with decision points.</li><li><strong>Test Thoroughly:</strong> Run the playbook against test cases and in a non-production environment before deploying it live.</li></ol>"
                        },
                        {
                            "title": "Orchestration vs. Automation",
                            "content": "<p>These terms are often used together, but have slightly different meanings.</p><ul><li><strong>Automation:</strong> The act of making a single task run without human intervention. (e.g., A script that looks up an IP address).</li><li><strong>Orchestration:</strong> The act of connecting and coordinating multiple automated tasks across different tools to accomplish a complete process. (e.g., A playbook that takes an IP address, looks it up, uses the result to decide whether to block it on the firewall, and then creates a ticket to document the action).</li></ul><p>A SOAR platform is primarily a tool for orchestration.</p><div class=\"info-box note\"><div class=\"info-box-header\"><i class=\"fas fa-info-circle\"></i><strong>The Human Element</strong></div><p>Even with advanced automation, human oversight remains critical. An analyst's intuition and experience are needed to handle novel attacks, interpret ambiguous data, and make high-stakes decisions. The goal of automation is to empower the analyst, not replace them.</p></div>"
                        }
                    ],
                    "codeExamples": [
                        {
                            "title": "Intelligent SOAR Playbook Pseudocode (YAML-like)",
                            "language": "yaml",
                            "code": "playbook: ImpossibleTravelAlert\n\ntrigger:\n  source: Azure AD Identity Protection\n  alert_type: Impossible Travel\n\nsteps:\n  - name: Enrich User and IP Data\n    actions:\n      - GetUserDetails(alert.user)\n      - GetIPReputation(alert.source_ip, provider='GreyNoise')\n      - GetGeoLocation(alert.source_ip)\n\n  - name: Check for Previous Activity\n    actions:\n      - QuerySIEM(query=f\"user={alert.user} and source_ip={alert.source_ip} in last 30 days\")\n\n  - name: Decision - Is IP Malicious or First-Time Access?\n    condition: (ip.reputation == 'malicious') or (siem.query.count == 0)\n    if_true: MarkAsSuspicious\n    if_false: MarkAsLowRisk\n\n  - name: MarkAsSuspicious\n    actions:\n      - CreateTicket(priority='High', title=f\"Impossible Travel for {alert.user}\")\n      - PostToSlack(channel='#ir-alerts', message=f\"High-risk impossible travel for {alert.user}. Manual review required.\")\n      - add_sub_playbook: RequireMFAAndResetPassword\n    next_step: End\n\n  - name: MarkAsLowRisk\n    actions:\n      - CreateTicket(priority='Low', title=f\"Low-risk impossible travel for {alert.user}\")\n      - SendEmail(to=alert.user, template='travel_confirmation')\n    next_step: End\n\nsub_playbooks:\n  - name: RequireMFAAndResetPassword\n    actions:\n      - AzureAD.RequireMFAForUser(alert.user)\n      - AzureAD.ExpireUserPassword(alert.user)\n\n"
                        }
                    ]
                },
                "quiz": {
                    "passingScore": 80,
                    "questions": [
                        {
                            "id": 1,
                            "question": "What is the primary benefit of automating incident response tasks?",
                            "options": [
                                "It allows the company to fire all its security analysts.",
                                "It increases the number of false positives.",
                                "It dramatically increases the speed and consistency of the response.",
                                "It makes security reports more complicated."
                            ],
                            "correct": 2,
                            "explanation": "The main drivers for automation are to increase the speed of response to combat machine-speed attacks and to ensure a consistent process is followed every time, reducing errors."
                        },
                        {
                            "id": 2,
                            "question": "Connecting an automated task on a SIEM to another automated task on a firewall is an example of what?",
                            "options": [
                                "Automation",
                                "Orchestration",
                                "Forensics",
                                "Log collection"
                            ],
                            "correct": 1,
                            "explanation": "Orchestration is about coordinating actions across multiple, disparate systems to achieve a larger goal, which is exactly what a SOAR platform does."
                        },
                        {
                            "id": 3,
                            "question": "When developing a new automation playbook, what is a recommended first step?",
                            "options": [
                                "Attempt to automate the most complex incident type first.",
                                "Choose a high-volume, well-understood incident type like phishing alerts.",
                                "Buy a new security tool.",
                                "Hire more analysts to handle the alerts."
                            ],
                            "correct": 1,
                            "explanation": "Starting with a common and well-understood process (a 'quick win') is the best way to develop a playbook, prove its value, and build momentum for more complex automation projects."
                        }
                    ]
                }
            },
                    {
            "id": "lesson-16",
            "title": "Cloud Incident Response",
            "duration": "120 min",
            "objectives": [
                "Identify the unique challenges of incident response in cloud environments.",
                "Understand the Shared Responsibility Model and its impact on IR.",
                "Learn to coordinate with Cloud Service Providers (CSPs) during an incident.",
                "Explore techniques for cloud forensics and evidence collection.",
                "Utilize cloud-native security tools for detection and response."
            ],
            "content": {
                "overview": "As organizations migrate to the cloud, incident response must adapt. This lesson covers the specific strategies and challenges of conducting IR in IaaS, PaaS, and SaaS environments like AWS, Azure, and GCP, where traditional tools and techniques may not apply.",
                "sections": [
                    {
                        "title": "The Shared Responsibility Model",
                        "content": "<p>The most fundamental concept in cloud security is the Shared Responsibility Model. It defines which security tasks are handled by the Cloud Service Provider (CSP) and which are handled by you, the customer.</p><ul><li><strong>The CSP is responsible for the security *of* the cloud:</strong> This includes the physical data centers, the hardware, and the core virtualization infrastructure.</li><li><strong>You are responsible for security *in* the cloud:</strong> This includes your data, your user access and identity management, your operating systems and applications, and your network configurations (like security groups and firewalls).</li></ul><p>For IR, this means you can't just call your CSP and expect them to handle an incident within your virtual machine. You are responsible for the response, but you must rely on the tools and logs the CSP provides.</p>"
                    },
                    {
                        "title": "Unique Challenges in Cloud IR",
                        "content": "<p>Cloud environments introduce new complexities for investigators.</p><h3>Key Challenges:</h3><ul><li><strong>Lack of Physical Access:</strong> You cannot physically seize a server or hard drive for forensic imaging. All evidence collection is done remotely via APIs.</li><li><strong>Ephemeral Resources:</strong> Cloud resources like containers and serverless functions can be short-lived, spinning up and down in seconds. If not configured correctly, their logs and evidence can vanish with them.</li><li><strong>Complex Logging:</strong> Cloud environments generate massive volumes of logs from many different services (e.g., AWS CloudTrail, VPC Flow Logs, S3 Access Logs). Correlating these logs is a major challenge.</li><li><strong>Jurisdiction and Data Sovereignty:</strong> Your data could be stored in a data center in another country, making it subject to different laws and regulations.</li></ul>"
                    },
                    {
                        "title": "Cloud Forensics and Evidence Acquisition",
                        "content": "<p>Collecting evidence in the cloud relies on CSP-provided APIs and tools.</p><h3>Common Techniques:</h3><ul><li><strong>Volume Snapshots:</strong> The cloud equivalent of a forensic disk image. You can take a point-in-time snapshot of an EBS volume (in AWS) or a Managed Disk (in Azure) for offline analysis.</li><li><strong>Memory Dumps:</strong> Some CSPs and third-party tools are beginning to offer the ability to capture RAM from a running virtual machine, which is critical for malware analysis.</li><li><strong>Log Collection:</strong> The most critical evidence source. It's essential to have services like AWS CloudTrail and Azure Monitor configured to capture all API calls and activities.</li><li><strong>Isolating Instances:</strong> Instead of unplugging a server, you isolate a compromised virtual machine by modifying its 'Security Group' or 'Network Security Group' to deny all traffic except from your forensics workstation.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Automate Your Response</strong></div><p>The API-driven nature of the cloud is perfect for automated response. For example, a Lambda function can be triggered by a GuardDuty finding to automatically snapshot a volume and isolate the instance within seconds of detection.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "AWS CLI Script to Isolate an EC2 Instance",
                        "language": "bash",
                        "code": "#!/bin/bash\n\n# This script isolates a compromised EC2 instance by changing its security group.\n\nINSTANCE_ID=\"i-0123456789abcdef0\"\nISOLATION_SG=\"sg-abcdef0123456789\"\nREGION=\"us-east-1\"\n\n# 1. Get the current security groups attached to the instance\nORIGINAL_SGS=$(aws ec2 describe-instances --instance-ids $INSTANCE_ID --region $REGION --query 'Reservations[].Instances[].SecurityGroups[].GroupId' --output text)\necho \"Original Security Groups: $ORIGINAL_SGS\"\n\n# 2. Tag the instance with its original security groups for later recovery\naws ec2 create-tags --resources $INSTANCE_ID --region $REGION --tags Key=OriginalSGs,Value=\"$ORIGINAL_SGS\"\n\n# 3. Modify the instance to use ONLY the isolation security group\n# The isolation SG should be pre-configured to deny all ingress/egress except from a forensics IP.\necho \"Applying isolation security group ($ISOLATION_SG)...\"\naws ec2 modify-instance-attribute --instance-id $INSTANCE_ID --region $REGION --groups $ISOLATION_SG\n\necho \"Instance $INSTANCE_ID has been successfully isolated.\"\n\n# 4. Take a snapshot of the root volume for forensic analysis\nVOLUME_ID=$(aws ec2 describe-instances --instance-ids $INSTANCE_ID --region $REGION --query 'Reservations[].Instances[].BlockDeviceMappings[?DeviceName==`/dev/sda1`].Ebs.VolumeId' --output text)\necho \"Creating snapshot of root volume $VOLUME_ID...\"\naws ec2 create-snapshot --volume-id $VOLUME_ID --region $REGION --description \"Forensic snapshot for instance $INSTANCE_ID\""
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "In the Shared Responsibility Model, who is responsible for patching the guest operating system on a virtual machine?",
                        "options": [
                            "The Cloud Service Provider (CSP)",
                            "The customer",
                            "The hardware vendor",
                            "It is a shared responsibility"
                        ],
                        "correct": 1,
                        "explanation": "The customer is responsible for security *in* the cloud, which includes configuring and patching the operating systems and applications they choose to run."
                    },
                    {
                        "id": 2,
                        "question": "What is the cloud equivalent of creating a forensic disk image?",
                        "options": [
                            "Logging into the server via SSH.",
                            "Running a memory dump.",
                            "Taking a volume snapshot.",
                            "Capturing network traffic."
                        ],
                        "correct": 2,
                        "explanation": "Creating a snapshot of a cloud storage volume (like AWS EBS) is the standard, forensically sound way to preserve the state of a disk for later analysis."
                    },
                    {
                        "id": 3,
                        "question": "Which of the following is a major challenge for IR in the cloud compared to on-premises?",
                        "options": [
                            "The existence of firewalls.",
                            "The need to patch systems.",
                            "The short-lived, ephemeral nature of resources like containers.",
                            "The use of passwords for authentication."
                        ],
                        "correct": 2,
                        "explanation": "Ephemeral resources can be destroyed before an investigator has a chance to collect evidence, making robust, real-time logging absolutely critical."
                    }
                ]
            }
        },
        {
            "id": "lesson-17",
            "title": "Mobile and IoT Incident Response",
            "duration": "90 min",
            "objectives": [
                "Understand the unique challenges of mobile and IoT device security.",
                "Develop IR procedures for BYOD and corporate-owned mobile devices.",
                "Integrate with Mobile Device Management (MDM) platforms for response.",
                "Explore techniques for remote data extraction and mobile forensics.",
                "Address privacy considerations when investigating personal devices."
            ],
            "content": {
                "overview": "The security perimeter has dissolved, with corporate data now accessed by a vast ecosystem of mobile phones, tablets, and Internet of Things (IoT) devices. This lesson covers the specialized approaches needed to respond to incidents involving these diverse and often unmanaged endpoints.",
                "sections": [
                    {
                        "title": "Mobile Incident Response Challenges",
                        "content": "<p>Mobile devices present a unique set of challenges compared to traditional endpoints.</p><h3>Key Challenges:</h3><ul><li><strong>Ownership (BYOD):</strong> Bring Your Own Device (BYOD) policies create a major gray area. How do you investigate a device the company doesn't own? This involves significant legal and privacy considerations.</li><li><strong>Diverse Platforms:</strong> The team must be prepared to deal with multiple versions of iOS and Android, each with different security models.</li><li><strong>Limited Access:</strong> Unlike a Windows server, you typically do not have full administrative or root access to a mobile device, making evidence collection difficult.</li><li><strong>Network Connectivity:</strong> Devices are often on untrusted networks (public Wi-Fi, cellular) outside the protection of corporate security controls.</li></ul>"
                    },
                    {
                        "title": "The Role of MDM/UEM",
                        "content": "<p>A Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform is the single most important tool for mobile IR.</p><h3>MDM/UEM Capabilities for IR:</h3><ul><li><strong>Remote Wipe:</strong> The ability to remotely delete all corporate data (or the entire device) if it is lost or stolen.</li><li><strong>Policy Enforcement:</strong> Pushing security policies like mandatory PINs, encryption, and blocking disallowed apps.</li><li><strong>Remote Lock:</strong> Locking a device to prevent unauthorized use.</li><li><strong>App & Configuration Management:</strong> Pushing trusted applications and network settings (like VPN configurations).</li><li><strong>Inventory:</strong> Keeping a record of what devices have access to corporate resources.</li></ul>"
                    },
                    {
                        "title": "IoT Incident Response",
                        "content": "<p>IoT devices, from security cameras to industrial sensors, are often 'black boxes' with minimal security features and no easy way for analysts to investigate them.</p><h3>IoT IR Strategy:</h3><ul><li><strong>Network Isolation is Key:</strong> Since you often can't access the device itself, the primary response strategy is at the network level. The first step is to isolate the compromised IoT device to prevent it from attacking other systems.</li><li><strong>Traffic Analysis:</strong> Network forensics is critical. Analyzing the traffic to and from the device can reveal the command and control (C2) server it's communicating with.</li><li><strong>Vendor Coordination:</strong> You will likely need to engage the device manufacturer to understand the device's behavior and obtain any available firmware or logs.</li><li><strong>Segmentation:</strong> Proactively, IoT devices should always be on a separate, highly restricted network segment, firewalled off from critical corporate systems.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>The Mirai Botnet</strong></div><p>The Mirai botnet demonstrated the power of insecure IoT devices by compromising hundreds of thousands of IP cameras and home routers, using them to launch some of the largest DDoS attacks ever recorded. This highlighted the critical need for IoT security and response planning.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "MDM API Call Pseudocode (Python) to Quarantine a Device",
                        "language": "python",
                        "code": "import requests\n\nMDM_API_ENDPOINT = \"https://api.mdmprovider.com/v1\"\nAPI_KEY = \"YOUR_MDM_API_KEY\"\n\ndef get_device_id(user_email):\n    # Pseudocode: Look up the device ID associated with a user\n    print(f\"Finding device for {user_email}\")\n    return \"DEVICE-ID-78910\"\n\ndef quarantine_device(device_id):\n    \"\"\"Applies a restrictive policy tag to an enrolled mobile device.\"\"\"\n    headers = {\"Authorization\": f\"Bearer {API_KEY}\"}\n    url = f\"{MDM_API_ENDPOINT}/devices/{device_id}/tags\"\n    \n    payload = {\n        \"add\": [\"quarantine_profile\"]\n    }\n    \n    # The 'quarantine_profile' would be pre-configured in the MDM to:\n    # - Remove access to corporate email and apps\n    # - Enforce a VPN connection\n    # - Block all network traffic except to IT services\n    \n    response = requests.post(url, headers=headers, json=payload)\n    \n    if response.status_code == 200:\n        print(f\"Successfully applied quarantine profile to device {device_id}\")\n    else:\n        print(f\"Error quarantining device: {response.text}\")\n\n# --- IR Playbook Step ---\ncompromised_user_email = \"alice@example.com\"\ndevice_to_quarantine = get_device_id(compromised_user_email)\nquarantine_device(device_to_quarantine)"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "What does BYOD stand for in the context of mobile security?",
                        "options": [
                            "Bring Your Own Disaster",
                            "Backup Your Own Data",
                            "Bring Your Own Device",
                            "Block Your Own Device"
                        ],
                        "correct": 2,
                        "explanation": "BYOD (Bring Your Own Device) refers to policies that allow employees to use their personal devices (like smartphones) to access corporate data and applications."
                    },
                    {
                        "id": 2,
                        "question": "What is the single most critical tool for enabling incident response on a large fleet of mobile devices?",
                        "options": [
                            "An antivirus app.",
                            "A SIEM.",
                            "A Mobile Device Management (MDM) or Unified Endpoint Management (UEM) platform.",
                            "A network firewall."
                        ],
                        "correct": 2,
                        "explanation": "An MDM or UEM is essential for mobile IR as it provides the core capabilities needed to manage, secure, and perform remote actions (like wiping or locking) on devices."
                    },
                    {
                        "id": 3,
                        "question": "When responding to a compromised IoT device like a security camera, what is often the most effective initial containment step?",
                        "options": [
                            "Attempting to SSH into the device.",
                            "Isolating the device at the network level.",
                            "Unplugging the device, which may just cause it to reboot and reconnect.",
                            "Ignoring the alert as it's probably a false positive."
                        ],
                        "correct": 1,
                        "explanation": "Because IoT devices are often 'black boxes' with no user interface for investigation, the most reliable and effective first step is to remove them from the network to prevent them from causing further harm."
                    }
                ]
            }
        },
        {
            "id": "lesson-18",
            "title": "Industrial Control Systems (ICS/SCADA) Incidents",
            "duration": "100 min",
            "objectives": [
                "Understand the unique challenges of responding to incidents in Operational Technology (OT) environments.",
                "Prioritize human safety and physical process integrity over data confidentiality.",
                "Develop response procedures for air-gapped and legacy systems.",
                "Coordinate with engineering and plant operations teams.",
                "Recognize the regulatory requirements for critical infrastructure sectors."
            ],
            "content": {
                "overview": "Incident response in Industrial Control Systems (ICS) and SCADA environments is a high-stakes discipline where a cyberattack can have physical consequences, including equipment damage, environmental disaster, or even loss of life. This lesson covers the specialized principles and precautions required for OT security.",
                "sections": [
                    {
                        "title": "IT vs. OT: A Different World",
                        "content": "<p>The priorities and constraints in an Operational Technology (OT) environment are fundamentally different from a standard IT network.</p><h3>The OT Security Triad: Safety First</h3><p>In IT, the security triad is Confidentiality, Integrity, Availability (CIA). In OT, the priority is inverted and a new element is added:</p><ol><li><strong>Safety:</strong> Protecting human life and the environment is the absolute, non-negotiable top priority.</li><li><strong>Availability:</strong> Critical physical processes (like power generation or manufacturing) must remain operational. Downtime is extremely costly.</li><li><strong>Integrity:</strong> The data and commands sent to physical controllers must be accurate. False data could cause catastrophic equipment failure.</li><li><strong>Confidentiality:</strong> Often the lowest priority. The recipe for a product might be secret, but keeping the plant from exploding is more important.</li></ol>"
                    },
                    {
                        "title": "Unique Challenges of ICS/SCADA Response",
                        "content": "<p>Standard IT response techniques can be dangerous in an OT environment.</p><h3>Key Challenges:</h3><ul><li><strong>Fragile Systems:</strong> Many ICS components are old, run on legacy operating systems (like Windows XP), and were never designed to be on a network. A simple port scan from a vulnerability scanner could cause a critical controller to crash.</li><li><strong>No Downtime:</strong> You cannot simply 'patch the server' in the middle of a manufacturing run. Maintenance windows are rare and tightly controlled.</li><li><strong>Physical Impact:</strong> A containment action like blocking a port could have unintended physical consequences by, for example, preventing an operator from opening a critical safety valve.</li><li><strong>Proprietary Protocols:</strong> OT networks use specialized protocols (like Modbus, DNP3) that standard IT security tools do not understand.</li></ul>"
                    },
                    {
                        "title": "Principles of OT Incident Response",
                        "content": "<p>The response must be deliberate, cautious, and coordinated with plant engineers.</p><h3>Guiding Principles:</h3><ul><li><strong>Do No Harm:</strong> The first rule. Your response actions must not endanger safety or disrupt the physical process.</li><li><strong>Engineers are in Charge:</strong> The IR team provides analysis and recommendations, but the final decision on any action that could affect the physical process rests with the plant engineers and operators.</li><li><strong>Passive Monitoring:</strong> Use passive tools (like network taps and NDR solutions) for detection. Avoid active scanning or intrusive tools.</li><li><strong>Network Segmentation:</strong> A properly segmented network (based on the Purdue Model) that separates the IT and OT environments is the single most important security control and a key point for containment.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Real-World Example: Stuxnet</strong></div><p>The Stuxnet worm was a highly sophisticated cyber weapon that targeted Iranian nuclear facilities. It was designed to subtly alter the speed of centrifuges, causing them to destroy themselves over time, all while reporting normal operating data back to the human operators. This demonstrated the potential for cyberattacks to cause precise, targeted physical destruction.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Firewall Rule Example for IT/OT Segmentation (Purdue Model)",
                        "language": "bash",
                        "code": "# This is a conceptual example of a firewall rule set for an IT/OT DMZ.\n# It aims to strictly control traffic between the Enterprise (IT) and Industrial (OT) networks.\n\n# Define network zones\nIT_ZONE=\"192.168.1.0/24\"\nOT_ZONE=\"10.10.0.0/16\"\nDMZ_ZONE=\"172.16.0.0/24\"\n\n# --- Rules on the IT-to-DMZ Firewall ---\n\n# 1. Allow IT workstations to access a jump host/terminal server in the DMZ via SSH/RDP.\n# This is the ONLY way for administrators to get into the OT environment.\niptables -A FORWARD -s $IT_ZONE -d $DMZ_JUMP_HOST -p tcp --dport 22 -j ACCEPT\niptables -A FORWARD -s $IT_ZONE -d $DMZ_JUMP_HOST -p tcp --dport 3389 -j ACCEPT\n\n# 2. Deny all other traffic from IT to the DMZ.\niptables -A FORWARD -s $IT_ZONE -d $DMZ_ZONE -j DROP\n\n# --- Rules on the DMZ-to-OT Firewall ---\n\n# 1. Allow the jump host to access specific HMIs (Human Machine Interfaces) in the OT zone.\niptables -A FORWARD -s $DMZ_JUMP_HOST -d $OT_HMI_1 -p tcp --dport 502 -j ACCEPT # Modbus\niptables -A FORWARD -s $DMZ_JUMP_HOST -d $OT_HMI_2 -p tcp --dport 502 -j ACCEPT\n\n# 2. Allow a historian server in the DMZ to collect data from a specific PLC in the OT zone.\niptables -A FORWARD -s $DMZ_HISTORIAN -d $OT_PLC -p tcp --dport 20000 -j ACCEPT # DNP3\n\n# 3. Deny ALL other traffic. The OT network should never be able to initiate connections to the IT network.\niptables -P FORWARD DROP"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "What is the absolute highest priority during an incident in an ICS/SCADA environment?",
                        "options": [
                            "Confidentiality of intellectual property.",
                            "Availability of the corporate website.",
                            "Integrity of financial reports.",
                            "Human safety and the integrity of the physical process."
                        ],
                        "correct": 3,
                        "explanation": "In OT environments, the potential for physical harm to people, equipment, and the environment always takes precedence over traditional IT security concerns like data confidentiality."
                    },
                    {
                        "id": 2,
                        "question": "Why is active vulnerability scanning generally discouraged in an OT network?",
                        "options": [
                            "It consumes too much bandwidth.",
                            "The legacy and fragile nature of ICS devices means a scan could cause them to crash.",
                            "It is too expensive to run.",
                            "It is not effective at finding vulnerabilities."
                        ],
                        "correct": 1,
                        "explanation": "Many industrial controllers and devices were never designed to handle unexpected network traffic. A standard port scan can easily overwhelm them, causing a system failure with potential physical consequences."
                    },
                    {
                        "id": 3,
                        "question": "The Purdue Model is a framework for what?",
                        "options": [
                            "Classifying malware.",
                            "Writing incident response reports.",
                            "Architecting network segmentation between IT and OT systems.",
                            "Calculating the financial impact of an incident."
                        ],
                        "correct": 2,
                        "explanation": "The Purdue Model is a widely adopted conceptual framework that defines levels of network segmentation to create a secure, defensible architecture for industrial control systems, separating the enterprise (IT) network from the operational (OT) network."
                    }
                ]
            }
        },
        {
            "id": "lesson-19",
            "title": "Insider Threat Incident Response",
            "duration": "100 min",
            "objectives": [
                "Differentiate between malicious, accidental, and compromised insider threats.",
                "Coordinate investigations with HR and Legal departments.",
                "Utilize tools like DLP and UEBA for detection and investigation.",
                "Develop procedures for evidence collection while respecting employee privacy.",
                "Plan for access revocation and termination procedures."
            ],
            "content": {
                "overview": "Not all threats come from the outside. An insider threat—from a malicious employee, a negligent contractor, or a compromised user account—can be incredibly damaging due to their inherent trust and access. This lesson covers the sensitive and complex process of investigating one of your own.",
                "sections": [
                    {
                        "title": "Types of Insider Threats",
                        "content": "<p>It's crucial to understand the intent behind the action to determine the correct response.</p><h3>The Three Categories:</h3><ul><li><strong>Malicious Insider:</strong> An employee or contractor who intentionally misuses their authorized access to steal data, cause disruption, or seek revenge. This is a criminal investigation.</li><li><strong>Accidental/Negligent Insider:</strong> A well-meaning employee who unintentionally exposes data or creates a vulnerability through carelessness, like falling for a phishing attack or misconfiguring a cloud storage bucket. This is often a training and process issue.</li><li><strong>Compromised Insider:</strong> A standard user whose account credentials have been stolen by an external attacker. The attacker is now masquerading as a trusted insider to move through the network. This is the most common type of 'insider' threat.</li></ul>"
                    },
                    {
                        "title": "The Critical Role of HR and Legal",
                        "content": "<p>An insider threat investigation cannot be run by the IT or security team alone. It is a partnership from the very beginning.</p><h3>Responsibilities:</h3><ul><li><strong>Legal:</strong> Provides guidance on what the company is allowed to monitor, how to collect evidence in a way that is legally admissible, and how to respect privacy laws. They manage the boundary between investigation and employee rights.</li><li><strong>Human Resources (HR):</strong> Provides context on the employee (e.g., Are they a disgruntled employee? Have they recently resigned?). HR manages all employee-facing actions, including interviews, disciplinary action, and termination.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Maintain Extreme Discretion</strong></div><p>Insider investigations must be handled with the utmost confidentiality. A false accusation can destroy a person's career and open the company to a lawsuit. Only a very small, defined group of people should be aware of the investigation.</p></div>"
                    },
                    {
                        "title": "Detection and Investigation Techniques",
                        "content": "<p>Detecting insider threats often relies on behavioral analysis rather than traditional signatures.</p><h3>Key Tools and Data Sources:</h3><ul><li><strong>UEBA (User and Entity Behavior Analytics):</strong> These tools baseline normal user behavior and then alert on anomalies. For example:<ul><li>A user who normally works 9-5 suddenly logs in at 3 AM.</li><li>A user in marketing suddenly starts trying to access engineering source code servers.</li><li>A user who normally transfers ~50MB of data per day suddenly downloads 10GB of data.</li></ul></li><li><strong>DLP (Data Loss Prevention):</strong> These tools monitor and block the exfiltration of sensitive data. They can detect when a user tries to copy sensitive files to a USB drive, upload them to a personal cloud storage account, or email them to a personal address.</li><li><strong>Log Analysis:</strong> Scrutinizing logs from VPNs, file servers, and applications can show a timeline of the insider's activity.</li></ul>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Example UEBA Alert Logic (Conceptual)",
                        "language": "yaml",
                        "code": "rule_name: Potential Data Exfiltration by Departing Employee\n\n# This rule triggers if an employee who has resigned accesses an unusually large amount of data from a sensitive location.\n\ndata_sources:\n  - Active Directory (user.termination_date)\n  - HR System API (employee.status)\n  - File Server Audit Logs (file.access)\n  - DLP System Logs (data.flow)\n\nlogic: |\n  // Define a watchlist of users who have a termination date set in the next 14 days\n  watchlist_departing_employees = SELECT user FROM HR_System WHERE employee.status == 'Resigned'\n\n  // For each user on the watchlist\n  FOR user in watchlist_departing_employees:\n    // Calculate their baseline daily data access from sensitive shares\n    baseline_gb = AVG(file.access.size_gb) WHERE user=user AND file.path CONTAINS '/sensitive_data/' AND time > now() - 90d\n\n    // Get today's data access total\n    today_gb = SUM(file.access.size_gb) WHERE user=user AND file.path CONTAINS '/sensitive_data/' AND time > now() - 24h\n\n    // Compare today's activity to the baseline\n    IF today_gb > (baseline_gb * 10) AND today_gb > 5:\n      CREATE ALERT {\n        severity: 'High',\n        user: user,\n        summary: f\"{user} has downloaded {today_gb}GB of sensitive data, which is 10x their normal baseline.\"\n      }"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "An employee clicks on a phishing link and their credentials are stolen. An external attacker then uses these credentials to log in. What type of insider threat is this?",
                        "options": [
                            "Malicious Insider",
                            "Accidental Insider",
                            "Compromised Insider",
                            "This is not an insider threat."
                        ],
                        "correct": 2,
                        "explanation": "This is a 'Compromised Insider' scenario. The employee was negligent, but the malicious activity is being carried out by an external threat actor masquerading as a trusted user."
                    },
                    {
                        "id": 2,
                        "question": "During an insider threat investigation, which department should be consulted before any monitoring or evidence collection takes place to ensure it's legally permissible?",
                        "options": [
                            "Marketing",
                            "Legal",
                            "Finance",
                            "Sales"
                        ],
                        "correct": 1,
                        "explanation": "The Legal department is a critical partner from the very beginning to provide guidance on employee privacy rights and ensure all investigative actions are legally sound."
                    },
                    {
                        "id": 3,
                        "question": "A tool that baselines normal user activity and then flags a deviation, such as an employee in finance suddenly trying to access R&D servers, is known as what?",
                        "options": [
                            "Antivirus",
                            "Firewall",
                            "User and Entity Behavior Analytics (UEBA)",
                            "A network switch"
                        ],
                        "correct": 2,
                        "explanation": "UEBA is the specific category of tool designed to detect insider threats and compromised accounts by identifying anomalous behavior compared to a learned baseline."
                    }
                ]
            }
        },
        {
            "id": "lesson-20",
            "title": "Supply Chain Incident Response",
            "duration": "90 min",
            "objectives": [
                "Understand the risks associated with third-party and supply chain compromises.",
                "Develop a plan for coordinating response with vendors and partners.",
                "Incorporate supply chain considerations into contracts and SLAs.",
                "Respond to incidents originating from compromised software updates.",
                "Utilize Software Bill of Materials (SBOM) for risk assessment."
            ],
            "content": {
                "overview": "Your organization's security is no longer just about your own defenses; it's also dependent on the security of your hundreds of vendors, partners, and software suppliers. This lesson focuses on how to prepare for and respond to a supply chain attack, one of the most challenging and potentially devastating types of incidents.",
                "sections": [
                    {
                        "title": "What is a Supply Chain Attack?",
                        "content": "<p>A supply chain attack is a type of cyberattack that targets a trusted third-party vendor or software provider with the goal of using their legitimate access to compromise their customers. Instead of attacking a well-defended target directly, the adversary attacks a weaker link in the 'chain'.</p><h3>Common Types:</h3><ul><li><strong>Software Supply Chain Attack:</strong> An attacker injects malicious code into a legitimate software product. When the provider sends out a routine update, they unknowingly distribute the malware to all of their customers.</li><li><strong>Third-Party Vendor Compromise:</strong> An attacker compromises a vendor that has trusted access to your network, such as a Managed Service Provider (MSP) or an HVAC maintenance company, and uses their credentials to pivot into your environment.</li></ul>"
                    },
                    {
                        "title": "The Challenge of Response",
                        "content": "<p>Supply chain incidents are incredibly difficult to handle because a significant part of the incident occurs outside of your control and visibility.</p><h3>Key Challenges:</h3><ul><li><strong>Lack of Visibility:</strong> You cannot see what is happening inside your vendor's network. You are completely reliant on them for information.</li><li><strong>Delayed Notification:</strong> You may not find out about the compromise for days or weeks after it has happened.</li><li><strong>One-to-Many Impact:</strong> A single vendor compromise can impact hundreds or thousands of their customers simultaneously, leading to widespread and chaotic response efforts.</li><li><strong>Trust Violation:</strong> The attack abuses a trusted relationship, making it very difficult to detect. An alert for 'activity from a trusted MSP' is unlikely to fire any alarms.</li></ul>"
                    },
                    {
                        "title": "Preparation and Coordination",
                        "content": "<p>Because you have limited control during the incident itself, preparation is paramount.</p><h3>Proactive Measures:</h3><ul><li><strong>Contractual Language:</strong> Your contracts with vendors must include specific cybersecurity requirements, including the right to audit, security standards they must adhere to, and mandatory breach notification timelines.</li><li><strong>Third-Party Risk Management (TPRM):</strong> A formal program for vetting the security of your vendors before you sign a contract with them.</li><li><strong>Principle of Least Privilege:</strong> Ensure that vendors have the absolute minimum level of access required to do their job. An HVAC vendor does not need domain admin rights.</li><li><strong>Software Bill of Materials (SBOM):</strong> An SBOM is a list of all the open-source and third-party components used to build a piece of software. When a new vulnerability like Log4j is discovered, an SBOM allows you to quickly identify which of your applications are affected.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Real-World Example: SolarWinds</strong></div><p>The SolarWinds attack was a sophisticated software supply chain attack where Russian state actors inserted a backdoor into the SolarWinds Orion IT monitoring platform. The company then unknowingly distributed the malicious code via a routine software update to over 18,000 customers, including top government agencies and Fortune 500 companies. This allowed the attackers to gain a foothold in some of the most secure networks in the world.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Sample SBOM in CycloneDX JSON Format",
                        "language": "json",
                        "code": "{\n  \"bomFormat\": \"CycloneDX\",\n  \"specVersion\": \"1.4\",\n  \"serialNumber\": \"urn:uuid:3e671687-395b-41f5-a30f-a58921a69b79\",\n  \"version\": 1,\n  \"metadata\": {\n    \"timestamp\": \"2025-09-02T08:00:00Z\",\n    \"tool\": {\n      \"vendor\": \"CycloneDX\",\n      \"name\": \"Node.js module\",\n      \"version\": \"4.0.0\"\n    },\n    \"component\": {\n      \"type\": \"application\",\n      \"name\": \"MyWebApp\",\n      \"version\": \"1.2.3\"\n    }\n  },\n  \"components\": [\n    {\n      \"type\": \"library\",\n      \"name\": \"express\",\n      \"version\": \"4.17.1\",\n      \"purl\": \"pkg:npm/express@4.17.1\"\n    },\n    {\n      \"type\": \"library\",\n      \"name\": \"lodash\",\n      \"version\": \"4.17.21\",\n      \"purl\": \"pkg:npm/lodash@4.17.21\"\n    },\n    {\n      \"type\": \"library\",\n      \"name\": \"log4j-core\",\n      \"version\": \"2.14.1\",\n      \"purl\": \"pkg:maven/org.apache.logging.log4j/log4j-core@2.14.1\"\n    }\n  ]\n}"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "An attacker compromises a software company and injects malware into their product's official update. What is this an example of?",
                        "options": [
                            "A phishing attack.",
                            "A denial-of-service attack.",
                            "A software supply chain attack.",
                            "An insider threat."
                        ],
                        "correct": 2,
                        "explanation": "This is a classic software supply chain attack, where a trusted distribution channel (the software update) is hijacked to deliver malware."
                    },
                    {
                        "id": 2,
                        "question": "What is a Software Bill of Materials (SBOM)?",
                        "options": [
                            "A list of all employees who can write code.",
                            "An invoice for software you have purchased.",
                            "A formal list of all the third-party and open-source components that make up a piece of software.",
                            "A security policy for developers."
                        ],
                        "correct": 2,
                        "explanation": "An SBOM is an inventory of software components. It's crucial for quickly identifying which systems are vulnerable when a new flaw is discovered in a common library like Log4j or OpenSSL."
                    },
                    {
                        "id": 3,
                        "question": "What is the MOST critical proactive measure for mitigating the risk of a third-party vendor compromise?",
                        "options": [
                            "Trusting the vendor's marketing materials.",
                            "Granting the vendor extensive administrative access to make their job easier.",
                            "Enforcing the principle of least privilege, giving the vendor the absolute minimum access needed.",
                            "Hoping the vendor has good security."
                        ],
                        "correct": 2,
                        "explanation": "The principle of least privilege is a foundational security concept. By strictly limiting vendor access, you limit the potential damage that can be done if that vendor's account is compromised."
                    }
                ]
            }
        },
        {
            "id": "lesson-21",
            "title": "Advanced Persistent Threat (APT) Response",
            "duration": "100 min",
            "objectives": [
                "Define the characteristics of an Advanced Persistent Threat (APT).",
                "Understand the methodologies used in long-term APT campaigns.",
                "Develop strategies for attribution and threat actor profiling.",
                "Implement long-term surveillance and monitoring.",
                "Explore the role of deception and honeypots in APT defense."
            ],
            "content": {
                "overview": "Responding to an APT is the pinnacle of incident response. These are not smash-and-grab attacks; they are long-term, stealthy, well-funded campaigns, often backed by nation-states, with specific strategic objectives. This lesson covers the advanced mindset and techniques required to counter these sophisticated adversaries.",
                "sections": [
                    {
                        "title": "What is an APT?",
                        "content": "<p>An Advanced Persistent Threat (APT) is defined by its characteristics:</p><ul><li><strong>Advanced:</strong> They use sophisticated and customized tools and techniques to breach defenses. They may use zero-day exploits and complex malware that evades standard detection.</li><li><strong>Persistent:</strong> Their goal is not a quick score. They aim to establish a long-term presence in the target's network, often for months or years, to achieve their objectives. They will actively work to maintain access even if individual footholds are discovered.</li><li><strong>Threat:</strong> They are not random actors. They are organized, well-funded groups (often state-sponsored) with a clear mission, such as espionage, intellectual property theft, or sabotage.</li></ul>"
                    },
                    {
                        "title": "The APT Response Mindset",
                        "content": "<p>Handling an APT requires a shift from standard IR procedure. The goal is not just to 'kick them out' as quickly as possible.</p><h3>Key Considerations:</h3><ul><li><strong>The 'One and Done' Eradication Myth:</strong> In an APT investigation, you must assume the attacker has multiple backdoors and points of persistence. If you find one and kick them out, they will simply use another to get right back in.</li><li><strong>Surveillance and Intelligence Gathering:</strong> The initial response phase is often a period of quiet, careful monitoring. The goal is to learn everything you can about the attacker: what tools are they using? what data are they after? how many systems have they compromised? This is done before taking any disruptive action.</li><li><strong>The Big Bang Eradication:</strong> Once you believe you have a complete picture of the adversary's presence, the eradication must be a swift, coordinated, and simultaneous action. You must remove all of their backdoors and change all compromised credentials at once to prevent them from regaining access.</li></ul>"
                    },
                    {
                        "title": "Deception Technology",
                        "content": "<p>Deception technology, like honeypots, can be a powerful tool against APTs.</p><ul><li><strong>Honeypots:</strong> These are decoy systems designed to be an attractive target for attackers. They have no production value, so any traffic to a honeypot is, by definition, suspicious.</li><li><strong>Honeytokens:</strong> These are decoy data or credentials. For example, a fake AWS API key placed in a document. You can then set up an alert to trigger if that API key is ever used, immediately telling you that the document has been stolen and is being used by an attacker.</li></ul><p>By observing how an attacker interacts with a honeypot, you can learn about their tools and methods in a safe environment, all while diverting them from your real assets.</p><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Attribution is Hard</strong></div><p>Attributing an attack to a specific APT group (e.g., APT28, Lazarus Group) is extremely difficult and often relies on collaboration with government agencies and threat intelligence firms. For most organizations, the focus should be on evicting the actor and securing the network, not on definitively proving who they are.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Honeytoken Example: A Fake AWS API Key",
                        "language": "bash",
                        "code": "# This is not a real key, but it demonstrates the format.\n# An attacker finding this in a config file on a compromised server might try to use it.\n\n# 1. Create a fake AWS IAM user with NO permissions.\n# Go to the AWS IAM console, create a new user called 'honeypot-user'.\n# Do NOT attach any policies. This user should have zero permissions.\n\n# 2. Generate an access key for this user.\n# AWS will provide an Access Key ID and a Secret Access Key.\n# Access Key ID: AKIAHONEYPOTDECOY123\n# Secret Key: ThIsIsJuStAnExAmPlEsEcReTkEyFoRdEmO\n\n# 3. Place these credentials in a decoy file on your servers.\n# For example, in a file named `~/.aws/credentials` or `config.py`\n\necho \"[default]\" > ~/.aws/credentials\necho \"aws_access_key_id = AKIAHONEYPOTDECOY123\" >> ~/.aws/credentials\necho \"aws_secret_access_key = ThIsIsJuStAnExAmPlEsEcReTkEyFoRdEmO\" >> ~/.aws/credentials\n\n# 4. Set up a CloudWatch alarm that triggers on ANY API call made by this user.\n# Go to CloudTrail -> Event history. Create a filter for User name: 'honeypot-user'.\n# Create a metric filter and a CloudWatch alarm based on this filter.\n# Set the alarm to notify your IR team via SNS (email, PagerDuty, etc.) if the count of events > 0.\n\n# 5. Result: The moment an attacker uses this key, your IR team gets an immediate, high-fidelity alert."
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "What does the 'Persistent' in Advanced Persistent Threat refer to?",
                        "options": [
                            "They persistently try to guess passwords.",
                            "They aim to establish a long-term presence in the target network, not just a quick hit.",
                            "The malware they use is written to a persistent disk.",
                            "They send persistent phishing emails."
                        ],
                        "correct": 1,
                        "explanation": "'Persistent' refers to their operational goal: to maintain long-term, stealthy access to the target environment to achieve strategic objectives like espionage."
                    },
                    {
                        "id": 2,
                        "question": "When responding to a confirmed APT, why is it often a bad idea to immediately block the first backdoor you find?",
                        "options": [
                            "It might violate your service level agreement.",
                            "The attacker likely has multiple backdoors, and you will tip them off that you are on to them before you understand their full scope of access.",
                            "It is better to try to reason with the attacker first.",
                            "Blocking backdoors is not an effective containment strategy."
                        ],
                        "correct": 1,
                        "explanation": "A key principle of APT response is to avoid tipping your hand. If you block one backdoor, the attacker will know they've been detected and will switch to their other, unknown backdoors, making your job much harder."
                    },
                    {
                        "id": 3,
                        "question": "A decoy server set up with the sole purpose of being attacked to learn about an adversary's methods is called a:",
                        "options": [
                            "Production Server",
                            "Honeypot",
                            "Firewall",
                            "SIEM"
                        ],
                        "correct": 1,
                        "explanation": "A honeypot is a system used as a deception tool. It has no legitimate production purpose, so any interaction with it is inherently suspicious and provides valuable intelligence about attacker TTPs (Tactics, Techniques, and Procedures)."
                    }
                ]
            }
        },
        {
            "id": "lesson-22",
            "title": "Incident Response Metrics and KPIs",
            "duration": "90 min",
            "objectives": [
                "Understand the importance of measuring IR program performance.",
                "Define and calculate key performance indicators (KPIs) like MTTD, MTTR, and MTTC.",
                "Develop methods for analyzing the cost per incident.",
                "Create effective dashboards and reports for executive stakeholders.",
                "Use metrics to drive continuous improvement and justify investments."
            ],
            "content": {
                "overview": "'You can't manage what you can't measure.' This lesson focuses on the critical process of developing and tracking metrics to evaluate the effectiveness of your incident response program, communicate its value to leadership, and identify areas for improvement.",
                "sections": [
                    {
                        "title": "Why Measure IR?",
                        "content": "<p>Tracking metrics turns incident response from a chaotic, reactive function into a managed, improvable business process.</p><h3>Key Benefits:</h3><ul><li><strong>Identify Weaknesses:</strong> Metrics can pinpoint bottlenecks in your response process. Is your detection time too slow? Is containment taking too long?</li><li><strong>Justify Investment:</strong> Hard numbers demonstrating long response times or high costs can be a powerful tool for making the business case for new tools or personnel.</li><li><strong>Communicate Value:</strong> Reporting on metrics shows leadership that the IR program is being managed effectively and is improving over time.</li><li><strong>Drive Improvement:</strong> By setting goals (e.g., 'We will reduce our MTTR by 10% this quarter'), you create a focus for your team's improvement efforts.</li></ul>"
                    },
                    {
                        "title": "Key Incident Response KPIs",
                        "content": "<p>There are several industry-standard metrics for measuring response time.</p><h3>The 'Mean Time To...' Metrics:</h3><ul><li><strong>MTTD (Mean Time to Detect):</strong> The average time it takes from when an incident starts (the actual compromise) to when your team detects it. This is a measure of your monitoring and detection capabilities.</li><li><strong>MTTA (Mean Time to Acknowledge):</strong> The average time it takes from when an alert fires to when an analyst begins working on it. This measures your team's responsiveness and staffing levels.</li><li><strong>MTTC (Mean Time to Contain):</strong> The average time it takes from when the investigation begins to when the incident is contained (the bleeding is stopped). This measures the efficiency of your initial response actions.</li><li><strong>MTTR (Mean Time to Remediate/Resolve):</strong> The average time it takes from when an incident starts to when it is fully eradicated and recovered. This is the broadest measure of the entire lifecycle.</li></ul><p><strong>Dwell Time:</strong> The total time an attacker is in your network before being discovered (MTTD). This is a critical metric often highlighted in major breach reports.</p>"
                    },
                    {
                        "title": "Executive Reporting and Dashboards",
                        "content": "<p>Reporting to the C-suite should be high-level and visual. They don't need to see every ticket, but they do need to understand risk and progress.</p><h3>A Good IR Dashboard Might Include:</h3><ul><li><strong>Trend lines for MTTD and MTTR:</strong> Are your response times getting better or worse over time?</li><li><strong>Incident Count by Severity:</strong> How many critical and high-priority incidents are you handling per month?</li><li><strong>Top Incident Categories:</strong> What are your biggest problems (e.g., Phishing, Ransomware, Insider Threat)? This helps direct investment.</li><li><strong>Estimated Cost of Incidents:</strong> A calculation based on analyst time, business downtime, and other factors to show the financial impact the IR team is mitigating.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Start Simple</strong></div><p>Don't try to track 50 metrics from day one. Start with the most critical and achievable ones, like MTTA and MTTC, which can often be calculated directly from your case management system. Ensure the data is accurate and then gradually add more sophisticated metrics as your program matures.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Python Script to Calculate IR Metrics from Case Data (CSV)",
                        "language": "python",
                        "code": "import pandas as pd\nfrom io import StringIO\n\n# Sample data that would come from your case management system\ncsv_data = \"\"\"\ncase_id,time_detected,time_acknowledged,time_contained,time_resolved\nCASE-001,2025-09-01 10:00:00,2025-09-01 10:05:00,2025-09-01 11:30:00,2025-09-02 14:00:00\nCASE-002,2025-09-01 14:15:00,2025-09-01 14:18:00,2025-09-01 15:00:00,2025-09-01 18:30:00\nCASE-003,2025-09-02 08:30:00,2025-09-02 08:45:00,2025-09-02 09:15:00,2025-09-02 11:00:00\n\"\"\"\n\ndf = pd.read_csv(StringIO(csv_data))\n\n# Convert columns to datetime objects\nfor col in ['time_detected', 'time_acknowledged', 'time_contained', 'time_resolved']:\n    df[col] = pd.to_datetime(df[col])\n\n# Calculate time differences in minutes\ndf['mtta_minutes'] = (df['time_acknowledged'] - df['time_detected']).dt.total_seconds() / 60\ndf['mttc_minutes'] = (df['time_contained'] - df['time_acknowledged']).dt.total_seconds() / 60\ndf['mttr_hours'] = (df['time_resolved'] - df['time_detected']).dt.total_seconds() / 3600\n\n# Calculate the mean (average)\nmean_mtta = df['mtta_minutes'].mean()\nmean_mttc = df['mttc_minutes'].mean()\nmean_mttr = df['mttr_hours'].mean()\n\nprint(\"--- Incident Response Metrics ---\")\nprint(f\"Mean Time to Acknowledge (MTTA): {mean_mtta:.2f} minutes\")\nprint(f\"Mean Time to Contain (MTTC): {mean_mttc:.2f} minutes\")\nprint(f\"Mean Time to Resolve (MTTR): {mean_mttr:.2f} hours\")"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "The time from when an attacker first compromises a system to when the security team detects the activity is known as what?",
                        "options": [
                            "Mean Time to Contain (MTTC)",
                            "Mean Time to Acknowledge (MTTA)",
                            "Mean Time to Detect (MTTD) or Dwell Time",
                            "Mean Time to Resolve (MTTR)"
                        ],
                        "correct": 2,
                        "explanation": "MTTD, often called Dwell Time, measures the effectiveness of your detection capabilities. A lower MTTD is better, as it means you are catching attackers sooner."
                    },
                    {
                        "id": 2,
                        "question": "You want to measure how quickly your on-call analysts begin working on new alerts. Which metric should you track?",
                        "options": [
                            "MTTD",
                            "MTTA",
                            "MTTC",
                            "MTTR"
                        ],
                        "correct": 1,
                        "explanation": "MTTA (Mean Time to Acknowledge) specifically measures the delay between an alert firing and an analyst actively starting the investigation. It's a key indicator of team responsiveness and staffing."
                    },
                    {
                        "id": 3,
                        "question": "What is a primary reason for tracking and reporting IR metrics to executive leadership?",
                        "options": [
                            "To show them complex technical data.",
                            "To justify the team's budget and demonstrate the program's value and improvement over time.",
                            "To blame other departments for security failings.",
                            "Metrics are only for technical teams and should not be shared with leadership."
                        ],
                        "correct": 1,
                        "explanation": "Metrics are the language of business. Translating IR activities into quantifiable data about risk reduction and efficiency is the most effective way to communicate with leadership and secure the resources needed for the program."
                    }
                ]
            }
        },
        {
            "id": "lesson-23",
            "title": "Training and Simulation Exercises",
            "duration": "100 min",
            "objectives": [
                "Understand the importance of regular IR training and exercises.",
                "Design and facilitate a tabletop exercise for management and technical teams.",
                "Differentiate between walkthroughs, tabletops, and full-scale simulations.",
                "Integrate red team and purple team exercises into the training plan.",
                "Measure the effectiveness of training and use it to improve the IR plan."
            ],
            "content": {
                "overview": "An incident response plan that sits on a shelf is useless. The team and the broader organization must be prepared to execute that plan under pressure. This lesson covers how to design and conduct various types of simulation exercises to build muscle memory, test procedures, and identify gaps before a real crisis hits.",
                "sections": [
                    {
                        "title": "Why Exercises are Crucial",
                        "content": "<p>You don't rise to the occasion in a crisis; you fall to the level of your training. Exercises are a form of controlled, managed stress that prepares the team for the chaos of a real incident.</p><h3>Key Goals of IR Exercises:</h3><ul><li><strong>Test the Plan:</strong> Do the procedures in your IR plan actually work? Are there gaps or incorrect assumptions?</li><li><strong>Clarify Roles and Responsibilities:</strong> Exercises reveal confusion about who is supposed to do what and who makes decisions.</li><li><strong>Build Muscle Memory:</strong> For technical teams, practicing the steps of containment and analysis makes them faster and more effective during a real event.</li><li><strong>Improve Communication:</strong> A simulated crisis is a safe way to test and refine communication paths between technical teams, management, legal, and PR.</li></ul>"
                    },
                    {
                        "title": "Types of IR Exercises",
                        "content": "<p>Exercises exist on a spectrum from simple discussions to live, full-scale simulations.</p><h3>The Spectrum of Exercises:</h3><ul><li><strong>Walkthrough/Workshop:</strong> The simplest form. The team gets together to read through the IR plan section by section and discuss it. This is good for new team members or new plans.</li><li><strong>Tabletop Exercise:</strong> This is a scenario-based discussion. A facilitator presents a developing incident scenario (e.g., 'It's 2 PM. You've just received a credible report of a ransomware outbreak in accounting. What do you do?'). Team members talk through their actions. This is excellent for testing decision-making and communication processes.</li><li><strong>Functional/Technical Simulation:</strong> A hands-on exercise where technical teams use their actual tools to respond to a simulated threat in a sandboxed environment. This tests technical skills and tool integrations.</li><li><strong>Full-Scale Simulation:</strong> The most complex type. This is a live, no-notice (or short-notice) exercise that can involve red teams (attackers), blue teams (defenders), and the full crisis management team. It's as close to a real incident as you can get.</li></ul>"
                    },
                    {
                        "title": "Red, Blue, and Purple Teaming",
                        "content": "<ul><li><strong>Red Team:</strong> An internal or external group that plays the role of the attacker, using real-world adversary TTPs to try to breach the organization's defenses.</li><li><strong>Blue Team:</strong> The internal incident response and security operations team—the defenders.</li><li><strong>Purple Team:</strong> Not a separate team, but a collaborative exercise where the red and blue teams work together. The red team explains the attack they are about to try, and the blue team checks to see if their tools can detect and block it. This is a highly efficient way to test and improve detection controls.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Running a Tabletop Exercise</strong></div><p>A good tabletop is not about finding a 'right' answer. It's about starting a conversation. The facilitator's job is to introduce 'injects'—new pieces of information—to advance the scenario and create pressure. For example: 'As you are containing the ransomware, a reporter from the Wall Street Journal calls your PR lead. What do you tell them?'</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Sample Tabletop Exercise Scenario Inject (Markdown)",
                        "language": "markdown",
                        "code": "## Tabletop Exercise: Project Nightfall\n\n### Scenario: Ransomware Outbreak\n\n**Inject #1 (10:00 AM - T+0 hours)**\n\n- The help desk receives several calls from users in the Finance department reporting that they cannot open any of their files.\n- The files have a new extension: `.L0CKED`.\n- One user forwards a screenshot of their desktop, which shows a ransom note demanding 50 Bitcoin.\n- A SIEM alert fires for 'Potential Ransomware Activity Detected' on the primary Finance file server, `FS-FIN-01`.\n\n**Questions for the Team:**\n\n1.  **Triage Analyst:** What are your immediate first five actions?\n2.  **Incident Manager:** What is the initial severity classification? Who do you need to notify *right now*?\n3.  **Team:** What is our immediate containment goal?\n\n---\n\n**Inject #2 (11:30 AM - T+1.5 hours)**\n\n- Analysis confirms the ransomware is actively spreading via an unpatched vulnerability in a common software application.\n- The EDR tool shows 35 workstations and 2 servers are now encrypted.\n- The forensics team finds evidence that the attackers exfiltrated approximately 100GB of data from the file server before deploying the ransomware.\n\n**Questions for the Team:**\n\n1.  **Incident Manager:** Does the discovery of data exfiltration change the incident's priority? Who else needs to be brought into the response now?\n2.  **Legal Lead:** What are the immediate legal and regulatory implications of this discovery?\n3.  **Comms Lead:** What is the initial message to employees? Are we preparing any external statements yet?"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "A facilitator presents a developing incident scenario and the team talks through their response actions without using any real technology. What type of exercise is this?",
                        "options": [
                            "A full-scale simulation",
                            "A red team engagement",
                            "A tabletop exercise",
                            "A technical walkthrough"
                        ],
                        "correct": 2,
                        "explanation": "A tabletop exercise is a discussion-based activity where participants walk through a scenario, making decisions and describing their actions. It's designed to test plans, policies, and communication, not technical skills."
                    },
                    {
                        "id": 2,
                        "question": "What is the primary goal of a 'purple team' exercise?",
                        "options": [
                            "To see if the red team can win.",
                            "To have the red team and blue team work collaboratively to test and improve detection controls in real-time.",
                            "To keep the red and blue teams completely separate.",
                            "To focus only on management-level decision making."
                        ],
                        "correct": 1,
                        "explanation": "Purple teaming is a collaborative effort. The goal isn't for one side to 'win', but for the red team's attacks and the blue team's defense to be used together to directly improve security controls."
                    },
                    {
                        "id": 3,
                        "question": "What is a major benefit of conducting regular incident response exercises?",
                        "options": [
                            "They guarantee that no real incidents will ever happen.",
                            "They help identify gaps in the IR plan and build 'muscle memory' before a real crisis.",
                            "They are a compliance requirement that can be checked off a list and then forgotten.",
                            "They are a good way to use up the end-of-year training budget."
                        ],
                        "correct": 1,
                        "explanation": "The core purpose of exercises is to prepare the team and test the plan in a safe environment, allowing you to find and fix problems before they can impact a real incident response."
                    }
                ]
            }
        },
        {
            "id": "lesson-24",
            "title": "Post-Incident Activities and Lessons Learned",
            "duration": "100 min",
            "objectives": [
                "Establish a formal process for conducting a post-incident review.",
                "Utilize root cause analysis methodologies like the '5 Whys'.",
                "Create a lessons learned report with actionable recommendations.",
                "Develop a system for tracking the implementation of improvements.",
                "Foster a culture of blameless post-mortems."
            ],
            "content": {
                "overview": "Arguably the most important phase of the incident response lifecycle is what happens after the incident is over. This is where the organization learns from its mistakes and successes to become more resilient. This lesson covers how to establish a structured post-incident process that drives meaningful and lasting improvement.",
                "sections": [
                    {
                        "title": "The Post-Incident Review Meeting",
                        "content": "<p>Shortly after the incident is resolved (but while memories are still fresh), a formal review meeting should be held with all key participants in the response.</p><h3>Key Goals:</h3><ul><li>Create a definitive timeline of the incident.</li><li>Analyze what went well and what didn't.</li><li>Determine the root cause of the incident.</li><li>Generate actionable recommendations for improvement.</li></ul><h3>The Importance of a Blameless Culture:</h3><p>The post-mortem meeting must be a safe space. The goal is to find systemic causes, not to blame individuals. If people are afraid of being punished for mistakes, they will not be honest, and the organization will not learn. The focus should be on failures in process, technology, or training, not on 'who messed up'.</p>"
                    },
                    {
                        "title": "Root Cause Analysis (RCA)",
                        "content": "<p>It's not enough to know *what* happened; you need to know *why* it happened. RCA techniques help you drill down past the surface-level symptoms to find the underlying cause.</p><h3>The '5 Whys' Technique:</h3><p>A simple but powerful method. You start with the problem and ask 'Why?' repeatedly until you get to a root cause.</p><ul><li><strong>Problem:</strong> A critical server was compromised by an attacker.</li><li><strong>1. Why?</strong> Because it was running a vulnerable version of Apache Struts.</li><li><strong>2. Why?</strong> Because the patch for the vulnerability was not applied.</li><li><strong>3. Why?</strong> Because the server was missed during the last patch cycle.</li><li><strong>4. Why?</strong> Because the server was not in the asset management database.</li><li><strong>5. Why?</strong> Because there is no formal process for adding new servers to the asset database when they are provisioned. <strong>(Root Cause)</strong></li></ul><p>The solution is not just 'patch the server'. The real solution is 'fix the server provisioning process'.</p>"
                    },
                    {
                        "title": "The Lessons Learned Report and Tracking",
                        "content": "<p>The output of the review meeting is a formal report.</p><h3>Report Components:</h3><ul><li><strong>Executive Summary:</strong> A high-level overview of the incident and its business impact.</li><li><strong>Timeline:</strong> A detailed, minute-by-minute timeline of events.</li><li><strong>Root Cause Analysis:</strong> The findings from the RCA process.</li><li><strong>What Went Well / What Could Be Improved:</strong> A summary of the team's analysis.</li><li><strong>Actionable Recommendations:</strong> A numbered list of specific, measurable, achievable, relevant, and time-bound (SMART) recommendations. Each item must have a clear owner and a due date.</li></ul><div class=\"info-box warning\"><div class=\"info-box-header\"><i class=\"fas fa-exclamation-triangle\"></i><strong>Don't Let it Become Shelfware</strong></div><p>The worst thing you can do is write a beautiful lessons learned report that no one ever looks at again. The recommendations must be entered into a ticketing or project management system and tracked to completion. This is the crucial step that turns learning into improvement.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Post-Incident Report Action Item Tracker (Markdown Table)",
                        "language": "markdown",
                        "code": "## Post-Incident Report: CASE-2025-007 - Action Items\n\n| ID  | Recommendation                                     | Root Cause Addressed              | Owner        | Due Date     | Status      |\n|-----|----------------------------------------------------|-----------------------------------|--------------|--------------|-------------|\n| 1   | Implement a formal process for server provisioning.| Missing server from asset inventory.| IT Ops Lead  | 2025-10-15   | In Progress |\n| 2   | Deploy EDR agent to all developer workstations.      | Lack of endpoint visibility.        | Security Eng | 2025-09-30   | Completed   |\n| 3   | Conduct phishing simulation for Finance team.      | Successful phishing of user.        | Sec Training | 2025-10-05   | Not Started |\n| 4   | Update IR plan with new legal notification contact.| Outdated contact information.     | IR Manager   | 2025-09-15   | Completed   |"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "What is the primary goal of a 'blameless' post-mortem culture?",
                        "options": [
                            "To ensure that no one is ever held accountable for their actions.",
                            "To create a safe environment where people can be honest about mistakes, allowing the team to find and fix systemic process failures.",
                            "To speed up the meeting by skipping the analysis of what went wrong.",
                            "To protect management from criticism."
                        ],
                        "correct": 1,
                        "explanation": "A blameless culture focuses on 'what' went wrong with the process, not 'who' made a mistake. This encourages open and honest feedback, which is essential for true organizational learning."
                    },
                    {
                        "id": 2,
                        "question": "The '5 Whys' is a technique used for what purpose?",
                        "options": [
                            "To calculate incident response metrics.",
                            "To conduct a tabletop exercise.",
                            "To perform root cause analysis.",
                            "To write an executive summary."
                        ],
                        "correct": 2,
                        "explanation": "The '5 Whys' is a simple but effective root cause analysis method that helps an investigation move beyond the initial symptoms to find the underlying process or technology failure."
                    },
                    {
                        "id": 3,
                        "question": "What is the most critical step after a lessons learned report is written?",
                        "options": [
                            "Emailing it to the entire company.",
                            "Archiving it for compliance purposes.",
                            "Assigning owners and due dates to the recommendations and tracking them to completion.",
                            "Starting the investigation for the next incident."
                        ],
                        "correct": 2,
                        "explanation": "A report is useless without action. The process of assigning, tracking, and completing the improvement items is what actually makes the organization more resilient for the future."
                    }
                ]
            }
        },
        {
            "id": "lesson-25",
            "title": "International and Cross-Border Incidents",
            "duration": "90 min",
            "objectives": [
                "Understand the challenges of coordinating IR across multiple legal jurisdictions.",
                "Learn about data sovereignty and cross-border data transfer laws.",
                "Develop protocols for cooperating with international law enforcement.",
                "Manage cultural, language, and time zone challenges in a global team.",
                "Engage with international incident response organizations like FIRST."
            ],
            "content": {
                "overview": "For global organizations, a major incident rarely respects national borders. An attacker in one country can compromise a server in another to steal the data of customers in a third. This lesson addresses the immense legal and logistical complexities of managing a cross-border incident response.",
                "sections": [
                    {
                        "title": "The Challenge of Jurisdiction",
                        "content": "<p>When an incident spans multiple countries, one of the first questions is: 'Whose laws apply?' The answer is often 'all of them,' which creates a complex compliance challenge.</p><h3>Key Legal Hurdles:</h3><ul><li><strong>Data Sovereignty:</strong> Many countries have laws requiring that their citizens' data remain within the country's borders. This can complicate cloud incident response and forensic analysis.</li><li><strong>Cross-Border Data Transfer:</strong> Transferring potential evidence (like logs or disk images) from a server in one country to an analyst in another can be illegal without the proper legal mechanisms in place (e.g., Standard Contractual Clauses under GDPR).</li><li><strong>Conflicting Regulations:</strong> A court order in one country might demand the disclosure of data, while a privacy law in another country might forbid it. Navigating these conflicts requires expert legal counsel.</li></ul>"
                    },
                    {
                        "title": "Coordinating a Global Response",
                        "content": "<p>Managing a follow-the-sun investigation requires excellent coordination and communication.</p><h3>Logistical Challenges:</h3><ul><li><strong>Time Zones:</strong> A 24/7 response requires a smooth handoff process between teams in different regions (e.g., Asia, Europe, North America). A common case management system and a formal handoff procedure are essential.</li><li><strong>Language:</strong> Local teams may need to interview users or analyze logs in the local language. Translation services may be required for the central coordination team.</li><li><strong>Cultural Norms:</strong> Different cultures have different communication styles and expectations. An effective global IR manager must be sensitive to these differences.</li></ul>"
                    },
                    {
                        "title": "International Law Enforcement and Cooperation",
                        "content": "<p>Engaging law enforcement in a single country can be complex. In an international incident, it's even more so.</p><h3>Key Organizations:</h3><ul><li><strong>Interpol:</strong> An international organization that facilitates worldwide police cooperation.</li><li><strong>Europol:</strong> The law enforcement agency of the European Union. Its European Cybercrime Centre (EC3) is a key partner.</li><li><strong>Mutual Legal Assistance Treaties (MLATs):</strong> Formal agreements between countries that allow for the gathering and exchange of information in criminal investigations. This is often a slow and bureaucratic process.</li></ul><p>It's also crucial to leverage informal networks. Organizations like the <strong>Forum of Incident Response and Security Teams (FIRST)</strong> provide a trusted global community for IR professionals to share information and best practices.</p><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Engage Local Counsel</strong></div><p>When dealing with a cross-border incident, it is absolutely essential to engage legal counsel that is an expert in the laws of *each* affected country. A lawyer in the US cannot provide accurate advice on German data privacy law.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Global IR Team Handoff Checklist (Markdown)",
                        "language": "markdown",
                        "code": "## Daily IR Handoff Report (APAC to EMEA)\n\n**Case ID:** CASE-2025-008 (Global Phishing Campaign)\n**Handoff Time:** 01:00 UTC\n\n### 1. Current Situation Summary\n- A large-scale phishing campaign targeting employees in all regions was identified at 22:00 UTC.\n- The campaign uses a fake O365 login page to harvest credentials.\n- Initial analysis shows the malicious domain was registered 8 hours ago.\n\n### 2. Actions Taken During APAC Shift\n- Malicious domain and source IPs have been blocked on the global firewall.\n- An email search was conducted; a list of all 250 recipients has been compiled.\n- EDR queries have identified 15 users who clicked the link. 5 users are confirmed to have entered credentials.\n- The accounts of the 5 confirmed-compromised users have been disabled pending password reset.\n\n### 3. Immediate Tasks for Incoming (EMEA) Shift\n- **HIGH PRIORITY:** Begin targeted investigation of the 5 compromised user accounts. Analyze mailbox rules, sent items, and recent logins for signs of further malicious activity.\n- Contact the 10 other users who clicked but may not have entered credentials to confirm and seize laptops if necessary.\n- Continue to monitor for any new attempts to use harvested credentials.\n\n### 4. Key Observables (IoCs)\n- **Phishing URL:** `o365-securelogin-portal.com`\n- **Source IP:** `123.45.67.89`\n- **Email Subject:** `Urgent: Action Required on Your Account`\n\n**Handoff From:** Alice (APAC Lead)\n**Handoff To:** Bob (EMEA Lead)"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "Laws that require a country's citizens' data to be stored on servers physically located within that country are known as what?",
                        "options": [
                            "Data transfer laws",
                            "Data sovereignty laws",
                            "Privacy laws",
                            "Cybercrime laws"
                        ],
                        "correct": 1,
                        "explanation": "Data sovereignty is the concept that data is subject to the laws and legal jurisdiction of the country in which it is physically located."
                    },
                    {
                        "id": 2,
                        "question": "What is FIRST (Forum of Incident Response and Security Teams)?",
                        "options": [
                            "A specific law enforcement agency.",
                            "A type of security software.",
                            "A trusted global non-profit organization for IR professionals to collaborate and share information.",
                            "A cybersecurity training certification."
                        ],
                        "correct": 2,
                        "explanation": "FIRST is a premier organization and a key global community for incident response teams worldwide, promoting cooperation and information sharing."
                    },
                    {
                        "id": 3,
                        "question": "When managing a global incident, why is a centralized case management system so important?",
                        "options": [
                            "It allows teams in different time zones to have a single source of truth and facilitates smooth handoffs.",
                            "It is a specific legal requirement in most countries.",
                            "It automatically resolves the incident without human intervention.",
                            "It prevents the need for communication between teams."
                        ],
                        "correct": 0,
                        "explanation": "A common case management system is the backbone of a follow-the-sun operation. It ensures that when a team in Europe starts their day, they can see exactly what the team in Asia accomplished and what the immediate next steps are, preventing duplication of effort and loss of context."
                    }
                ]
            }
        },
        {
            "id": "lesson-26",
            "title": "Crisis Management Integration",
            "duration": "90 min",
            "objectives": [
                "Differentiate between an 'incident' and a 'crisis'.",
                "Understand the structure and role of a Crisis Management Team (CMT).",
                "Align the technical IR team with the strategic CMT.",
                "Provide effective, business-focused updates to executive leadership.",
                "Manage the transition from technical recovery to long-term business recovery."
            ],
            "content": {
                "overview": "Not every incident is a crisis, but every crisis involves an incident. When a security incident becomes so severe that it threatens the organization's viability, reputation, or financial stability, it moves beyond a technical response into the realm of crisis management. This lesson covers how the IR team integrates with and supports the executive-level crisis management function.",
                "sections": [
                    {
                        "title": "Incident vs. Crisis",
                        "content": "<p>It's important to understand the distinction.</p><ul><li><strong>An Incident</strong> is a technical event that violates a security policy. It is handled by the <strong>Incident Response Team (IRT)</strong>. Their goal is to contain and remediate the technical problem.</li><li><strong>A Crisis</strong> is a business-level event that threatens the strategic objectives of the organization. It is handled by the <strong>Crisis Management Team (CMT)</strong>. Their goal is to protect the business as a whole.</li></ul><p>A malware infection on a single laptop is an incident. A ransomware attack that shuts down all company manufacturing and has been reported on by the Wall Street Journal is a crisis.</p>"
                    },
                    {
                        "title": "The Crisis Management Team (CMT)",
                        "content": "<p>The CMT is a strategic, cross-functional group of senior leaders. The IR team *informs* the CMT; they are not typically part of it.</p><h3>Typical CMT Members:</h3><ul><li><strong>CMT Lead (often the COO or a designated executive)</strong></li><li><strong>CEO / President</strong></li><li><strong>General Counsel (Legal Lead)</strong></li><li><strong>CFO (Financial Lead)</strong></li><li><strong>Head of HR</strong></li><li><strong>Head of Communications / PR</strong></li><li><strong>CISO / CIO (acting as the liaison to the technical IRT)</strong></li></ul>"
                    },
                    {
                        "title": "The Flow of Information",
                        "content": "<p>The relationship between the IRT and the CMT is crucial. The IRT is on the 'front lines' of the technical battle, and the CMT is in the 'command center' making strategic decisions based on the information the IRT provides.</p><h3>IRT's Responsibility to the CMT:</h3><ul><li>Provide regular, jargon-free updates focused on business impact.</li><li>Give realistic estimates for recovery times.</li><li>Answer questions to help the CMT make decisions. For example, Legal might ask, 'Do we know for sure if customer data was taken?' to decide if they need to start the notification process.</li><li>Escalate needs for resources or critical decisions.</li></ul><h3>CMT's Responsibility to the IRT:</h3><ul><li>Provide clear strategic direction. (e.g., 'The absolute top priority is restoring the e-commerce site. De-prioritize internal systems for now.')</li><li>Run interference and remove roadblocks for the IRT.</li><li>Manage all external communication (media, customers, regulators), allowing the IRT to focus on the technical work.</li></ul><div class=\"info-box tip\"><div class=\"info-box-header\"><i class=\"fas fa-lightbulb\"></i><strong>Different Rooms, Different Goals</strong></div><p>Think of it as two separate 'war rooms'. The **Technical War Room** is where the IRT is deep in forensics, log analysis, and remediation. The **Strategic War Room** is where the CMT is on the phone with lawyers, drafting press releases, and calculating financial impact. The CISO or CIO acts as the bridge between these two rooms.</p></div>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "CMT Update Template (The '3-3-3' Model)",
                        "language": "markdown",
                        "code": "## CMT Briefing: Project Nightfall (Ransomware Crisis)\n\n**Update As Of:** 2025-09-02 18:00 UTC\n\n### The 3 Things We KNOW:\n1.  We have been impacted by a widespread ransomware attack that began at approximately 10:00 UTC.\n2.  The attack exploited a known vulnerability; forensic analysis confirms the attackers exfiltrated data from the Finance share before encryption.\n3.  All manufacturing plant operations are currently halted as a direct result of this attack.\n\n### The 3 Things We are DOING:\n1.  Our IR team is actively working with our external partner to restore critical systems from backup. The top priority is the manufacturing execution system (MES).\n2.  Our legal team has engaged external counsel and is preparing for data breach notification requirements.\n3.  Our communications team has prepared internal and external holding statements and is monitoring social media.\n\n### The 3 Things We NEED:\n1.  **Decision:** The attackers have made a ransom demand of 50 BTC (~$1.5M). We need a decision from the CMT on whether to engage a negotiator or rule out payment entirely.\n2.  **Resource:** We need emergency PO approval for $250k for our external IR partner.\n3.  **Direction:** Please confirm that the MES system is the correct top priority for restoration, above all other systems."
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "What is the primary difference between an incident and a crisis?",
                        "options": [
                            "There is no difference.",
                            "An incident is a technical event handled by the IRT; a crisis is a strategic business threat handled by the CMT.",
                            "An incident involves malware, while a crisis does not.",
                            "An incident is handled internally, while a crisis is handled by law enforcement."
                        ],
                        "correct": 1,
                        "explanation": "This distinction is key. The IRT handles the technical problem, while the CMT handles the overarching business problem that the technical incident has caused."
                    },
                    {
                        "id": 2,
                        "question": "Who is typically a member of the Crisis Management Team (CMT)?",
                        "options": [
                            "Junior help desk analysts.",
                            "Senior executives like the CEO, General Counsel, and Head of Communications.",
                            "The entire IT department.",
                            "External auditors."
                        ],
                        "correct": 1,
                        "explanation": "The CMT is composed of senior business leaders who have the authority to make strategic decisions that affect the entire organization."
                    },
                    {
                        "id": 3,
                        "question": "What is the role of the Incident Response Team (IRT) in relation to the Crisis Management Team (CMT)?",
                        "options": [
                            "The IRT manages the CMT.",
                            "The IRT provides the CMT with technical, business-focused updates to inform strategic decision-making.",
                            "The two teams should never communicate.",
                            "The IRT is responsible for communicating with the media."
                        ],
                        "correct": 1,
                        "explanation": "The IRT is the source of technical truth. Their job is to distill the complex technical situation into clear, concise updates about business impact so that the CMT can make informed decisions."
                    }
                ]
            }
        },
        {
            "id": "lesson-27",
            "title": "Incident Response for Different Organization Types",
            "duration": "90 min",
            "objectives": [
                "Tailor IR planning for large enterprises versus small and medium businesses (SMBs).",
                "Understand the specific regulatory requirements for sectors like healthcare and finance.",
                "Address the unique challenges of government and public sector incident response.",
                "Develop an IR strategy for Managed Service Providers (MSPs).",
                "Adapt IR procedures for educational institutions."
            ],
            "content": {
                "overview": "Incident response is not one-size-fits-all. The priorities, resources, and regulatory pressures of a large bank are vastly different from those of a small school district or a tech startup. This lesson explores how to adapt the principles of incident response to fit the specific context of different organization types.",
                "sections": [
                    {
                        "title": "Enterprise vs. SMB",
                        "content": "<h3>Large Enterprise:</h3><ul><li><strong>Strengths:</strong> Larger budget, dedicated IR team, sophisticated toolsets (SIEM, SOAR, EDR).</li><li><strong>Challenges:</strong> Massive and complex environment, bureaucracy can slow decision-making, huge attack surface.</li><li><strong>IR Focus:</strong> Formal processes, clear roles, automation, and managing a complex web of stakeholders are key.</li></ul><h3>Small & Medium Business (SMB):</h3><ul><li><strong>Strengths:</strong> Agility, simpler environment, direct communication lines to leadership.</li><li><strong>Challenges:</strong> Limited budget, no dedicated security staff (IT staff wear many hats), lack of advanced tools.</li><li><strong>IR Focus:</strong> Preparation is paramount. Having a simple, actionable plan and a pre-paid retainer with a third-party IR firm is often the most effective strategy.</li></ul>"
                    },
                    {
                        "title": "Sector-Specific Considerations",
                        "content": "<p>Certain industries have unique requirements that must be built into the IR plan.</p><h3>Healthcare:</h3><ul><li><strong>Driver:</strong> HIPAA.</li><li><strong>Focus:</strong> The primary concern is the potential breach of Protected Health Information (PHI).</li><li><strong>IR Nuance:</strong> The 60-day breach notification clock is a major factor. The response must quickly determine if PHI was accessed. Incidents affecting medical devices (IoMT) can have patient safety implications.</li></ul><h3>Financial Services:</h3><ul><li><strong>Drivers:</strong> GLBA, SOX, PCI DSS, NYDFS.</li><li><strong>Focus:</strong> Protecting financial data, ensuring transaction integrity, and maintaining market confidence.</li><li><strong>IR Nuance:</strong> Extremely low tolerance for downtime. Reporting requirements to regulatory bodies (like the OCC or FINRA) are very strict and have short timelines.</li></ul><h3>Government/Public Sector:</h3><ul><li><strong>Drivers:</strong> FISMA, various federal and state laws.</li><li><strong>Focus:</strong> Protecting sensitive citizen data and national security interests, maintaining public trust.</li><li><strong>IR Nuance:</strong> The response is often highly formalized and procedural. Coordination with other government agencies (like CISA or the FBI) is common and often mandatory.</li></ul>"
                    },
                    {
                        "title": "Managed Service Providers (MSPs / MSSPs)",
                        "content": "<p>MSPs are a special case because they are a prime target for supply chain attacks. A compromise of an MSP can give an attacker access to all of that MSP's clients.</p><h3>IR Focus for MSPs:</h3><ul><li><strong>Customer Communication:</strong> The MSP's IR plan must have a detailed and robust section on how they will communicate with their clients during an incident.</li><li><strong>Segregation:</strong> The MSP's internal network must be strictly segregated from client networks. Credentials used to access client environments must be unique and highly secured.</li><li><strong>Multi-Tenancy Forensics:</strong> Investigating an incident in a multi-tenant environment is extremely complex, requiring careful procedures to avoid violating the privacy of unaffected clients.</li></ul>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "IR Plan Snippet for a Healthcare Organization",
                        "language": "markdown",
                        "code": "### 4.5 HIPAA / PHI Breach Protocol\n\n**Trigger:** This protocol is activated immediately upon a credible belief that an incident has resulted in the unauthorized access, use, or disclosure of Protected Health Information (PHI).\n\n1.  **Immediate Escalation:** The Incident Manager must immediately notify the organization's designated Privacy Officer and General Counsel.\n\n2.  **Preliminary Risk Assessment:** Within 24 hours, the IR team, in conjunction with the Privacy Officer, will conduct a preliminary assessment using the HIPAA Breach Notification Rule's four-factor risk assessment:\n    -   The nature and extent of the PHI involved.\n    -   The unauthorized person who used the PHI or to whom the disclosure was made.\n    -   Whether the PHI was actually acquired or viewed.\n    -   The extent to which the risk to the PHI has been mitigated.\n\n3.  **Initiate Notification Clock:** The discovery of the breach marks the start of the 60-day notification clock as mandated by HIPAA.\n\n4.  **Evidence Preservation:** All evidence related to the potential breach must be strictly preserved under the direction of the General Counsel to support the formal investigation and reporting.\n\n5.  **External Communication:** NO external communication regarding the potential breach will be made without the express approval of the General Counsel and the Crisis Management Team."
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "For a small business with no dedicated security staff, what is often the most practical IR strategy?",
                        "options": [
                            "To buy a full SIEM and SOAR platform and try to manage it themselves.",
                            "To ignore security and hope for the best.",
                            "To create a simple IR plan and establish a retainer with a reputable third-party IR firm.",
                            "To assign incident response to the marketing intern."
                        ],
                        "correct": 2,
                        "explanation": "SMBs get the best value by focusing on preparation (having a plan) and having experts on call. A retainer ensures they can get professional help quickly during a crisis without having to negotiate contracts and pricing under duress."
                    },
                    {
                        "id": 2,
                        "question": "A breach at a hospital involving patient medical records would be primarily governed by which US regulation?",
                        "options": [
                            "PCI DSS",
                            "SOX",
                            "HIPAA",
                            "FISMA"
                        ],
                        "correct": 2,
                        "explanation": "HIPAA (Health Insurance Portability and Accountability Act) is the primary US federal law that governs the security and privacy of Protected Health Information (PHI)."
                    },
                    {
                        "id": 3,
                        "question": "Why are Managed Service Providers (MSPs) such a high-value target for attackers?",
                        "options": [
                            "They typically have poor security.",
                            "A single MSP compromise can provide the attacker with access to the networks of all of the MSP's clients.",
                            "They are easy to find in the phone book.",
                            "They do not have incident response plans."
                        ],
                        "correct": 1,
                        "explanation": "MSPs are a classic supply chain target. Attackers view them as a 'skeleton key' that can unlock the doors to potentially hundreds of other victim organizations."
                    }
                ]
            }
        },
        {
            "id": "lesson-28",
            "title": "Emerging Threats and Future Preparedness",
            "duration": "90 min",
            "objectives": [
                "Analyze the potential impact of AI and machine learning on security incidents.",
                "Consider the long-term implications of quantum computing for cryptography and IR.",
                "Develop response strategies for incidents involving blockchain and cryptocurrencies.",
                "Prepare for threats from deep fakes and synthetic media.",
                "Foster an adaptive approach to incident response."
            ],
            "content": {
                "overview": "The threat landscape is constantly evolving. The tools and techniques that are effective today may be obsolete tomorrow. This forward-looking lesson explores emerging threats and technologies, and discusses how incident response programs must adapt to remain effective in the future.",
                "sections": [
                    {
                        "title": "AI and Machine Learning: A Double-Edged Sword",
                        "content": "<h3>AI for Attack:</h3><ul><li><strong>AI-Powered Fuzzing:</strong> AI can be used to find new software vulnerabilities much faster than humans.</li><li><strong>Adaptive Malware:</strong> Malware that can learn and change its behavior to evade detection by EDR and antivirus tools.</li><li><strong>Hyper-Realistic Phishing:</strong> AI can be used to generate highly convincing, personalized spear-phishing emails at scale.</li></ul><h3>AI for Defense:</h3><ul><li><strong>UEBA and Anomaly Detection:</strong> Most modern security tools already use machine learning to baseline normal activity and detect suspicious deviations.</li><li><strong>Automated Triage:</strong> AI can help analyze the millions of alerts an organization receives, prioritizing the most critical ones and filtering out false positives.</li><li><strong>SOAR Playbook Optimization:</strong> AI can analyze the results of past incidents to suggest improvements to automated response workflows.</li></ul>"
                    },
                    {
                        "title": "The Quantum Threat",
                        "content": "<p>Quantum computing, while likely still a decade or more away from being a practical threat, poses a fundamental risk to modern security.</p><ul><li><strong>The Threat:</strong> A sufficiently powerful quantum computer will be able to break most of the public-key cryptography we rely on today for things like TLS (website encryption) and VPNs.</li><li><strong>The Response:</strong> The IR field, along with the entire tech industry, will need to transition to new 'quantum-resistant' or 'post-quantum' cryptography standards. The challenge is that adversaries may be engaging in 'harvest now, decrypt later' attacks—capturing encrypted data today with the expectation of decrypting it in the future once they have a quantum computer.</li></ul>"
                    },
                    {
                        "title": "Responding to New Threat Types",
                        "content": "<h3>Deep Fakes and Synthetic Media:</h3><ul><li><strong>The Threat:</strong> Imagine a deep fake video of your CEO announcing a fake merger to manipulate stock prices, or an audio deep fake of your CFO authorizing a fraudulent wire transfer.</li><li><strong>IR Challenge:</strong> The challenge will be in rapid verification and response. Forensics will need new tools to detect synthetic media. The crisis communication team will need plans to quickly debunk fake information.</li></ul><h3>Blockchain and Cryptocurrency Incidents:</h3><ul><li><strong>The Threat:</strong> Ransom demands are already in cryptocurrency. Future incidents may involve the theft of corporate crypto assets or the manipulation of smart contracts.</li><li><strong>IR Challenge:</strong> The anonymous and irreversible nature of crypto transactions makes asset recovery extremely difficult. It requires specialized blockchain analysis tools and collaboration with crypto exchanges and law enforcement.</li></ul>"
                    },
                    {
                        "title": "The Need for an Adaptive IR Strategy",
                        "content": "<p>Given the pace of change, a rigid, static incident response plan is doomed to fail. The future of IR is about agility and adaptability.</p><h3>Principles for Future Preparedness:</h3><ul><li><strong>Focus on TTPs, not just IoCs:</strong> Instead of chasing specific file hashes, focus on detecting and responding to adversary *behaviors* (Tactics, Techniques, and Procedures).</li><li><strong>Embrace Automation:</strong> As attack speeds increase, the only way to respond effectively will be at machine speed.</li><li><strong>Continuous Learning:</strong> The IR team must have dedicated time for research, training, and learning about new threats.</li><li><strong>Assume a Breach:</strong> Continue to invest in response and recovery capabilities, not just prevention. It's not a matter of *if* you will be compromised, but *when*.</li></ul>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Conceptual Python Script to Detect Deepfake Video Artifacts",
                        "language": "python",
                        "code": "# This is conceptual pseudocode and not a working implementation.\n# Real deepfake detection is a complex AI/ML problem.\n\nclass DeepfakeDetector:\n    def __init__(self, video_file):\n        self.video = self.load_video(video_file)\n        self.artifacts = []\n\n    def check_for_unnatural_blinking(self):\n        # Real humans blink at a certain rate. Deepfakes often get this wrong.\n        blink_rate = self.analyze_blinking_rate(self.video)\n        if blink_rate < 5 or blink_rate > 30: # Normal is ~15-20 per minute\n            self.artifacts.append(\"Unnatural blink rate detected.\")\n\n    def check_for_inconsistent_head_pose(self):\n        # Checks if the head movement looks synthetic or disconnected from the body.\n        consistency_score = self.analyze_head_pose(self.video)\n        if consistency_score < 0.8:\n            self.artifacts.append(\"Inconsistent head pose or 'puppet' movement.\")\n\n    def check_for_gaze_mismatch(self):\n        # Analyzes if the subject's eyes are correctly focusing on objects.\n        gaze_errors = self.analyze_gaze_direction(self.video)\n        if gaze_errors > 3:\n            self.artifacts.append(\"Mismatched or inconsistent gaze direction.\")\n\n    def analyze(self):\n        self.check_for_unnatural_blinking()\n        self.check_for_inconsistent_head_pose()\n        self.check_for_gaze_mismatch()\n\n        if not self.artifacts:\n            print(\"Video appears to be authentic.\")\n        else:\n            print(\"Potential Deepfake Detected! Found the following artifacts:\")\n            for artifact in self.artifacts:\n                print(f\"- {artifact}\")"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "An attacker capturing encrypted data today with the plan to decrypt it in 10 years with a powerful quantum computer is known as what kind of attack?",
                        "options": [
                            "A zero-day attack",
                            "A denial-of-service attack",
                            "A 'harvest now, decrypt later' attack",
                            "A phishing attack"
                        ],
                        "correct": 2,
                        "explanation": "This strategy highlights the long-term risk of quantum computing, as data encrypted with today's standards could be compromised in the future."
                    },
                    {
                        "id": 2,
                        "question": "What is the primary challenge in responding to an incident involving the theft of cryptocurrency?",
                        "options": [
                            "The transactions are easily reversible.",
                            "The anonymous and largely irreversible nature of blockchain transactions makes recovery very difficult.",
                            "It is easy to identify the thief.",
                            "The value of cryptocurrency never changes."
                        ],
                        "correct": 1,
                        "explanation": "Unlike a fraudulent wire transfer, which a bank can often reverse, cryptocurrency transactions are designed to be immutable, making theft recovery a significant challenge for IR teams and law enforcement."
                    },
                    {
                        "id": 3,
                        "question": "Given the rapid evolution of threats, what is the most important characteristic of a modern IR strategy?",
                        "options": [
                            "It should be printed once and never changed.",
                            "It should be rigid and bureaucratic.",
                            "It should be adaptive and focus on detecting adversary behaviors (TTPs).",
                            "It should focus entirely on preventative technologies and ignore response."
                        ],
                        "correct": 2,
                        "explanation": "A successful IR program must be agile and adaptable. Focusing on attacker behaviors (like lateral movement or credential dumping) is more resilient than chasing specific malware signatures, which are constantly changing."
                    }
                ]
            }
        },
        {
            "id": "lesson-29",
            "title": "Incident Response Program Management",
            "duration": "90 min",
            "objectives": [
                "Establish a formal governance structure for the IR program.",
                "Develop a strategic roadmap for improving program maturity.",
                "Manage the IR budget and resource allocation.",
                "Oversee vendor management and procurement for IR tools and services.",
                "Prepare for and manage internal and external audits of the IR program."
            ],
            "content": {
                "overview": "A successful incident response capability is more than just a collection of tools and a plan; it's a fully managed business program. This lesson moves beyond the tactical response to individual incidents and covers the strategic aspects of managing the entire IR program, including governance, budgeting, and continuous improvement.",
                "sections": [
                    {
                        "title": "IR Program Governance",
                        "content": "<p>Governance provides the structure, oversight, and authority for the IR program.</p><h3>Key Components:</h3><ul><li><strong>IR Charter:</strong> A formal document, approved by executive leadership, that defines the mission, scope, and authority of the incident response team. It empowers the team to take necessary actions during an incident.</li><li><strong>Steering Committee:</strong> A cross-functional group of leaders (e.g., from IT, Security, Legal, HR) that meets regularly (e.g., quarterly) to review IR metrics, approve the strategic roadmap, and provide oversight.</li><li><strong>Policy and Standards:</strong> The formal, high-level policies that govern incident response, which are then supported by detailed standards and procedures.</li></ul>"
                    },
                    {
                        "title": "Building a Maturity Roadmap",
                        "content": "<p>An IR program should be on a path of continuous improvement. A roadmap visualizes that path.</p><h3>Steps to Create a Roadmap:</h3><ol><li><strong>Assess Your Current State:</strong> Use a maturity model (like the IR maturity model from Lesson 1) to honestly assess your current capabilities. Where are you on the scale from 'ad-hoc' to 'optimized'?</li><li><strong>Define Your Target State:</strong> Where do you want to be in 12-24 months? You don't need to be fully optimized in every area. Your target state should be based on your organization's risk profile.</li><li><strong>Identify the Gaps:</strong> What are the specific people, process, and technology gaps between your current and target states?</li><li><strong>Create Initiatives:</strong> Turn those gaps into specific, time-bound projects. For example:<ul><li>'Implement a SOAR platform' (Technology)</li><li>'Develop an insider threat playbook' (Process)</li><li>'Send two analysts for advanced forensics training' (People)</li></ul></li><li><strong>Prioritize and Schedule:</strong> Place these initiatives on a timeline, creating a 1-2 year strategic roadmap.</li></ol>"
                    },
                    {
                        "title": "Budgeting and Resource Management",
                        "content": "<p>A well-managed program requires a well-managed budget. Justifying this budget to the CFO requires speaking in terms of risk reduction.</p><h3>Typical IR Budget Categories:</h3><ul><li><strong>Personnel:</strong> Salaries, benefits, and training for the IR team.</li><li><strong>Technology:</strong> Software licenses, hardware, and maintenance for tools like SIEM, EDR, and SOAR.</li><li><strong>Third-Party Services:</strong> The annual cost for an IR retainer, threat intelligence feeds, and specialized consulting.</li></ul><p>Using metrics (Lesson 22) is key. You can justify a SOAR platform investment by showing how much it will reduce your MTTR and, therefore, reduce the financial impact of each incident.</p>"
                    },
                    {
                        "title": "Managing Audits",
                        "content": "<p>Your IR program will inevitably be reviewed by internal or external auditors to ensure compliance with regulations like PCI DSS or SOX. Good program management makes audits much less painful.</p><h3>Keys to a Successful Audit:</h3><ul><li><strong>Documentation:</strong> Have your IR plan, procedures, and charter well-documented and easily accessible.</li><li><strong>Evidence:</strong> Be able to produce evidence that you are following your plan. This comes from your case management system—show the auditors the ticket for a past incident, with all the timestamps, notes, and the final lessons learned report.</li><li><strong>Consistency:</strong> Auditors look for consistency. If your plan says you do a post-incident review for every high-severity incident, you must be able to show that you have actually done so.</li></ul>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "IR Program Maturity Roadmap (Gantt Chart - Text Representation)",
                        "language": "markdown",
                        "code": "## IR Program Strategic Roadmap: FY2026\n\n**Q1 (Jan-Mar)**\n- [X] Initiative 1.1: Renew IR Retainer with Vendor XYZ\n- [ ] Initiative 1.2: Conduct Annual Tabletop Exercise with CMT\n- [ ] Initiative 1.3: Begin SOAR Platform Proof of Concept\n\n**Q2 (Apr-Jun)**\n- [ ] Initiative 2.1: Implement SOAR Platform (Phase 1: Phishing Playbook)\n- [ ] Initiative 2.2: Send Analyst 1 to SANS FOR508 Training\n- [ ] Initiative 2.3: Develop and test Cloud IR Playbook\n\n**Q3 (Jul-Sep)**\n- [ ] Initiative 3.1: Integrate Threat Intelligence Platform with SOAR\n- [ ] Initiative 3.2: Conduct Internal Red Team Exercise\n- [ ] Initiative 3.3: Mature IR Metrics and create Executive Dashboard\n\n**Q4 (Oct-Dec)**\n- [ ] Initiative 4.1: Implement SOAR Platform (Phase 2: Ransomware Playbook)\n- [ ] Initiative 4.2: Review and Update IR Plan for FY2027\n- [ ] Initiative 4.3: FY2027 Budget Planning and Submission"
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "A formal document approved by leadership that defines the mission, scope, and authority of the IR team is called a(n):",
                        "options": [
                            "Incident ticket",
                            "IR Charter",
                            "Firewall rule",
                            "Budget request"
                        ],
                        "correct": 1,
                        "explanation": "The IR Charter is a critical governance document that formally empowers the IR team and establishes its role within the organization."
                    },
                    {
                        "id": 2,
                        "question": "What is the first step in creating a strategic roadmap for your IR program?",
                        "options": [
                            "To buy a new tool.",
                            "To write the budget.",
                            "To honestly assess your program's current state using a maturity model.",
                            "To hire more staff."
                        ],
                        "correct": 2,
                        "explanation": "You cannot plan a route to your destination if you don't know where you are starting from. A candid assessment of your current capabilities is the essential first step in any strategic planning process."
                    },
                    {
                        "id": 3,
                        "question": "When preparing for an audit of your IR program, what is most important?",
                        "options": [
                            "Having the most expensive tools.",
                            "Having well-documented plans and procedures, and evidence that you consistently follow them.",
                            "Having a large team.",
                            "Hoping the auditor doesn't ask any hard questions."
                        ],
                        "correct": 1,
                        "explanation": "Auditors operate on the principle of 'say what you do, do what you say.' They will look at your plan (what you say you do) and then ask for evidence from your records (proof that you actually do it)."
                    }
                ]
            }
        },
        {
            "id": "lesson-30",
            "title": "Advanced Incident Response Leadership",
            "duration": "100 min",
            "objectives": [
                "Develop the leadership skills required of an Incident Commander.",
                "Learn techniques for making critical decisions under high stress and with incomplete information.",
                "Manage and motivate a team through a long-term, high-stress incident.",
                "Effectively manage stakeholder expectations and navigate organizational politics.",
                "Foster a culture of continuous learning and professional development within the IR team."
            ],
            "content": {
                "overview": "Technical skills are essential for incident response, but leadership makes the difference between a chaotic, ineffective response and a calm, coordinated one. This final lesson focuses on the 'soft skills' of leadership, decision-making, and communication that are critical for those who lead an IR team or act as an Incident Commander during a major crisis.",
                "sections": [
                    {
                        "title": "The Incident Commander (IC) Role",
                        "content": "<p>In a major incident, one person needs to be in charge. The Incident Commander is the single point of leadership for the technical response. They are not necessarily the most senior technical person, but they are the best leader and coordinator.</p><h3>Key Responsibilities of the IC:</h3><ul><li><strong>Command and Control:</strong> Directing the team's efforts and ensuring everyone is working on the right priorities.</li><li><strong>Information Synthesis:</strong> Taking in technical information from multiple analysts and synthesizing it into a coherent picture of the incident.</li><li><strong>Decision Making:</strong> Making the tough calls, often with limited information (e.g., 'Do we take the server offline now, even though it will impact sales?').</li><li><strong>Communication Hub:</strong> Serving as the primary point of contact between the technical team and the rest of the organization (especially the CMT).</li><li><strong>Protecting the Team:</strong> Shielding the technical analysts from outside distractions (like requests from executives) so they can focus on their work.</li></ul>"
                    },
                    {
                        "title": "Decision-Making Under Pressure",
                        "content": "<p>During a crisis, you will rarely have all the information you want. An effective leader must be able to make a decision based on the best information available *at that moment* and then adapt as the situation changes.</p><h3>A Framework for Crisis Decisions (OODA Loop):</h3><ul><li><strong>Observe:</strong> What is the current state of the situation? What do we know for sure?</li><li><strong>Orient:</strong> Analyze the information in the context of your experience and the organization's goals. What does this data mean? What are our options?</li><li><strong>Decide:</strong> Choose a course of action.</li><li><strong>Act:</strong> Execute the decision.</li></ul><p>This is a continuous loop. After you act, you observe the results of that action, re-orient your understanding, and make a new decision.</p>"
                    },
                    {
                        "title": "Managing Team Burnout",
                        "content": "<p>Major incidents can be marathons, not sprints. A ransomware response can last for days or weeks of high-stress, around-the-clock work. A leader's job is to manage the human element and prevent team burnout.</p><h3>Strategies for Team Management:</h3><ul><li><strong>Enforce Rotations:</strong> Set up a formal shift schedule (e.g., two 12-hour shifts) and force people to go home and rest. A tired analyst makes mistakes.</li><li><strong>Provide Support:</strong> Ensure the team has what they need, whether it's food and coffee in the war room or backup from a third-party partner to share the load.</li><li><strong>Celebrate Small Wins:</strong> In a long incident, it's important to acknowledge progress and keep morale high.</li><li><strong>Lead by Example:</strong> The leader's calm and confidence sets the tone for the entire team. If the leader panics, the team will panic.</li></ul>"
                    },
                    {
                        "title": "Leading After the Crisis",
                        "content": "<p>A leader's job doesn't end when the incident is resolved. The post-incident phase is a critical leadership opportunity.</p><ul><li><strong>Champion the Lessons Learned:</strong> The leader must be the primary advocate for the improvements identified in the post-mortem. They must use their political capital to ensure the recommendations get funded and implemented.</li><li><strong>Recognize the Team:</strong> Publicly and privately acknowledge the hard work of the response team to leadership. This builds the team's reputation and morale.</li><li><strong>Focus on Development:</strong> Use the gaps identified in the incident to guide the team's training and development plan for the next year.</li></ul>"
                    }
                ],
                "codeExamples": [
                    {
                        "title": "Incident Commander's Shift Handoff Checklist",
                        "language": "markdown",
                        "code": "## IC Shift Handoff: Project Nightfall\n\n**Outgoing IC:** Alice Smith | **Incoming IC:** Bob Jones\n**Time:** 18:00 UTC\n\n### 1. Current Situation Assessment (SITREP)\n- We have successfully contained the ransomware to the corporate user segment. The manufacturing OT network appears to be unaffected.\n- 5 critical servers have been rebuilt from backup and are in the final validation phase.\n- Data exfiltration has been confirmed; the volume is estimated at 100GB of financial data.\n\n### 2. Key Decisions Made This Shift\n- Made the decision to NOT pay the ransom, based on CMT direction.\n- Authorized emergency procurement for external IR consulting services.\n- Approved the plan to rebuild servers rather than attempt to clean them.\n\n### 3. Current Priorities for the Team\n- **P1:** Complete validation of rebuilt servers and prepare for phased service restoration.\n- **P2:** Continue forensic analysis of the exfiltrated data to determine if any PII/PHI was included.\n- **P3:** Proactively hunt for any additional attacker persistence mechanisms.\n\n### 4. Open Questions & Action Items for Incoming IC\n- The CMT is requesting an ETA for restoration of the main ERP system. We need to provide them with a realistic estimate in the next 2 hours.\n- The forensics team needs a decision on whether to image all 35 affected workstations or just a representative sample.\n- Ensure the night shift team members take their mandatory 8-hour rest break before returning.\n\n### 5. Stakeholder Communication Status\n- Last CMT update was at 16:00 UTC.\n- Legal and Comms teams are currently drafting the formal customer notification.\n- No direct contact with law enforcement has been made yet, pending CMT approval."
                    }
                ]
            },
            "quiz": {
                "passingScore": 80,
                "questions": [
                    {
                        "id": 1,
                        "question": "What is the primary role of an Incident Commander (IC)?",
                        "options": [
                            "To perform all the technical forensics themselves.",
                            "To provide overall leadership, coordination, and communication for the response, and to make critical decisions.",
                            "To write the lessons learned report after the incident is over.",
                            "To approve the budget for the IR team."
                        ],
                        "correct": 1,
                        "explanation": "The Incident Commander is the leader and coordinator. They direct the efforts of the technical experts, synthesize information, and serve as the single point of contact to ensure an orderly and effective response."
                    },
                    {
                        "id": 2,
                        "question": "The OODA Loop (Observe, Orient, Decide, Act) is a framework for what?",
                        "options": [
                            "Writing a lessons learned report.",
                            "Making decisions in a fast-moving, high-stress environment.",
                            "Calculating IR metrics.",
                            "Performing malware analysis."
                        ],
                        "correct": 1,
                        "explanation": "The OODA loop provides a mental model for making decisions with incomplete information, acting, and then iterating based on the results, which is perfectly suited for the dynamic nature of a security crisis."
                    },
                    {
                        "id": 3,
                        "question": "During a long-term incident, what is a leader's most important responsibility regarding their team?",
                        "options": [
                            "To ensure everyone works at least 18 hours a day to resolve the incident faster.",
                            "To manage team stress and prevent burnout by enforcing rotations and providing support.",
                            "To find someone to blame for the incident.",
                            "To provide minute-by-minute technical direction to each analyst."
                        ],
                        "correct": 1,
                        "explanation": "A burned-out team is an ineffective team. A good leader understands that managing the human element is just as important as managing the technical problem, especially in a prolonged crisis."
                    }
                ]
            }
        }
    ]
};
      // =====================================================
      // GLOBAL VARIABLES
      // =====================================================
      let currentUser = null;
      let currentLessonIndex = 0;
      let courseProgress = {};
      let userStats = {};
      let quizState = {
        currentQuestion: 0,
        answers: [],
        score: 0,
        isComplete: false,
      };

      // Enhanced session tracking
      let courseSession = {
        startTime: null,
        totalStudyTime: 0,
        lessonsStarted: 0,
        lessonsCompleted: 0,
        pageLoadTime: new Date(),
        interactionCount: 0,
        lastActivityTime: new Date(),
      };

      // Music Player Variables
      let audioPlayer = new Audio();

      // Achievement notification system
      let notificationQueue = [];
      let isShowingNotification = false;

      // =====================================================
      // INITIALIZATION
      // =====================================================
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          showLoadingScreen();
          await checkAuth();

          if (currentUser) {
            // Initialize session tracking
            startCourseSession();

            // Load course data and progress
            await loadCourseData();
            await loadUserProfile();
            await loadProgress();

            // Initialize UI
            initializeEventListeners();
            renderSidebar();
            loadLesson(currentLessonIndex);

            // Initialize additional features
            initMusicPlayer();
            addMusicIndicator();
            initializeActivityTracking();

            hideLoadingScreen();
          } else {
            openAuthModal();
          }
        } catch (error) {
          console.error("Error initializing course:", error);
          hideLoadingScreen();
          showToast("Failed to initialize course system", "error");
        }
      });

      // =====================================================
      // AUTHENTICATION SYSTEM
      // =====================================================
      async function checkAuth() {
        try {
          const {
            data: { session },
            error,
          } = await supabase.auth.getSession();

          if (error) {
            console.error("Auth error:", error);
            currentUser = null;
            openAuthModal();
            return;
          }

          if (!session) {
            currentUser = null;
            openAuthModal();
            return;
          }

          currentUser = session.user;
          updateUIWithUser();
        } catch (error) {
          console.error("Error checking auth:", error);
          currentUser = null;
          openAuthModal();
        }
      }

      function updateUIWithUser() {
        if (!currentUser) return;

        const name =
          currentUser.user_metadata?.full_name ||
          currentUser.email.split("@")[0];
        const userElements = document.querySelectorAll("[data-user-name]");
        userElements.forEach((el) => (el.textContent = name));
      }

      // =====================================================
      // USER PROFILE & STATS MANAGEMENT
      // =====================================================
      async function loadUserProfile() {
        try {
          // 🔍 Step 1: Try to fetch existing profile
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("*")
            .eq("id", currentUser.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (!profile) {
            // 🆕 Step 2: Create new profile if missing
            await createUserProfile();
          } else {
            // ✅ Step 3: Use existing profile
            userStats = profile;
            await updateLastActivity();
          }
        } catch (error) {
          console.error("❌ Error loading user profile:", error);
          showToast("Failed to load user profile", "error");
        }
      }
      async function createUserProfile() {
        try {
          const newProfile = {
            id: currentUser.id,
            full_name: currentUser.user_metadata?.full_name || "",
            email: currentUser.email,
            level: "Script Kiddie",
            total_points: 0,
            completed_courses: 0,
            current_streak: 0,
            total_certificates: 0,
            total_achievements: 0,
            sections_visited: 0,
            bonus_points: 0,
            in_progress_courses: 0,
            settings_changed: 0,
            midnight_sessions: 0,
            early_sessions: 0,
            weekend_sessions: 0,
            last_activity: new Date().toISOString(),
            created_at: new Date().toISOString(),
          };

          const { error } = await supabase
            .from("profiles")
            .insert([newProfile]);

          if (!error) {
            userStats = newProfile;
            // Award first login achievement
            setTimeout(() => checkAndUnlockAchievement("first_login"), 1000);
          }
        } catch (error) {
          console.error("Error creating user profile:", error);
        }
      }

      async function updateLastActivity() {
        try {
          const now = new Date();

          // Update activity tracking
          courseSession.lastActivityTime = now;

          // Update database
          await supabase
            .from("profiles")
            .update({
              last_activity: now.toISOString(),
            })
            .eq("id", currentUser.id);

          // Check time-based achievements
          await checkTimeBasedAchievements(now);
        } catch (error) {
          console.error("Error updating last activity:", error);
        }
      }

      // =====================================================
      // COURSE SESSION MANAGEMENT
      // =====================================================
      function startCourseSession() {
        courseSession.startTime = new Date();
        courseSession.pageLoadTime = new Date();

        logUserActivity("course_session_start", {
          course_id: COURSE_DATA.id,
          course_title: COURSE_DATA.title,
          user_agent: navigator.userAgent,
          screen_resolution: `${screen.width}x${screen.height}`,
        });

        // Check daily streak
        checkDailyStreak();
      }

      function initializeActivityTracking() {
        // Track page focus/blur for accurate study time
        document.addEventListener("visibilitychange", handleVisibilityChange);

        // Track user interactions
        ["click", "keydown", "scroll", "mousemove"].forEach((event) => {
          document.addEventListener(event, trackUserInteraction, {
            passive: true,
          });
        });

        // Periodic activity updates
        setInterval(updateStudyTime, 60000); // Every minute

        // Save session data before page unload
        window.addEventListener("beforeunload", saveSessionData);
      }

      function handleVisibilityChange() {
        if (document.hidden) {
          courseSession.lastActivityTime = new Date();
        } else {
          // Page became visible again - update activity
          updateLastActivity();
        }
      }

      function trackUserInteraction() {
        courseSession.interactionCount++;
        courseSession.lastActivityTime = new Date();

        // Throttle activity updates
        if (courseSession.interactionCount % 50 === 0) {
          updateLastActivity();
        }
      }

      function updateStudyTime() {
        if (!courseSession.startTime || document.hidden) return;

        const now = new Date();
        const sessionDuration = now - courseSession.startTime;
        courseSession.totalStudyTime = Math.floor(sessionDuration / 1000 / 60); // in minutes

        // Update progress with study time
        saveProgress();
      }

      function saveSessionData() {
        if (!currentUser || !courseSession.startTime) return;

        const sessionData = {
          user_id: currentUser.id,
          course_id: COURSE_DATA.id,
          session_duration: courseSession.totalStudyTime,
          lessons_viewed: courseSession.lessonsStarted,
          lessons_completed: courseSession.lessonsCompleted,
          interactions: courseSession.interactionCount,
          session_date: courseSession.startTime.toISOString().split("T")[0],
        };

        // Store in localStorage as backup
        localStorage.setItem(
          "course_session_backup",
          JSON.stringify(sessionData)
        );

        // Try to save to database
        logUserActivity("course_session_end", sessionData);
      }

      // =====================================================
      // COURSE DATA & PROGRESS MANAGEMENT
      // =====================================================
      async function loadCourseData() {
        try {
          // Update course info in UI
          document.getElementById("courseTitle").textContent =
            COURSE_DATA.title;
          document.getElementById("totalLessons").textContent =
            COURSE_DATA.lessons.length;

          // Log course access
          logUserActivity("course_access", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
          });
        } catch (error) {
          console.error("Error loading course data:", error);
        }
      }

      async function loadProgress() {
        try {
          // Get existing progress from database
          const { data, error } = await supabase
            .from("course_progress")
            .select("*")
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id)
            .single();

          if (error && error.code !== "PGRST116") {
            throw error;
          }

          if (data) {
            courseProgress = JSON.parse(data.lesson_progress || "{}");
            currentLessonIndex = data.current_lesson || 0;

            // Update session tracking
            courseSession.lessonsStarted = Object.keys(courseProgress).length;
            courseSession.lessonsCompleted = Object.values(
              courseProgress
            ).filter((p) => p.completed).length;
          } else {
            // Initialize new progress
            courseProgress = {};
            currentLessonIndex = 0;
            await saveProgress();

            // Award first course start achievement
            await checkAndUnlockAchievement("first_course_start");
          }

          updateProgressDisplay();
        } catch (error) {
          console.error("Error loading progress:", error);
          showToast("Failed to load progress", "error");
        }
      }

      async function saveProgress() {
        try {
          if (!currentUser) return;

          const now = new Date();
          const progressData = {
            user_id: currentUser.id,
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            current_lesson: currentLessonIndex,
            lesson_progress: JSON.stringify(courseProgress),
            progress: calculateOverallProgress(),
            lessons_completed: getCompletedLessonsCount(),
            lessons_started: Object.keys(courseProgress).length,
            study_time_minutes: courseSession.totalStudyTime,
            last_accessed: now.toISOString(),
            updated_at: now.toISOString(),
          };

          // Upsert progress
          const { error } = await supabase
            .from("course_progress")
            .upsert([progressData]);

          if (error) throw error;

          // Update user stats
          await updateUserStats();

          updateProgressDisplay();
        } catch (error) {
          console.error("Error saving progress:", error);
          showToast("Failed to save progress", "error");
        }
      }

      async function updateUserStats() {
        try {
          // Get all course progress for this user
          const { data: allProgress, error } = await supabase
            .from("course_progress")
            .select("progress, course_id, study_time_minutes")
            .eq("user_id", currentUser.id);

          if (error) throw error;

          // Calculate stats
          const completedCourses =
            allProgress?.filter((p) => p.progress >= 100).length || 0;
          const inProgressCourses =
            allProgress?.filter((p) => p.progress > 0 && p.progress < 100)
              .length || 0;
          const totalStudyTime =
            allProgress?.reduce(
              (sum, p) => sum + (p.study_time_minutes || 0),
              0
            ) || 0;

          // Calculate points (500 per completed course + achievement points)
          const coursePoints = completedCourses * 500;
          const bonusPoints = userStats.bonus_points || 0;
          const totalPoints = coursePoints + bonusPoints;

          // Update profile
          const updateData = {
            completed_courses: completedCourses,
            in_progress_courses: inProgressCourses,
            total_points: totalPoints,
            total_study_time: totalStudyTime,
            last_activity: new Date().toISOString(),
          };

          const { error: updateError } = await supabase
            .from("profiles")
            .update(updateData)
            .eq("id", currentUser.id);

          if (updateError) throw updateError;

          // Update local stats
          Object.assign(userStats, updateData);
        } catch (error) {
          console.error("Error updating user stats:", error);
        }
      }

      function calculateOverallProgress() {
        const completedLessons = getCompletedLessonsCount();
        return Math.round(
          (completedLessons / COURSE_DATA.lessons.length) * 100
        );
      }

      function getCompletedLessonsCount() {
        return Object.values(courseProgress).filter(
          (lesson) => lesson.completed
        ).length;
      }

      function updateProgressDisplay() {
        const completedCount = getCompletedLessonsCount();
        const progressPercent = calculateOverallProgress();

        // Update UI elements
        const elements = {
          completedLessons: completedCount,
          courseProgressPercent: `${progressPercent}%`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });

        // Update progress bar
        const progressBar = document.getElementById("courseProgressFill");
        if (progressBar) progressBar.style.width = `${progressPercent}%`;
      }

      // =====================================================
      // LESSON MANAGEMENT
      // =====================================================
      function loadLesson(index) {
        if (index < 0 || index >= COURSE_DATA.lessons.length) return;

        const lesson = COURSE_DATA.lessons[index];
        currentLessonIndex = index;

        // Mark lesson as started and track activity
        if (!courseProgress[lesson.id]) {
          courseProgress[lesson.id] = {
            started: true,
            completed: false,
            startedAt: new Date().toISOString(),
            timeSpent: 0,
          };

          courseSession.lessonsStarted++;
          saveProgress();

          // Log lesson start
          logUserActivity("lesson_start", {
            lesson_id: lesson.id,
            lesson_title: lesson.title,
            lesson_index: index,
          });
        }

        // Update lesson start time for time tracking
        courseProgress[lesson.id].currentSessionStart = new Date();

        // Update sidebar and navigation
        renderSidebar();
        updateNavigationButtons();

        // Update header info
        updateLessonHeader(lesson, index);

        // Render lesson content
        renderLessonContent(lesson);

        // Smooth scroll and animations
        window.scrollTo({ top: 0, behavior: "smooth" });
        document.getElementById("contentBody").scrollTop = 0;

        const contentBody = document.getElementById("contentBody");
        contentBody.classList.add("fade-in");
        setTimeout(() => contentBody.classList.remove("fade-in"), 500);

        // Check lesson-based achievements
        checkLessonAchievements(index + 1);
      }

      function updateLessonHeader(lesson, index) {
        const elements = {
          currentLessonNumber: index + 1,
          currentLessonTitle: lesson.title,
          navInfo: `Lesson ${index + 1} of ${COURSE_DATA.lessons.length}`,
        };

        Object.entries(elements).forEach(([id, value]) => {
          const element = document.getElementById(id);
          if (element) element.textContent = value;
        });
      }

      function renderSidebar() {
        const lessonNav = document.getElementById("lessonNav");
        if (!lessonNav) return;

        lessonNav.innerHTML = "";

        COURSE_DATA.lessons.forEach((lesson, index) => {
          const lessonItem = document.createElement("div");
          lessonItem.className = "lesson-item";

          // Determine lesson status
          const lessonProgress = courseProgress[lesson.id];
          const isCompleted = lessonProgress?.completed || false;
          const isInProgress = lessonProgress?.started || false;
          const isLocked = !isCompleted && !canAccessLesson(index);
          const isActive = index === currentLessonIndex;

          // Apply status classes
          if (isCompleted) lessonItem.classList.add("completed");
          if (isLocked) lessonItem.classList.add("locked");
          if (isActive) lessonItem.classList.add("active");

          // Determine status display
          let statusClass = "not-started";
          let statusIcon = index + 1;

          if (isCompleted) {
            statusClass = "completed";
            statusIcon = "✓";
          } else if (isInProgress) {
            statusClass = "in-progress";
            statusIcon = "◐";
          }

          // Create lesson item HTML
          lessonItem.innerHTML = `
            <div class="lesson-status ${statusClass}">${statusIcon}</div>
            <div class="lesson-info">
                <div class="lesson-title">${lesson.title}</div>
                <div class="lesson-meta">
                    ${
                      isCompleted
                        ? "Completed"
                        : isInProgress
                        ? "In Progress"
                        : isLocked
                        ? "Locked"
                        : "Not Started"
                    }
                </div>
            </div>
            <div class="lesson-duration">${lesson.duration}</div>
        `;

          // Add click handler if not locked
          if (!isLocked) {
            lessonItem.addEventListener("click", () => {
              if (index !== currentLessonIndex) {
                // Track lesson time before switching
                trackLessonTime();

                currentLessonIndex = index;
                loadLesson(index);
                closeSidebar();
              }
            });
          }

          lessonNav.appendChild(lessonItem);
        });
      }

      function canAccessLesson(index) {
        if (index === 0) return true; // First lesson always accessible

        // Can access if previous lesson is completed
        const previousLessonId = COURSE_DATA.lessons[index - 1].id;
        return courseProgress[previousLessonId]?.completed || false;
      }

      function trackLessonTime() {
        const currentLesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonProgress = courseProgress[currentLesson.id];

        if (lessonProgress?.currentSessionStart) {
          const sessionTime = Math.floor(
            (new Date() - new Date(lessonProgress.currentSessionStart)) /
              1000 /
              60
          );
          lessonProgress.timeSpent =
            (lessonProgress.timeSpent || 0) + sessionTime;
          delete lessonProgress.currentSessionStart;
        }
      }

      // =====================================================
      // LESSON CONTENT RENDERING
      // =====================================================
      function renderLessonContent(lesson) {
        const contentContainer = document.getElementById("lessonContent");
        if (!contentContainer) return;

        let contentHTML = `
        <div class="content-section">
            <h2>Learning Objectives</h2>
            <ul>
                ${lesson.objectives.map((obj) => `<li>${obj}</li>`).join("")}
            </ul>
        </div>
        
        <div class="content-section">
            <h2>Overview</h2>
            <p>${lesson.content.overview}</p>
        </div>
    `;

        // Render content sections
        lesson.content.sections.forEach((section) => {
          contentHTML += `
            <div class="content-section">
                <h2>${section.title}</h2>
                ${section.content}
                ${
                  section.image
                    ? `<img src="${section.image}" alt="${section.title}" class="content-image" loading="lazy">`
                    : ""
                }
            </div>
        `;
        });

        // Render code examples
        if (
          lesson.content.codeExamples &&
          lesson.content.codeExamples.length > 0
        ) {
          contentHTML += `<div class="content-section"><h2>Code Examples</h2></div>`;

          lesson.content.codeExamples.forEach((example, index) => {
            const codeId = `code-${lesson.id}-${index}`;
            contentHTML += `
                <div class="code-section">
                    <div class="code-header">
                        <span class="code-title">${example.title}</span>
                        <button class="copy-btn" onclick="copyCode('${codeId}')">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                    </div>
                    <pre class="code-block"><code id="${codeId}" class="language-${
              example.language
            }">${escapeHtml(example.code)}</code></pre>
                </div>
            `;
          });
        }

        // Render quiz
        contentHTML += renderQuiz(lesson.quiz);

        contentContainer.innerHTML = contentHTML;

        // Highlight code syntax if Prism is available
        setTimeout(() => {
          if (window.Prism) {
            Prism.highlightAll();
          }
        }, 100);
      }

      // =====================================================
      // QUIZ SYSTEM
      // =====================================================
      function renderQuiz(quiz) {
        const currentLessonProgress =
          courseProgress[COURSE_DATA.lessons[currentLessonIndex].id];
        const isCompleted = currentLessonProgress?.completed || false;

        let quizHTML = `
        <div class="quiz-section" id="quizSection">
            <div class="quiz-header">
                <h2 class="quiz-title">
                    <i class="fas fa-clipboard-check"></i>
                    Knowledge Check
                </h2>
                <p class="quiz-info">
                    Complete this quiz with ${quiz.passingScore}% or higher to unlock the next lesson.
                </p>
            </div>
    `;

        if (isCompleted) {
          const savedScore = currentLessonProgress.quizScore || 0;
          quizHTML += `
            <div class="quiz-results show">
                <div class="quiz-score pass">${savedScore}%</div>
                <div class="quiz-message">
                    <strong>Lesson Completed!</strong><br>
                    You've successfully passed this lesson's quiz.
                </div>
            </div>
        `;
        } else {
          // Render quiz questions
          quiz.questions.forEach((question, qIndex) => {
            quizHTML += `
                <div class="quiz-question ${
                  qIndex === 0 ? "active" : ""
                }" data-question="${qIndex}">
                    <div class="question-header">
                        <span class="question-number">Question ${
                          qIndex + 1
                        }</span>
                        <span class="question-progress">${qIndex + 1}/${
              quiz.questions.length
            }</span>
                    </div>
                    <div class="question-text">${question.question}</div>
                    <div class="question-options">
                        ${question.options
                          .map(
                            (option, oIndex) => `
                            <div class="option" data-option="${oIndex}" onclick="selectOption(${qIndex}, ${oIndex})">
                                <span class="option-letter">${String.fromCharCode(
                                  65 + oIndex
                                )}</span>
                                <span class="option-text">${option}</span>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                </div>
            `;
          });

          quizHTML += `
            <div class="quiz-controls">
                <button class="btn btn-secondary" id="prevQuestionBtn" onclick="previousQuestion()" disabled>
                    <i class="fas fa-chevron-left"></i>
                    Previous
                </button>
                <div>
                    <button class="btn btn-secondary" id="nextQuestionBtn" onclick="nextQuestion()" disabled>
                        Next
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn btn-primary" id="submitQuizBtn" onclick="submitQuiz()" style="display: none;">
                        <i class="fas fa-check"></i>
                        Submit Quiz
                    </button>
                </div>
            </div>

            <div class="quiz-results" id="quizResults">
                <div class="quiz-score" id="quizScore">0%</div>
                <div class="quiz-message" id="quizMessage"></div>
                <div class="quiz-actions">
                    <button class="btn btn-primary" id="continueBtn" onclick="completeLesson()" style="display: none;">
                        <i class="fas fa-arrow-right"></i>
                        Continue to Next Lesson
                    </button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">
                        <i class="fas fa-redo"></i>
                        Retake Quiz
                    </button>
                </div>
            </div>
        `;
        }

        quizHTML += "</div>";
        return quizHTML;
      }

      // Quiz interaction functions
      function selectOption(questionIndex, optionIndex) {
        // Clear previous selections
        document
          .querySelectorAll(`[data-question="${questionIndex}"] .option`)
          .forEach((opt) => {
            opt.classList.remove("selected");
          });

        // Select current option
        const selectedOption = document.querySelector(
          `[data-question="${questionIndex}"] [data-option="${optionIndex}"]`
        );
        selectedOption.classList.add("selected");

        // Store answer
        quizState.answers[questionIndex] = optionIndex;

        // Update navigation
        const isLastQuestion =
          questionIndex ===
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length - 1;
        if (isLastQuestion) {
          document.getElementById("submitQuizBtn").style.display =
            "inline-flex";
          document.getElementById("nextQuestionBtn").style.display = "none";
        } else {
          document.getElementById("nextQuestionBtn").disabled = false;
        }
      }

      function nextQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const nextQuestionEl = currentQuestionEl.nextElementSibling;

        if (
          nextQuestionEl &&
          nextQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          nextQuestionEl.classList.add("active");
          quizState.currentQuestion++;
          updateQuizNavigation();
        }
      }

      function previousQuestion() {
        const currentQuestionEl = document.querySelector(
          ".quiz-question.active"
        );
        const prevQuestionEl = currentQuestionEl.previousElementSibling;

        if (
          prevQuestionEl &&
          prevQuestionEl.classList.contains("quiz-question")
        ) {
          currentQuestionEl.classList.remove("active");
          prevQuestionEl.classList.add("active");
          quizState.currentQuestion--;
          updateQuizNavigation();
        }
      }

      function updateQuizNavigation() {
        const totalQuestions =
          COURSE_DATA.lessons[currentLessonIndex].quiz.questions.length;
        const prevBtn = document.getElementById("prevQuestionBtn");
        const nextBtn = document.getElementById("nextQuestionBtn");
        const submitBtn = document.getElementById("submitQuizBtn");

        prevBtn.disabled = quizState.currentQuestion === 0;

        const hasAnswer =
          quizState.answers[quizState.currentQuestion] !== undefined;
        const isLastQuestion = quizState.currentQuestion === totalQuestions - 1;

        if (isLastQuestion) {
          nextBtn.style.display = "none";
          submitBtn.style.display = hasAnswer ? "inline-flex" : "none";
        } else {
          nextBtn.style.display = "inline-flex";
          nextBtn.disabled = !hasAnswer;
          submitBtn.style.display = "none";
        }
      }

      async function submitQuiz() {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const quiz = lesson.quiz;
        let correctAnswers = 0;

        // Hide questions and controls
        document
          .querySelectorAll(".quiz-question")
          .forEach((q) => (q.style.display = "none"));
        document.querySelector(".quiz-controls").style.display = "none";

        // Calculate score and highlight answers
        quiz.questions.forEach((question, index) => {
          const userAnswer = quizState.answers[index];
          const correctAnswer = question.correct;
          const isCorrect = userAnswer === correctAnswer;

          if (isCorrect) correctAnswers++;

          // Highlight answers
          const questionEl = document.querySelector(
            `[data-question="${index}"]`
          );
          const options = questionEl.querySelectorAll(".option");

          options[correctAnswer].classList.add("correct");
          if (userAnswer !== correctAnswer && userAnswer !== undefined) {
            options[userAnswer].classList.add("incorrect");
          }
        });

        const score = Math.round(
          (correctAnswers / quiz.questions.length) * 100
        );
        const passed = score >= quiz.passingScore;

        // Update quiz results UI
        const quizScore = document.getElementById("quizScore");
        const quizMessage = document.getElementById("quizMessage");
        const quizActions = document.querySelector(".quiz-actions");

        quizScore.textContent = `${score}%`;
        quizScore.className = `quiz-score ${passed ? "pass" : "fail"}`;

        if (passed) {
          quizMessage.innerHTML = `
            <strong>Congratulations!</strong><br>
            You passed with ${score}%. You can now proceed to the next lesson.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-primary" onclick="completeLesson()">
                <i class="fas fa-arrow-right"></i>
                Continue to Next Lesson
            </button>
        `;

          // Mark lesson as completed
          await markLessonComplete(score);
        } else {
          quizMessage.innerHTML = `
            <strong>Not quite there yet.</strong><br>
            You scored ${score}%. You need ${quiz.passingScore}% to pass. Review the material and try again.
        `;

          quizActions.innerHTML = `
            <button class="btn btn-secondary" onclick="retakeQuiz()">
                <i class="fas fa-redo"></i>
                Retake Quiz
            </button>
        `;
        }

        document.getElementById("quizResults").classList.add("show");

        // Log quiz completion
        logUserActivity("quiz_completed", {
          lesson_id: lesson.id,
          lesson_title: lesson.title,
          score: score,
          passed: passed,
          attempts: (courseProgress[lesson.id]?.quizAttempts || 0) + 1,
        });

        // Scroll to results
        document
          .getElementById("quizResults")
          .scrollIntoView({ behavior: "smooth" });
      }

      function retakeQuiz() {
        // Reset quiz state
        quizState = {
          currentQuestion: 0,
          answers: [],
          score: 0,
          isComplete: false,
        };

        // Track quiz retry
        const lessonId = COURSE_DATA.lessons[currentLessonIndex].id;
        if (!courseProgress[lessonId]) courseProgress[lessonId] = {};
        courseProgress[lessonId].quizAttempts =
          (courseProgress[lessonId].quizAttempts || 0) + 1;

        // Reload lesson content
        loadLesson(currentLessonIndex);

        // Scroll to quiz
        setTimeout(() => {
          document
            .getElementById("quizSection")
            .scrollIntoView({ behavior: "smooth" });
        }, 500);
      }

      async function markLessonComplete(score) {
        const lesson = COURSE_DATA.lessons[currentLessonIndex];
        const lessonId = lesson.id;

        // Track lesson completion time
        trackLessonTime();

        // Update lesson progress
        courseProgress[lessonId] = {
          ...courseProgress[lessonId],
          completed: true,
          quizScore: score,
          completedAt: new Date().toISOString(),
          finalScore: score,
        };

        // Update session tracking
        courseSession.lessonsCompleted++;

        // Save progress to database
        await saveProgress();

        // Update UI
        renderSidebar();
        updateNavigationButtons();

        // Check various achievements
        await checkLessonCompletionAchievements();
        await checkPerfectScoreAchievements(score);
        await checkStudyTimeAchievements();

        // Log lesson completion
        logUserActivity("lesson_completed", {
          lesson_id: lessonId,
          lesson_title: lesson.title,
          final_score: score,
          time_spent: courseProgress[lessonId].timeSpent || 0,
          lesson_number: currentLessonIndex + 1,
        });

        showToast("Lesson completed successfully!", "success");
      }

      async function completeLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          // Move to next lesson
          currentLessonIndex++;
          loadLesson(currentLessonIndex);
        } else {
          // Course completion
          await completeCourse();
        }
      }

      async function completeCourse() {
        try {
          const completionTime = courseSession.totalStudyTime;

          // Update course progress to 100% completed
          await supabase
            .from("course_progress")
            .update({
              progress: 100,
              completed_at: new Date().toISOString(),
              completion_time_minutes: completionTime,
            })
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Award course completion achievements
          await checkAndUnlockAchievement("course_completion_1");
          await checkSpeedCompletionAchievements(completionTime);
          await checkCourseStreakAchievements();

          // Update user stats
          await updateUserStats();

          // Show completion message
          showToast(
            "Congratulations! Course completed successfully!",
            "certificate"
          );

          // Log course completion
          logUserActivity("course_completed", {
            course_id: COURSE_DATA.id,
            course_title: COURSE_DATA.title,
            completion_time_minutes: completionTime,
            total_lessons: COURSE_DATA.lessons.length,
            average_quiz_score: calculateAverageQuizScore(),
          });

          // Redirect to dashboard after delay
          setTimeout(() => {
            window.location.href = "/dashboard.html";
          }, 3000);
        } catch (error) {
          console.error("Error completing course:", error);
          showToast("Error marking course as complete", "error");
        }
      }

      // =====================================================
      // ACHIEVEMENT INTEGRATION SYSTEM
      // =====================================================
      async function checkAndUnlockAchievement(
        achievementId,
        skipNotification = false
      ) {
        try {
          // Prevent duplicate checks
          const cacheKey = `achievement_${achievementId}_${currentUser.id}`;
          if (sessionStorage.getItem(cacheKey)) return false;

          // Check if already unlocked
          const { data: existing, error } = await supabase
            .from("user_achievements")
            .select("id")
            .eq("user_id", currentUser.id)
            .eq("achievement_id", achievementId)
            .single();

          if (existing) {
            sessionStorage.setItem(cacheKey, "true");
            return false;
          }

          // Award achievement
          const achievementData = {
            user_id: currentUser.id,
            achievement_id: achievementId,
            unlocked_at: new Date().toISOString(),
            points_awarded: getAchievementPoints(achievementId),
            context: "course_system",
          };

          const { data, error: insertError } = await supabase
            .from("user_achievements")
            .insert([achievementData])
            .select()
            .single();

          if (insertError) {
            if (insertError.code === "23505") return false; // Already exists
            throw insertError;
          }

          // Update user points
         await supabase.rpc('increment_user_stats', {
  user_id_param: currentUser.id,
  points_to_add: achievementData.points_awarded,
  achievements_to_add: 1
});

          // Cache and queue notification
          sessionStorage.setItem(cacheKey, "true");

          if (!skipNotification) {
            queueAchievementNotification({
              id: achievementId,
              name: getAchievementName(achievementId),
              description: getAchievementDescription(achievementId),
              points: achievementData.points_awarded,
              rarity: getAchievementRarity(achievementId),
              icon: getAchievementIcon(achievementId),
            });
          }

          return true;
        } catch (error) {
          console.error("Error unlocking achievement:", error);
          return false;
        }
      }

      // Helper functions for achievement data (replace with your actual achievement definitions)
      function getAchievementPoints(id) {
        const pointsMap = {
          first_course_start: 75,
          first_lesson: 100,
          course_completion_1: 500,
          perfect_score: 250,
          speed_demon: 750,
          marathon_learner: 500,
          night_owl: 200,
          early_bird: 200,
          weekend_warrior: 150,
          // Add more as needed
        };
        return pointsMap[id] || 100;
      }

      function getAchievementName(id) {
        const nameMap = {
          first_course_start: "Learning Initiated",
          first_lesson: "First Steps",
          course_completion_1: "Course Conqueror",
          perfect_score: "Perfectionist",
          speed_demon: "Speed Demon",
          // Add more as needed
        };
        return nameMap[id] || "Achievement Unlocked";
      }

      function getAchievementDescription(id) {
        const descMap = {
          first_course_start: "Start your first cybersecurity course",
          first_lesson: "Complete your first lesson",
          course_completion_1: "Complete your first course",
          perfect_score: "Score 100% on any quiz",
          speed_demon: "Complete a course in under 2 hours",
          // Add more as needed
        };
        return descMap[id] || "Achievement description";
      }

      function getAchievementRarity(id) {
        const rarityMap = {
          first_course_start: "common",
          first_lesson: "bronze",
          course_completion_1: "silver",
          perfect_score: "gold",
          speed_demon: "legendary",
          // Add more as needed
        };
        return rarityMap[id] || "common";
      }

      function getAchievementIcon(id) {
        const iconMap = {
          first_course_start: "fas fa-play",
          first_lesson: "fas fa-baby",
          course_completion_1: "fas fa-trophy",
          perfect_score: "fas fa-star",
          speed_demon: "fas fa-rocket",
          // Add more as needed
        };
        return iconMap[id] || "fas fa-award";
      }

      async function checkLessonAchievements(lessonNumber) {
        if (lessonNumber === 1) {
          await checkAndUnlockAchievement("first_lesson");
        }

        // Check if user has completed multiple lessons in one day
        const today = new Date().toISOString().split("T")[0];
        const todayCompletions = Object.values(courseProgress).filter(
          (p) => p.completed && p.completedAt?.startsWith(today)
        ).length;

        if (todayCompletions >= 3) {
          await checkAndUnlockAchievement("lesson_marathon");
        }
      }

      async function checkLessonCompletionAchievements() {
        const completedCount = getCompletedLessonsCount();

        // Lesson-based achievements
        const lessonMilestones = [1, 5, 10, 25, 50, 100];
        for (const milestone of lessonMilestones) {
          if (completedCount >= milestone) {
            await checkAndUnlockAchievement(`lessons_${milestone}`);
          }
        }

        // Course completion achievements
        if (completedCount === COURSE_DATA.lessons.length) {
          await checkAndUnlockAchievement("course_completion_1");

          // Check for additional course completion achievements
          const { data: allCourses } = await supabase
            .from("course_progress")
            .select("course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100);

          const totalCompleted = allCourses?.length || 0;

          const courseMilestones = [1, 5, 10, 25];
          for (const milestone of courseMilestones) {
            if (totalCompleted >= milestone) {
              await checkAndUnlockAchievement(`course_completion_${milestone}`);
            }
          }
        }
      }

      async function checkPerfectScoreAchievements(score) {
        if (score === 100) {
          await checkAndUnlockAchievement("perfect_score");

          // Check for consecutive perfect scores
          const recentScores = Object.values(courseProgress)
            .filter((p) => p.completed && p.quizScore)
            .slice(-5) // Last 5 completed
            .map((p) => p.quizScore);

          if (
            recentScores.length >= 3 &&
            recentScores.every((s) => s === 100)
          ) {
            await checkAndUnlockAchievement("perfectionist_streak");
          }
        }
      }

      async function checkSpeedCompletionAchievements(completionTime) {
        // Speed demon: Complete course in under 2 hours (120 minutes)
        if (completionTime <= 120) {
          await checkAndUnlockAchievement("speed_demon");
        }

        // Quick learner: Complete course in under 4 hours (240 minutes)
        if (completionTime <= 240) {
          await checkAndUnlockAchievement("quick_learner");
        }
      }

      async function checkStudyTimeAchievements() {
        const totalTime = courseSession.totalStudyTime;

        // Marathon learner: Study for 8+ hours in a course session
        if (totalTime >= 480) {
          // 8 hours
          await checkAndUnlockAchievement("marathon_learner");
        }

        // Dedicated learner: Study for 4+ hours
        if (totalTime >= 240) {
          // 4 hours
          await checkAndUnlockAchievement("dedicated_learner");
        }
      }

      async function checkCourseStreakAchievements() {
        try {
          // Check for consecutive course completions
          const { data: recentCourses, error } = await supabase
            .from("course_progress")
            .select("completed_at, course_id")
            .eq("user_id", currentUser.id)
            .eq("progress", 100)
            .order("completed_at", { ascending: false })
            .limit(10);

          if (error || !recentCourses) return;

          // Check for courses completed on consecutive days
          let consecutiveDays = 1;
          for (let i = 1; i < recentCourses.length; i++) {
            const prevDate = new Date(
              recentCourses[i - 1].completed_at
            ).toDateString();
            const currentDate = new Date(
              recentCourses[i].completed_at
            ).toDateString();
            const dayDiff =
              Math.abs(new Date(prevDate) - new Date(currentDate)) /
              (1000 * 60 * 60 * 24);

            if (dayDiff <= 1) {
              consecutiveDays++;
            } else {
              break;
            }
          }

          if (consecutiveDays >= 3) {
            await checkAndUnlockAchievement("learning_streak");
          }
        } catch (error) {
          console.error("Error checking course streak achievements:", error);
        }
      }

      // =====================================================
      // TIME-BASED ACHIEVEMENTS
      // =====================================================
      async function checkTimeBasedAchievements(timestamp) {
        const hour = timestamp.getHours();
        const dayOfWeek = timestamp.getDay();

        // Night owl (after midnight, before 6 AM)
        if (hour >= 0 && hour < 6) {
          await incrementTimeBasedCounter("midnight_sessions", "night_owl");
        }

        // Early bird (4 AM to 6 AM)
        if (hour >= 4 && hour < 6) {
          await incrementTimeBasedCounter("early_sessions", "early_bird");
        }

        // Weekend warrior (Saturday = 6, Sunday = 0)
        if (dayOfWeek === 0 || dayOfWeek === 6) {
          await incrementTimeBasedCounter(
            "weekend_sessions",
            "weekend_warrior"
          );
        }
      }

      async function incrementTimeBasedCounter(counterType, achievementId) {
        try {
          const dateStr = new Date().toISOString().split("T")[0];
          const cacheKey = `${counterType}_${currentUser.id}_${dateStr}`;

          // Prevent multiple increments per day
          if (sessionStorage.getItem(cacheKey)) return;

          // Update counter
         await supabase.rpc('increment_profile_counter', {
  user_id_param: currentUser.id,
  counter_field: counterType,
  increment_value: 1
});

          // Cache to prevent double counting
          sessionStorage.setItem(cacheKey, "true");

          // Check related achievement
          if (achievementId) {
            await checkAndUnlockAchievement(achievementId, true);
          }
        } catch (error) {
          console.error(`Error incrementing ${counterType}:`, error);
        }
      }

      async function checkDailyStreak() {
        try {
          const { data: profile, error } = await supabase
            .from("profiles")
            .select("last_activity, current_streak, last_streak_date")
            .eq("id", currentUser.id)
            .single();

          if (error) throw error;

          const now = new Date();
          const today = now.toDateString();
          const lastActivity = profile.last_activity
            ? new Date(profile.last_activity)
            : null;
          const lastStreakDate = profile.last_streak_date
            ? new Date(profile.last_streak_date).toDateString()
            : null;

          let newStreak = profile.current_streak || 0;
          let shouldUpdateStreak = false;

          if (!lastActivity) {
            // First time user
            newStreak = 1;
            shouldUpdateStreak = true;
          } else {
            const daysSinceLastActivity = Math.floor(
              (now - lastActivity) / (1000 * 60 * 60 * 24)
            );

            if (lastStreakDate === today) {
              // Already counted today's streak
              return newStreak;
            } else if (
              daysSinceLastActivity === 1 ||
              (daysSinceLastActivity === 0 && lastStreakDate !== today)
            ) {
              // Consecutive day or same day but not counted yet
              newStreak += 1;
              shouldUpdateStreak = true;
            } else if (daysSinceLastActivity > 1) {
              // Streak broken
              newStreak = 1;
              shouldUpdateStreak = true;
            }
          }

          if (shouldUpdateStreak) {
            await supabase
              .from("profiles")
              .update({
                current_streak: newStreak,
                last_activity: now.toISOString(),
                last_streak_date: now.toISOString(),
              })
              .eq("id", currentUser.id);

            userStats.current_streak = newStreak;

            showToast(`Daily streak: ${newStreak} days!`, "success");
            await checkStreakAchievements(newStreak);
          }

          return newStreak;
        } catch (error) {
          console.error("Error checking daily streak:", error);
          return 0;
        }
      }

      async function checkStreakAchievements(currentStreak) {
        const streakMilestones = [3, 7, 14, 30, 100, 365];

        for (const milestone of streakMilestones) {
          if (currentStreak >= milestone) {
            await checkAndUnlockAchievement(`streak_${milestone}`);
          }
        }
      }

      // =====================================================
      // USER ACTIVITY LOGGING
      // =====================================================
      async function logUserActivity(activityType, metadata = {}) {
        try {
          const now = new Date();

          const activityData = {
            user_id: currentUser.id,
            activity_type: activityType,
            timestamp: now.toISOString(),
            course_id: COURSE_DATA.id,
            lesson_index: currentLessonIndex,
            session_duration: courseSession.totalStudyTime,
            metadata: JSON.stringify(metadata),
            created_at: now.toISOString(),
          };

          // Try to log to activities table
          const { error } = await supabase
            .from("user_activities")
            .insert([activityData]);

          if (error && error.code !== "42P01") {
            console.warn("Activity logging failed:", error.message);
          }

          // Always update last activity in profile
          await supabase
            .from("profiles")
            .update({ last_activity: now.toISOString() })
            .eq("id", currentUser.id);
        } catch (error) {
          console.error("Error logging user activity:", error);
        }
      }

      // =====================================================
      // NAVIGATION SYSTEM
      // =====================================================
      function updateNavigationButtons() {
        const prevBtn = document.getElementById("prevLessonBtn");
        const nextBtn = document.getElementById("nextLessonBtn");

        if (!prevBtn || !nextBtn) return;

        // Previous button
        prevBtn.disabled = currentLessonIndex === 0;

        // Next button logic
        const isLastLesson =
          currentLessonIndex === COURSE_DATA.lessons.length - 1;
        const canGoNext =
          currentLessonIndex < COURSE_DATA.lessons.length - 1 &&
          canAccessLesson(currentLessonIndex + 1);

        if (isLastLesson) {
          const isCurrentCompleted =
            courseProgress[COURSE_DATA.lessons[currentLessonIndex].id]
              ?.completed;
          nextBtn.disabled = !isCurrentCompleted;
          nextBtn.innerHTML = '<i class="fas fa-trophy"></i> Complete Course';
        } else {
          nextBtn.disabled = !canGoNext;
          nextBtn.innerHTML = 'Next <i class="fas fa-chevron-right"></i>';
        }
      }

      // Navigation button event handlers
      function goToPreviousLesson() {
        if (currentLessonIndex > 0) {
          trackLessonTime(); // Track time spent on current lesson
          currentLessonIndex--;
          loadLesson(currentLessonIndex);
        }
      }

      function goToNextLesson() {
        if (currentLessonIndex < COURSE_DATA.lessons.length - 1) {
          const canGoNext = canAccessLesson(currentLessonIndex + 1);
          if (canGoNext) {
            trackLessonTime();
            currentLessonIndex++;
            loadLesson(currentLessonIndex);
          } else {
            showToast("Complete the current lesson quiz to proceed", "warning");
          }
        } else {
          // Complete course
          completeCourse();
        }
      }

      // =====================================================
      // SIDEBAR FUNCTIONS
      // =====================================================
      function toggleSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.toggle("open");
        if (overlay) overlay.classList.toggle("active");
      }

      function closeSidebar() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("sidebarOverlay");

        if (sidebar) sidebar.classList.remove("open");
        if (overlay) overlay.classList.remove("active");
      }

      // =====================================================
      // ACHIEVEMENT NOTIFICATION SYSTEM
      // =====================================================
      function queueAchievementNotification(achievement) {
        notificationQueue.push(achievement);
        processNotificationQueue();
      }

      function processNotificationQueue() {
        if (isShowingNotification || notificationQueue.length === 0) return;

        isShowingNotification = true;
        const achievement = notificationQueue.shift();
        showAchievementNotification(achievement);

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          isShowingNotification = false;
          processNotificationQueue();
        }, duration + 500);
      }

      function showAchievementNotification(achievement) {
        const notification = document.getElementById("achievementNotification");
        if (!notification) return;

        const icon = document.getElementById("notificationIcon");
        const title = document.getElementById("notificationTitle");
        const description = document.getElementById("notificationDescription");
        const points = document.getElementById("notificationPoints");

        if (icon) {
          icon.innerHTML = `<i class="${achievement.icon}"></i>`;
          icon.className = `notification-icon ${achievement.rarity}`;
        }
        if (title) title.textContent = achievement.name;
        if (description) description.textContent = achievement.description;
        if (points) points.textContent = `+${achievement.points} Points`;

        notification.className = `achievement-notification ${achievement.rarity}`;
        notification.classList.add("show");

        const duration =
          achievement.rarity === "mythic"
            ? 8000
            : achievement.rarity === "legendary"
            ? 7000
            : 6000;

        setTimeout(() => {
          notification.classList.remove("show");
        }, duration);
      }

      // =====================================================
      // UTILITY FUNCTIONS
      // =====================================================
      function calculateAverageQuizScore() {
        const scores = Object.values(courseProgress)
          .filter((p) => p.completed && p.quizScore)
          .map((p) => p.quizScore);

        if (scores.length === 0) return 0;
        return Math.round(
          scores.reduce((sum, score) => sum + score, 0) / scores.length
        );
      }

      async function resetProgress() {
        if (
          !confirm(
            "Are you sure you want to reset your progress? This action cannot be undone."
          )
        ) {
          return;
        }

        try {
          // Track lesson time before reset
          trackLessonTime();

          // Reset local state
          courseProgress = {};
          currentLessonIndex = 0;
          courseSession = {
            startTime: new Date(),
            totalStudyTime: 0,
            lessonsStarted: 0,
            lessonsCompleted: 0,
            pageLoadTime: new Date(),
            interactionCount: 0,
            lastActivityTime: new Date(),
          };

          // Delete from database
          await supabase
            .from("course_progress")
            .delete()
            .eq("user_id", currentUser.id)
            .eq("course_id", COURSE_DATA.id);

          // Log reset activity
          logUserActivity("progress_reset", {
            course_id: COURSE_DATA.id,
            reset_reason: "manual",
          });

          // Reinitialize
          await saveProgress();
          renderSidebar();
          loadLesson(0);

          showToast("Progress reset successfully", "success");
        } catch (error) {
          console.error("Error resetting progress:", error);
          showToast("Failed to reset progress", "error");
        }
      }

      function copyCode(codeId) {
        const codeElement = document.getElementById(codeId);
        if (!codeElement) return;

        const text = codeElement.textContent;

        navigator.clipboard
          .writeText(text)
          .then(() => {
            showToast("Code copied to clipboard!", "success");

            // Track code copy for achievements
            logUserActivity("code_copied", {
              code_section: codeId,
              lesson_id: COURSE_DATA.lessons[currentLessonIndex].id,
            });
          })
          .catch((err) => {
            console.error("Failed to copy code:", err);
            showToast("Failed to copy code", "error");

            // Fallback for older browsers
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
              document.execCommand("copy");
              showToast("Code copied to clipboard!", "success");
            } catch (fallbackError) {
              showToast(
                "Copy failed - please select and copy manually",
                "error"
              );
            }
            document.body.removeChild(textArea);
          });
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // =====================================================
      // UI FEEDBACK SYSTEMS
      // =====================================================
      function showToast(message, type = "success") {
        const toast = document.getElementById("toast");
        const messageEl = document.getElementById("toastMessage");

        if (!toast || !messageEl) {
          console.log(`Toast: ${message} (${type})`);
          return;
        }

        messageEl.textContent = message;
        toast.className = `toast ${type} show`;

        setTimeout(() => {
          toast.classList.remove("show");
        }, 4000);
      }

      function showLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) loadingScreen.classList.remove("hidden");
      }

      function hideLoadingScreen() {
        const loadingScreen = document.getElementById("loadingScreen");
        if (loadingScreen) {
          setTimeout(() => {
            loadingScreen.classList.add("hidden");
          }, 1000);
        }
      }

      // =====================================================
      // MUSIC PLAYER INTEGRATION
      // =====================================================
      function initMusicPlayer() {
        const btnText = document.getElementById("music-button-text");
        const icon = document.getElementById("music-icon");
        const dropdown = document.getElementById("music-dropdown-content");

        if (!btnText || !icon || !dropdown) return;

        function setUI(state) {
          btnText.textContent =
            state === "Playing" ? "PAUSE MUSIC" : "STUDY MUSIC";
          icon.className =
            state === "Playing"
              ? "fa-solid fa-circle-pause"
              : "fa-solid fa-music";
        }

        // Load saved music state
        const savedSrc = localStorage.getItem("cybersec_music_src");
        const savedTime = parseFloat(
          localStorage.getItem("cybersec_music_time") || 0
        );

        if (savedSrc) {
          audioPlayer.src = savedSrc;
          audioPlayer.currentTime = savedTime;
          audioPlayer
            .play()
            .then(() => setUI("Playing"))
            .catch(() => setUI("Stopped"));
        }

        // Music button click handler
        document
          .getElementById("music-dropdown")
          .querySelector("button")
          .addEventListener("click", (e) => {
            e.stopPropagation();
            dropdown.style.display =
              dropdown.style.display === "block" ? "none" : "block";

            if (audioPlayer.src && !audioPlayer.paused) {
              audioPlayer.pause();
              setUI("Stopped");
            } else if (audioPlayer.src) {
              audioPlayer.play().then(() => setUI("Playing"));
            }
          });

        // Music selection handlers
        dropdown.querySelectorAll("a[data-src]").forEach((link) => {
          link.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.src = link.dataset.src;
            audioPlayer.play().then(() => setUI("Playing"));
            localStorage.setItem("cybersec_music_src", link.dataset.src);
            dropdown.style.display = "none";
          });
        });

        // Stop music handler
        const stopLink = document.getElementById("stop-music-link");
        if (stopLink) {
          stopLink.addEventListener("click", (e) => {
            e.preventDefault();
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
            audioPlayer.removeAttribute("src");
            setUI("Stopped");
            localStorage.removeItem("cybersec_music_src");
            localStorage.removeItem("cybersec_music_time");
            dropdown.style.display = "none";
          });
        }

        // Save music state before page unload
        window.addEventListener("beforeunload", () => {
          if (!audioPlayer.paused && audioPlayer.src) {
            localStorage.setItem("cybersec_music_src", audioPlayer.src);
            localStorage.setItem(
              "cybersec_music_time",
              audioPlayer.currentTime
            );
          }
        });

        // Close dropdown when clicking outside
        window.addEventListener("click", (e) => {
          if (!e.target.closest("#music-dropdown")) {
            dropdown.style.display = "none";
          }
        });
      }

      // Show initial music indicator
      function addMusicIndicator() {
        const musicBtn = document.querySelector("#music-dropdown");
        if (musicBtn) {
          const indicator = document.createElement("div");
          indicator.className = "music-indicator";
          indicator.innerHTML = `<i class="fa-solid fa-music"></i> Try Study Music!`;

          musicBtn.style.position = "relative";
          musicBtn.appendChild(indicator);

          setTimeout(() => indicator.remove(), 3000);
        }
      }

      // Initialize Event Listeners
      function initializeEventListeners() {
        // Navigation buttons
        document
          .getElementById("prevLessonBtn")
          ?.addEventListener("click", goToPreviousLesson);
        document
          .getElementById("nextLessonBtn")
          ?.addEventListener("click", goToNextLesson);

        // Reset progress button
        document
          .getElementById("resetProgressBtn")
          ?.addEventListener("click", resetProgress);

        // Mobile menu toggle
        document
          .getElementById("menuToggle")
          ?.addEventListener("click", toggleSidebar);
        document
          .getElementById("sidebarOverlay")
          ?.addEventListener("click", closeSidebar);

        // Keyboard shortcuts
        document.addEventListener("keydown", handleKeyboardShortcuts);

        // Window resize handler
        window.addEventListener("resize", handleWindowResize);

        // Content interaction tracking
        document.getElementById("contentBody")?.addEventListener(
          "scroll",
          debounce(() => {
            trackUserInteraction();
          }, 1000)
        );
      }

      // Keyboard Shortcuts
      function handleKeyboardShortcuts(e) {
        if (document.querySelector(".quiz-question.active")) return;

        if (e.key === "ArrowLeft" && e.ctrlKey) {
          e.preventDefault();
          goToPreviousLesson();
        } else if (e.key === "ArrowRight" && e.ctrlKey) {
          e.preventDefault();
          goToNextLesson();
        }
      }

      // Window Resize Handler
      function handleWindowResize() {
        if (window.innerWidth > 768) {
          closeSidebar();
        }
      }

      // Debounce Helper
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // Initialize responsive behavior
      if (window.innerWidth <= 768) {
        document.getElementById("menuToggle").style.display = "inline-flex";
      }

      // Auto-save progress periodically
      setInterval(async () => {
        if (currentUser && Object.keys(courseProgress).length > 0) {
          await saveProgress();
        }
      }, 60000); // Save every minute

      // System initialization logging
      console.log("CyberSec Academy Course System Initialized");
      console.log("Current Course:", COURSE_DATA.title);
      console.log("Total Lessons:", COURSE_DATA.lessons.length);

      // Google OAuth Integration
      const googleBtn = document.querySelector(".btn-google");
      if (googleBtn) {
        googleBtn.addEventListener("click", async () => {
          const { data, error } = await supabase.auth.signInWithOAuth({
            provider: "google",
            options: {
              redirectTo:
                window.location.origin +
                "/courses/complete-incident-response-planning.html",
            },
          });

          if (error) {
            console.error("Google login error:", error.message);
            showToast("Google login failed: " + error.message, "error");
          }
        });
      }

      // Check for existing session
      supabase.auth.getSession().then(({ data }) => {
        if (data.session) {
          console.log("User already logged in:", data.session.user);
          currentUser = data.session.user;
          startCourseSession();
        }
      });

      // Add missing auth modal functions
      function openAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "flex";
        }
      }

      function closeAuthModal() {
        const modal = document.getElementById("authModal");
        if (modal) {
          modal.style.display = "none";
        }
      }

      // Add auth tab switching functionality
      document.getElementById("tabSignIn")?.addEventListener("click", () => {
        document.getElementById("tabSignIn").classList.add("active");
        document.getElementById("tabSignUp").classList.remove("active");
        document.getElementById("signInForm").style.display = "block";
        document.getElementById("signUpForm").style.display = "none";
      });

      document.getElementById("tabSignUp")?.addEventListener("click", () => {
        document.getElementById("tabSignUp").classList.add("active");
        document.getElementById("tabSignIn").classList.remove("active");
        document.getElementById("signUpForm").style.display = "block";
        document.getElementById("signInForm").style.display = "none";
      });

      document
        .getElementById("closeAuthModal")
        ?.addEventListener("click", closeAuthModal);

      // Improved error handling for auth session
      supabase.auth.onAuthStateChange((event, session) => {
        if (event === "SIGNED_IN") {
          currentUser = session.user;
          closeAuthModal();
          startCourseSession();
        } else if (event === "SIGNED_OUT") {
          currentUser = null;
          openAuthModal();
        }
      });

      // Add form submission handlers
      document
        .getElementById("emailSignInForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signInEmail").value;
          const password = document.getElementById("signInPassword").value;

          try {
            const { data, error } = await supabase.auth.signInWithPassword({
              email,
              password,
            });

            if (error) throw error;

            closeAuthModal();
          } catch (error) {
            showToast(error.message, "error");
          }
        });

      document
        .getElementById("emailSignUpForm")
        ?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("signUpEmail").value;
          const password = document.getElementById("signUpPassword").value;
          const name = document.getElementById("signUpName").value;

          try {
            const { data, error } = await supabase.auth.signUp({
              email,
              password,
              options: {
                data: {
                  full_name: name,
                },
              },
            });

            if (error) throw error;

            showToast(
              "Account created successfully! Please check your email.",
              "success"
            );
          } catch (error) {
            showToast(error.message, "error");
          }
        });
    </script>
  </body>
</html>

